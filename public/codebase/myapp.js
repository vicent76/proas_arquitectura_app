!function(e){var t={};function o(i){if(t[i])return t[i].exports;var n=t[i]={i:i,l:!1,exports:{}};return e[i].call(n.exports,n,n.exports,o),n.l=!0,n.exports}o.m=e,o.c=t,o.d=function(e,t,i){o.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:i})},o.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},o.t=function(e,t){if(1&t&&(e=o(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var i=Object.create(null);if(o.r(i),Object.defineProperty(i,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var n in e)o.d(i,n,function(t){return e[t]}.bind(null,n));return i},o.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return o.d(t,"a",t),t},o.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},o.p="/codebase/",o(o.s=47)}([function(e,t,o){"use strict";o.d(t,"a",(function(){return i}));o(1);var i={errorMessageAjax:function(e){var t=e.response;webix.alert({type:"alert-error",title:"ERROR",text:t})},errorMessage:function(e){webix.alert({type:"alert-error",title:"ERROR",text:e})},normalMessage:function(e){webix.alert({title:"INFORMATION",text:e})},errorRestriccion:function(){webix.alert({title:"INFORMATION",text:"Hay registros dependientes de esta entrada. No se puede eliminar."})}}},function(e,t,o){"use strict";o.d(t,"a",(function(){return i}));var i={getConfig:function(){return new Promise((function(e,t){webix.ajax().timeout(1e4).headers({"Content-Type":"application/json"}).get("/config").then((function(t){e(t.json())})).catch((function(e){t(e)}))}))},getConfigMysql:function(){return new Promise((function(e,t){webix.ajax().timeout(1e4).headers({"Content-Type":"application/json"}).get("/config").then((function(t){e(t.json())})).catch((function(e){t(e)}))}))},getVersion:function(){return new Promise((function(e,t){webix.ajax().timeout(1e4).headers({"Content-Type":"application/json"}).get("/version").then((function(t){e(t.json())})).catch((function(e){t(e)}))}))}}},function(e,t,o){"use strict";o.d(t,"a",(function(){return i}));var i={prepareDataForDataTable:function(e,t){var o=[];return t.forEach((function(t){t.id=t[e],o.push(t)})),o},prepareDataForCombo:function(e,t,o){var i=[];return o.forEach((function(o){i.push({id:o[e],value:o[t]})})),i}}},function(e,t,o){"use strict";o.d(t,"a",(function(){return r}));var i=o(16),n=o(1),r={getUsuarioCookie:function(){var e=i.a.getCookie("usuarioArquitectura");return e?JSON.parse(e):null},setUsuarioCookie:function(e){i.a.setCookie("usuarioArquitectura",JSON.stringify(e),1)},deleteUsuarioCookie:function(e){i.a.deleteCookie("usuarioArquitectura")},getAccesoCookie:function(){var e=i.a.getCookie("loginArquitectura");return e?JSON.parse(e):null},setAccesoCookie:function(e){i.a.setCookie("loginArquitectura",JSON.stringify(e),1e5)},deleteAccesoCookie:function(){i.a.deleteCookie("loginArquitectura")},checkLoggedUser:function(){var e=r.getUsuarioCookie();return e||(window.open("/#!/login","_blank"),window.close(),!1)},getLogin:function(e,t){return new webix.promise((function(o,i){n.a.getConfig().then((function(o){var i=o.urlApi+"/api/usuarios/login",n={usuario:{login:e,password:t}};return webix.ajax().timeout(1e4).headers({"Content-Type":"application/json"}).post(i,n)})).then((function(e){o(e.json())})).catch((function(e){i(e)}))}))},getUsuarios:function(){return new webix.promise((function(e,t){n.a.getConfig().then((function(e){var t=e.urlApi+"/api/usuarios/";return webix.ajax().timeout(1e4).headers({"Content-Type":"application/json"}).get(t)})).then((function(t){e(t.json())})).catch((function(e){t(e)}))}))},getUsuario:function(e){return new webix.promise((function(t,o){n.a.getConfig().then((function(t){var o=t.urlApi+"/api/usuarios/"+e;return webix.ajax().timeout(1e4).headers({"Content-Type":"application/json"}).get(o)})).then((function(e){t(e.json())})).catch((function(e){o(e)}))}))},getDepartamentosAsociados:function(e){return new webix.promise((function(t,o){n.a.getConfig().then((function(t){var o=t.urlApi+"/api/usuarios/departamentos/"+e;return webix.ajax().timeout(1e4).headers({"Content-Type":"application/json"}).get(o)})).then((function(e){t(e.json())})).catch((function(e){o(e)}))}))},postUsuario:function(e){return new webix.promise((function(t,o){n.a.getConfig().then((function(t){var o=t.urlApi+"/api/usuarios/";return webix.ajax().timeout(1e4).headers({"Content-Type":"application/json"}).post(o,{usuario:e})})).then((function(e){t(e.json())})).catch((function(e){o(e)}))}))},postUsuarioDepartamento:function(e){return new webix.promise((function(t,o){n.a.getConfig().then((function(t){var o=t.urlApi+"/api/usuarios/departamento";return webix.ajax().timeout(1e4).headers({"Content-Type":"application/json"}).post(o,{departamento:e})})).then((function(e){t(e.json())})).catch((function(e){o(e)}))}))},putUsuario:function(e){return new webix.promise((function(t,o){n.a.getConfig().then((function(t){var o=t.urlApi+"/api/usuarios/"+e.usuarioId;return webix.ajax().timeout(1e4).headers({"Content-Type":"application/json"}).put(o,{usuario:e})})).then((function(e){t(e.json())})).catch((function(e){o(e)}))}))},putUsuarioDepartamento:function(e,t){return new webix.promise((function(o,i){n.a.getConfig().then((function(o){var i=o.urlApi+"/api/usuarios/departamento/"+e;return webix.ajax().timeout(1e4).headers({"Content-Type":"application/json"}).put(i,{departamento:t})})).then((function(e){o(e.json())})).catch((function(e){i(e)}))}))},deleteUsuario:function(e){return new webix.promise((function(t,o){n.a.getConfig().then((function(t){var o=t.urlApi+"/api/usuarios/"+e;return webix.ajax().timeout(1e4).headers({"Content-Type":"application/json"}).del(o)})).then((function(e){t(e.json())})).catch((function(e){o(e)}))}))},deleteUsuarioDepartamento:function(e){return new webix.promise((function(t,o){n.a.getConfig().then((function(t){var o=t.urlApi+"/api/usuarios/departamento/"+e;return webix.ajax().timeout(1e4).headers({"Content-Type":"application/json"}).del(o)})).then((function(e){t(e.json())})).catch((function(e){o(e)}))}))},prepareDataForCombo:function(){return[{id:1,value:"Usuario"},{id:2,value:"Jefe de Equipo"},{id:3,value:"Vigilante"}]}}},function(e,t,o){"use strict";o.d(t,"d",(function(){return W})),o.d(t,"b",(function(){return $})),o.d(t,"c",(function(){return f})),o.d(t,"a",(function(){return v}));var i="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e};function n(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function r(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}function a(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}var s=function e(){a(this,e)},c=function(){function e(t){a(this,e),this.webixJet=!0,this.webix=t,this._events=[],this._subs={},this._data={}}return e.prototype.getRoot=function(){return this._root},e.prototype.destructor=function(){this._detachEvents(),this._destroySubs(),this._events=this._container=this.app=this._parent=this._root=null},e.prototype.setParam=function(e,t,o){if(this._data[e]!==t&&(this._data[e]=t,this._segment.update(e,t,0),o))return this.show(null)},e.prototype.getParam=function(e,t){var o=this._data[e];if(void 0!==o||!t)return o;var i=this.getParentView();return i?i.getParam(e,t):void 0},e.prototype.getUrl=function(){return this._segment.suburl()},e.prototype.getUrlString=function(){return this._segment.toString()},e.prototype.getParentView=function(){return this._parent},e.prototype.$$=function(e){if("string"==typeof e){var t=this.getRoot();return t.queryView((function(o){return(o.config.id===e||o.config.localId===e)&&o.$scope===t.$scope}),"self")}return e},e.prototype.on=function(e,t,o){var i=e.attachEvent(t,o);return this._events.push({obj:e,id:i}),i},e.prototype.contains=function(e){for(var t in this._subs){var o=this._subs[t].view;if(o===e||o.contains(e))return!0}return!1},e.prototype.getSubView=function(e){var t=this.getSubViewInfo(e);if(t)return t.subview.view},e.prototype.getSubViewInfo=function(e){var t=this._subs[e||"default"];return t?{subview:t,parent:this}:"_top"===e?(this._subs[e]={url:"",id:null,popup:!0},this.getSubViewInfo(e)):this._parent?this._parent.getSubViewInfo(e):null},e.prototype._detachEvents=function(){for(var e=this._events,t=e.length-1;t>=0;t--)e[t].obj.detachEvent(e[t].id)},e.prototype._destroySubs=function(){for(var e in this._subs){var t=this._subs[e].view;t&&t.destructor()}this._subs={}},e.prototype._init_url_data=function(){var e=this._segment.current();this._data={},this.webix.extend(this._data,e.params,!0)},e.prototype._getDefaultSub=function(){if(this._subs.default)return this._subs.default;for(var e in this._subs){var t=this._subs[e];if(!t.branch&&t.view&&"_top"!==e){var o=t.view._getDefaultSub();if(o)return o}}},e.prototype._routed_view=function(){var e=this.getParentView();if(!e)return!0;var t=e._getDefaultSub();return!(!t&&t!==this)&&e._routed_view()},e}();function l(e){"/"===e[0]&&(e=e.substr(1));for(var t=e.split("/"),o=[],i=0;i<t.length;i++){var n=t[i],r={},a=n.indexOf(":");if(-1===a&&(a=n.indexOf("?")),-1!==a){var s=n.substr(a+1).split(/[\:\?\&]/g),c=Array.isArray(s),l=0;for(s=c?s:s[Symbol.iterator]();;){var u;if(c){if(l>=s.length)break;u=s[l++]}else{if((l=s.next()).done)break;u=l.value}var d=u.split("=");r[d[0]]=decodeURIComponent(d[1])}}o[i]={page:a>-1?n.substr(0,a):n,params:r,isNew:!0}}return o}function u(e){var t=[],o=e,i=Array.isArray(o),n=0;for(o=i?o:o[Symbol.iterator]();;){var r;if(i){if(n>=o.length)break;r=o[n++]}else{if((n=o.next()).done)break;r=n.value}var a=r;t.push("/"+a.page);var s=d(a.params);s&&t.push("?"+s)}return t.join("")}function d(e){var t=[];for(var o in e)t.length&&t.push("&"),t.push(o+"="+encodeURIComponent(e[o]));return t.join("")}var p=function(){function e(t,o){a(this,e),this._next=1,this.route="string"==typeof t?{url:l(t),path:t}:t,this.index=o}return e.prototype.current=function(){return this.route.url[this.index]},e.prototype.next=function(){return this.route.url[this.index+this._next]},e.prototype.suburl=function(){return this.route.url.slice(this.index)},e.prototype.shift=function(){return new e(this.route,this.index+this._next)},e.prototype.refresh=function(){for(var e=this.route.url,t=this.index+1;t<e.length;t++)e[t].isNew=!0},e.prototype.toString=function(){var e=u(this.suburl());return e?e.substr(1):""},e.prototype._join=function(e,t){var o=this.route.url;if(null===e)return o;var i=this.route.url;if(o=i.slice(0,this.index+(t?this._next:0)),e){o=o.concat(l(e));for(var n=0;n<o.length;n++)i[n]&&(o[n].view=i[n].view),i[n]&&o[n].page===i[n].page&&(o[n].isNew=!1)}return o},e.prototype.append=function(e){var t=this._join(e,!0);return this.route.path=u(t),this.route.url=t,this.route.path},e.prototype.show=function(e,t,o){var i=this,n=this._join(e,o);return new Promise((function(e,o){var r=u(n),a={url:n,redirect:r,confirm:Promise.resolve()},c=t?t.app:null;if(c&&!c.callEvent("app:guard",[a.redirect,t,a]))return void o(new s);a.confirm.catch((function(e){return o(e)})).then((function(){if(null!==a.redirect){if(a.redirect!==r)return c.show(a.redirect),void o(new s);i.route.path=r,i.route.url=n,e()}else o(new s)}))}))},e.prototype.size=function(e){this._next=e},e.prototype.split=function(){var t={url:this.route.url.slice(this.index+1),path:""};return t.url.length&&(t.path=u(t.url)),new e(t,0)},e.prototype.update=function(e,t,o){var i=this.route.url[this.index+(o||0)];if(!i)return this.route.url.push({page:"",params:{}}),this.update(e,t,o);""===e?i.page=t:i.params[e]=t,this.route.path=u(this.route.url)},e}(),f=function(e){function t(o,i){a(this,t);var r=n(this,e.call(this,o.webix));return r.app=o,r._children=[],r}return r(t,e),t.prototype.ui=function(e,t){var o=(t=t||{}).container||e.container,n=this.app.createView(e);return this._children.push(n),n.render(o,this._segment,this),"object"!==(void 0===e?"undefined":i(e))||e instanceof c?n:n.getRoot()},t.prototype.show=function(e,t){if(t=t||{},"object"===(void 0===e?"undefined":i(e))){for(var o in e)this.setParam(o,e[o]);e=null}else{if("/"===e.substr(0,1))return this.app.show(e);if(0===e.indexOf("./")&&(e=e.substr(2)),0===e.indexOf("../")){var n=this.getParentView();return n?n.show(e.substr(3),t):this.app.show("/"+e.substr(3))}var r=this.getSubViewInfo(t.target);if(r){if(r.parent!==this)return r.parent.show(e,t);if(t.target&&"default"!==t.target)return this._renderFrameLock(t.target,r.subview,e)}else if(e)return this.app.show("/"+e)}return this._show(this._segment,e,this)},t.prototype._show=function(e,t,o){var i=this;return e.show(t,o,!0).then((function(){return i._init_url_data(),i._urlChange()})).then((function(){e.route.linkRouter&&(i.app.getRouter().set(e.route.path,{silent:!0}),i.app.callEvent("app:route",[e.route.path]))}))},t.prototype.init=function(e,t){},t.prototype.ready=function(e,t){},t.prototype.config=function(){this.app.webix.message("View:Config is not implemented")},t.prototype.urlChange=function(e,t){},t.prototype.destroy=function(){},t.prototype.destructor=function(){this.destroy(),this._destroyKids(),this._root.destructor(),e.prototype.destructor.call(this)},t.prototype.use=function(e,t){e(this.app,this,t)},t.prototype.refresh=function(){this.getUrl();return this.destroy(),this._destroyKids(),this._destroySubs(),this._detachEvents(),this._container.tagName&&this._root.destructor(),this._segment.refresh(),this._render(this._segment)},t.prototype.render=function(e,t,o){var i=this;"string"==typeof t&&(t=new p(t,0)),this._segment=t,this._parent=o,this._init_url_data();var n="string"==typeof(e=e||document.body)?this.webix.toNode(e):e;return this._container!==n?(this._container=n,this._render(t)):this._urlChange().then((function(){return i.getRoot()}))},t.prototype._render=function(e){var t=this,o=this.config();return o.then?o.then((function(o){return t._render_final(o,e)})):this._render_final(o,e)},t.prototype._render_final=function(e,t){var o=this,i=null,n=null,r=!1;if(this._container.tagName?n=this._container:(i=this._container).popup?(n=document.body,r=!0):n=this.webix.$$(i.id),!this.app||!n)return Promise.reject(null);var a=void 0,s=this._segment.current(),c={ui:{}};this.app.copyConfig(e,c.ui,this._subs),this.app.callEvent("app:render",[this,t,c]),c.ui.$scope=this,!i&&s.isNew&&s.view&&s.view.destructor();try{if(i&&!r){var l=n,u=l.getParentView();u&&"multiview"===u.name&&!c.ui.id&&(c.ui.id=l.config.id)}this._root=this.app.webix.ui(c.ui,n);var d=this._root;r&&d.setPosition&&!d.isVisible()&&d.show(),i&&(i.view&&i.view!==this&&i.view!==this.app&&i.view.destructor(),i.id=this._root.config.id,this.getParentView()||!this.app.app?i.view=this:i.view=this.app),s.isNew&&(s.view=this,s.isNew=!1),a=Promise.resolve(this._init(this._root,t)).then((function(){return o._urlChange().then((function(){return o._initUrl=null,o.ready(o._root,t.suburl())}))}))}catch(e){a=Promise.reject(e)}return a.catch((function(e){return o._initError(o,e)}))},t.prototype._init=function(e,t){return this.init(e,t.suburl())},t.prototype._urlChange=function(){var e=this;this.app.callEvent("app:urlchange",[this,this._segment]);var t=[];for(var o in this._subs){var i=this._subs[o],n=this._renderFrameLock(o,i,null);n&&t.push(n)}return Promise.all(t).then((function(){return e.urlChange(e._root,e._segment.suburl())}))},t.prototype._renderFrameLock=function(e,t,o){if(!t.lock){var i=this._renderFrame(e,t,o);i&&(t.lock=i.then((function(){return t.lock=null}),(function(){return t.lock=null})))}return t.lock},t.prototype._renderFrame=function(e,t,o){var i=this;if("default"===e){if(this._segment.next())return this._createSubView(t,this._segment.shift());t.view&&t.popup&&(t.view.destructor(),t.view=null)}if(null!==o&&(t.url=o),t.route){if(null!==o)return t.route.show(o,t.view).then((function(){return i._createSubView(t,t.route)}));if(t.branch)return}var n=t.view;if(!n&&t.url){if("string"==typeof t.url)return t.route=new p(t.url,0),this._createSubView(t,t.route);"function"!=typeof t.url||n instanceof t.url||(n=new t.url(this.app,"")),n||(n=t.url)}if(n)return n.render(t,t.route||this._segment,this)},t.prototype._initError=function(e,t){return this.app&&this.app.error("app:error:initview",[t,e]),!0},t.prototype._createSubView=function(e,t){var o=this;return this.app.createFromURL(t.current()).then((function(i){return i.render(e,t,o)}))},t.prototype._destroyKids=function(){for(var e=this._children,t=e.length-1;t>=0;t--)e[t]&&e[t].destructor&&e[t].destructor();this._children=[]},t}(c),h=function(e){function t(o,i){a(this,t);var r=n(this,e.call(this,o,i));return r._ui=i.ui,r}return r(t,e),t.prototype.config=function(){return this._ui},t}(f),m=function(){function e(t,o,i){a(this,e),this.path="",this.app=i}return e.prototype.set=function(e,t){this.path=e;var o=this.app;o.app.getRouter().set(o._segment.append(this.path),{silent:!0})},e.prototype.get=function(){return this.path},e}(),g=!0,b=function(e){function t(o){a(this,t);var i=(o||{}).webix||window.webix,r=n(this,e.call(this,i));return r.config=r.webix.extend({name:"App",version:"1.0",start:"/home"},o,!0),r.app=r.config.app,r.ready=Promise.resolve(),r._services={},r.webix.extend(r,r.webix.EventSystem),r}return r(t,e),t.prototype.getUrl=function(){return this._subSegment.suburl()},t.prototype.getUrlString=function(){return this._subSegment.toString()},t.prototype.getService=function(e){var t=this._services[e];return"function"==typeof t&&(t=this._services[e]=t(this)),t},t.prototype.setService=function(e,t){this._services[e]=t},t.prototype.destructor=function(){this.getSubView().destructor(),e.prototype.destructor.call(this)},t.prototype.copyConfig=function(e,t,o){if((e instanceof c||"function"==typeof e&&e.prototype instanceof c)&&(e={$subview:e}),void 0!==e.$subview)return this.addSubView(e,t,o);for(var n in t=t||(e instanceof Array?[]:{}),e){var r=e[n];if("function"==typeof r&&r.prototype instanceof c&&(r={$subview:r}),!r||"object"!==(void 0===r?"undefined":i(r))||r instanceof this.webix.DataCollection||r instanceof RegExp||r instanceof Map)t[n]=r;else if(r instanceof Date)t[n]=new Date(r);else{var a=this.copyConfig(r,r instanceof Array?[]:{},o);null!==a&&(t[n]=a)}}return t},t.prototype.getRouter=function(){return this.$router},t.prototype.clickHandler=function(e,t){if(e&&(t=t||e.target||e.srcElement)&&t.getAttribute){var o=t.getAttribute("trigger");if(o)return this._forView(t,(function(e){return e.app.trigger(o)})),e.cancelBubble=!0,e.preventDefault();var i=t.getAttribute("route");if(i)return this._forView(t,(function(e){return e.show(i)})),e.cancelBubble=!0,e.preventDefault()}var n=t.parentNode;n&&this.clickHandler(e,n)},t.prototype.getRoot=function(){return this.getSubView().getRoot()},t.prototype.refresh=function(){var e=this;return this._subSegment?this.getSubView().refresh().then((function(t){return e.callEvent("app:route",[e.getUrl()]),t})):Promise.resolve(null)},t.prototype.loadView=function(e){var t=this,o=this.config.views,i=null;if(""===e)return Promise.resolve(this._loadError("",new Error("Webix Jet: Empty url segment")));try{o&&"string"==typeof(i="function"==typeof o?o(e):o[e])&&(e=i,i=null),i||(i="_blank"===e?{}:this._loadViewDynamic(e))}catch(t){i=this._loadError(e,t)}return i.then||(i=Promise.resolve(i)),i=i.then((function(e){return e.__esModule?e.default:e})).catch((function(o){return t._loadError(e,o)}))},t.prototype._forView=function(e,t){var o=this.webix.$$(e);o&&t(o.$scope)},t.prototype._loadViewDynamic=function(e){return null},t.prototype.createFromURL=function(e){var t=this;return e.isNew||!e.view?this.loadView(e.page).then((function(e){return t.createView(e,name)})):Promise.resolve(e.view)},t.prototype.createView=function(e,o){if("function"==typeof e){if(e.prototype instanceof t)return new e({app:this,name:o,router:m});if(e.prototype instanceof c)return new e(this,{name:o});e=e(this)}return e instanceof c?e:new h(this,{name:o,ui:e})},t.prototype.show=function(e){return this.render(this._container,e||this.config.start)},t.prototype.trigger=function(e){for(var t=arguments.length,o=Array(t>1?t-1:0),i=1;i<t;i++)o[i-1]=arguments[i];this.apply(e,o)},t.prototype.apply=function(e,t){this.callEvent(e,t)},t.prototype.action=function(e){return this.webix.bind((function(){for(var t=arguments.length,o=Array(t),i=0;i<t;i++)o[i]=arguments[i];this.apply(e,o)}),this)},t.prototype.on=function(e,t){this.attachEvent(e,t)},t.prototype.use=function(e,t){e(this,null,t)},t.prototype.error=function(e,t){if(this.callEvent(e,t),this.callEvent("app:error",t),this.config.debug)for(var o=0;o<t.length;o++)if(console.error(t[o]),t[o]instanceof Error){var i=t[o].message;0===i.indexOf("Module build failed")?(i=i.replace(/\x1b\[[0-9;]*m/g,""),document.body.innerHTML="<pre style='font-size:16px; background-color: #ec6873; color: #000; padding:10px;'>"+i+"</pre>"):(i+="<br><br>Check console for more details",this.webix.message({type:"error",text:i,expire:-1}))}},t.prototype.render=function(e,t,o){var i=this;this._container="string"==typeof e?this.webix.toNode(e):e||document.body;var n=null;!this.$router?(g&&"tagName"in this._container&&(this.webix.event(document.body,"click",(function(e){return i.clickHandler(e)})),g=!1),"string"==typeof t&&(t=new p(t,0)),this._subSegment=this._first_start(t),this._subSegment.route.linkRouter=!0):n="string"==typeof t?t:this.app?t.split().route.path||this.config.start:t.toString();var r=this.getSubView(),a=this._subSegment,s=a.show(n,r).then((function(){return i.createFromURL(a.current())})).then((function(t){return t.render(e,a)})).then((function(e){return i.$router.set(a.route.path,{silent:!0}),i.callEvent("app:route",[i.getUrl()]),e}));return this.ready=this.ready.then((function(){return s})),s},t.prototype.getSubView=function(){if(this._subSegment){var e=this._subSegment.current().view;if(e)return e}return new f(this,{})},t.prototype._first_start=function(e){var t=this;this._segment=e;if(this.$router=new this.config.router((function(e){return setTimeout((function(){t.show(e).catch((function(e){if(!(e instanceof s))throw e}))}),1)}),this.config,this),this._container===document.body&&!1!==this.config.animation){var o=this._container;this.webix.html.addCss(o,"webixappstart"),setTimeout((function(){t.webix.html.removeCss(o,"webixappstart"),t.webix.html.addCss(o,"webixapp")}),10)}if(e)this.app&&(e.current().view=this,e.next()?(e.refresh(),e=e.split()):e=new p(this.config.start,0));else{var i=this.$router.get();i||(i=this.config.start,this.$router.set(i,{silent:!0})),e=new p(i,0)}return e},t.prototype._loadError=function(e,t){return this.error("app:error:resolve",[t,e]),{template:" "}},t.prototype.addSubView=function(e,t,o){var i=!0!==e.$subview?e.$subview:null,n=e.name||(i?this.webix.uid():"default");return t.id=e.id||"s"+this.webix.uid(),(o[n]={id:t.id,url:i,branch:e.branch,popup:e.popup}).popup?null:t},t}(c),v=function(){function e(t,o){var i=this;a(this,e),this.config=o||{},this._detectPrefix(),this.cb=t,window.onpopstate=function(){return i.cb(i.get())}}return e.prototype.set=function(e,t){var o=this;if(this.config.routes){var i=e.split("?",2);for(var n in this.config.routes)if(this.config.routes[n]===i[0]){e=n+(i.length>1?"?"+i[1]:"");break}}this.get()!==e&&window.history.pushState(null,null,this.prefix+this.sufix+e),t&&t.silent||setTimeout((function(){return o.cb(e)}),1)},e.prototype.get=function(){var e=this._getRaw().replace(this.prefix,"").replace(this.sufix,"");if(e="/"!==e&&"#"!==e?e:"",this.config.routes){var t=e.split("?",2),o=this.config.routes[t[0]];o&&(e=o+(t.length>1?"?"+t[1]:""))}return e},e.prototype._detectPrefix=function(){var e=this.config.routerPrefix;this.sufix="#"+(void 0===e?"!":e),this.prefix=document.location.href.split("#",2)[0]},e.prototype._getRaw=function(){return document.location.href},e}(),w=!1;function x(e){if(!w&&e){w=!0;var t=window;t.Promise||(t.Promise=e.promise);var o=e.version.split(".");10*o[0]+1*o[1]<53&&(e.ui.freeze=function(t){var o=t();return o&&o.then?o.then((function(t){return e.ui.$freeze=!1,e.ui.resize(),t})):(e.ui.$freeze=!1,e.ui.resize()),o});var n=e.ui.baselayout.prototype.addView,r=e.ui.baselayout.prototype.removeView,a={addView:function(e,t){var o=this;if(!this.$scope||!this.$scope.webixJet||e.queryView)return n.apply(this,arguments);var r=function(){var i=o.$scope,r={};e=i.app.copyConfig(e,{},r),n.apply(o,[e,t]);var a=function(e){i._renderFrame(e,r[e],null).then((function(){i._subs[e]=r[e]}))};for(var s in r)a(s);return{v:e.id}}();return"object"===(void 0===r?"undefined":i(r))?r.v:void 0},removeView:function(){if(r.apply(this,arguments),this.$scope&&this.$scope.webixJet){var t=this.$scope._subs;for(var o in t){var i=t[o];e.$$(i.id)||(i.view.destructor(),delete t[o])}}}};e.extend(e.ui.layout.prototype,a,!0),e.extend(e.ui.baselayout.prototype,a,!0),e.protoUI({name:"jetapp",$init:function(t){this.$app=new this.app(t);var o=e.uid().toString();for(var i in t.body={id:o},this.$ready.push((function(){this.$app.render({id:o})})),this.$app){var n=this.$app[i];"function"!=typeof n||this[i]||(this[i]=n.bind(this.$app))}}},e.ui.proxy)}}var $=function(e){function t(o){a(this,t),o.router=o.router||v;var i=n(this,e.call(this,o));return x(i.webix),i}return r(t,e),t.prototype._loadViewDynamic=function(e){return e=e.replace(/\./g,"/"),o(48)("./"+e)},t}(b);(function(){function e(t,o,i){a(this,e),this.storage=o.storage||i.webix.storage.session,this.name=o.storeName||o.id+":route",this.cb=t}e.prototype.set=function(e,t){var o=this;this.storage.put(this.name,e),t&&t.silent||setTimeout((function(){return o.cb(e)}),1)},e.prototype.get=function(){return this.storage.get(this.name)}})(),function(e){function t(){return a(this,t),n(this,e.apply(this,arguments))}r(t,e),t.prototype._detectPrefix=function(){this.prefix="",this.sufix=this.config.routerPrefix||""},t.prototype._getRaw=function(){return document.location.pathname+(document.location.search||"")}}(v),function(){function e(t,o){a(this,e),this.path="",this.cb=t}e.prototype.set=function(e,t){var o=this;this.path=e,t&&t.silent||setTimeout((function(){return o.cb(e)}),1)},e.prototype.get=function(){return this.path}}();function y(e,t){return Object.prototype.hasOwnProperty.call(e,t)}function C(e,t,o){for(var i in e)y(e,i)&&t.call(o||e,e[i],i,e)}function j(e){e="Warning: "+e,"undefined"!=typeof console&&console.error(e);try{throw new Error(e)}catch(e){}}var A=String.prototype.replace,I=String.prototype.split,E=function(e){var t=e%10;return 11!==e&&1===t?0:2<=t&&t<=4&&!(e>=12&&e<=14)?1:2},P={arabic:function(e){if(e<3)return e;var t=e%100;return t>=3&&t<=10?3:t>=11?4:5},bosnian_serbian:E,chinese:function(){return 0},croatian:E,french:function(e){return e>1?1:0},german:function(e){return 1!==e?1:0},russian:E,lithuanian:function(e){return e%10==1&&e%100!=11?0:e%10>=2&&e%10<=9&&(e%100<11||e%100>19)?1:2},czech:function(e){return 1===e?0:e>=2&&e<=4?1:2},polish:function(e){if(1===e)return 0;var t=e%10;return 2<=t&&t<=4&&(e%100<10||e%100>=20)?1:2},icelandic:function(e){return e%10!=1||e%100==11?1:0},slovenian:function(e){var t=e%100;return 1===t?0:2===t?1:3===t||4===t?2:3}},F={arabic:["ar"],bosnian_serbian:["bs-Latn-BA","bs-Cyrl-BA","srl-RS","sr-RS"],chinese:["id","id-ID","ja","ko","ko-KR","lo","ms","th","th-TH","zh"],croatian:["hr","hr-HR"],german:["fa","da","de","en","es","fi","el","he","hi-IN","hu","hu-HU","it","nl","no","pt","sv","tr"],french:["fr","tl","pt-br"],russian:["ru","ru-RU"],lithuanian:["lt"],czech:["cs","cs-CZ","sk"],polish:["pl"],icelandic:["is"],slovenian:["sl-SL"]};function O(e){var t,o=(t={},C(F,(function(e,o){C(e,(function(e){t[e]=o}))})),t);return o[e]||o[I.call(e,/-/,1)[0]]||o.en}function T(e){return e.replace(/[.*+?^${}()|[\]\\]/g,"\\$&")}var G=/\$/g,_=/%\{(.*?)\}/g;function S(e,t,o,i){if("string"!=typeof e)throw new TypeError("Polyglot.transformPhrase expects argument #1 to be string");if(null==t)return e;var n=e,r=i||_,a="number"==typeof t?{smart_count:t}:t;if(null!=a.smart_count&&n){var s=I.call(n,"||||");n=(s[function(e,t){return P[O(e)](t)}(o||"en",a.smart_count)]||s[0]).replace(/^[\s\uFEFF\xA0]+|[\s\uFEFF\xA0]+$/g,"")}return n=A.call(n,r,(function(e,t){return y(a,t)&&null!=a[t]?A.call(a[t],G,"$$"):e}))}function V(e){var t=e||{};this.phrases={},this.extend(t.phrases||{}),this.currentLocale=t.locale||"en";var o=t.allowMissing?S:null;this.onMissingKey="function"==typeof t.onMissingKey?t.onMissingKey:o,this.warn=t.warn||j,this.tokenRegex=function(e){var t=e&&e.prefix||"%{",o=e&&e.suffix||"}";if("||||"===t||"||||"===o)throw new RangeError('"||||" token is reserved for pluralization');return new RegExp(T(t)+"(.*?)"+T(o),"g")}(t.interpolation)}V.prototype.locale=function(e){return e&&(this.currentLocale=e),this.currentLocale},V.prototype.extend=function(e,t){C(e,(function(e,o){var n=t?t+"."+o:o;"object"===(void 0===e?"undefined":i(e))?this.extend(e,n):this.phrases[n]=e}),this)},V.prototype.unset=function(e,t){"string"==typeof e?delete this.phrases[e]:C(e,(function(e,o){var n=t?t+"."+o:o;"object"===(void 0===e?"undefined":i(e))?this.unset(e,n):delete this.phrases[n]}),this)},V.prototype.clear=function(){this.phrases={}},V.prototype.replace=function(e){this.clear(),this.extend(e)},V.prototype.t=function(e,t){var o,i,n=null==t?{}:t;if("string"==typeof this.phrases[e])o=this.phrases[e];else if("string"==typeof n._)o=n._;else if(this.onMissingKey){i=(0,this.onMissingKey)(e,n,this.currentLocale,this.tokenRegex)}else this.warn('Missing translation for key: "'+e+'"'),i=e;return"string"==typeof o&&(i=S(o,n,this.currentLocale,this.tokenRegex)),i},V.prototype.has=function(e){return y(this.phrases,e)},V.transformPhrase=function(e,t,o){return S(e,t,o)};var D=V;function k(e,t,o){if(t.urls)o=t.urls[o]||o;else if(t.param){var i;(i={})[t.param]=o,o=i}e.show(o)}var R={good:"check",error:"warning",saving:"refresh fa-spin"},L={good:"Ok",error:"Error",saving:"Connecting..."};function N(e,t,o){for(var i=0;i<o.length;i++)e[o[i]]=t[i+1]?t[i+1].page:""}var M=window.webix;M&&x(M);var W={UnloadGuard:function(e,t,o){t.on(e,"app:guard",(function(e,i,n){if(i===t||i.contains(t)){var r=o();n.confirm=!1===r?Promise.reject(new s):n.confirm.then((function(){return r}))}}))},Locale:function(e,t,i){var n=(i=i||{}).storage,r=n?n.get("lang")||"en":i.lang||"en";function a(t,o,a){o.__esModule&&(o=o.default);var s={phrases:o};i.polyglot&&e.webix.extend(s,i.polyglot);var l=c.polyglot=new D(s);if(l.locale(t),c._=e.webix.bind(l.t,l),r=t,n&&n.put("lang",r),i.webix){var u=i.webix[t];u&&e.webix.i18n.setLocale(u)}return a?Promise.resolve():e.refresh()}function s(e,t){if(!1!==i.path){var n=(i.path?i.path+"/":"")+e;a(e,o(49)("./"+n),t)}}var c={getLang:function(){return r},setLang:s,setLangData:a,_:null,polyglot:null};e.setService("locale",c),s(r,!0)},Menu:function(e,t,o){var i=t.getSubViewInfo().parent,n=t.$$(o.id||o),r=!1;n.attachEvent("onchange",(function(){r||k(i,o,this.getValue())})),n.attachEvent("onafterselect",(function(){if(!r){var e=null;n.setValue?e=this.getValue():n.getSelectedId&&(e=n.getSelectedId()),k(i,o,e)}})),t.on(e,"app:route",(function(){var e="";if(o.param)e=t.getParam(o.param,!0);else{var a=i.getUrl()[1];a&&(e=a.page)}e&&(r=!0,n.setValue&&n.getValue()!==e?n.setValue(e):n.select&&n.exists(e)&&n.getSelectedId()!==e&&n.select(e),r=!1)}))},Theme:function(e,t,o){var i=(o=o||{}).storage,n=i?i.get("theme")||"flat-default":o.theme||"flat-default",r={getTheme:function(){return n},setTheme:function(t,o){for(var r=t.split("-"),a=document.getElementsByTagName("link"),s=0;s<a.length;s++){var c=a[s].getAttribute("title");c&&(c===t||c===r[0]?a[s].disabled=!1:a[s].disabled=!0)}e.webix.skin.set(r[0]),e.webix.html.removeCss(document.body,"theme-"+n),e.webix.html.addCss(document.body,"theme-"+t),n=t,i&&i.put("theme",t),o||e.refresh()}};e.setService("theme",r),r.setTheme(n,!0)},User:function(e,t,o){var i=(o=o||{}).login||"/login",n=o.logout||"/logout",r=o.afterLogin||e.config.start,a=o.afterLogout||"/login",s=o.ping||3e5,c=o.model,l=o.user,u={getUser:function(){return l},getStatus:function(e){return e?c.status().catch((function(){return null})).then((function(e){l=e})):null!==l},login:function(t,o){return c.login(t,o).then((function(t){if(l=t,!t)throw new Error("Access denied");e.callEvent("app:user:login",[l]),e.show(r)}))},logout:function(){return l=null,c.logout().then((function(t){return e.callEvent("app:user:logout",[]),t}))}};function d(e,t){e===n?(u.logout(),t.redirect=a):e===i||u.getStatus()||(t.redirect=i)}e.setService("user",u),e.attachEvent("app:guard",(function(e,t,i){return!(!o.public||!o.public(e))||(void 0===l&&(i.confirm=u.getStatus(!0).then((function(){return d(e,i)}))),d(e,i))})),s&&setInterval((function(){return u.getStatus(!0)}),s)},Status:function(e,t,o){var i="good",n=0,r=!1,a=o.expire;a||!1===a||(a=2e3);var s=o.texts||L,c=o.icons||R;function l(e){var n=t.$$(o.target);n&&(e||(e="<div class='status_"+i+"'><span class='webix_icon fa-"+c[i]+"'></span> "+s[i]+"</div>"),n.setHTML(e))}function u(){n--,h("good")}function d(e){n--,h("error",e)}function p(e){n++,h("saving"),e&&e.then&&e.then(u,d)}function f(){0===n&&l(" ")}function h(t,o){n<0&&(n=0),"saving"===t?(i="saving",l()):(r="error"===t,0===n&&(i=r?"error":"good",r?e.error("app:error:server",[o.responseText||o]):a&&setTimeout(f,a),l()))}function m(o){var i=e.webix.dp(o);i&&(t.on(i,"onAfterDataSend",p),t.on(i,"onAfterSaveError",(function(e,t,o){return d(o)})),t.on(i,"onAfterSave",u))}"string"==typeof o&&(o={target:o}),e.setService("status",{getStatus:function(){return i},setStatus:h,track:m}),o.remote&&t.on(e.webix,"onRemoteCall",p),o.ajax&&t.on(e.webix,"onBeforeAjax",(function(e,t,o,i,n,r,a){p(a)})),o.data&&m(o.data)},UrlParam:function(e,t,o){var i=o.route||o,n={};t.on(e,"app:urlchange",(function(e,o){t===e&&(N(n,o.suburl(),i),o.size(i.length+1))}));var r=t.setParam,a=t.getParam;t.setParam=function(e,o,a){var s=i.indexOf(e);return s>=0?(n[e]=o,this._segment.update("",o,s+1),a?t.show(null):void 0):r.call(this,e,o,a)},t.getParam=function(e,t){var o=n[e];return void 0!==o?o:a.call(this,e,t)},N(n,t.getUrl(),i)}},U=window;U.Promise||(U.Promise=U.webix.promise)},function(e,t,o){"use strict";o.d(t,"a",(function(){return n}));var i=o(1),n={getOfertas:function(e){return new webix.promise((function(t,o){i.a.getConfig().then((function(t){var o=t.urlApi+"/api/ofertas/usuario/logado/departamento/"+e+"/5";return webix.ajax().timeout(1e4).headers({"Content-Type":"application/json"}).get(o)})).then((function(e){t(e.json())})).catch((function(e){o(e)}))}))},getOfertasExpediente:function(e,t){return new webix.promise((function(o,n){i.a.getConfig().then((function(o){var i=o.urlApi+"/api/ofertas/expedientes/tecnicas/"+e+"/"+t;return webix.ajax().timeout(1e4).headers({"Content-Type":"application/json"}).get(i)})).then((function(e){o(e.json())})).catch((function(e){n(e)}))}))},getOferta:function(e){return new webix.promise((function(t,o){i.a.getConfig().then((function(t){var o=t.urlApi+"/api/ofertas/"+e;return webix.ajax().timeout(1e4).headers({"Content-Type":"application/json"}).get(o)})).then((function(e){t(e.json())})).catch((function(e){o(e)}))}))},getLineasOferta:function(e){return new webix.promise((function(t,o){i.a.getConfig().then((function(t){var o=t.urlApi+"/api/ofertas/lineas/"+e+"/"+!1+"/"+!1;return webix.ajax().timeout(1e4).headers({"Content-Type":"application/json"}).get(o)})).then((function(e){t(e.json())})).catch((function(e){o(e)}))}))},getLineaOferta:function(e){return new webix.promise((function(t,o){i.a.getConfig().then((function(t){var o=t.urlApi+"/api/ofertas/linea/"+e;return webix.ajax().timeout(1e4).headers({"Content-Type":"application/json"}).get(o)})).then((function(e){t(e.json())})).catch((function(e){o(e)}))}))},getBasesOferta:function(e){return new webix.promise((function(t,o){i.a.getConfig().then((function(t){var o=t.urlApi+"/api/ofertas/bases/"+e;return webix.ajax().timeout(1e4).headers({"Content-Type":"application/json"}).get(o)})).then((function(e){t(e.json())})).catch((function(e){o(e)}))}))},getSiguienteLinea:function(e){return new webix.promise((function(t,o){i.a.getConfig().then((function(t){var o=t.urlApi+"/api/ofertas/nextlinea/"+e;return webix.ajax().timeout(1e4).headers({"Content-Type":"application/json"}).get(o)})).then((function(e){t(e.json())})).catch((function(e){o(e)}))}))},getProveedoresOferta:function(e){return new webix.promise((function(t,o){i.a.getConfig().then((function(t){var o=t.urlApi+"/api/ofertas/proveedores/lineas/totales/"+e;return webix.ajax().timeout(1e4).headers({"Content-Type":"application/json"}).get(o)})).then((function(e){t(e.json())})).catch((function(e){o(e)}))}))},postOferta:function(e){return new webix.promise((function(t,o){i.a.getConfig().then((function(t){var o=t.urlApi+"/api/ofertas/";return webix.ajax().timeout(1e4).headers({"Content-Type":"application/json"}).post(o,{oferta:e})})).then((function(e){t(e.json())})).catch((function(e){o(e)}))}))},postOfertaVenta:function(e){return new webix.promise((function(t,o){i.a.getConfig().then((function(t){var o=t.urlApi+"/api/ofertas/venta/cabecera/lineas/";return webix.ajax().timeout(1e4).headers({"Content-Type":"application/json"}).post(o,{oferta:e})})).then((function(e){t(e.json())})).catch((function(e){o(e)}))}))},putOferta:function(e,t){return new webix.promise((function(o,n){i.a.getConfig().then((function(o){var i=o.urlApi+"/api/ofertas/"+t;return webix.ajax().timeout(1e4).headers({"Content-Type":"application/json"}).put(i,{oferta:e})})).then((function(e){o(e.json())})).catch((function(e){n(e)}))}))},putOfertaVenta:function(e){return new webix.promise((function(t,o){i.a.getConfig().then((function(t){var o=t.urlApi+"/api/ofertas/venta/cabecera/lineas/";return webix.ajax().timeout(1e4).headers({"Content-Type":"application/json"}).put(o,{oferta:e})})).then((function(e){t(e.json())})).catch((function(e){o(e)}))}))},postLineaOferta:function(e){return new webix.promise((function(t,o){i.a.getConfig().then((function(t){var o=t.urlApi+"/api/ofertas/lineas";return webix.ajax().timeout(1e4).headers({"Content-Type":"application/json"}).post(o,{ofertaLinea:e})})).then((function(e){t(e.json())})).catch((function(e){o(e)}))}))},putLineaOferta:function(e,t){return new webix.promise((function(o,n){i.a.getConfig().then((function(o){var i=o.urlApi+"/api/ofertas/lineas/"+t;return webix.ajax().timeout(1e4).headers({"Content-Type":"application/json"}).put(i,{ofertaLinea:e})})).then((function(e){o(e.json())})).catch((function(e){n(e)}))}))},deleteOferta:function(e){return new webix.promise((function(t,o){i.a.getConfig().then((function(t){var o=t.urlApi+"/api/ofertas/"+e;return webix.ajax().timeout(1e4).headers({"Content-Type":"application/json"}).del(o)})).then((function(e){t(e.json())})).catch((function(e){o(e)}))}))},deleteLineaOferta:function(e,t){return new webix.promise((function(o,n){i.a.getConfig().then((function(o){var i=o.urlApi+"/api/ofertas/lineas/"+e;return webix.ajax().timeout(1e4).headers({"Content-Type":"application/json"}).del(i,{ofertaLinea:t})})).then((function(e){o(e.json())})).catch((function(e){n(e)}))}))}}},function(e,t,o){"use strict";o.r(t),o.d(t,"languageService",(function(){return r}));var i=o(4),n={es:{groupDelimiter:".",groupSize:3,decimalDelimiter:",",decimalSize:2,dateFormat:"%d/%m/%Y",timeFormat:"%H:%i",longDateFormat:"%d %F %Y",fullDateFormat:"%d.%m.%Y %H:%i",am:null,pm:null,price:"{obj} €",calendar:{monthFull:["Enero","Febrero","Marzo","Abril","Mayo","Junio","Julio","Agosto","Septiembre","Octubre","Noviembre","Diciembre"],monthShort:["En","Feb","Mar","Abr","Mayo","Jun","Jul","Ago","Sep","Oct","Nov","Dic"],dayFull:["Domingo","Lunes","Martes","Miercoles","Jueves","Viernes","Sabado"],dayShort:["Dom","Lun","Mar","Mier","Jue","Vier","Sab"]},hours:"Horas ",minutes:"Minutos",done:"Listo",controls:{select:"Seleccione"}},en:{groupDelimiter:".",groupSize:3,decimalDelimiter:",",decimalSize:2,dateFormat:"%d/%m/%Y",timeFormat:"%H:%i",longDateFormat:"%d %F %Y",fullDateFormat:"%d.%m.%Y %H:%i",am:null,pm:null,price:"{obj} €",calendar:{monthFull:["Enero","Febrero","Marzo","Abril","Mayo","Junio","Julio","Agosto","Septiembre","Octubre","Noviembre","Diciembre"],monthShort:["En","Feb","Mar","Abr","Mayo","Jun","Jul","Ago","Sep","Oct","Nov","Dic"],dayFull:["Domingo","Lunes","Martes","Miercoles","Jueves","Viernes","Sabado"],dayShort:["Dom","Lun","Mar","Mier","Jue","Vier","Sab"]},hours:"Horas ",minutes:"Minutos",done:"Listo",controls:{select:"Seleccione"}},fr:{groupDelimiter:".",groupSize:3,decimalDelimiter:",",decimalSize:2,dateFormat:"%d/%m/%Y",timeFormat:"%H:%i",longDateFormat:"%d %F %Y",fullDateFormat:"%d.%m.%Y %H:%i",am:null,pm:null,price:"{obj} €",calendar:{monthFull:["Enero","Febrero","Marzo","Abril","Mayo","Junio","Julio","Agosto","Septiembre","Octubre","Noviembre","Diciembre"],monthShort:["En","Feb","Mar","Abr","Mayo","Jun","Jul","Ago","Sep","Oct","Nov","Dic"],dayFull:["Domingo","Lunes","Martes","Miercoles","Jueves","Viernes","Sabado"],dayShort:["Dom","Lun","Mar","Mier","Jue","Vier","Sab"]},hours:"Horas ",minutes:"Minutos",done:"Listo",controls:{select:"Seleccione"}}},r={setLanguage:function(e,t){e.use(i.d.Locale,{lang:t}),webix.i18n.locales[t]=n[t],webix.i18n.setLocale(t)}}},function(e,t,o){"use strict";o.d(t,"a",(function(){return n}));var i=o(1),n={getExpedientes:function(e){return new webix.promise((function(t,o){i.a.getConfig().then((function(t){var o=t.urlApi+"/api/expedientes/estado/"+e;return webix.ajax().timeout(1e4).headers({"Content-Type":"application/json"}).get(o)})).then((function(e){t(e.json())})).catch((function(e){o(e)}))}))},getExpediente:function(e){return new webix.promise((function(t,o){i.a.getConfig().then((function(t){var o=t.urlApi+"/api/expedientes/"+e;return webix.ajax().timeout(1e4).headers({"Content-Type":"application/json"}).get(o)})).then((function(e){t(e.json())})).catch((function(e){o(e)}))}))},postExpediente:function(e){return new webix.promise((function(t,o){i.a.getConfig().then((function(t){var o=t.urlApi+"/api/expedientes/";return webix.ajax().timeout(1e4).headers({"Content-Type":"application/json"}).post(o,{expediente:e})})).then((function(e){t(e.json())})).catch((function(e){o(e)}))}))},putExpediente:function(e,t){return new webix.promise((function(o,n){i.a.getConfig().then((function(o){var i=o.urlApi+"/api/expedientes/"+t;return webix.ajax().timeout(1e4).headers({"Content-Type":"application/json"}).put(i,{expediente:e})})).then((function(e){o(e.json())})).catch((function(e){n(e)}))}))},getSiguienteReferencia:function(e){return new webix.promise((function(t,o){i.a.getConfig().then((function(t){var o=t.urlApi+"/api/ofertas/siguiente_referencia/"+e+"/"+!0;return webix.ajax().timeout(1e4).headers({"Content-Type":"application/json"}).get(o)})).then((function(e){t(e.json())})).catch((function(e){o(e)}))}))}}},function(e,t,o){"use strict";o.d(t,"a",(function(){return n}));var i=o(1),n={getClientes:function(){return new webix.promise((function(e,t){i.a.getConfig().then((function(e){var t=e.urlApi+"/api/clientes";return webix.ajax().timeout(1e4).headers({"Content-Type":"application/json"}).get(t)})).then((function(t){e(t.json())})).catch((function(e){t(e)}))}))},getClientesActivos:function(){return new webix.promise((function(e,t){i.a.getConfig().then((function(e){var t=e.urlApi+"/api/clientes/activos";return webix.ajax().timeout(1e4).headers({"Content-Type":"application/json"}).get(t)})).then((function(t){e(t.json())})).catch((function(e){t(e)}))}))},getMantenedoresActivos:function(){return new webix.promise((function(e,t){i.a.getConfig().then((function(e){var t=e.urlApi+"/api/clientes/mantenedores_activos";return webix.ajax().timeout(1e4).headers({"Content-Type":"application/json"}).get(t)})).then((function(t){e(t.json())})).catch((function(e){t(e)}))}))},getClientesAgente:function(e){return new webix.promise((function(t,o){i.a.getConfig().then((function(t){var o=t.urlApi+"/api/clientes/agente/"+e;return webix.ajax().timeout(1e4).headers({"Content-Type":"application/json"}).get(o)})).then((function(e){t(e.json())})).catch((function(e){o(e)}))}))},getClientesAgenteActivos:function(e){return new webix.promise((function(t,o){i.a.getConfig().then((function(t){var o=t.urlApi+"/api/clientes/agente/clientes-activos/"+e;return webix.ajax().timeout(1e4).headers({"Content-Type":"application/json"}).get(o)})).then((function(e){t(e.json())})).catch((function(e){o(e)}))}))},getCliente:function(e){return new webix.promise((function(t,o){i.a.getConfig().then((function(t){var o=t.urlApi+"/api/clientes/"+e;return webix.ajax().timeout(1e4).headers({"Content-Type":"application/json"}).get(o)})).then((function(e){t(e.json())})).catch((function(e){o(e)}))}))},getClientesNombre:function(e){return new webix.promise((function(t,o){i.a.getConfig().then((function(t){var o=t.urlApi+"/api/clientes/activos/?nombre="+e;return webix.ajax().timeout(1e4).headers({"Content-Type":"application/json"}).get(o)})).then((function(e){t(e.json())})).catch((function(e){o(e)}))}))},getProId:function(e){return new webix.promise((function(t,o){i.a.getConfig().then((function(t){var o=t.urlApi+"/api/clientes/agente/"+e;return webix.ajax().timeout(1e4).headers({"Content-Type":"application/json"}).get(o)})).then((function(e){t(e.json())})).catch((function(e){o(e)}))}))},getCobrosCliente:function(e){return new webix.promise((function(t,o){i.a.getConfig().then((function(t){var o=t.urlApi+"/api/cobros/cliente/"+e;return webix.ajax().timeout(1e4).headers({"Content-Type":"application/json"}).get(o)})).then((function(e){t(e.json())})).catch((function(e){o(e)}))}))},getPrecioUnitarioArticulo:function(e,t){return new webix.promise((function(o,n){i.a.getConfig().then((function(o){var i=o.urlApi+"/api/clientes/tarifa/por/articuloId/"+e+"/"+t;return webix.ajax().timeout(1e4).headers({"Content-Type":"application/json"}).get(i)})).then((function(e){o(e.json())})).catch((function(e){n(e)}))}))},postCliente:function(e,t){return new webix.promise((function(o,n){i.a.getConfig().then((function(o){var i=o.urlApi+"/api/clientes";return webix.ajax().timeout(1e4).headers({"Content-Type":"application/json","x-apiKey":e.apiKey}).post(i,t)})).then((function(e){o(e.json())})).catch((function(e){n(e)}))}))},putCliente:function(e,t){return new webix.promise((function(o,n){i.a.getConfig().then((function(t){t.urlApi;return webix.ajax().timeout(1e4).headers({"Content-Type":"application/json","x-apiKey":e.apiKey})})).put(url,t).then((function(e){o(e.json())})).catch((function(e){n(e)}))}))},deleteCliente:function(e,t){return new webix.promise((function(o,n){Object(i.a)().getConfig().then((function(o){var i=o.urlApi+"/api/clientes/"+t;return webix.ajax().timeout(1e4).headers({"Content-Type":"application/json","x-apiKey":e.apiKey}).del(i)})).then((function(e){o(e.json())})).catch((function(e){n(e)}))}))},getClientesActivosQuery:function(e){return new webix.promise((function(t,o){i.a.getConfig().then((function(t){var o=t.urlApi+"/api/clientes/activos?nombre="+e;return webix.ajax().timeout(2e4).headers({"Content-Type":"application/json"}).get(o)})).then((function(e){t(e.json())})).catch((function(e){o(e)}))}))},procesaProId:function(e){var t=[],o={},i=0;return e.forEach((function(e){i++,o={id:i,value:e.proId},t.push(o)})),t}}},function(e,t,o){"use strict";o.d(t,"a",(function(){return n}));var i=o(1),n={getTiposProyecto:function(e){return new webix.promise((function(t,o){i.a.getConfig().then((function(t){var o=t.urlApi+"/api/tipos_proyectos/departamento/tecnico/"+e+"/5";return webix.ajax().timeout(1e4).headers({"Content-Type":"application/json"}).get(o)})).then((function(e){t(e.json())})).catch((function(e){o(e)}))}))},getTipoProyecto:function(e){return new webix.promise((function(t,o){i.a.getConfig().then((function(t){var o=t.urlApi+"/api/tipos_proyectos/"+e;return webix.ajax().timeout(1e4).headers({"Content-Type":"application/json"}).get(o)})).then((function(e){t(e.json())})).catch((function(e){o(e)}))}))},postTipoProyecto:function(e){return new webix.promise((function(t,o){i.a.getConfig().then((function(t){var o=t.urlApi+"/api/tipos_proyectos";return webix.ajax().timeout(1e4).headers({"Content-Type":"application/json"}).post(o,{tipoProyecto:e})})).then((function(e){t(e.json())})).catch((function(e){o(e)}))}))},putTipoProyecto:function(e){return new webix.promise((function(t,o){i.a.getConfig().then((function(t){var o=t.urlApi+"/api/tipos_proyectos/"+e.tipoProyectoId;return webix.ajax().timeout(1e4).headers({"Content-Type":"application/json"}).put(o,{tipoProyecto:e})})).then((function(e){t(e.json())})).catch((function(e){o(e)}))}))},deleteTipoProyecto:function(e){return new webix.promise((function(t,o){i.a.getConfig().then((function(t){var o=t.urlApi+"/api/tipos_proyectos/"+e;return webix.ajax().timeout(1e4).headers({"Content-Type":"application/json"}).del(o)})).then((function(e){t(e.json())})).catch((function(e){o(e)}))}))}}},function(e,t,o){"use strict";o.r(t);var i,n=o(4),r=(o(3),o(1));function a(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function s(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}var c=function(e){function t(){return a(this,t),s(this,e.apply(this,arguments))}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(t,e),t.prototype.config=function(){return{view:"window",id:"ofertasEpisReport",position:"top",move:!0,resize:!0,scroll:"x,y",width:1129,height:775,fullscreen:!1,head:{view:"toolbar",cols:[{view:"label",label:(0,this.app.getService("locale")._)("IMPRESIÓN DE OFERTAS")},{view:"icon",icon:"mdi mdi-close",click:function(){$$("ofertasEpisReport").hide()}}]},modal:!0,body:{template:"<div id='report_viewer'></div>"}}},t.prototype.init=function(e,t){r.a.getConfigMysql().then((function(e){i=e})).catch((function(e){fail(e)}))},t.prototype.showWindow=function(e,t){$$("ofertasEpisReport").show();var o=new Stimulsoft.Viewer.StiViewerOptions;Stimulsoft.Base.Localization.StiLocalization.setLocalizationFile("../stireport/localization/es.xml",!0),Stimulsoft.Base.StiLicense.key="6vJhGtLLLz2GNviWmUTrhSqnOItdDwjBylQzQcAOiHltN9ZO4D78QwpEoh6+UpBm5mrGyhSAIsuWoljPQdUv6R6vgviStsx8W3jirJvfPH27oRYrC2WIPEmaoAZTNtqb+nDxUpJlSmG62eA46oRJDV8kJ2cJSEx19GMJXYgZvv7yQT9aJHYaSrTVD7wdhpNVS1nQC3OtisVd7MQNQeM40GJxcZpyZDPfvld8mK6VX0RTPJsQZ7UcCEH4Y3LaKzA5DmUS+mwSnjXz/JFv1uO2JNkfcioieXfYfTaBIgZlKecarCS5vBgMrXly3m5kw+YwpJ2v+cMXuDk3UrZgrdxNnOhg8ZHPg9ijHxqUomZZBzKpVQU0d06ne60j/liMH5KirAI2JCVfBcBvIcyliJos8LAWr9q/1sPR9y7LmA1eyS1/dXaxmEaqi5ubhLqlf+OS0xFX6tlBBgegqHlIj6Fytwvq5YlGAZ0Cra05JhnKh/ohYlADQz6Jbg5sOKyn5EbejvPS3tWr0LRBH2FO6+mJaSEAwzGmoWT057ScSvGgQmfx8wCqSF+PgK/zTzjy75Oh",StiOptions.WebServer.url=i.report.stiUrl,o.appearance.scrollbarsMode=!0,o.appearance.fullScreenMode=!1,o.toolbar.showSendEmailButton=!1,o.toolbar.viewMode=Stimulsoft.Viewer.StiWebViewMode.Continuous;var n=new Stimulsoft.Viewer.StiViewer(o,"StiViewer",!1),r=new Stimulsoft.Report.StiReport;r.loadFile(t);i.report.host;i.report.database,i.report.user,i.report.password;for(var a=0;a<r.dataSources.items.length;a++)r.dataSources.items[a].sqlCommand;var s=r.dataSources.items[0].sqlCommand;s=s+" WHERE o.ofertaId = "+e,r.dataSources.items[0].sqlCommand=s,n.report=r,n.renderHtml("report_viewer")},t.prototype.cancel=function(){$$("ofertasEpisReport").hide()},t}(n.c);t.default=c},function(e,t,o){"use strict";o.d(t,"a",(function(){return n}));o(16);var i=o(1),n={getCapitulos:function(){return new webix.promise((function(e,t){i.a.getConfig().then((function(e){var t=e.urlApi+"/api/grupo_articulo/departamento/son/tecnicos/5";return webix.ajax().timeout(1e4).headers({"Content-Type":"application/json"}).get(t)})).then((function(t){e(t.json())})).catch((function(e){t(e)}))}))},getCapitulo:function(e){return new webix.promise((function(t,o){i.a.getConfig().then((function(t){var o=t.urlApi+"/api/grupo_articulo/"+e;return webix.ajax().timeout(1e4).headers({"Content-Type":"application/json"}).get(o)})).then((function(e){t(e.json())})).catch((function(e){o(e)}))}))},getCapitulosPorGrupo:function(e){return new webix.promise((function(t,o){i.a.getConfig().then((function(t){var o=t.urlApi+"/api/grupo_articulo/departamento/son/tecnicos/5/"+e;return webix.ajax().timeout(1e4).headers({"Content-Type":"application/json"}).get(o)})).then((function(e){t(e.json())})).catch((function(e){o(e)}))}))},postCapitulo:function(e){return new webix.promise((function(t,o){i.a.getConfig().then((function(t){var o=t.urlApi+"/api/grupo_articulo/tecnicos";return webix.ajax().timeout(1e4).headers({"Content-Type":"application/json"}).post(o,{capitulo:e})})).then((function(e){t(e.json())})).catch((function(e){o(e)}))}))},putCapitulo:function(e){return new webix.promise((function(t,o){i.a.getConfig().then((function(t){var o=t.urlApi+"/api/grupo_articulo/tecnicos/"+e.grupoArticuloId;return webix.ajax().timeout(1e4).headers({"Content-Type":"application/json"}).put(o,{capitulo:e})})).then((function(e){t(e.json())})).catch((function(e){o(e)}))}))},deleteCapitulo:function(e){return new webix.promise((function(t,o){i.a.getConfig().then((function(t){var o=t.urlApi+"/api/grupo_articulo/"+e;return webix.ajax().timeout(1e4).headers({"Content-Type":"application/json"}).del(o)})).then((function(e){t(e.json())})).catch((function(e){o(e)}))}))}}},function(e,t,o){"use strict";o.d(t,"a",(function(){return n}));var i=o(1),n={getAgentes:function(){return new webix.promise((function(e,t){i.a.getConfig().then((function(e){var t=e.urlApi+"/api/comerciales/agentes/activos";return webix.ajax().timeout(1e4).headers({"Content-Type":"application/json"}).get(t)})).then((function(t){e(t.json())})).catch((function(e){t(e)}))}))},getAgentesNombre:function(e){return new webix.promise((function(t,o){i.a.getConfig().then((function(t){var o=t.urlApi+"/api/comerciales/agentes_activos/?nombre="+e;return webix.ajax().timeout(1e4).headers({"Content-Type":"application/json"}).get(o)})).then((function(e){t(e.json())})).catch((function(e){o(e)}))}))},getAgente:function(e){return new webix.promise((function(t,o){i.a.getConfig().then((function(t){var o=t.urlApi+"/api/comerciales/"+e;return webix.ajax().timeout(1e4).headers({"Content-Type":"application/json"}).get(o)})).then((function(e){t(e.json())})).catch((function(e){o(e)}))}))},getAgenteCliente:function(e){return new webix.promise((function(t,o){i.a.getConfig().then((function(t){var o=t.urlApi+"/api/comerciales/agente/cliente/"+e;return webix.ajax().timeout(1e4).headers({"Content-Type":"application/json"}).get(o)})).then((function(e){t(e.json())})).catch((function(e){o(e)}))}))},getSyncAgentes:function(){var e=i.a.geturlApi()+"/api/comerciales/",t=webix.ajax().headers({"Content-Type":"application/json"}).sync().get(e),o={data:null,err:null};return 200!=t.status?o.err=t:o.data=JSON.parse(t.response),o},getAgentesActivosQuery:function(e){return new webix.promise((function(t,o){i.a.getConfig().then((function(t){var o=t.urlApi+"/api/comerciales/activos?nombre="+e;return webix.ajax().timeout(2e4).headers({"Content-Type":"application/json"}).get(o)})).then((function(e){t(e.json())})).catch((function(e){o(e)}))}))},getComisionAgente:function(e,t,o){return new webix.promise((function(n,r){i.a.getConfig().then((function(i){var n=i.urlApi+"/api/comerciales/comision";return n+="/"+e,n+="/"+t,n+="/"+o,webix.ajax().timeout(2e4).headers({"Content-Type":"application/json"}).get(n)})).then((function(e){n(e.json())})).catch((function(e){r(e)}))}))}}},function(e,t,o){"use strict";o.d(t,"a",(function(){return n}));var i=o(1),n={getArticulos:function(){return new webix.promise((function(e,t){i.a.getConfig().then((function(e){var t=e.urlApi+"/api/articulos/";return webix.ajax().timeout(1e4).headers({"Content-Type":"application/json"}).get(t)})).then((function(t){e(t.json())})).catch((function(e){t(e)}))}))},getArticulosGrupo:function(e){return new webix.promise((function(t,o){i.a.getConfig().then((function(t){var o=t.urlApi+"/api/articulos/grupo/"+e;return webix.ajax().timeout(1e4).headers({"Content-Type":"application/json"}).get(o)})).then((function(e){t(e.json())})).catch((function(e){o(e)}))}))},getArticulo:function(e){return new webix.promise((function(t,o){i.a.getConfig().then((function(t){var o=t.urlApi+"/api/articulos/"+e;return webix.ajax().timeout(1e4).headers({"Content-Type":"application/json"}).get(o)})).then((function(e){t(e.json())})).catch((function(e){o(e)}))}))},getGruposArticulos:function(){return new webix.promise((function(e,t){i.a.getConfig().then((function(e){var t=e.urlApi+"/api/grupo_articulo/departamento/5";return webix.ajax().timeout(1e4).headers({"Content-Type":"application/json"}).get(t)})).then((function(t){e(t.json())})).catch((function(e){t(e)}))}))},getGrupoArticulos:function(e){return new webix.promise((function(t,o){i.a.getConfig().then((function(t){var o=t.urlApi+"/api/grupo_articulo/"+e;return webix.ajax().timeout(1e4).headers({"Content-Type":"application/json"}).get(o)})).then((function(e){t(e.json())})).catch((function(e){o(e)}))}))},getArticuloCodigo:function(e){return new webix.promise((function(t,o){i.a.getConfig().then((function(t){var o=t.urlApi+"/api/articulos/codigo/"+e;return webix.ajax().timeout(1e4).headers({"Content-Type":"application/json"}).get(o)})).then((function(e){t(e.json())})).catch((function(e){o(e)}))}))},getArticulosTarifas:function(e,t,o){return new webix.promise((function(n,r){i.a.getConfig().then((function(i){var n=i.urlApi+"/api/articulos/tarifas/cliente/proveedor/"+e+"/"+t+"/"+o;return webix.ajax().timeout(1e4).headers({"Content-Type":"application/json"}).get(n)})).then((function(e){n(e.json())})).catch((function(e){r(e)}))}))},postArticulo:function(e){return new webix.promise((function(t,o){i.a.getConfig().then((function(t){var o=t.urlApi+"/api/articulos";return webix.ajax().timeout(1e4).headers({"Content-Type":"application/json"}).post(o,{articulo:e})})).then((function(e){t(e.json())})).catch((function(e){o(e)}))}))},putArticulo:function(e){return new webix.promise((function(t,o){i.a.getConfig().then((function(t){var o=t.urlApi+"/api/articulos/"+e.articuloId;return webix.ajax().timeout(1e4).headers({"Content-Type":"application/json"}).put(o,{articulo:e})})).then((function(e){t(e.json())})).catch((function(e){o(e)}))}))},deleteArticulo:function(e){return new webix.promise((function(t,o){i.a.getConfig().then((function(t){var o=t.urlApi+"/api/articulo/"+e;return webix.ajax().timeout(1e4).headers({"Content-Type":"application/json"}).del(o)})).then((function(e){t(e.json())})).catch((function(e){o(e)}))}))}}},function(e,t,o){"use strict";o.d(t,"a",(function(){return O}));var i,n,r,a,s,c=o(0),l=o(2),u=(o(8),o(1)),d=function(){return new webix.promise((function(e,t){u.a.getConfig().then((function(e){var t=e.urlApi+"/api/tipos_iva";return webix.ajax().timeout(1e4).headers({"Content-Type":"application/json"}).get(t)})).then((function(t){e(t.json())})).catch((function(e){t(e)}))}))},p=function(e){return new webix.promise((function(t,o){u.a.getConfig().then((function(t){var o=t.urlApi+"/api/tipos_iva/"+e;return webix.ajax().timeout(1e4).headers({"Content-Type":"application/json"}).get(o)})).then((function(e){t(e.json())})).catch((function(e){o(e)}))}))},f=function(){return new webix.promise((function(e,t){u.a.getConfig().then((function(e){var t=e.urlApi+"/api/unidades/";return webix.ajax().timeout(1e4).headers({"Content-Type":"application/json"}).get(t)})).then((function(t){e(t.json())})).catch((function(e){t(e)}))}))},h=o(5),m=o(13),g=function(){return new webix.promise((function(e,t){u.a.getConfig().then((function(e){var t=e.urlApi+"/api/tipos_profesional";return webix.ajax().timeout(1e4).headers({"Content-Type":"application/json"}).get(t)})).then((function(t){e(t.json())})).catch((function(e){t(e)}))}))},b=!1,v={getGridTarifasWindow:function(e){var t;if(!b){var o=e.getService("locale")._,r={rows:[{cols:[{view:"combo",id:"cmbTiposProf",name:"tipoProfesionalId",options:{},label:"Tipo profesional",labelPosition:"top",width:200,on:{onChange:function(e,t){var o=e;(o||""!=o)&&v.loadGridTarifas(i,n,o)}}},{minWidth:240},{view:"text",id:"tarifaClienteNombre",value:0,name:"tarifaClienteNombre",minWidth:100,disabled:!0},{view:"text",id:"tarifaProveedorNombre",value:0,name:"tarifaProveedorNombre",minWidth:100,disabled:!0}]}]},a={rows:[{view:"toolbar",padding:3,elements:[{view:"icon",icon:"mdi mdi-archive",width:37,align:"left"},{view:"label",label:"Tarifas"}]},{cols:[{view:"button",type:"icon",icon:"mdi mdi-refresh",width:37,align:"left",hotkey:"Ctrl+R",tooltip:o("Refrescar la lista (Ctrl+R)"),click:function(){v.cleanAndload()}},{view:"button",type:"icon",icon:"wxi-download",width:37,align:"right",tooltip:o("Descargar como Excel"),click:function(){webix.toExcel($$("tarifasGrid"),{filename:"tarifas",name:"tarifas",rawValues:!0,ignore:{actions:!0}})}},{view:"label",id:"TarifasNReg",label:"NREG: "},{view:"pager",id:"mypagerTarifas",css:{"text-align":"right"},template:"{common.first()} {common.prev()} {common.pages()} {common.next()} {common.last()}",size:25,group:5}]},r,((t={view:"datatable",css:{"font-size":"0.9em","font-weight":"bold"},height:550,id:"tarifasGrid",scroll:"x,y",pager:"mypagerTarifas",select:"row",columns:[{id:"articuloId",header:["Id",{content:"textFilter"}],sort:"int",width:50,hidden:!0},{id:"codigoReparacion",header:["Codigo reparación",{content:"textFilter"}],sort:"string",width:60},{id:"abrev",header:["Unidad",{content:"textFilter"}],sort:"string",width:50},{id:"nombre",header:["Nombre",{content:"textFilter"}],sort:"string",width:350},{id:"precioCliente",header:["Precio cli",{content:"textFilter"}],sort:"int",format:webix.i18n.numberFormat,width:110},{id:"precioProveedor",header:["Precio pro.",{content:"textFilter"}],sort:"int",format:webix.i18n.numberFormat,width:110}]}).scroll=!0,t.on={onItemDblClick:function(e,t,o){this.data.pull[e.row];$$("tarifasGridWindow").hide()}},t.onClick={onEdit:function(e,t,o){this.data.pull[t.row]}},t.editable=!0,t.editaction="dblclick",t.rules={},t)]};webix.ui({view:"window",id:"tarifasGridWindow",position:"center",move:!0,resize:!1,width:690,height:690,head:{view:"toolbar",cols:[{},{view:"icon",icon:"mdi mdi-close",click:function(){$$("tarifasGridWindow").hide()}}]},modal:!0,body:a}),b=!0}},loadWindow:function(e,t,o){i=e,n=t,$$("tarifasGridWindow").show(),v.loadTiposProfesionales(o),v.loadGridTarifas(i,n,o)},loadGridTarifas:function(e,t,o){o&&""!=o||(o=0),m.a.getArticulosTarifas(e,t,o).then((function(e){var t;if(!(e.length>0)){$$("tarifasGrid").clearAll();var o=$$("tarifasGrid").count();return $$("TarifasNReg").config.label="NREG: "+o,void $$("TarifasNReg").refresh()}t=v.formateaData(e),$$("tarifasGrid").clearAll(),$$("tarifasGrid").parse(l.a.prepareDataForDataTable("articuloId",t));o=$$("tarifasGrid").count();$$("TarifasNReg").config.label="NREG: "+o,$$("TarifasNReg").refresh()})).catch((function(e){-1!=e.response.indexOf("Cannot delete or update a parent row: a foreign key constraint fails")?c.a.errorRestriccion():c.a.errorMessageAjax(e)}))},formateaData:function(e){var t=[];return $$("tarifaClienteNombre").setValue(e[0].tarifaClienteNombre),$$("tarifaProveedorNombre").setValue(e[0].tarifaProveedorNombre),e.forEach((function(e){delete e.tarifaClienteId,delete e.tarifaClienteNombre,delete e.tarifaProveedorNombre,delete e.tarifaProveedorId,t.push(e)})),t},loadTiposProfesionales:function(e){g().then((function(t){t.splice(0,0,{tipoProfesionalId:0,nombre:""});var o=l.a.prepareDataForCombo("tipoProfesionalId","nombre",t),i=$$("cmbTiposProf").getPopup().getList();i.clearAll(),i.parse(o),e?($$("cmbTiposProf").setValue(e),$$("cmbTiposProf").refresh()):($$("cmbTiposProf").setValue(null),$$("cmbTiposProf").refresh())}))},cleanAndload:function(){$$("tarifasGrid").eachColumn((function(e,t){if("actions"!=t.id){var o=this.getFilter(e);o&&(o.setValue?o.setValue(""):o.value="")}})),this.load()}},w=(o(26),o(18)),x=o(11),$=o(19),y=!1,C=null,j=null,A=!1,I=!1,E=0,P=0,F=0,O={getWindow:function(e){var t,o;if(!y){v.getGridTarifasWindow(e),r=e.getService("locale")._;var i=((o={view:"form",id:"LineasOfertafrm",scroll:"y"}).scroll=!0,o.elements=[{template:"Linea del oferta",type:"section"},{view:"fieldset",label:"GENERAL",id:"general",body:{rows:[{rows:[{cols:[{view:"text",id:"capituloLinea",name:"capituloLinea",required:!0,label:"Texto del capitulo",labelPosition:"top",disabled:!0}]},{cols:[{view:"text",id:"linea",name:"linea",required:!0,label:"Linea",labelPosition:"top",width:80},{view:"combo",id:"cmbGrupoArticulo",name:"grupoArticuloId",required:!0,options:{},label:"Capítulo",labelPosition:"top",minwidth:250},{view:"combo",id:"cmbArticulos",name:"articuloId",minwidth:200,label:"Unidad constructiva",labelPosition:"top",options:{filter:function(e,t){var o=e.id;return-1!==e.value.toLowerCase().indexOf(t)||o==t}}},(t={view:"combo",id:"cmbUnidades",name:"unidadId",options:{},label:"Unidades",labelPosition:"top",width:120},t.width=150,t),{view:"counter",id:"cantidad",name:"cantidad",required:!0,step:1,label:"Cantidad",labelPosition:"top",width:100,css:"custom-counter",on:{onChange:function(e){F=e;var t=$$("cantidad").getValue(),o=$$("importeCliente").getValue();if(""!=o){o=parseFloat(o);var i=parseFloat(t*o);$$("precioCliente").setValue(parseFloat(i));var n=$$("dto").getValue();""!=n||n>0?(n=parseFloat(n),$$("coste").setValue(i-n)):$$("coste").setValue(i)}},onClick:function(){this.setValue(F);var e=$$("cantidad").getValue(),t=$$("importeCliente").getValue();if(""!=t){t=parseFloat(t);var o=parseFloat(e*t);$$("precioCliente").setValue(parseFloat(o));var i=$$("dto").getValue();""!=i||i>0?(i=parseFloat(i),$$("coste").setValue(o-i)):$$("coste").setValue(o)}}}}]},{cols:[{view:"textarea",id:"descripcion",name:"descripcion",label:"Descripción",labelPosition:"top",height:170}]}]}]}},{view:"fieldset",label:"CLIENTE",id:"cliente",body:{rows:[{cols:[{view:"combo",id:"cmbTiposIva",name:"tipoIvaId",required:!0,options:{},label:"IVA",labelPosition:"top",width:180,hidden:!0},{view:"text",id:"porcentaje",name:"porcentaje",label:"Porcentaje",labelPosition:"top",minwidth:80,format:"1.00",hidden:!0},{view:"text",id:"importeCliente",name:"importe",label:"coste/ud",labelPosition:"top",minwidth:80,format:{edit:function(e){return webix.Number.format(e,webix.i18n)},parse:function(e){return webix.Number.parse(e,webix.i18n)}}},{view:"text",id:"perdto",name:"perdto",label:"% Descuento",labelPosition:"top",minwidth:80,format:{edit:function(e){return webix.Number.format(e,webix.i18n)},parse:function(e){return webix.Number.parse(e,webix.i18n)}}}]},{cols:[{view:"text",id:"precioCliente",value:0,name:"precio",required:!0,label:"Precio",labelPosition:"top",minWidth:100,format:"1,00",disabled:!0},{view:"text",id:"dto",value:0,name:"dto",required:!0,disabled:!0,label:"Importe descuento",labelPosition:"top",minWidth:100,format:"1.00"},{view:"text",id:"coste",name:"coste",disabled:!0,label:"total coste",labelPosition:"top",minwidth:80,format:"1,00"}]}]}},{margin:5,cols:[{gravity:5},{view:"button",id:"btnCancelarWindowLineaOferta",label:r("Cancelar"),click:O.cancel,hotkey:"esc"},{view:"button",id:"btnAceptarWindowLineaOferta",label:r("Aceptar"),click:O.accept,type:"form"}]}],o);webix.ui({view:"window",id:"lineasOfertaWindow",position:"top",move:!0,resize:!0,width:1100,height:700,head:{view:"toolbar",cols:[{},{view:"icon",icon:"mdi mdi-close",click:function(){$$("lineasOfertaWindow").hide()}}]},modal:!0,body:i}),y=!0,$$("cmbGrupoArticulo").attachEvent("onChange",(function(e,t){""!=e&&(O.loadGruposArticulo(e,null),O.loadArticulos(e,null),O.crearTextoDeCapituloAutomatico(e),O.loadCapituloData(e))})),$$("cmbArticulos").attachEvent("onChange",(function(e,t){e&&""!=e&&O.cambioArticulo(e)})),$$("cantidad").attachEvent("onBlur",(function(e,t){var o=$$("cantidad").getValue(),i=$$("importeCliente").getValue();if(""!=i){i=parseFloat(i);var n=parseFloat(o*i);$$("precioCliente").setValue(parseFloat(n));var r=$$("dto").getValue();""!=r||r>0?(r=parseFloat(r),$$("coste").setValue(n-r)):$$("coste").setValue(n)}})),$$("importeCliente").attachEvent("onChange",(function(e,t){""==e&&(e=0);var o=parseFloat(e);if(""!=(i=$$("cantidad").getValue()))var i=parseFloat(i);if(""!=i){var n=parseFloat(i*o);$$("precioCliente").setValue(parseFloat(n));var r=$$("dto").getValue();""!=r||r>0?(r=parseFloat(r),$$("coste").setValue(n-r)):$$("coste").setValue(n)}})),$$("perdto").attachEvent("onBlur",(function(e,t){var o=$$("perdto").getValue(),i=$$("precioCliente").getValue();if((o>0||""!=o)&&(i>0||""!=i)){o=parseFloat(o),i=parseFloat(i),o/=100;var n=parseFloat(i*o);$$("dto").setValue(n);var r=parseFloat(i-n);$$("coste").setValue(r)}}))}},loadWindow:function(e,t,o,i,n,r,l){$$("LineasOfertafrm").clear(),a=e,s=t,o,r?j=r:$.a.getParametros().then((function(e){e&&e[0].indiceCorrector&&(E=e[0].indiceCorrector),P=l})).catch((function(e){c.a.errorMessageAjax(e)})),$$("lineasOfertaWindow").show(),s?(A=!0,O.bloqueaEventos()):($$("cmbGrupoArticulo").blockEvent(),A=!1,O.limpiaWindow(i,n)),O.loadTiposIva(4)},limpiaWindow:function(e,t){$$("porcentaje").setValue(0),$$("importeCliente").setValue(0),$$("perdto").setValue(0),$$("dto").setValue(0),$$("coste").setValue(0),$$("precioCliente").setValue(0),$$("perdto").setValue(0),$$("dto").setValue(0),$$("descripcion").setValue(""),e&&t?O.loadGruposArticulo(e,t):O.loadGruposArticulo(null,null),O.loadUnidades(9),O.nuevaLinea(e)},loadCapituloData:function(e){x.a.getCapitulo(e).then((function(e){e&&(j={indiceCorrector:E,porcen1:e.porcen1/100,porcen2:e.porcen2/100,porcen3:e.porcen3/100,porcen4:e.porcen4/100,importeObra:P,limiteImpObra:e.limiteImpObra})}))},calcularCosto:function(){var e=void 0;j.importeObra>j.limiteImpObra?e=j.importeObra*j.porcen1:e=j.importeObra*j.porcen2<j.costeArticulo?j.costeArticulo:j.importeObra*j.porcen3+(j.limiteImpObra-j.importeObra)*j.porcen4;j.indiceCorrector,$$("importeCliente").setValue(e),O.desbloqueaEventos(),A=!0},crearTextoDeCapituloAutomatico:function(e){var t="Capitulo "+Math.floor($$("linea").getValue())+": ";m.a.getGrupoArticulos(e).then((function(e){$$("capituloLinea").getValue()!=(t+=e.nombre)&&$$("capituloLinea").setValue(t)})).catch((function(e){c.a.errorMessageAjax(e)}))},nuevaLinea:function(e){h.a.getSiguienteLinea(a).then((function(t){t&&($$("linea").setValue(t),e&&(O.crearTextoDeCapituloAutomatico(e),O.loadCapituloData(e)))})).catch((function(e){c.a.errorMessageAjax(e)}))},bloqueaEventos:function(){$$("importeCliente").blockEvent(),$$("cmbArticulos").blockEvent(),$$("cmbGrupoArticulo").blockEvent(),h.a.getLineaOferta(s).then((function(e){var t=e[0];$$("LineasOfertafrm").clear(),$$("LineasOfertafrm").setValues(t),O.loadUnidades(t.unidadId),O.recuperaCapituloId(t.articuloId,!0)})).catch((function(e){c.a.errorMessageAjax(e)}))},recuperaCapituloId:function(e){m.a.getArticulo(e).then((function(t){t&&O.loadGruposArticulo(t.grupoArticuloId,e)})).catch((function(e){c.a.errorMessageAjax(e)}))},desbloqueaEventos:function(){$$("importeCliente").unblockEvent(),$$("cmbArticulos").unblockEvent(),$$("cmbGrupoArticulo").unblockEvent()},accept:function(){$$("LineasOfertafrm").validate()?O.enviaDatos():c.a.errorMessage("Debe rellenar los campos correctamente")},enviaDatos:function(){var e=$$("LineasOfertafrm").getValues();(e=O.formateaDatos(e)).ofertaLineaId?h.a.putLineaOferta(e,e.ofertaLineaId).then((function(e){$$("lineasOfertaWindow").hide(),O.refreshGridCloseWindow(a)})).catch((function(e){-1!=e.response.indexOf("Cannot delete or update a parent row: a foreign key constraint fails")?c.a.errorRestriccion():c.a.errorMessageAjax(e)})):(e.ofertaLineaId=0,h.a.postLineaOferta(e).then((function(e){$$("lineasOfertaWindow").hide(),O.refreshGridCloseWindow(a)})).catch((function(e){c.a.errorMessageAjax(e)})))},formateaDatos:function(e){return delete e.unidades,delete e.grupoArticuloId,e.ofertaId=a,e.totalLinea=$$("coste").getValue(),e.porcentajeBeneficio=0,e.porcentajeAgente=0,e.importeProveedor=$$("importeCliente").getValue(),s||(e.ofertaLineaId=0),e},preparaDatos:function(e){return delete e.cmbDescripcion,delete e.tipoProfesionalId,e.descripcion=$$("descripcion").getValue(),e},updateFacprove:function(e,t){facturacionService.putLineaFacprove(e,t).then((function(e){})).catch((function(e){-1!=e.response.indexOf("Cannot delete or update a parent row: a foreign key constraint fails")?c.a.errorRestriccion():c.a.errorMessageAjax(e)}))},updateFactura:function(e){e.clienteId=$$("cliId").getValue(),facturacionService.putLineaFactura(e).then((function(e){})).catch((function(e){-1!=e.response.indexOf("Cannot delete or update a parent row: a foreign key constraint fails")?c.a.errorRestriccion():c.a.errorMessageAjax(e)}))},cancel:function(){$$("lineasOfertaWindow").hide()},refreshGridCloseWindow:function(e){e&&O.refreshLineas(e)},refreshLineas:function(e){h.a.getLineasOferta(e).then((function(e){var t=0;if(null!=e||e.length>0){$$("lineasOfertaGrid").clearAll(),$$("lineasOfertaGrid").parse(l.a.prepareDataForDataTable("ofertaLineaId",e));var o=$$("lineasOfertaGrid").count();$$("ofertasLineasNReg").config.label="NREG: "+o,$$("ofertasLineasNReg").refresh(),$$("lineasOfertaWindow").hide();for(var i=0;i<e.length;i++)t+=e[i].totalLinea,$$("importeCli").setValue(t)}else $$("lineasOfertaWindow").hide(),$$("importeCli").setValue(t)})).catch((function(e){c.a.errorMessageAjax(e)}))},refreshBases:function(e){h.a.getBasesOferta(e).then((function(e){if(e.length>0){$$("basesOfertaGrid").clearAll(),$$("basesOfertaGrid").parse(l.a.prepareDataForDataTable("ofertaBaseId",e));var t=$$("basesOfertaGrid").count();$$("basesLineasNReg").config.label="NREG: "+t,$$("basesLineasNReg").refresh()}else $$("basesOfertaGrid").clearAll()})).catch((function(e){c.a.errorMessageAjax(e)}))},loadCmbDescripcion:function(e){var t=$$("descripcion").getValue(),o=l.a.prepareDataForCombo("codigoReparacion","nombre",void 0),i=$$("cmbDescripcion").getPopup().getList();$$("descripcion").getValue();i.clearAll(),i.parse(o),e&&($$("cmbDescripcion").setValue(e),$$("cmbDescripcion").refresh(),(C&&C!=e||""==t)&&$$("descripcion").setValue($$("cmbDescripcion").getText()),C=e)},loadTiposIva:function(e){d().then((function(t){var o=l.a.prepareDataForCombo("tipoIvaId","nombre",t);o.push({id:null,value:""});var i=$$("cmbTiposIva").getPopup().getList();i.clearAll(),i.parse(o),$$("cmbTiposIva").setValue(e),$$("cmbTiposIva").refresh()}))},loadGruposArticulo:function(e,t){x.a.getCapitulos().then((function(o){var i=l.a.prepareDataForCombo("grupoArticuloId","nombre",o),n=$$("cmbGrupoArticulo").getPopup().getList();if(n.clearAll(),n.parse(i),e){var r=o.find((function(t){return t.grupoArticuloId==e}));r&&(I=r.aplicarFormula,$$("cmbGrupoArticulo").setValue(e),$$("cmbGrupoArticulo").refresh(),O.loadArticulos(e,t))}else $$("cmbGrupoArticulo").setValue(null),$$("cmbGrupoArticulo").refresh(),O.loadArticulos(null,t)}))},loadArticulos:function(e,t){e?m.a.getArticulosGrupo(e).then((function(e){if(e){var o=l.a.prepareDataForCombo("articuloId","nombre",e),i=$$("cmbArticulos").getPopup().getList();i.clearAll(),i.parse(o),$$("cmbArticulos").setValue(t),$$("cmbArticulos").refresh(),A?O.desbloqueaEventos():O.recuperaCosteArticulo(t)}})):m.a.getArticulos().then((function(e){if(e){var o=l.a.prepareDataForCombo("articuloId","nombre",e),i=$$("cmbArticulos").getPopup().getList();i.clearAll(),i.parse(o),$$("cmbArticulos").setValue(t),$$("cmbArticulos").refresh(),O.desbloqueaEventos()}}))},loadUnidades:function(e){f().then((function(t){var o=l.a.prepareDataForCombo("unidadId","abrev",t),i=$$("cmbUnidades").getPopup().getList();i.clearAll(),i.parse(o),$$("cmbUnidades").setValue(e),$$("cmbUnidades").refresh()}))},cambioArticulo:function(e){m.a.getArticulo(e).then((function(t){t&&($$("cmbUnidades").setValue(t.unidadId),$$("cmbUnidades").refresh(),$$("descripcion").setValue(t.descripcion),$$("cantidad").setValue(1),O.recuperaCosteArticulo(e))})).catch((function(e){c.a.errorMessageAjax(e)}))},cambioTipoIva:function(e){p(e).then((function(e){e&&$$("porcentaje").setValue(e.porcentaje)}))},recuperaCosteArticulo:function(e){e&&w.a.getUnidadObra(e).then((function(e){e&&(I?(j.costeArticulo=e.coste,O.calcularCosto()):($$("importeCliente").setValue(e.coste),O.desbloqueaEventos()))})).catch((function(e){-1!=e.response.indexOf("Cannot delete or update a parent row: a foreign key constraint fails")?c.a.errorRestriccion():c.a.errorMessageAjax(e)}))}}},function(e,t,o){"use strict";o.d(t,"a",(function(){return n}));var i=o(1),n={getEmpresas:function(){return new webix.promise((function(e,t){i.a.getConfig().then((function(e){var t=e.urlApi+"/api/empresas";return webix.ajax().timeout(1e4).headers({"Content-Type":"application/json"}).get(t)})).then((function(t){e(t.json())})).catch((function(e){t(e)}))}))},getEmpresa:function(e){return new webix.promise((function(t,o){i.a.getConfig().then((function(t){var o=t.urlApi+"/api/empresas/"+e;return webix.ajax().timeout(1e4).headers({"Content-Type":"application/json"}).get(o)})).then((function(e){t(e.json())})).catch((function(e){o(e)}))}))},postEmpresa:function(e){return new webix.promise((function(t,o){i.a.getConfig().then((function(t){var o=t.urlApi+"/api/empresas";return webix.ajax().timeout(1e4).headers({"Content-Type":"application/json"}).post(o,{empresa:e})})).then((function(e){t(e.json())})).catch((function(e){o(e)}))}))},putEmpresa:function(e){return new webix.promise((function(t,o){i.a.getConfig().then((function(t){var o=t.urlApi+"/api/empresas";return webix.ajax().timeout(1e4).headers({"Content-Type":"application/json"}).put(o,{empresa:e})})).then((function(e){t(e.json())})).catch((function(e){o(e)}))}))},deleteEmpresa:function(e){return new webix.promise((function(t,o){i.a.getConfig().then((function(t){var o=t.urlApi+"/api/empresas/"+e;return webix.ajax().timeout(1e4).headers({"Content-Type":"application/json"}).del(o)})).then((function(e){t(e.json())})).catch((function(e){o(e)}))}))}}},function(e,t,o){"use strict";o.d(t,"a",(function(){return i}));var i={areCookiesEnabled:function(){var e=!!navigator.cookieEnabled;return void 0!==navigator.cookieEnabled||e||(document.cookie="testcookie",e=-1!=document.cookie.indexOf("testcookie")),e},setCookie:function(e,t,o){i.areCookiesEnabled()||alert("NO COOKIES");var n=new Date;n.setDate(n.getDate()+o);var r=encodeURI(t)+(null==o?"":"; expires="+n.toUTCString());document.cookie=e+"="+r},deleteCookie:function(e){i.areCookiesEnabled()||alert("NO COOKIES"),document.cookie=e+"=;expires=Thu, 01 Jan 1970 00:00:01 GMT;"},getCookie:function(e){var t,o,i,n=document.cookie.split(";");for(t=0;t<n.length;t++)if(o=n[t].substr(0,n[t].indexOf("=")),i=n[t].substr(n[t].indexOf("=")+1),(o=o.replace(/^\s+|\s+$/g,""))==e)return decodeURI(i)}}},function(e,t,o){"use strict";o.d(t,"a",(function(){return l}));var i,n=o(0),r=o(2),a=o(5),s=o(14),c=0,l={getGrid:function(e){var t=e.getService("locale")._;try{s.a.getWindow(e)}catch(e){console.log(e)}return"<span class='onDelete webix_icon wxi-trash'></span>",{view:"layout",id:"lineasDelOferta",rows:[{view:"toolbar",padding:3,elements:[{view:"icon",icon:"mdi mdi-folder-network-outline",width:37,align:"left"},{view:"label",label:t("PARTIDAS")}]},{cols:[{view:"button",id:"btnNew3",type:"icon",icon:"wxi-plus",width:37,align:"left",hotkey:"Ctrl+A",tooltip:t("Nuevo registro en formulario (Ctrl+A)"),click:function(){if(i)try{var e=$$("cmbClientes").getValue();s.a.loadWindow(i,null,e,null,null,null,c)}catch(e){console.log(e)}else n.a.errorMessage(t("Debe dar de alta el oferta antes las lineas"))}},{view:"label",id:"ofertasLineasNReg",label:"NREG: "},{view:"pager",id:"mypager3",css:{"text-align":"right"},template:"{common.first()} {common.prev()} {common.pages()} {common.next()} {common.last()}",size:25,group:5}]},{view:"datatable",scroll:"x",id:"lineasOfertaGrid",pager:"mypager3",select:"row",autoheight:!0,footer:!1,ready:function(){$$("lineasOfertaGrid").attachEvent("onItemDblClick",(function(e,t,o){var i=this.data.pull[e.row],n=$$("cmbClientes").getValue();s.a.loadWindow(i.ofertaId,i.ofertaLineaId,n,null,null,null,c)}))},columns:[{id:"ofertaLineaId",header:[t("Id"),{content:"textFilter"}],sort:"string",width:50,hidden:!0},{id:"ofertaId",header:[t("Id"),{content:"textFilter"}],sort:"string",width:50,hidden:!0},{id:"linea",header:[t("Linea"),{content:"textFilter"}],sort:"string",width:60},{id:"unidades",header:[t("Uds."),{content:"textFilter"}],sort:"string",width:40},{id:"descripcion",header:[t("Concepto"),{content:"textFilter"}],sort:"string",fillspace:!0},{id:"importe",header:[t("€/Ud. Cli."),{content:"textFilter"}],sort:"string",width:80,format:webix.i18n.numberFormat,css:{"text-align":"right"}},{id:"cantidad",header:[t("Cant."),{content:"textFilter"}],sort:"string",width:50,css:{"text-align":"right"}},{id:"dto",header:[t("Descuento"),{content:"textFilter"}],sort:"string",width:100,format:webix.i18n.numberFormat,css:{"text-align":"right"}},{id:"costeLinea",header:[t("Imp cli."),{content:"textFilter"}],sort:"string",width:80,format:webix.i18n.numberFormat,css:{"text-align":"right"}},{id:"actions",header:[{text:t("Acciones"),css:{"text-align":"center"}}],template:"<span class='onEdit webix_icon wxi-pencil'></span><span class='onDelete webix_icon wxi-trash'></span>"}],rightSplit:1,onClick:{onDelete:function(t,o,i){o=o.row;var n=this.data.pull[o];l.delete(o,n,e)},onEdit:function(e,t,o){var i=this.data.pull[t.row],n=$$("cmbClientes").getValue();s.a.loadWindow(i.ofertaId,i.ofertaLineaId,n)}},editable:!0,editaction:"dblclick",rules:{},on:{onAfterEditStart:function(e){},onAfterEditStop:function(e,t,o){},onAfterFilter:function(){var e=$$("lineasOfertaGrid").count();$$("ofertasLineasNReg").config.label="NREG: "+e,$$("ofertasLineasNReg").refresh()}}}]}},loadGrid:function(e,t,o){c=o,t,0,(i=e)?a.a.getLineasOferta(i).then((function(e){var t=0;if(e.length>0){$$("lineasOfertaGrid").clearAll(),$$("lineasOfertaGrid").parse(r.a.prepareDataForDataTable("ofertaLineaId",e));var o=$$("lineasOfertaGrid").count();$$("ofertasLineasNReg").config.label="NREG: "+o,$$("ofertasLineasNReg").refresh();for(var i=0;i<e.length;i++)t+=e[i].totalLinea,$$("importeCli").setValue(t)}else $$("lineasOfertaGrid").clearAll(),$$("importeCli").setValue(t)})).catch((function(e){n.a.errorMessageAjax(e)})):$$("lineasOfertaGrid").clearAll()},delete:function(e,t,o){var r=o.getService("locale")._;webix.confirm({title:r("AVISO"),text:r("Está seguro que desea eliminar la linea "),type:"confirm-warning",callback:function(o){!0===o&&a.a.deleteLineaOferta(e,t).then((function(e){l.loadGrid(i)})).catch((function(e){n.a.errorMessageAjax(e)}))}})},disparaEvento:function(){},estableceContado:function(e){setTimeout((function(){var t=0;if(e){for(var o=0;o<e.length;o++)t+=e[o].aCuentaProveedor;$$("aCuentaProfesional").setValue(t)}else $$("aCuentaProfesional").setValue(t)}),300)}}},function(e,t,o){"use strict";o.d(t,"a",(function(){return n}));var i=o(1),n={getUnidadesObra:function(e,t){return new webix.promise((function(o,n){i.a.getConfig().then((function(o){var i=o.urlApi+"/api/articulos/usuario/departamento/tecnico/"+e+"/"+t;return webix.ajax().timeout(1e4).headers({"Content-Type":"application/json"}).get(i)})).then((function(e){o(e.json())})).catch((function(e){n(e)}))}))},getUnidadObra:function(e){return new webix.promise((function(t,o){i.a.getConfig().then((function(t){var o=t.urlApi+"/api/articulos/"+e;return webix.ajax().timeout(1e4).headers({"Content-Type":"application/json"}).get(o)})).then((function(e){t(e.json())})).catch((function(e){o(e)}))}))},getUnidadesObraGrupo:function(e){return new webix.promise((function(t,o){i.a.getConfig().then((function(t){var o=t.urlApi+"/api/articulos/grupo/"+e;return webix.ajax().timeout(1e4).headers({"Content-Type":"application/json"}).get(o)})).then((function(e){t(e.json())})).catch((function(e){o(e)}))}))}}},function(e,t,o){"use strict";o.d(t,"a",(function(){return n}));var i=o(1),n={getParametros:function(){return new webix.promise((function(e,t){i.a.getConfig().then((function(e){var t=e.urlApi+"/api/parametros";return webix.ajax().timeout(1e4).headers({"Content-Type":"application/json"}).get(t)})).then((function(t){e(t.json())})).catch((function(e){t(e)}))}))}}},function(e,t,o){"use strict";o.d(t,"a",(function(){return c}));var i,n,r=o(0),a=o(2),s=o(5),c=(o(10),{getGrid:function(e){var t=e.getService("locale")._;return{view:"layout",id:"poeveedoresDelaOferta",rows:[{view:"toolbar",padding:3,elements:[{view:"icon",icon:"mdi mdi-folder-network-outline",width:37,align:"left"},{view:"label",label:t("PARTIDAS")}]},{cols:[{view:"label",id:"poeveedoresNReg",label:"NREG: "},{view:"pager",id:"mypager2",css:{"text-align":"right"},template:"{common.first()} {common.prev()} {common.pages()} {common.next()} {common.last()}",size:25,group:5}]},{view:"datatable",scroll:"x",id:"proveedoresOfertaGrid",pager:"mypager2",select:"row",autoheight:!0,footer:!1,columns:[{id:"proveedorId",header:[t("Id"),{content:"textFilter"}],sort:"string",width:50,hidden:!0},{id:"proveedornombre",header:[t("Proveedor"),{content:"textFilter"}],sort:"string",fillspace:!0},{id:"totalProveedor",header:[t("Base"),{content:"textFilter"}],sort:"string",width:80,format:webix.i18n.numberFormat},{id:"totalProveedorIva",header:[t("Total"),{content:"textFilter"}],sort:"string",width:100,format:webix.i18n.numberFormat},{id:"actions",header:[{text:"Acciones",css:{"text-align":"center"}}],css:{"text-align":"center"},adjust:"all",hidden:!1,template:function(e){return null==e.proveedorId?"":"<span class='onPrint mdi mdi-printer'></span>"}}],onClick:{onDelete:function(e,t,o){},onEdit:function(e,t,o){},onPrint:function(e,t,o){var i=this.data.pull[t.row];n.showWindow(i.ofertaId,i.proveedorId,"/stireport/reports/oferta_general_proveedores.mrt")}},editable:!0,editaction:"dblclick",rules:{},on:{onAfterEditStart:function(e){},onAfterEditStop:function(e,t,o){}}}]}},loadGrid:function(e,t){var o;t&&(n=t);for(var c=$$("proveedoresOfertaGrid").config.columns,l=0;l<c.length;l++)3==l&&(c[l].hidden||(o=c[l].hidden));(i=e)?s.a.getProveedoresOferta(i).then((function(e){if(e){for(var t=0;t<e.length;t++)null==e[t].proveedorId&&(e[t].proveedornombre="Sin proveedor asignado",e[t].totalProveedorIva=e[t].totalLinea);1!=e.length||null!=e[0].proveedorId||o||$$("proveedoresOfertaGrid").hideColumn("actions"),$$("proveedoresOfertaGrid").clearAll(),$$("proveedoresOfertaGrid").parse(a.a.prepareDataForDataTable("proveedorId",e));var i=$$("proveedoresOfertaGrid").count();$$("poeveedoresNReg").config.label="NREG: "+i,$$("poeveedoresNReg").refresh()}else $$("proveedoresOfertaGrid").clearAll()})).catch((function(e){r.a.errorMessageAjax(e)})):$$("proveedoresOfertaGrid").clearAll()}})},function(e,t,o){"use strict";o.d(t,"a",(function(){return n}));var i=o(1),n={getFormasPago:function(){return new webix.promise((function(e,t){i.a.getConfig().then((function(e){var t=e.urlApi+"/api/formas_pago";return webix.ajax().timeout(1e4).headers({"Content-Type":"application/json"}).get(t)})).then((function(t){e(t.json())})).catch((function(e){t(e)}))}))}}},function(e,t,o){"use strict";o.d(t,"a",(function(){return n}));var i=o(1),n={getColaboradores:function(){return new webix.promise((function(e,t){i.a.getConfig().then((function(e){var t=e.urlApi+"/api/comerciales/colaboradores/activos";return webix.ajax().timeout(1e4).headers({"Content-Type":"application/json"}).get(t)})).then((function(t){e(t.json())})).catch((function(e){t(e)}))}))},getAgentesNombre:function(e){return new webix.promise((function(t,o){i.a.getConfig().then((function(t){var o=t.urlApi+"/api/comerciales/agentes_activos/?nombre="+e;return webix.ajax().timeout(1e4).headers({"Content-Type":"application/json"}).get(o)})).then((function(e){t(e.json())})).catch((function(e){o(e)}))}))},getAgente:function(e){return new webix.promise((function(t,o){i.a.getConfig().then((function(t){var o=t.urlApi+"/api/comerciales/"+e;return webix.ajax().timeout(1e4).headers({"Content-Type":"application/json"}).get(o)})).then((function(e){t(e.json())})).catch((function(e){o(e)}))}))},getAgenteCliente:function(e){return new webix.promise((function(t,o){i.a.getConfig().then((function(t){var o=t.urlApi+"/api/comerciales/agente/cliente/"+e;return webix.ajax().timeout(1e4).headers({"Content-Type":"application/json"}).get(o)})).then((function(e){t(e.json())})).catch((function(e){o(e)}))}))},getSyncAgentes:function(){var e=i.a.geturlApi()+"/api/comerciales/",t=webix.ajax().headers({"Content-Type":"application/json"}).sync().get(e),o={data:null,err:null};return 200!=t.status?o.err=t:o.data=JSON.parse(t.response),o},getColaboradoresActivosQuery:function(e,t){return new webix.promise((function(o,n){i.a.getConfig().then((function(o){var i=o.urlApi+"/api/comerciales/comerciales_activos/"+t+"/?nombre="+e;return webix.ajax().timeout(2e4).headers({"Content-Type":"application/json"}).get(i)})).then((function(e){o(e.json())})).catch((function(e){n(e)}))}))}}},function(e,t,o){"use strict";o.r(t);var i=o(4);function n(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function r(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}var a=function(e){function t(){return n(this,t),r(this,e.apply(this,arguments))}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(t,e),t.prototype.config=function(){var e=this.app.getService("locale")._;return{view:"sidebar",width:280,id:"main:menu",activeTitle:!0,select:!0,collapsed:!0,data:[{id:"inicio",icon:"mdi mdi-home",value:"Inicio"},{id:"administracion",icon:"mdi mdi-laptop-chromebook",value:e("Administración"),open:!1,data:[{id:"usuarios",icon:"mdi mdi-account-key",value:e("Usuarios")},{id:"tiposProyecto",icon:"mdi mdi-swap-vertical",value:e("Tipos de proyecto")},{id:"capitulos",icon:"mdi mdi-swap-vertical",value:e("Capitulos")},{id:"unidadesObra",icon:"mdi mdi-swap-vertical",value:e("Unidades de obra")}]},{id:"gestion",icon:"mdi mdi-book",value:e("Gestión"),open:!0,data:[{id:"expedientes",icon:"mdi mdi-currency-eur",value:e("Expedientes")}]}]}},t.prototype.init=function(){this.use(i.d.Menu,"main:menu")},t}(i.c);t.default=a},function(e,t,o){"use strict";o.r(t);var i=o(4),n=o(3),r=o(6);function a(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function s(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}var c=function(e){function t(){return a(this,t),s(this,e.apply(this,arguments))}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(t,e),t.prototype.config=function(){var e=this,t=this.app,o=(t.getService("locale"),t.getService("theme"),n.a.getUsuarioCookie());this.app.getService("locale");return{view:"toolbar",height:60,elements:[{view:"button",type:"icon",icon:"mdi mdi-menu",width:37,align:"left",click:function(){$$("main:menu").toggle()}},{view:"label",label:"<a href='#!/top/inicio'><img src='assets/img/logo.png' height='50' /></a>",width:150},{view:"button",width:60,label:'<span class="mdi mdi-account-key mdi-36px mystyle"></span>'},{height:46,id:"person_template",css:"header_person",borderless:!0,data:o,template:function(e){var t="<div style='height:100%;width:100%;'>";return t+="<span class='name'>"+e.nombre+"</span> </div>"}},{view:"label",label:"\n\t\t\t\t\t\t<div>\n\t\t\t\t\t\t<img style=\"vertical-align:middle\" src='assets/img/handshake.png' height='35' />\n\t\t\t\t\t\t<span>"+this.app.config.name+"</span>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t",width:200},{view:"button",type:"icon",icon:"mdi mdi-exit-run mdi-36px",width:50,align:"right",tooltip:"Salir",click:function(){n.a.deleteUsuarioCookie(),e.show("/login")}}]}},t.prototype.init=function(){n.a.checkLoggedUser(),r.languageService.setLanguage(this.app,"es")},t}(i.c);t.default=c},function(e,t,o){"use strict";o.r(t);var i=o(4),n=o(3),r=(o(16),o(1)),a=function(){return new webix.promise((function(e,t){r.a.getConfig().then((function(e){var t=e.urlApi+"/api/version";return webix.ajax().timeout(1e4).headers({"Content-Type":"application/json"}).get(t,null)})).then((function(t){e(t.json())})).catch((function(e){t(e)}))}))};function s(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function c(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}var l=function(e){function t(){return s(this,t),c(this,e.apply(this,arguments))}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(t,e),t.prototype.config=function(){var e=this.app;e.getService("locale"),e.getService("theme"),n.a.getUsuarioCookie(),this.app.getService("locale")._;return{view:"label",id:"vers",align:"center",label:"NREG: ",height:60,minWidth:100}},t.prototype.init=function(){a().then((function(e){$$("vers").config.label="Proasistencia "+e.version+" - Aplicación general © Ariadna Software S.L. 2019-2020",$$("vers").refresh()})).catch((function(e){-1!=e.response.indexOf("Cannot delete or update a parent row: a foreign key constraint fails")?messageApi.errorRestriccion():messageApi.errorMessageAjax(e)}))},t}(i.c);t.default=l},function(e,t,o){"use strict";o.r(t);var i,n=o(4),r=o(3),a=o(8),s=o(0),c=o(2),l=o(12),u=o(5),d=o(9),p=o(6),f=o(15),h=o(21),m=o(17),g=o(20),b=function(e){var t=e.getService("locale")._;return{view:"layout",id:"basesOferta",rows:[{view:"toolbar",padding:3,elements:[{view:"icon",icon:"mdi mdi-folder-network-outline",width:37,align:"left"},{view:"label",label:t("Bases de la oferta")}]},{cols:[{view:"label",id:"basesLineasNReg",label:"NREG: "},{view:"pager",id:"mypager",css:{"text-align":"right"},template:"{common.first()} {common.prev()} {common.pages()} {common.next()} {common.last()}",size:25,group:5}]},{view:"datatable",id:"basesOfertaGrid",pager:"mypager",select:"row",autoheight:!0,footer:!1,columns:[{id:"ofertaBaseId",header:[t("Id"),{content:"textFilter"}],sort:"string",width:50,hidden:!0},{id:"tipoIvaId",header:[t("Id"),{content:"textFilter"}],sort:"string",width:50,hidden:!0},{id:"tipo",header:[t("Tipo"),{content:"textFilter"}],sort:"string",minWidth:180},{id:"porcentaje",header:[t("Porcentaje"),{content:"textFilter"}],sort:"string",minWidth:140},{id:"base",header:[t("Base"),{content:"textFilter"}],sort:"string",minWidth:380,format:webix.i18n.numberFormat},{id:"cuota",header:[t("Cuota"),{content:"textFilter"}],sort:"string",fillspace:!0,format:webix.i18n.numberFormat}],onClick:{onDelete:function(e,t,o){},onEdit:function(e,t,o){}},editable:!1,rules:{},on:{onAfterEditStart:function(e){},onAfterEditStop:function(e,t,o){},onAfterFilter:function(){var e=$$("basesOfertaGrid").count();$$("basesLineasNReg").config.label="NREG: "+e,$$("basesLineasNReg").refresh()}}}]}},v=function(e){(i=e)?u.a.getBasesOferta(i).then((function(e){if(e.length>0){$$("basesOfertaGrid").clearAll(),$$("basesOfertaGrid").parse(c.a.prepareDataForDataTable("ofertaBaseId",e));var t=$$("basesOfertaGrid").count();$$("basesLineasNReg").config.label="NREG: "+t,$$("basesLineasNReg").refresh()}else $$("basesOfertaGrid").clearAll()})).catch((function(e){s.a.errorMessageAjax(e)})):$$("basesOfertaGrid").clearAll()},w=o(10),x=o(7);function $(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function y(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}var C,j,A,I=0,E=0,P=0,F=0,O=function(e){function t(){return $(this,t),y(this,e.apply(this,arguments))}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(t,e),t.prototype.config=function(){this.app.getService("locale")._;var e=m.a.getGrid(this.app),t=g.a.getGrid(this.app),o=b(this.app);return{view:"tabview",cells:[{header:"Oferta",body:{view:"layout",id:"ofertasForm",multiview:!0,rows:[{view:"toolbar",padding:3,elements:[{view:"icon",icon:"mdi mdi-currency-eur",width:37,align:"left"},{view:"label",label:"Ofertas"}]},{view:"form",scroll:"y",id:"frmOfertas",maxWidth:1500,autoheight:!0,elements:[{cols:[{view:"text",id:"ofertaId",name:"ofertaId",hidden:!0,label:"ID",labelPosition:"top",width:50,disabled:!0},{view:"text",id:"referencia",name:"referencia",required:!0,label:"Referencia",labelPosition:"top",width:250},{view:"combo",id:"cmbEmpresas",name:"empresaId",required:!0,options:{},label:"Empresa",labelPosition:"top",width:250},{view:"datepicker",id:"fechaOferta",name:"fechaOferta",width:150,label:"Fecha de Solicitud",labelPosition:"top",required:!0},{view:"combo",id:"cmbTiposProyecto",name:"tipoProyectoId",required:!0,label:"Tipo proyecto",labelPosition:"top",options:{}}]},{cols:[{view:"combo",id:"cmbClientes",name:"clienteId",required:!0,label:"Cliente (empezar busquedas con @)",labelPosition:"top",suggest:{view:"mentionsuggest",id:"clientesList",data:[]}},{minWidth:200},{view:"combo",id:"cmbAgentes",name:"agenteId",required:!0,label:"Agente (empezar busquedas con @)",labelPosition:"top",suggest:{view:"mentionsuggest",id:"agentesList",data:[]}}]},{cols:[{view:"combo",id:"cmbFormasPago",name:"formaPagoId",required:!0,options:{},label:"Forma de pago",labelPosition:"top",minWidth:250},{view:"text",id:"importeCli",name:"importeCliente",disabled:!0,width:180,label:"Importe cliente",labelPosition:"top",value:0,format:"1,00"}]},{cols:[{view:"textarea",id:"observaciones",name:"observaciones",label:"Observaciones",labelPosition:"top",height:140},{rows:[{padding:50,cols:[{view:"button",label:"Cancelar",click:this.cancel,hotkey:"esc"},{view:"button",label:"Aceptar",click:this.accept,type:"form"}]}]}]},e,{minWidth:100},o]}],scroll:!0}},{header:"Lineas proveedores",body:{view:"layout",id:"proveedoresGrid",multiview:!0,rows:[t,{minheight:500}]}}]}},t.prototype.init=function(e,t){A=this.ui(w.default),this.cargarEventos()},t.prototype.urlChange=function(e,t){t[0].params.NEW&&s.a.normalMessage("Oferta correctamente, puede crear ahora las  lineas asociadas."),j=r.a.checkLoggedUser(),C=j.usuarioId,p.languageService.setLanguage(this.app,"es"),t[0].params.ofertaId&&(I=t[0].params.ofertaId),t[0].params.expedienteId&&(E=t[0].params.expedienteId),this.cargarEventos(),this.load(I,E)},t.prototype.load=function(e,t){var o=this;0==e&&t>0?x.a.getExpediente(t).then((function(e){o.loadEmpresas(e.empresaId),o.loadAgentes(e.agenteId),o.loadClientesAgente(e.clienteId,e.agenteId),o.loadFormasPago(),o.loadTiposProyecto(),$$("fechaOferta").setValue(new Date(e.fecha)),o.$$("referencia").setValue(e.referencia),m.a.loadGrid(null,null),v(null),g.a.loadGrid(null,null)})).catch((function(e){s.a.errorMessageAjax(e)})):u.a.getOferta(e).then((function(e){$$("cmbTiposProyecto").blockEvent(),delete e.empresa,delete e.cliente,delete e.tipo,delete e.mantenedor,delete e.agente,delete e.formaPago,e.fechaOferta=new Date(e.fechaOferta),$$("frmOfertas").setValues(e),o.loadAgentes(e.agenteId),o.loadEmpresas(e.empresaId),o.loadClientesAgente(e.clienteId,e.agenteId),o.loadTiposProyecto(e.tipoProyectoId),m.a.loadGrid(e.ofertaId,A),v(e.ofertaId),g.a.loadGrid(e.ofertaId,A),o.loadFormasPago(e.formaPagoId),$$("cmbTiposProyecto").unblockEvent()})).catch((function(e){s.a.errorMessageAjax(e)}))},t.prototype.cargarEventos=function(){var e=this;$$("clientesList").attachEvent("onValueSuggest",(function(t){e.loadAgenteCliente(t.id),e.loadClienteData(t.id)})),$$("agentesList").attachEvent("onValueSuggest",(function(t){e.loadClientesAgente(null,t.id)})),$$("cmbTiposProyecto").attachEvent("onChange",(function(t,o){""!=t&&t&&e.cambioTipoProyecto(t)}))},t.prototype.cancel=function(){this.$scope.show("/top/ofertas")},t.prototype.accept=function(){var e=this;if($$("frmOfertas").validate()){var t=$$("frmOfertas").getValues();0==I?(t.ofertaId=0,t.tipoOfertaId=5,t.coste=0,t.porcentajeBeneficio=0,t.importeBeneficio=0,t.ventaNeta=0,t.porcentajeAgente=0,t.importeAgente=0,t.importeCliente=0,t.importeMantenedor=0,t.mantenedorId=null,t.expedienteId=E,t.esCoste=0,u.a.postOferta(t).then((function(t){e.$scope.show("/top/ofertasForm?ofertaId="+t.ofertaId+"&NEW")})).catch((function(e){-1!=e.response.indexOf("Cannot delete or update a parent row: a foreign key constraint fails")?s.a.errorRestriccion():s.a.errorMessageAjax(e)}))):(t.porcentajeBeneficio=0,t.importeBeneficio=0,t.porcentajeAgente=0,t.importeAgente=0,t.importeMantenedor=0,u.a.putOferta(t,t.ofertaId).then((function(){e.$scope.show("/top/ofertas?ofertaId="+t.ofertaId)})).catch((function(e){-1!=e.response.indexOf("Cannot delete or update a parent row: a foreign key constraint fails")?s.a.errorRestriccion():s.a.errorMessageAjax(e)})))}else s.a.errorMessage("Debe rellenar los campos correctamente")},t.prototype.loadEmpresas=function(e){f.a.getEmpresas().then((function(t){var o=c.a.prepareDataForCombo("empresaId","nombre",t),i=$$("cmbEmpresas").getPopup().getList();i.clearAll(),i.parse(o),e?($$("cmbEmpresas").setValue(e),$$("cmbEmpresas").refresh()):($$("cmbEmpresas").setValue(10),$$("cmbEmpresas").refresh())}))},t.prototype.loadAgentes=function(e,t){l.a.getAgentes().then((function(t){var o=c.a.prepareDataForCombo("comercialId","nombre",t),i=$$("agentesList").getList();i.clearAll(),i.parse(o),e&&($$("cmbAgentes").setValue(e),$$("cmbAgentes").refresh())}))},t.prototype.loadClientesAgente=function(e,t){t&&a.a.getClientesAgenteActivos(t).then((function(t){var o=c.a.prepareDataForCombo("clienteId","nombre",t),i=$$("clientesList").getList();i.clearAll(),i.parse(o),e?($$("cmbClientes").setValue(e),$$("cmbClientes").refresh()):($$("cmbClientes").setValue(null),$$("cmbClientes").refresh())}))},t.prototype.loadClientes=function(){a.a.getClientesActivos().then((function(e){var t=c.a.prepareDataForCombo("clienteId","nombre",e);t.sort((function(e,t){return e.value>t.value?1:e.value<t.value?-1:0}));var o=$$("clientesList").getList();o.clearAll(),o.parse(t),$$("cmbClientes").setValue(null),$$("cmbClientes").refresh()}))},t.prototype.loadClienteData=function(e){e&&a.a.getCliente(e).then((function(e){$$("cmbFormasPago").setValue(e.formaPagoId),$$("cmbFormasPago").refresh()}))},t.prototype.cambioTipoProyecto=function(e){var t=this;d.a.getTipoProyecto(e).then((function(e){e&&u.a.getSiguienteReferencia(e.abrev).then((function(e){var o=e;t.$$("referencia").setValue(o)})).catch((function(e){s.a.errorMessageAjax(e)}))})).catch((function(e){s.a.errorMessageAjax(e)}))},t.prototype.loadFormasPago=function(e){h.a.getFormasPago().then((function(t){var o=c.a.prepareDataForCombo("formaPagoId","nombre",t),i=$$("cmbFormasPago").getPopup().getList();i.clearAll(),i.parse(o),$$("cmbFormasPago").setValue(e),$$("cmbFormasPago").refresh()})).catch((function(e){s.a.errorMessageAjax(e)}))},t.prototype.loadTiposProfesionales=function(e){tiposProfesionalService.getTiposProfesional().then((function(t){var o=c.a.prepareDataForCombo("tipoProfesionalId","nombre",t),i=$$("cmbTiposProfesional").getPopup().getList();i.clearAll(),i.parse(o),e&&($$("cmbTiposProfesional").setValue(e),$$("cmbTiposProfesional").refresh())}))},t.prototype.loadTiposProyecto=function(e){d.a.getTiposProyecto(C).then((function(e){var t=c.a.prepareDataForCombo("tipoProyectoId","nombre",e),o=$$("cmbTiposProyecto").getPopup().getList();o.clearAll(),o.parse(t),tiposProyectoId&&($$("cmbTiposProyecto").setValue(tiposProyectoId),$$("cmbTiposProyecto").refresh())}))},t.prototype.loadAgenteCliente=function(e){var t=this;e&&l.a.getAgenteCliente(e).then((function(o){t.loadAgentes(o[0].comercialId,e)}))},t.prototype.loadUsuarios=function(e){r.a.getUsuarios().then((function(t){var o=c.a.prepareDataForCombo("usuarioId","nombre",t),i=$$("cmbUsuarios").getPopup().getList();i.clearAll(),i.parse(o),e?($$("cmbUsuarios").setValue(e),$$("cmbUsuarios").refresh()):($$("cmbUsuarios").setValue(null),$$("cmbUsuarios").refresh())}))},t.prototype.loadNumero=function(){u.a.getNumServicio().then((function(e){$$("numServicio").setValue(e)})).catch((function(e){-1!=e.response.indexOf("Cannot delete or update a parent row: a foreign key constraint fails")?s.a.errorRestriccion():s.a.errorMessageAjax(e)}))},t.prototype.compruebaCobrosCliente=function(e){a.a.getCliente(e).then((function(t){t&&a.a.getCobrosCliente(e).then((function(e){P=t.limiteCredito,e.forEach((function(e){e.seguro||(F+=parseFloat(e.impvenci))})),F>P&&s.a.normalMessage("ATENCION!!!, este cliente ha superado su limete de credito")})).catch((function(e){s.a.errorMessageAjax(e)}))})).catch((function(e){}))},t}(n.c);t.default=O},function(e,t,o){},function(e,t,o){"use strict";o.r(t);var i=o(4),n=o(11),r=o(9),a=o(3),s=o(0),c=o(2),l=o(6);function u(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function d(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}var p,f,h=[],m=function(e){function t(){return u(this,t),d(this,e.apply(this,arguments))}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(t,e),t.prototype.config=function(){var e=this,t=this.app.getService("locale")._;return{rows:[{view:"toolbar",padding:3,elements:[{view:"icon",icon:"mdi mdi-account-key",width:37,align:"left"},{view:"label",label:t("Capitulos")}]},{cols:[{view:"button",type:"icon",icon:"wxi-plus",width:37,align:"left",hotkey:"Ctrl+A",tooltip:t("Nuevo registro en formulario (Ctrl+A)"),click:function(){var e=webix.uid();$$("capitulosGrid").add({id:e,grupoArticuloId:0,nombre:"",tipoProyectoId:"",departamentoId:5,estecnico:1},0),$$("capitulosGrid").edit(e)}},{view:"button",type:"icon",icon:"mdi mdi-refresh",width:37,align:"left",hotkey:"Ctrl+R",tooltip:t("Refrescar la lista (Ctrl+R)"),click:function(){e.cleanAndload()}},{view:"button",type:"icon",icon:"wxi-download",width:37,align:"right",tooltip:t("Descargar como Excel"),click:function(){webix.toExcel($$("capitulosGrid"),{filename:"capitulos",name:"Capitulos",rawValues:!0,ignore:{actions:!0}})}},{view:"label",id:"CapitulosNReg",label:"NREG: "},{view:"pager",id:"mypager",css:{"text-align":"right"},template:"{common.first()} {common.prev()} {common.pages()} {common.next()} {common.last()}",size:25,group:5}]},{view:"datatable",id:"capitulosGrid",pager:"mypager",select:"row",columns:[{id:"grupoArticuloId",adjust:!0,header:[t("ID"),{content:"numberFilter"}],sort:"number"},{id:"nombre",fillspace:!0,header:[t("Nombre capitulo"),{content:"textFilter"}],sort:"string",editor:"text",minWidth:200},{id:"tipoProyectoId",header:[t("Tipo proyecto"),{content:"selectFilter"}],sort:"string",fillspace:!0,minWidth:350,editor:"combo",collection:h},{id:"limiteImpObra",header:[t("Limite obra"),{content:"numberFilter"}],width:100,editor:"text",format:webix.i18n.priceFormat},{id:"porcen1",header:[t("Porcentaje 1"),{content:"numberFilter"}],width:110,editor:"text",format:webix.i18n.numberFormat},{id:"porcen2",header:[t("Porcentaje 2"),{content:"numberFilter"}],width:110,editor:"text",format:webix.i18n.numberFormat},{id:"porcen3",header:[t("Porcentaje 3"),{content:"numberFilter"}],width:110,editor:"text",format:webix.i18n.numberFormat},{id:"porcen4",header:[t("Porcentaje 4"),{content:"numberFilter"}],width:110,editor:"text",format:webix.i18n.numberFormat},{id:"aplicarFormula",header:t("Aplicar Fórmula"),width:150,editor:"checkbox",template:"{common.checkbox()}",css:{"text-align":"center"}},{id:"departamentoId",adjust:"header",header:[t("departamentoId"),{content:"textFilter"}],sort:"string",editor:"text",hidden:!0},{id:"esTecnico",adjust:"header",header:[t("es tecnico"),{content:"textFilter"}],sort:"string",editor:"text",hidden:!0},{id:"actions",header:[{text:t("Acciones"),css:{"text-align":"center"}}],template:"<span class='onDelete webix_icon wxi-trash'></span>",css:{"text-align":"center"}}],rightSplit:1,onClick:{onDelete:function(e,t,o){var i=this.data.pull[t.row].nombre;this.$scope.delete(t.row,i)},onEdit:function(e,t,o){this.$scope.edit(t.row)}},editable:!0,editaction:"dblclick",rules:{nombre:webix.rules.isNotEmpty},on:{onBeforeLoad:function(){r.a.getTiposProyecto(f).then((function(e){h=c.a.prepareDataForCombo("tipoProyectoId","nombre",e),$$("capitulosGrid").getColumnConfig("tipoProyectoId").collection=h,$$("capitulosGrid").refreshColumns()}))},onAfterEditStart:function(e){p=e.row,this.data.pull[p]},onAfterEditStop:function(e,t,o){var i=t.row,r=this.getItem(i),a=this.$scope.convertirAEstandar(r.limiteImpObra),c=this.$scope.convertirAEstandar(r.porcen1),l=this.$scope.convertirAEstandar(r.porcen2),u=this.$scope.convertirAEstandar(r.porcen3),d=this.$scope.convertirAEstandar(r.porcen4);r.limiteImpObra=a,r.porcen1=c,r.porcen2=l,r.porcen3=u,r.porcen4=d,e.value==e.old&&0!=r.grupoArticuloId||(this.validate(i)?(delete r.id,0==r.grupoArticuloId?n.a.postCapitulo(r).then((function(e){r.grupoArticuloId=e.grupoArticuloId,$$("capitulosGrid").updateItem(i,r),$$("capitulosGrid").editStop()})).catch((function(e){return handleServerError(e)})):n.a.putCapitulo(r).catch((function(e){return handleServerError(e)}))):s.a.errorMessage("Valores incorrectos"))},onCheck:function(e,t,o){if("aplicarFormula"===t){var i=this.getItem(e);console.log("Checkbox cambiado:",o,"Fila actualizada:",i),delete i.id,0==i.grupoArticuloId?n.a.postCapitulo(i).then((function(t){i.grupoArticuloId=t.grupoArticuloId,$$("capitulosGrid").updateItem(e,i),$$("capitulosGrid").editStop()})).catch((function(e){return handleServerError(e)})):n.a.putCapitulo(i).catch((function(e){return handleServerError(e)}))}},onAfterFilter:function(){var e=$$("capitulosGrid").count();$$("CapitulosNReg").config.label="NREG: "+e,$$("CapitulosNReg").refresh()}}}]}},t.prototype.urlChange=function(e,t){var o=a.a.checkLoggedUser();f=o.usuarioId,l.languageService.setLanguage(this.app,"es");var i=null;t[0].params.grupoArticuloId&&(i=t[0].params.grupoArticuloId),webix.UIManager.addHotKey("Esc",(function(){return $$("capitulosGrid").remove(-1),!1}),$$("capitulosGrid")),webix.extend($$("capitulosGrid"),webix.ProgressBar),this.load(i)},t.prototype.load=function(e){n.a.getCapitulos().then((function(t){$$("capitulosGrid").clearAll(),$$("capitulosGrid").parse(c.a.prepareDataForDataTable("grupoArticuloId",t)),e&&($$("capitulosGrid").select(e),$$("capitulosGrid").showItem(e));var o=$$("capitulosGrid").count();$$("CapitulosNReg").config.label="NREG: "+o,$$("CapitulosNReg").refresh(),$$("capitulosGrid").hideProgress()})).catch((function(e){$$("capitulosGrid").hideProgress(),-1!=e.response.indexOf("Cannot delete or update a parent row: a foreign key constraint fails")?s.a.errorRestriccion():s.a.errorMessageAjax(e)}))},t.prototype.edit=function(e){this.show("/top/capitulosForm?grupoArticuloId="+e)},t.prototype.delete=function(e,t){var o=this.app.getService("locale")._,i=this;webix.confirm({title:o("AVISO"),text:o("¿Desea realmente borrar este registro?").replace("*",t),type:"confirm-warning",callback:function(t){!0===t&&n.a.deleteCapitulo(e).then((function(e){i.load()})).catch((function(e){-1!=e.response.indexOf("Cannot delete or update a parent row: a foreign key constraint fails")?s.a.errorRestriccion():s.a.errorMessageAjax(e)}))}})},t.prototype.convertirAEstandar=function(e){return"string"==typeof e?parseFloat(e.replace(",",".")):e},t.prototype.cleanAndload=function(){$$("capitulosGrid").eachColumn((function(e,t){if("actions"!=t.id){var o=this.getFilter(e);o&&(o.setValue?o.setValue(""):o.value="")}})),this.load()},t}(i.c);t.default=m},function(e,t,o){"use strict";o.r(t);var i=o(4),n=o(3),r=o(7),a=o(0),s=o(2),c=o(6),l=o(10);function u(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function d(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}var p=function(e){function t(){return u(this,t),d(this,e.apply(this,arguments))}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(t,e),t.prototype.config=function(){var e,t,o,i,n,r,a,s=this,c=this.app.getService("locale")._,l="<span class='onEdit webix_icon wxi-pencil'></span> ";return l+="<span class='onDelete webix_icon wxi-trash'></span> ",l+="<span class='onPrint mdi mdi-printer'></span>",{rows:[{view:"toolbar",padding:3,elements:[{view:"icon",icon:"mdi mdi-file",width:37,align:"left"},{view:"label",label:"Expedientes"}]},{cols:[{view:"button",type:"icon",icon:"wxi-plus",width:37,align:"left",hotkey:"Ctrl+A",tooltip:c("Nuevo registro en formulario (Ctrl+A)"),click:function(){s.show("/top/expedientesForm?expedienteId=0")}},{view:"button",type:"icon",icon:"mdi mdi-refresh",width:37,align:"left",hotkey:"Ctrl+R",tooltip:c("Refrescar la lista (Ctrl+R)"),click:function(){s.cleanAndloadSolicitud()}},{view:"button",type:"icon",icon:"wxi-download",width:37,align:"right",tooltip:c("Descargar como Excel"),click:function(){webix.toExcel($$("expedientesGridSolicitud"),{filename:"expedientes",name:"oferta",rawValues:!0,ignore:{actions:!0}})}},{view:"pager",id:"mypager1",css:{"text-align":"right"},template:"{common.first()} {common.prev()} {common.pages()} {common.next()} {common.last()}",size:25,group:5}]},{view:"tabview",cells:[{header:"Solicitud",width:100,body:(e={view:"datatable",css:{"font-size":"0.9em"},id:"expedientesGridSolicitud",scroll:"x,y",pager:"mypager1",select:"row",footer:!0,ready:function(){this.attachEvent("onItemDblClick",(function(e,t,o){var i=this.data.pull[e.row];this.$scope.edit(i.expedienteId)}))},scheme:{$change:function(e){$$("expedientesGridSolicitud").getIndexById(e.id)%2||(e.$css={background:"#E6E7E7"})}},columns:[{id:"expedienteId",header:["Id",{content:"textFilter"}],sort:"int",adjust:"data",hidden:!0},{id:"empresaId",header:["IdEmpresa",{content:"textFilter"}],sort:"int",adjust:"data",hidden:!0},{id:"referencia",header:["Ref.",{content:"textFilter"}],sort:"string",adjust:"data"},{id:"estado",header:["Tipo.",{content:"textFilter"}],sort:"string",adjust:"data",hidden:!0},{id:"cliente",header:["Cliente",{content:"textFilter"}],sort:"string",adjust:"all"},{id:"titulo",header:["Titulo",{content:"textFilter"}],sort:"string",adjust:"all"},{id:"fecha",header:[{text:c("Fecha"),css:{"text-align":"center"}},{content:"dateFilter"}],adjust:"data",sort:"string",format:webix.i18n.dateFormatStr,css:{"text-align":"center"}},{id:"empresa",header:["Empresa",{content:"textFilter"}],sort:"string",adjust:"all"},{id:"agente",header:["Agente",{content:"textFilter"}],sort:"string",adjust:"all"},{id:"comercial",header:["Comercial",{content:"textFilter"}],sort:"string",adjust:"all"},{id:"jefeGrupo",header:["Jefe de grupo",{content:"textFilter"}],sort:"string",adjust:"all",minWidth:150},{id:"jefeObras",header:["Jefe de obras",{content:"textFilter"}],sort:"string",adjust:"all",minWidth:150},{id:"oficinatecnica",header:["Oficina técnica",{content:"textFilter"}],sort:"string",adjust:"all",minWidth:150},{id:"asesorTecnico",header:["Asesor técnico",{content:"textFilter"}],sort:"string",adjust:"all",minWidth:150},{id:"observaciones",header:["Observaciones",{content:"textFilter"}],sort:"string",adjust:"all",fillspace:!0,minWidth:150},{id:"actions",header:[{text:"Acciones",css:{"text-align":"center"}}],template:l,css:{"text-align":"center"},adjust:"all"}],rightSplit:1,leftSplit:6},e.scroll=!0,e.onClick={onEdit:function(e,t,o){var i=this.data.pull[t.row];this.$scope.edit(i.expedienteId)},onDelete:function(e,t,o){t=t.row;var i=this.data.pull[t];this.$scope.delete(i.expedienteId)},onPrint:function(e,t,o){var i=this.data.pull[t.row];this.$scope.imprimirWindow.showWindow(i.expedienteId,null,"/stireport/reports/oferta_general.mrt")}},e.editable=!0,e.editaction="dblclick",e.rules={direccionTrabajo:webix.rules.isNotEmpty},e.on={onAfterFilter:function(){webix.storage.local.put("stateGridExpedientes",this.getState())},onAfterLoad:function(){this.getColumnConfig("referencia").footer={text:"NREG: "+this.count(),colspan:3},this.refreshColumns()}},e)},{header:"Estudio",width:100,body:(t={view:"datatable",css:{"font-size":"0.9em"},id:"expedientesGridEstudio",scroll:"x,y",pager:"mypager1",select:"row",footer:!0,ready:function(){this.attachEvent("onItemDblClick",(function(e,t,o){var i=this.data.pull[e.row];this.$scope.edit(i.expedienteId)}))},scheme:{$change:function(e){$$("expedientesGridEstudio").getIndexById(e.id)%2||(e.$css={background:"#E6E7E7"})}},columns:[{id:"expedienteId",header:["Id",{content:"textFilter"}],sort:"int",adjust:"data",hidden:!0},{id:"empresaId",header:["IdEmpresa",{content:"textFilter"}],sort:"int",adjust:"data",hidden:!0},{id:"referencia",header:["Ref.",{content:"textFilter"}],sort:"string",adjust:"data"},{id:"estado",header:["Tipo.",{content:"textFilter"}],sort:"string",adjust:"data",hidden:!0},{id:"cliente",header:["Cliente",{content:"textFilter"}],sort:"string",adjust:"all"},{id:"titulo",header:["Titulo",{content:"textFilter"}],sort:"string",adjust:"all"},{id:"fecha",header:[{text:c("Fecha"),css:{"text-align":"center"}},{content:"dateFilter"}],adjust:"data",sort:"string",format:webix.i18n.dateFormatStr,css:{"text-align":"center"}},{id:"empresa",header:["Empresa",{content:"textFilter"}],sort:"string",adjust:"all"},{id:"agente",header:["Agente",{content:"textFilter"}],sort:"string",adjust:"all"},{id:"comercial",header:["Comercial",{content:"textFilter"}],sort:"string",adjust:"all"},{id:"jefeGrupo",header:["Jefe de grupo",{content:"textFilter"}],sort:"string",minWidth:150},{id:"jefeObras",header:["Jefe de obras",{content:"textFilter"}],sort:"string",adjust:"all",minWidth:150},{id:"oficinatecnica",header:["Oficina técnica",{content:"textFilter"}],sort:"string",adjust:"all",minWidth:150},{id:"asesorTecnico",header:["Asesor técnico",{content:"textFilter"}],sort:"string",adjust:"all",minWidth:150},{id:"observaciones",header:["Observaciones",{content:"textFilter"}],sort:"string",adjust:"all",fillspace:!0,minWidth:150},{id:"actions",header:[{text:"Acciones",css:{"text-align":"center"}}],template:l,css:{"text-align":"center"},adjust:"all"}],rightSplit:1,leftSplit:6},t.scroll=!0,t.onClick={onEdit:function(e,t,o){var i=this.data.pull[t.row];this.$scope.edit(i.expedienteId)},onDelete:function(e,t,o){t=t.row;var i=this.data.pull[t];this.$scope.delete(i.expedienteId)},onPrint:function(e,t,o){var i=this.data.pull[t.row];this.$scope.imprimirWindow.showWindow(i.expedienteId,null,"/stireport/reports/oferta_general.mrt")}},t.editable=!0,t.editaction="dblclick",t.rules={direccionTrabajo:webix.rules.isNotEmpty},t.on={onAfterFilter:function(){webix.storage.local.put("stateGridExpedientes",this.getState())},onAfterLoad:function(){this.getColumnConfig("referencia").footer={text:"NREG: "+this.count(),colspan:3},this.refreshColumns()}},t)},{header:"Enviado",width:100,body:(o={view:"datatable",css:{"font-size":"0.9em"},id:"expedientesGridEnviado",scroll:"x,y",pager:"mypager1",select:"row",footer:!0,ready:function(){this.attachEvent("onItemDblClick",(function(e,t,o){var i=this.data.pull[e.row];this.$scope.edit(i.expedienteId)}))},scheme:{$change:function(e){$$("expedientesGridEnviado").getIndexById(e.id)%2||(e.$css={background:"#E6E7E7"})}},columns:[{id:"expedienteId",header:["Id",{content:"textFilter"}],sort:"int",adjust:"data",hidden:!0},{id:"empresaId",header:["IdEmpresa",{content:"textFilter"}],sort:"int",adjust:"data",hidden:!0},{id:"referencia",header:["Ref.",{content:"textFilter"}],sort:"string",adjust:"data"},{id:"estado",header:["Tipo.",{content:"textFilter"}],sort:"string",adjust:"data",hidden:!0},{id:"cliente",header:["Cliente",{content:"textFilter"}],sort:"string",adjust:"all"},{id:"titulo",header:["Titulo",{content:"textFilter"}],sort:"string",adjust:"all"},{id:"fecha",header:[{text:c("Fecha"),css:{"text-align":"center"}},{content:"dateFilter"}],adjust:"data",sort:"string",format:webix.i18n.dateFormatStr,css:{"text-align":"center"}},{id:"empresa",header:["Empresa",{content:"textFilter"}],sort:"string",adjust:"all"},{id:"agente",header:["Agente",{content:"textFilter"}],sort:"string",adjust:"all"},{id:"comercial",header:["Comercial",{content:"textFilter"}],sort:"string",adjust:"all"},{id:"jefeGrupo",header:["Jefe de grupo",{content:"textFilter"}],sort:"string",minWidth:150},{id:"jefeObras",header:["Jefe de obras",{content:"textFilter"}],sort:"string",adjust:"all",minWidth:150},{id:"oficinatecnica",header:["Oficina técnica",{content:"textFilter"}],sort:"string",adjust:"all",minWidth:150},{id:"asesorTecnico",header:["Asesor técnico",{content:"textFilter"}],sort:"string",adjust:"all",minWidth:150},{id:"observaciones",header:["Observaciones",{content:"textFilter"}],sort:"string",adjust:"all",fillspace:!0,minWidth:150},{id:"actions",header:[{text:"Acciones",css:{"text-align":"center"}}],template:l,css:{"text-align":"center"},adjust:"all"}],rightSplit:1,leftSplit:6},o.scroll=!0,o.onClick={onEdit:function(e,t,o){var i=this.data.pull[t.row];this.$scope.edit(i.expedienteId)},onDelete:function(e,t,o){t=t.row;var i=this.data.pull[t];this.$scope.delete(i.expedienteId)},onPrint:function(e,t,o){var i=this.data.pull[t.row];this.$scope.imprimirWindow.showWindow(i.expedienteId,null,"/stireport/reports/oferta_general.mrt")}},o.editable=!0,o.editaction="dblclick",o.rules={direccionTrabajo:webix.rules.isNotEmpty},o.on={onAfterFilter:function(){webix.storage.local.put("stateGridExpedientes",this.getState())},onAfterLoad:function(){this.getColumnConfig("referencia").footer={text:"NREG: "+this.count(),colspan:3},this.refreshColumns()}},o)},{header:"Adjudicado",width:100,body:(i={view:"datatable",css:{"font-size":"0.9em"},id:"expedientesGridAdjudicado",scroll:"x,y",pager:"mypager1",select:"row",footer:!0,ready:function(){this.attachEvent("onItemDblClick",(function(e,t,o){var i=this.data.pull[e.row];this.$scope.edit(i.expedienteId)}))},scheme:{$change:function(e){$$("expedientesGridAdjudicado").getIndexById(e.id)%2||(e.$css={background:"#E6E7E7"})}},columns:[{id:"expedienteId",header:["Id",{content:"textFilter"}],sort:"int",adjust:"data",hidden:!0},{id:"empresaId",header:["IdEmpresa",{content:"textFilter"}],sort:"int",adjust:"data",hidden:!0},{id:"referencia",header:["Ref.",{content:"textFilter"}],sort:"string",adjust:"data"},{id:"estado",header:["Tipo.",{content:"textFilter"}],sort:"string",adjust:"data",hidden:!0},{id:"cliente",header:["Cliente",{content:"textFilter"}],sort:"string",adjust:"all"},{id:"titulo",header:["Titulo",{content:"textFilter"}],sort:"string",adjust:"all"},{id:"fecha",header:[{text:c("Fecha"),css:{"text-align":"center"}},{content:"dateFilter"}],adjust:"data",sort:"string",format:webix.i18n.dateFormatStr,css:{"text-align":"center"}},{id:"empresa",header:["Empresa",{content:"textFilter"}],sort:"string",adjust:"all"},{id:"agente",header:["Agente",{content:"textFilter"}],sort:"string",adjust:"all"},{id:"comercial",header:["Comercial",{content:"textFilter"}],sort:"string",adjust:"all"},{id:"jefeGrupo",header:["Jefe de grupo",{content:"textFilter"}],sort:"string",minWidth:150},{id:"jefeObras",header:["Jefe de obras",{content:"textFilter"}],sort:"string",adjust:"all",minWidth:150},{id:"oficinatecnica",header:["Oficina técnica",{content:"textFilter"}],sort:"string",adjust:"all",minWidth:150},{id:"asesorTecnico",header:["Asesor técnico",{content:"textFilter"}],sort:"string",adjust:"all",minWidth:150},{id:"observaciones",header:["Observaciones",{content:"textFilter"}],sort:"string",adjust:"all",fillspace:!0,minWidth:150},{id:"actions",header:[{text:"Acciones",css:{"text-align":"center"}}],template:l,css:{"text-align":"center"},adjust:"all"}],rightSplit:1,leftSplit:6},i.scroll=!0,i.onClick={onEdit:function(e,t,o){var i=this.data.pull[t.row];this.$scope.edit(i.expedienteId)},onDelete:function(e,t,o){t=t.row;var i=this.data.pull[t];this.$scope.delete(i.expedienteId)},onPrint:function(e,t,o){var i=this.data.pull[t.row];this.$scope.imprimirWindow.showWindow(i.expedienteId,null,"/stireport/reports/oferta_general.mrt")}},i.editable=!0,i.editaction="dblclick",i.rules={direccionTrabajo:webix.rules.isNotEmpty},i.on={onAfterFilter:function(){webix.storage.local.put("stateGridExpedientes",this.getState())},onAfterLoad:function(){this.getColumnConfig("referencia").footer={text:"NREG: "+this.count(),colspan:3},this.refreshColumns()}},i)},{header:"Iniciado",width:100,body:(n={view:"datatable",css:{"font-size":"0.9em"},id:"expedientesGridIniciado",scroll:"x,y",pager:"mypager1",select:"row",footer:!0,ready:function(){this.attachEvent("onItemDblClick",(function(e,t,o){var i=this.data.pull[e.row];this.$scope.edit(i.expedienteId)}))},scheme:{$change:function(e){$$("expedientesGridIniciado").getIndexById(e.id)%2||(e.$css={background:"#E6E7E7"})}},columns:[{id:"expedienteId",header:["Id",{content:"textFilter"}],sort:"int",adjust:"data",hidden:!0},{id:"empresaId",header:["IdEmpresa",{content:"textFilter"}],sort:"int",adjust:"data",hidden:!0},{id:"referencia",header:["Ref.",{content:"textFilter"}],sort:"string",adjust:"data"},{id:"estado",header:["Tipo.",{content:"textFilter"}],sort:"string",adjust:"data",hidden:!0},{id:"cliente",header:["Cliente",{content:"textFilter"}],sort:"string",adjust:"all"},{id:"titulo",header:["Titulo",{content:"textFilter"}],sort:"string",adjust:"all"},{id:"fecha",header:[{text:c("Fecha"),css:{"text-align":"center"}},{content:"dateFilter"}],adjust:"data",sort:"string",format:webix.i18n.dateFormatStr,css:{"text-align":"center"}},{id:"empresa",header:["Empresa",{content:"textFilter"}],sort:"string",adjust:"all"},{id:"agente",header:["Agente",{content:"textFilter"}],sort:"string",adjust:"all"},{id:"comercial",header:["Comercial",{content:"textFilter"}],sort:"string",adjust:"all"},{id:"jefeGrupo",header:["Jefe de grupo",{content:"textFilter"}],sort:"string",minWidth:150},{id:"jefeObras",header:["Jefe de obras",{content:"textFilter"}],sort:"string",adjust:"all",minWidth:150},{id:"oficinatecnica",header:["Oficina técnica",{content:"textFilter"}],sort:"string",adjust:"all",minWidth:150},{id:"asesorTecnico",header:["Asesor técnico",{content:"textFilter"}],sort:"string",adjust:"all",minWidth:150},{id:"observaciones",header:["Observaciones",{content:"textFilter"}],sort:"string",adjust:"all",fillspace:!0,minWidth:150},{id:"actions",header:[{text:"Acciones",css:{"text-align":"center"}}],template:l,css:{"text-align":"center"},adjust:"all"}],rightSplit:1,leftSplit:6},n.scroll=!0,n.onClick={onEdit:function(e,t,o){var i=this.data.pull[t.row];this.$scope.edit(i.expedienteId)},onDelete:function(e,t,o){t=t.row;var i=this.data.pull[t];this.$scope.delete(i.expedienteId)},onPrint:function(e,t,o){var i=this.data.pull[t.row];this.$scope.imprimirWindow.showWindow(i.expedienteId,null,"/stireport/reports/oferta_general.mrt")}},n.editable=!0,n.editaction="dblclick",n.rules={direccionTrabajo:webix.rules.isNotEmpty},n.on={onAfterFilter:function(){webix.storage.local.put("stateGridExpedientes",this.getState())},onAfterLoad:function(){this.getColumnConfig("referencia").footer={text:"NREG: "+this.count(),colspan:3},this.refreshColumns()}},n)},{header:"Finalizado",width:100,body:(r={view:"datatable",css:{"font-size":"0.9em"},id:"expedientesGridFinalizado",scroll:"x,y",pager:"mypager1",select:"row",footer:!0,ready:function(){this.attachEvent("onItemDblClick",(function(e,t,o){var i=this.data.pull[e.row];this.$scope.edit(i.expedienteId)}))},scheme:{$change:function(e){$$("expedientesGridFinalizado").getIndexById(e.id)%2||(e.$css={background:"#E6E7E7"})}},columns:[{id:"expedienteId",header:["Id",{content:"textFilter"}],sort:"int",adjust:"data",hidden:!0},{id:"empresaId",header:["IdEmpresa",{content:"textFilter"}],sort:"int",adjust:"data",hidden:!0},{id:"referencia",header:["Ref.",{content:"textFilter"}],sort:"string",adjust:"data"},{id:"estado",header:["Tipo.",{content:"textFilter"}],sort:"string",adjust:"data",hidden:!0},{id:"cliente",header:["Cliente",{content:"textFilter"}],sort:"string",adjust:"all"},{id:"titulo",header:["Titulo",{content:"textFilter"}],sort:"string",adjust:"all"},{id:"fecha",header:[{text:c("Fecha"),css:{"text-align":"center"}},{content:"dateFilter"}],adjust:"data",sort:"string",format:webix.i18n.dateFormatStr,css:{"text-align":"center"}},{id:"empresa",header:["Empresa",{content:"textFilter"}],sort:"string",adjust:"all"},{id:"agente",header:["Agente",{content:"textFilter"}],sort:"string",adjust:"all"},{id:"comercial",header:["Comercial",{content:"textFilter"}],sort:"string",adjust:"all"},{id:"jefeGrupo",header:["Jefe de grupo",{content:"textFilter"}],sort:"string",minWidth:150},{id:"jefeObras",header:["Jefe de obras",{content:"textFilter"}],sort:"string",adjust:"all",minWidth:150},{id:"oficinatecnica",header:["Oficina técnica",{content:"textFilter"}],sort:"string",adjust:"all",minWidth:150},{id:"asesorTecnico",header:["Asesor técnico",{content:"textFilter"}],sort:"string",adjust:"all",minWidth:150},{id:"observaciones",header:["Observaciones",{content:"textFilter"}],sort:"string",adjust:"all",fillspace:!0,minWidth:150},{id:"actions",header:[{text:"Acciones",css:{"text-align":"center"}}],template:l,css:{"text-align":"center"},adjust:"all"}],rightSplit:1,leftSplit:6},r.scroll=!0,r.onClick={onEdit:function(e,t,o){var i=this.data.pull[t.row];this.$scope.edit(i.expedienteId)},onDelete:function(e,t,o){t=t.row;var i=this.data.pull[t];this.$scope.delete(i.expedienteId)},onPrint:function(e,t,o){var i=this.data.pull[t.row];this.$scope.imprimirWindow.showWindow(i.expedienteId,null,"/stireport/reports/oferta_general.mrt")}},r.editable=!0,r.editaction="dblclick",r.rules={direccionTrabajo:webix.rules.isNotEmpty},r.on={onAfterFilter:function(){webix.storage.local.put("stateGridExpedientes",this.getState())},onAfterLoad:function(){this.getColumnConfig("referencia").footer={text:"NREG: "+this.count(),colspan:3},this.refreshColumns()}},r)},{header:"Denegado",width:100,body:(a={view:"datatable",css:{"font-size":"0.9em"},id:"expedientesGridDenegado",scroll:"x,y",pager:"mypager1",select:"row",footer:!0,ready:function(){this.attachEvent("onItemDblClick",(function(e,t,o){var i=this.data.pull[e.row];this.$scope.edit(i.expedienteId)}))},scheme:{$change:function(e){$$("expedientesGridDenegado").getIndexById(e.id)%2||(e.$css={background:"#E6E7E7"})}},columns:[{id:"expedienteId",header:["Id",{content:"textFilter"}],sort:"int",adjust:"data",hidden:!0},{id:"empresaId",header:["IdEmpresa",{content:"textFilter"}],sort:"int",adjust:"data",hidden:!0},{id:"referencia",header:["Ref.",{content:"textFilter"}],sort:"string",adjust:"data"},{id:"estado",header:["Tipo.",{content:"textFilter"}],sort:"string",adjust:"data",hidden:!0},{id:"cliente",header:["Cliente",{content:"textFilter"}],sort:"string",adjust:"all"},{id:"titulo",header:["Titulo",{content:"textFilter"}],sort:"string",adjust:"all"},{id:"fecha",header:[{text:c("Fecha"),css:{"text-align":"center"}},{content:"dateFilter"}],adjust:"data",sort:"string",format:webix.i18n.dateFormatStr,css:{"text-align":"center"}},{id:"empresa",header:["Empresa",{content:"textFilter"}],sort:"string",adjust:"all"},{id:"agente",header:["Agente",{content:"textFilter"}],sort:"string",adjust:"all"},{id:"comercial",header:["Comercial",{content:"textFilter"}],sort:"string",adjust:"all"},{id:"jefeGrupo",header:["Jefe de grupo",{content:"textFilter"}],sort:"string",minWidth:150},{id:"jefeObras",header:["Jefe de obras",{content:"textFilter"}],sort:"string",adjust:"all",minWidth:150},{id:"oficinatecnica",header:["Oficina técnica",{content:"textFilter"}],sort:"string",adjust:"all",minWidth:150},{id:"asesorTecnico",header:["Asesor técnico",{content:"textFilter"}],sort:"string",adjust:"all",minWidth:150},{id:"observaciones",header:["Observaciones",{content:"textFilter"}],sort:"string",adjust:"all",fillspace:!0,minWidth:150},{id:"actions",header:[{text:"Acciones",css:{"text-align":"center"}}],template:l,css:{"text-align":"center"},adjust:"all"}],rightSplit:1,leftSplit:6},a.scroll=!0,a.onClick={onEdit:function(e,t,o){var i=this.data.pull[t.row];this.$scope.edit(i.expedienteId)},onDelete:function(e,t,o){t=t.row;var i=this.data.pull[t];this.$scope.delete(i.expedienteId)},onPrint:function(e,t,o){var i=this.data.pull[t.row];this.$scope.imprimirWindow.showWindow(i.expedienteId,null,"/stireport/reports/oferta_general.mrt")}},a.editable=!0,a.editaction="dblclick",a.rules={direccionTrabajo:webix.rules.isNotEmpty},a.on={onAfterFilter:function(){webix.storage.local.put("stateGridExpedientes",this.getState())},onAfterLoad:function(){this.getColumnConfig("referencia").footer={text:"NREG: "+this.count(),colspan:3},this.refreshColumns()}},a)}]}]}},t.prototype.init=function(e,t){this.imprimirWindow=this.ui(l.default)},t.prototype.urlChange=function(e,t){var o=n.a.checkLoggedUser().usuarioId;c.languageService.setLanguage(this.app,"es"),this.loadSolicitud(o),this.loadEstudio(o),this.loadEnviado(),this.loadAdjudicado(),this.loadIniciado(),this.loadFinalizado(),this.loadDenegado()},t.prototype.formateaCampos=function(e){return e.forEach((function(e){e.empresa=e.empresa.substr(0,4),e.fecha=new Date(e.fecha)})),e},t.prototype.edit=function(e){this.show("/top/expedientesForm?expedienteId="+e)},t.prototype.delete=function(e){var t=this;r.a.deleteOferta(e).then((function(e){t.loadSolicitud(),t.loadEstudio(),t.loadEnviado(),t.loadAdjudicado(),t.loadIniciado(),t.loadFinalizado(),t.loadDenegado()})).catch((function(e){a.a.errorMessageAjax(e)}))},t.prototype.loadSolicitud=function(e){var t=this;r.a.getExpedientes(1).then((function(e){e||(e=[]),e=t.formateaCampos(e),$$("expedientesGridSolicitud").clearAll(),$$("expedientesGridSolicitud").parse(s.a.prepareDataForDataTable("expedienteId",e));var o=webix.storage.local.get("stateGridExpedientes");o&&t.$$("expedientesGridSolicitud").setState(o)})).catch((function(e){-1!=e.response.indexOf("Cannot delete or update a parent row: a foreign key constraint fails")?a.a.errorRestriccion():a.a.errorMessageAjax(e)}))},t.prototype.loadEstudio=function(e){var t=this;r.a.getExpedientes(2).then((function(e){e||(e=[]),e=t.formateaCampos(e),$$("expedientesGridEstudio").clearAll(),$$("expedientesGridEstudio").parse(s.a.prepareDataForDataTable("expedienteId",e));var o=webix.storage.local.get("stateGridExpedientes");o&&t.$$("expedientesGridEstudio").setState(o)})).catch((function(e){-1!=e.response.indexOf("Cannot delete or update a parent row: a foreign key constraint fails")?a.a.errorRestriccion():a.a.errorMessageAjax(e)}))},t.prototype.loadEstudio=function(e){var t=this;r.a.getExpedientes(2).then((function(e){e||(e=[]),e=t.formateaCampos(e),$$("expedientesGridEstudio").clearAll(),$$("expedientesGridEstudio").parse(s.a.prepareDataForDataTable("expedienteId",e));var o=webix.storage.local.get("stateGridExpedientes");o&&t.$$("expedientesGridEstudio").setState(o)})).catch((function(e){-1!=e.response.indexOf("Cannot delete or update a parent row: a foreign key constraint fails")?a.a.errorRestriccion():a.a.errorMessageAjax(e)}))},t.prototype.loadEnviado=function(e){var t=this;r.a.getExpedientes(3).then((function(e){e||(e=[]),e=t.formateaCampos(e),$$("expedientesGridEnviado").clearAll(),$$("expedientesGridEnviado").parse(s.a.prepareDataForDataTable("expedienteId",e));var o=webix.storage.local.get("stateGridExpedientes");o&&t.$$("expedientesGridEnviado").setState(o)})).catch((function(e){-1!=e.response.indexOf("Cannot delete or update a parent row: a foreign key constraint fails")?a.a.errorRestriccion():a.a.errorMessageAjax(e)}))},t.prototype.loadAdjudicado=function(e){var t=this;r.a.getExpedientes(4).then((function(e){e||(e=[]),e=t.formateaCampos(e),$$("expedientesGridAdjudicado").clearAll(),$$("expedientesGridAdjudicado").parse(s.a.prepareDataForDataTable("expedienteId",e));var o=webix.storage.local.get("stateGridExpedientes");o&&t.$$("expedientesGridAdjudicado").setState(o)})).catch((function(e){-1!=e.response.indexOf("Cannot delete or update a parent row: a foreign key constraint fails")?a.a.errorRestriccion():a.a.errorMessageAjax(e)}))},t.prototype.loadIniciado=function(e){var t=this;r.a.getExpedientes(5).then((function(e){e||(e=[]),e=t.formateaCampos(e),$$("expedientesGridIniciado").clearAll(),$$("expedientesGridIniciado").parse(s.a.prepareDataForDataTable("expedienteId",e));var o=webix.storage.local.get("stateGridExpedientes");o&&t.$$("expedientesGridIniciado").setState(o)})).catch((function(e){-1!=e.response.indexOf("Cannot delete or update a parent row: a foreign key constraint fails")?a.a.errorRestriccion():a.a.errorMessageAjax(e)}))},t.prototype.loadFinalizado=function(e){var t=this;r.a.getExpedientes(6).then((function(e){e||(e=[]),e=t.formateaCampos(e),$$("expedientesGridFinalizado").clearAll(),$$("expedientesGridFinalizado").parse(s.a.prepareDataForDataTable("expedienteId",e));var o=webix.storage.local.get("stateGridExpedientes");o&&t.$$("expedientesGridFinalizado").setState(o)})).catch((function(e){-1!=e.response.indexOf("Cannot delete or update a parent row: a foreign key constraint fails")?a.a.errorRestriccion():a.a.errorMessageAjax(e)}))},t.prototype.loadDenegado=function(e){var t=this;r.a.getExpedientes(7).then((function(e){e||(e=[]),e=t.formateaCampos(e),$$("expedientesGridDenegado").clearAll(),$$("expedientesGridDenegado").parse(s.a.prepareDataForDataTable("expedienteId",e));var o=webix.storage.local.get("stateGridExpedientes");o&&t.$$("expedientesGridDenegado").setState(o)})).catch((function(e){-1!=e.response.indexOf("Cannot delete or update a parent row: a foreign key constraint fails")?a.a.errorRestriccion():a.a.errorMessageAjax(e)}))},t.prototype.cleanAndloadSolicitud=function(){$$("expedientesGridSolicitud").eachColumn((function(e,t){if("actions"!=t.id){var o=this.getFilter(e);o&&(o.setValue?o.setValue(""):o.value="")}})),this.loadSolicitud()},t}(i.c);t.default=p},function(e,t,o){"use strict";o.r(t);var i=o(4),n=o(1);function r(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function a(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}var s=function(e){function t(){return r(this,t),a(this,e.apply(this,arguments))}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(t,e),t.prototype.config=function(){return{view:"window",id:"imprimirWindow",position:"center",move:!0,resize:!0,fullscreen:!0,head:{view:"toolbar",cols:[{view:"label",label:(0,this.app.getService("locale")._)("IMPRESIÓN DE FACTURAS")},{view:"icon",icon:"mdi mdi-close",click:function(){$$("imprimirWindow").hide()}}]},modal:!0,body:{template:"<div id='report_viewer'></div>"}}},t.prototype.init=function(e,t){n.a.getConfigMysql().then((function(e){myconfig=e})).catch((function(e){fail(e)}))},t.prototype.showWindow=function(e,t){},t.prototype.cancel=function(){$$("imprimirWindow").hide()},t}(i.c);t.default=s},function(e,t,o){"use strict";o.r(t);var i=o(4),n=o(3),r=o(6);function a(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function s(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}var c=function(e){function t(){return a(this,t),s(this,e.apply(this,arguments))}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(t,e),t.prototype.config=function(){this.app.getService("locale")._;return{view:"label",height:750,label:"<img src='assets/img/arquitectura.jpg' width='100%' />"}},t.prototype.init=function(){n.a.checkLoggedUser(),r.languageService.setLanguage(this.app,"es")},t}(i.c);t.default=c},function(e,t,o){"use strict";o.r(t);var i=o(4),n=o(3),r=o(0),a=o(1);function s(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function c(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}var l=function(e){function t(){return s(this,t),c(this,e.apply(this,arguments))}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(t,e),t.prototype.config=function(){return{view:"layout",css:"loginBack",rows:[{},{cols:[{},{rows:[{view:"form",width:300,css:"round-border",id:"frmLogin",elements:[{view:"label",height:100,align:"center",label:"<img src='assets/img/logo.png' width='155' height='50' />"},{view:"label",align:"center",id:"version",label:"VRS"},{view:"text",name:"login",id:"login",required:!0,label:"Usuario",labelPosition:"top"},{view:"text",type:"password",name:"password",id:"password",required:!0,label:"Contraseña",labelPosition:"top"},{view:"checkbox",id:"recordar",name:"recordar",label:"Recordarme en este equipo",labelWidth:200,labelAlign:"left",value:0},{margin:5,cols:[{view:"button",label:"Aceptar",click:this.accept,type:"form",hotkey:"enter"},{view:"button",label:"Cancelar",click:this.cancel,hotkey:"esc"}]}]}]},{}]},{}]}},t.prototype.init=function(){var e;a.a.getVersion().then((function(t){$$("version").data.label="VRS "+t.version,$$("version").refresh(),(e=n.a.getAccesoCookie())&&($$("login").setValue(e.login),$$("password").setValue(e.password),$$("recordar").setValue(1))})).catch((function(e){-1!=e.response.indexOf("Cannot delete or update a parent row: a foreign key constraint fails")?r.a.errorRestriccion():r.a.errorMessageAjax(e)}))},t.prototype.cancel=function(){},t.prototype.accept=function(){var e=this;if($$("frmLogin").validate()){var t=void 0,o=$$("frmLogin").getValues(),i={};n.a.getLogin(o.login,o.password).then((function(r){r&&(t=r,n.a.setUsuarioCookie(t),o.recordar?(i={login:o.login,password:o.password},n.a.setAccesoCookie(i)):n.a.deleteAccesoCookie(),e.$scope.show("top/inicio"))})).catch((function(e){r.a.errorMessageAjax(e.response)}))}else r.a.errorMessage("Debe rellenar los campos correctamente")},t}(i.c);t.default=l},function(e,t,o){"use strict";o.r(t);var i=o(4),n=o(3),r=o(5),a=o(0),s=o(2),c=o(6),l=o(10);function u(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function d(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}var p=function(e){function t(){return u(this,t),d(this,e.apply(this,arguments))}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(t,e),t.prototype.config=function(){var e,t=this,o=this.app.getService("locale")._;return"<span class='onDelete webix_icon wxi-trash'></span> ","<span class='onPrint mdi mdi-printer'></span>",{rows:[{view:"toolbar",padding:3,elements:[{view:"icon",icon:"mdi mdi-file",width:37,align:"left"},{view:"label",label:"Ofertas"}]},{cols:[{view:"button",type:"icon",icon:"wxi-plus",width:37,align:"left",hotkey:"Ctrl+A",tooltip:o("Nuevo registro en formulario (Ctrl+A)"),click:function(){t.show("/top/ofertasForm?ofertaId=0")}},{view:"button",type:"icon",icon:"mdi mdi-refresh",width:37,align:"left",hotkey:"Ctrl+R",tooltip:o("Refrescar la lista (Ctrl+R)"),click:function(){t.cleanAndload()}},{view:"button",type:"icon",icon:"wxi-download",width:37,align:"right",tooltip:o("Descargar como Excel"),click:function(){webix.toExcel($$("ofertasGrid"),{filename:"ofertas",name:"oferta",rawValues:!0,ignore:{actions:!0}})}},{view:"label",id:"ofertasNReg",label:"NREG: "},{view:"pager",id:"mypager1",css:{"text-align":"right"},template:"{common.first()} {common.prev()} {common.pages()} {common.next()} {common.last()}",size:25,group:5}]},((e={view:"datatable",css:{"font-size":"0.9em"},id:"ofertasGrid",scroll:"x,y",pager:"mypager1",select:"row",scheme:{$change:function(e){$$("ofertasGrid").getIndexById(e.id)%2||(e.$css={background:"#E6E7E7"})}},columns:[{id:"ofertaId",header:["Id",{content:"textFilter"}],sort:"int",adjust:"data",hidden:!0},{id:"empresaId",header:["IdEmpresa",{content:"textFilter"}],sort:"int",adjust:"data",hidden:!0},{id:"referencia",header:["Ref.",{content:"textFilter"}],sort:"string",adjust:"data"},{id:"tipo",header:["Tipo.",{content:"textFilter"}],sort:"string",adjust:"data"},{id:"fechaOferta",header:[{text:o("Fecha"),css:{"text-align":"center"}},{content:"dateFilter"}],adjust:"data",sort:"string",format:webix.i18n.dateFormatStr,css:{"text-align":"center"}},{id:"empresa",header:["Empresa",{content:"textFilter"}],sort:"string",adjust:"data"},{id:"cliente",header:["Cliente",{content:"textFilter"}],sort:"string",adjust:"all"},{id:"agente",header:["Agente",{content:"textFilter"}],sort:"string",adjust:"data"},{id:"total",header:["Base",{content:"textFilter"}],sort:"int",format:webix.i18n.numberFormat,adjust:"data"},{id:"observaciones",header:["Observaciones",{content:"textFilter"}],sort:"string",adjust:"all"},{id:"actions",header:[{text:"Acciones",css:{"text-align":"center"}}],template:"<span class='onEdit webix_icon wxi-pencil'></span> <span class='onDelete webix_icon wxi-trash'></span> <span class='onPrint mdi mdi-printer'></span>",css:{"text-align":"center"},adjust:"all"}],rightSplit:1}).scroll=!0,e.onClick={onEdit:function(e,t,o){var i=this.data.pull[t.row];this.$scope.edit(i.ofertaId)},onDelete:function(e,t,o){t=t.row;var i=this.data.pull[t];this.$scope.delete(i.ofertaId)},onPrint:function(e,t,o){var i=this.data.pull[t.row];this.$scope.imprimirWindow.showWindow(i.ofertaId,null,"/stireport/reports/oferta_general.mrt")}},e.editable=!0,e.editaction="dblclick",e.rules={direccionTrabajo:webix.rules.isNotEmpty},e.on={onAfterFilter:function(){webix.storage.local.put("stateGridOfertas",this.getState())}},e)]}},t.prototype.init=function(e,t){this.imprimirWindow=this.ui(l.default),$$("ofertasGrid").attachEvent("onItemDblClick",(function(e,t,o){var i=this.data.pull[e.row];this.$scope.edit(i.ofertaId)}))},t.prototype.urlChange=function(e,t){var o=n.a.checkLoggedUser().usuarioId;c.languageService.setLanguage(this.app,"es"),this.load(o)},t.prototype.load=function(e){var t=this;r.a.getOfertas(e).then((function(e){e||(e=[]),e=t.formateaCampos(e),$$("ofertasGrid").clearAll(),$$("ofertasGrid").parse(s.a.prepareDataForDataTable("ofertaId",e));var o=$$("ofertasGrid").count();$$("ofertasNReg").config.label="NREG: "+o,$$("ofertasNReg").refresh();var i=webix.storage.local.get("stateGridOfertas");i&&t.$$("ofertasGrid").setState(i)})).catch((function(e){-1!=e.response.indexOf("Cannot delete or update a parent row: a foreign key constraint fails")?a.a.errorRestriccion():a.a.errorMessageAjax(e)}))},t.prototype.formateaCampos=function(e){return e.forEach((function(e){e.empresa=e.empresa.substr(0,4),e.fechaOferta=new Date(e.fechaOferta)})),e},t.prototype.cleanAndload=function(){$$("ofertasGrid").eachColumn((function(e,t){if("actions"!=t.id){var o=this.getFilter(e);o&&(o.setValue?o.setValue(""):o.value="")}})),this.load()},t.prototype.edit=function(e){this.show("/top/ofertasForm?ofertaId="+e)},t.prototype.delete=function(e){var t=this;r.a.deleteOferta(e).then((function(e){t.load()})).catch((function(e){a.a.errorMessageAjax(e)}))},t}(i.c);t.default=p},function(e,t,o){"use strict";o.r(t);var i=o(4),n=o(3),r=o(8),a=o(22),s=o(0),c=o(2),l=o(12),u=o(5),d=o(9),p=o(6),f=o(15),h=(o(21),o(17)),m=o(10),g=o(7),b=o(11),v=o(19),w=o(18),x=o(14);function $(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function y(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}var C,j,A,I,E,P=!1,F=0,O=0,T=0,G=0,_=null,S=0,V=0,D=0,k=0,R=0,L=0,N=0,M=null,W=function(e){function t(){return $(this,t),y(this,e.apply(this,arguments))}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(t,e),t.prototype.config=function(){var e=this;E=this.app;this.app.getService("locale")._;var t=h.a.getGrid(this.app);return{view:"layout",id:"ofertasCosteForm",multiview:!0,rows:[{view:"toolbar",padding:3,elements:[{view:"icon",icon:"mdi mdi-currency-eur",width:37,align:"left"},{view:"label",label:"Oferta de coste"}]},{view:"form",scroll:"y",id:"frmOfertas",maxWidth:2500,autoheight:!0,elements:[{view:"toolbar",padding:3,css:{"background-color":"#F4F5F9"},elements:[{view:"icon",icon:"mdi mdi-currency-eur",width:37,align:"left"},{view:"label",label:"Datos"}]},{cols:[{view:"text",id:"ofertaId",name:"ofertaId",hidden:!0,label:"ID",labelPosition:"top",width:50,disabled:!0},{view:"text",id:"referencia",name:"referencia",required:!0,label:"Referencia",labelPosition:"top",width:250},{view:"combo",id:"cmbEmpresas",name:"empresaId",required:!0,options:{},label:"Empresa",labelPosition:"top",width:250},{view:"datepicker",id:"fechaOferta",name:"fechaOferta",width:150,label:"Fecha de Solicitud",labelPosition:"top",required:!0},{view:"combo",id:"cmbExpedientes",name:"expedienteId",disabled:!0,label:"Expediente",labelPosition:"top",options:{}},{view:"label",label:"Valorado",width:60,on:{onAfterRender:function(){this.getNode().style.marginLeft="10px"}}},{view:"checkbox",id:"valorado",name:"valorado",width:50},{view:"label",label:"Desglosado",width:80},{view:"checkbox",id:"desglosado",name:"desglosado",width:50},{view:"label",label:"IVA",width:30},{view:"checkbox",id:"mostrarIva",name:"mostrarIva",width:50}]},{cols:[{view:"combo",id:"cmbClientes",name:"clienteId",required:!0,minWidth:300,label:"Cliente",labelPosition:"top",options:{},on:{onChange:function(t,o){if(!P){var i=t;e.loadAgenteCliente(i)}},onTimedKeyPress:function(){var e=$$("cmbClientes").getText();e.length>=3&&this.buscaClientesActivos(e),"*"===e&&this.buscaClientesActivos(e)}.bind(this)}},{view:"text",id:"importeCli",name:"importeCliente",disabled:!0,width:180,label:"Importe cliente",labelPosition:"top",value:0,format:"1,00"}]},{view:"toolbar",padding:3,css:{"background-color":"#F4F5F9"},elements:[{view:"icon",icon:"mdi mdi-currency-eur",width:37,align:"left"},{view:"label",label:"Colaboradores"}]},{cols:[{view:"combo",id:"cmbAgentes",name:"agenteId",required:!0,label:"Agente",labelPosition:"top",minWidth:130,options:{},on:{onChange:function(t,o){if(!P){var i=t;o&&""!==o&&e.loadClientesAgente(null,i,null)}},onTimedKeyPress:function(){var e=$$("cmbAgentes").getText();e.length>=3&&this.buscaAgentesActivos(e),"*"===e&&this.buscaAgentesActivos(e)}.bind(this)}},{view:"combo",id:"cmbComerciales",name:"comercialId",label:"Comercial",labelPosition:"top",minWidth:130,options:{},on:{onTimedKeyPress:function(){var e=$$("cmbComerciales").getText(),t=$$("cmbComerciales").config.name;e.length>=3&&this.buscaColaboradoresActivos(e,t,"cmbComerciales",null),"*"===e&&this.buscaColaboradoresActivos(e,t,"cmbComerciales",null)}.bind(this)}},{view:"combo",id:"cmbJefeGrupo",name:"jefeGrupoId",label:"Jefe de grupo",labelPosition:"top",minWidth:130,options:{},on:{onTimedKeyPress:function(){var e=$$("cmbJefeGrupo").getText(),t=$$("cmbJefeGrupo").config.name;e.length>=3&&this.buscaColaboradoresActivos(e,t,"cmbJefeGrupo",null),"*"===e&&this.buscaColaboradoresActivos(e,t,"cmbJefeGrupo",null)}.bind(this)}},{view:"combo",id:"cmbAsesorTecnico",name:"asesorTecnicoId",label:"Asesor técnico",labelPosition:"top",minWidth:130,options:{},on:{onTimedKeyPress:function(){var e=$$("cmbAsesorTecnico").getText(),t=$$("cmbAsesorTecnico").config.name;e.length>=3&&this.buscaColaboradoresActivos(e,t,"cmbAsesorTecnico",null),"*"===e&&this.buscaColaboradoresActivos(e,t,"cmbAsesorTecnico",null)}.bind(this)}}]},{cols:[{view:"textarea",id:"observaciones",name:"observaciones",label:"Observaciones",labelPosition:"top",height:140},{width:600,rows:[{gravity:1},{paddingX:50,align:"center",cols:[{view:"button",label:"Cancelar",css:"webix_danger",click:this.cancel},{view:"button",label:"Guardar",click:function(){return e.accept(!0)},css:"webix_primary",type:"form"}]},{paddingX:50,align:"center",cols:[{view:"button",label:"Guardar sin salir",click:function(){return e.accept(!1)},type:"form"}]},{gravity:1}]}]},{cols:[{rows:[{view:"label",label:"Tipos de Proyecto",align:"left"},{view:"list",id:"listTiposProyecto",template:"#value#",select:!0,autoheight:!1,height:200,scroll:"y",on:{onItemClick:function(e){this.$scope.loadCapitulos(e)}}}]},{rows:[{view:"label",label:"Capítulos",align:"left"},{view:"list",id:"listCapitulos",template:"#value#",select:!0,autoheight:!1,height:200,scroll:"y",on:{onItemClick:function(e){_=e,this.$scope.loadUnidadesObra(e)}}}]},{rows:[{view:"label",label:"Partidas",align:"left"},{view:"list",id:"listUnidadesObra",template:"#value#",select:!0,autoheight:!1,height:200,scroll:"y",on:{onItemClick:function(e){var t=$$("cmbClientes").getValue(),o={indiceCorrector:S,porcen1:D,porcen2:k,porcen3:R,porcen4:L,importeObra:N,limiteImpObra:V};x.a.loadWindow(F,null,t,_,e,o)}}}]}]},t,{minWidth:100}]}],scroll:!0}},t.prototype.init=function(e,t){A=this.ui(m.default),this.cargarEventos()},t.prototype.urlChange=function(e,t){t[0].params.NEW&&s.a.normalMessage("Oferta creada correctamente, puede crear ahora las  lineas asociadas."),t[0].params.MOD&&s.a.normalMessage("Oferta guardada correctamente."),j=n.a.checkLoggedUser(),C=j.usuarioId,p.languageService.setLanguage(this.app,"es"),t[0].params.ofertaId&&(F=t[0].params.ofertaId),t[0].params.expedienteId&&(O=t[0].params.expedienteId),t[0].params.importeObra&&(N=parseFloat(t[0].params.importeObra)),this.cargarEventos(),this.load(F,O)},t.prototype.load=function(e,t){var o=this;v.a.getParametros().then((function(i){i&&i[0].indiceCorrector&&(S=i[0].indiceCorrector),0==e&&t>0?g.a.getExpediente(t).then((function(e){I=e.tipoProyectoId,o.loadEmpresas(e.empresaId),o.loadAgentes(e.agenteId),o.loadClientesAgente(e.clienteId,e.agenteId),o.loadTiposProyecto(e.tipoProyectoId),o.loadExpediente(e),$$("fechaOferta").setValue(new Date(e.fecha)),M=e.formaPagoId,o.buscaColaboradoresActivos("","comercialId","cmbComerciales",e.comercialId),o.buscaColaboradoresActivos("","jefeGrupoId","cmbJefeGrupo",e.jefeGrupoId),o.buscaColaboradoresActivos("","asesorTecnicoId","cmbAsesorTecnico",e.asesorTecnicoId);var t=new Date(e.fecha).getFullYear();o.getReferencia(e.referencia+"_PC_"+t),h.a.loadGrid(null,null,N),$$("valorado").setValue(1),setTimeout(o.accept,2e3)})).catch((function(e){s.a.errorMessageAjax(e)})):u.a.getOferta(e).then((function(e){P=!0,delete e.empresa,delete e.cliente,delete e.tipo,delete e.mantenedor,delete e.agente,delete e.formaPago,M=e.formaPagoId,e.fechaOferta=new Date(e.fechaOferta),$$("frmOfertas").setValues(e),o.loadAgentes(e.agenteId),o.loadEmpresas(e.empresaId),o.loadClientesAgente(e.clienteId,e.agenteId),o.loadTiposProyecto(e.tipoProyectoId),h.a.loadGrid(e.ofertaId,A,N),$$("valorado").setValue(e.valorado),$$("desglosado").setValue(e.desglosado),$$("mostrarIva").setValue(e.mostrarIva),o.buscaColaboradoresActivos("","comercialId","cmbComerciales",e.comercialId),o.buscaColaboradoresActivos("","jefeGrupoId","cmbJefeGrupo",e.jefeGrupoId),o.buscaColaboradoresActivos("","asesorTecnicoId","cmbAsesorTecnico",e.asesorTecnicoId),g.a.getExpediente(t).then((function(e){o.loadExpediente(e),P=!1})).catch((function(e){s.a.errorMessageAjax(e)}))})).catch((function(e){s.a.errorMessageAjax(e)}))})).catch((function(e){s.a.errorMessageAjax(e)}))},t.prototype.cargarEventos=function(){},t.prototype.cancel=function(){this.$scope.show("/top/expedientesForm?expedienteId="+O+"&desdeCoste=true")},t.prototype.accept=function(e){var t=this;if($$("frmOfertas").validate()){var o=$$("frmOfertas").getValues();o.formaPagoId=M,""==o.jefeGrupoId&&(o.jefeGrupoId=null),""==o.asesorTecnicoId&&(o.asesorTecnicoId=null),0==F?(o.tipoProyectoId=I,o.ofertaId=0,o.tipoOfertaId=5,o.coste=0,o.porcentajeBeneficio=0,o.importeBeneficio=0,o.ventaNeta=0,o.porcentajeAgente=0,o.importeAgente=0,o.importeCliente=0,o.importeMantenedor=0,o.mantenedorId=null,o.expedienteId=O,o.esCoste=1,u.a.postOferta(o).then((function(e){E.show("/top/ofertasCosteForm?ofertaId="+e.ofertaId+"&NEW")})).catch((function(e){-1!=e.response.indexOf("Cannot delete or update a parent row: a foreign key constraint fails")?s.a.errorRestriccion():s.a.errorMessageAjax(e)}))):(delete o.direccion,delete o.codpostal,delete o.poblacion,delete o.provincia,delete o.tipoViaId,delete o.comercialCliente,o.porcentajeBeneficio=0,o.importeBeneficio=0,o.porcentajeAgente=0,o.importeAgente=0,o.importeMantenedor=0,o.total=o.importeCliente,o.totalConIva=o.importeCliente,o.coste=o.importeCliente,u.a.putOferta(o,o.ofertaId).then((function(){e?t.show("/top/expedientesForm?expedienteId="+O+"&ofertaCosteId="+o.ofertaId+"&desdeCoste=true"):E.show("/top/ofertasCosteForm?ofertaId="+o.ofertaId+"&MOD")})).catch((function(e){-1!=e.response.indexOf("Cannot delete or update a parent row: a foreign key constraint fails")?s.a.errorRestriccion():s.a.errorMessageAjax(e)})))}else s.a.errorMessage("Debe rellenar los campos correctamente")},t.prototype.loadEmpresas=function(e){f.a.getEmpresas().then((function(t){var o=c.a.prepareDataForCombo("empresaId","nombre",t),i=$$("cmbEmpresas").getPopup().getList();i.clearAll(),i.parse(o),e?($$("cmbEmpresas").setValue(e),$$("cmbEmpresas").refresh()):($$("cmbEmpresas").setValue(10),$$("cmbEmpresas").refresh())}))},t.prototype.loadAgentes=function(e){l.a.getAgentes().then((function(t){var o=c.a.prepareDataForCombo("comercialId","nombre",t),i=$$("agentesList").getList();i.clearAll(),i.parse(o),e&&($$("cmbAgentes").setValue(e),$$("cmbAgentes").refresh())}))},t.prototype.loadClientesAgente=function(e,t){t&&r.a.getClientesAgenteActivos(t).then((function(t){var o=c.a.prepareDataForCombo("clienteId","nombre",t),i=$$("cmbClientes").getList();i.clearAll(),i.parse(o),e?($$("cmbClientes").setValue(e),$$("cmbClientes").refresh()):($$("cmbClientes").setValue(null),$$("cmbClientes").refresh())}))},t.prototype.loadClientes=function(){r.a.getClientesActivos().then((function(e){var t=c.a.prepareDataForCombo("clienteId","nombre",e);t.sort((function(e,t){return e.value>t.value?1:e.value<t.value?-1:0}));var o=$$("clientesList").getList();o.clearAll(),o.parse(t),$$("cmbClientes").setValue(null),$$("cmbClientes").refresh()}))},t.prototype.cambioTipoProyecto=function(e){var t=this;d.a.getTipoProyecto(e).then((function(e){e&&u.a.getSiguienteReferencia(e.abrev).then((function(e){var o=e;t.$$("referencia").setValue(o)})).catch((function(e){s.a.errorMessageAjax(e)}))})).catch((function(e){s.a.errorMessageAjax(e)}))},t.prototype.getReferencia=function(e){var t=this;g.a.getSiguienteReferencia(e).then((function(e){var o=e;t.$$("referencia").setValue(o),P=!1})).catch((function(e){s.a.errorMessageAjax(e)}))},t.prototype.loadTiposProyecto=function(e){var t=this;d.a.getTiposProyecto(C).then((function(o){var i=c.a.prepareDataForCombo("tipoProyectoId","nombre",o),n=$$("listTiposProyecto");n.clearAll(),n.parse(i),e&&(n.select(e),t.loadCapitulos(e))}))},t.prototype.loadCapitulos=function(e){b.a.getCapitulosPorGrupo(e).then((function(e){var t=c.a.prepareDataForCombo("grupoArticuloId","nombre",e),o=$$("listCapitulos");o.clearAll(),o.parse(t)}))},t.prototype.loadCapituloData=function(e){b.a.getCapitulo(e).then((function(e){if(e){var t=e;V=t.limiteImpObra,D=t.porcen1/100,k=t.porcen2/100,R=t.porcen3/100,L=t.porcen4/100}}))},t.prototype.loadUnidadesObra=function(e){var t=this;w.a.getUnidadesObraGrupo(e).then((function(o){var i=c.a.prepareDataForCombo("articuloId","nombre",o),n=$$("listUnidadesObra");n.clearAll(),n.parse(i),t.loadCapituloData(e).then((function(e){}))}))},t.prototype.loadAgenteCliente=function(e){var t=this;e&&l.a.getAgenteCliente(e).then((function(e){t.loadAgentes(e[0].comercialId)}))},t.prototype.loadUsuarios=function(e){n.a.getUsuarios().then((function(t){var o=c.a.prepareDataForCombo("usuarioId","nombre",t),i=$$("cmbUsuarios").getPopup().getList();i.clearAll(),i.parse(o),e?($$("cmbUsuarios").setValue(e),$$("cmbUsuarios").refresh()):($$("cmbUsuarios").setValue(null),$$("cmbUsuarios").refresh())}))},t.prototype.loadNumero=function(){u.a.getNumServicio().then((function(e){$$("numServicio").setValue(e)})).catch((function(e){-1!=e.response.indexOf("Cannot delete or update a parent row: a foreign key constraint fails")?s.a.errorRestriccion():s.a.errorMessageAjax(e)}))},t.prototype.loadExpediente=function(e){var t=[];t.push(e);var o=c.a.prepareDataForCombo("expedienteId","titulo",t),i=$$("cmbExpedientes").getPopup().getList();i.clearAll(),i.parse(o),$$("cmbExpedientes").setValue(e.expedienteId),$$("cmbExpedientes").refresh()},t.prototype.compruebaCobrosCliente=function(e){r.a.getCliente(e).then((function(t){t&&r.a.getCobrosCliente(e).then((function(e){T=t.limiteCredito,e.forEach((function(e){e.seguro||(G+=parseFloat(e.impvenci))})),G>T&&s.a.normalMessage("ATENCION!!!, este cliente ha superado su limete de credito")})).catch((function(e){s.a.errorMessageAjax(e)}))})).catch((function(e){}))},t.prototype.buscaColaboradoresActivos=function(e,t,o,i){var n=0;switch(t){case"comercialId":n=2;break;case"jefeGrupoId":n=3;break;case"jefeObrasId":n=5;break;case"oficinaTecnicaId":n=6;break;case"asesorTecnicoId":n=7;break;default:console.log("No hacemos nada.")}console.log(t),a.a.getColaboradoresActivosQuery(e,n).then((function(e){var t=c.a.prepareDataForCombo("comercialId","nombre",e),n=$$(o).getList();$$(o).getPopup();n.clearAll(),n.parse(t),i?($$(o).setValue(i),$$(o).refresh()):($$(o).setValue(null),$$(o).refresh())})).catch((function(e){console.error("Error al buscar agentes activos:",e)}))},t.prototype.loadAgentes=function(e){l.a.getAgentes().then((function(t){var o=c.a.prepareDataForCombo("comercialId","nombre",t),i=$$("cmbAgentes").getList();i.clearAll(),i.parse(o),e&&($$("cmbAgentes").setValue(e),$$("cmbAgentes").refresh())}))},t.prototype.buscaClientesActivos=function(e){r.a.getClientesActivosQuery(e).then((function(e){var t=c.a.prepareDataForCombo("clienteId","nombre",e),o=$$("cmbClientes").getPopup().getList(),i=$$("cmbClientes").getPopup();o.clearAll(),o.parse(t),i.show()})).catch((function(e){console.error("Error al buscar clientes activos:",e)}))},t}(i.c);t.default=W},function(e,t,o){"use strict";o.r(t),t.default={template:"Start page",css:"webix_shadow_medium app_start"}},function(e,t,o){"use strict";o.r(t);var i=o(4),n=o(9),r=o(3),a=o(0),s=o(2),c=o(6);function l(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function u(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}var d,p=function(e){function t(){return l(this,t),u(this,e.apply(this,arguments))}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(t,e),t.prototype.config=function(){var e=this,t=this.app.getService("locale")._;return{rows:[{view:"toolbar",padding:3,elements:[{view:"icon",icon:"mdi mdi-account-key",width:37,align:"left"},{view:"label",label:t("Tipos de proyecto")}]},{cols:[{view:"button",type:"icon",icon:"wxi-plus",width:37,align:"left",hotkey:"Ctrl+A",tooltip:t("Nuevo registro en formulario (Ctrl+A)"),click:function(){var e=webix.uid();$$("tiposProyectoGrid").add({id:e,tipoProyectoId:0,nombre:"",abrev:"",tipoMantenimientoId:5,esTecnico:1},0),$$("tiposProyectoGrid").edit(e)}},{view:"button",type:"icon",icon:"mdi mdi-refresh",width:37,align:"left",hotkey:"Ctrl+R",tooltip:t("Refrescar la lista (Ctrl+R)"),click:function(){e.cleanAndload()}},{view:"button",type:"icon",icon:"wxi-download",width:37,align:"right",tooltip:t("Descargar como Excel"),click:function(){webix.toExcel($$("tiposProyectoGrid"),{filename:"tiposProyecto",name:"TiposProyectos",rawValues:!0,ignore:{actions:!0}})}},{view:"label",id:"TiposProyectosNReg",label:"NREG: "},{view:"pager",id:"mypager",css:{"text-align":"right"},template:"{common.first()} {common.prev()} {common.pages()} {common.next()} {common.last()}",size:25,group:5}]},{view:"datatable",id:"tiposProyectoGrid",pager:"mypager",select:"row",columns:[{id:"tipoProyectoId",adjust:!0,header:[t("ID"),{content:"numberFilter"}],sort:"number"},{id:"nombre",fillspace:!0,header:[t("Nombre"),{content:"textFilter"}],sort:"string",editor:"text",minWidth:200},{id:"abrev",adjust:"header",header:[t("Abreviatura"),{content:"textFilter"}],sort:"string",editor:"text"},{id:"tipoMantenimientoId",adjust:"header",header:[t("Referencia"),{content:"textFilter"}],sort:"string",editor:"text",hidden:!0},{id:"esTecnico",adjust:"header",header:[t("Referencia"),{content:"textFilter"}],sort:"string",editor:"text",hidden:!0},{id:"actions",header:[{text:t("Acciones"),css:{"text-align":"center"}}],template:"<span class='onDelete webix_icon wxi-trash'></span>",css:{"text-align":"center"}}],rightSplit:1,onClick:{onDelete:function(e,t,o){var i=this.data.pull[t.row].nombre;this.$scope.delete(t.row,i)},onEdit:function(e,t,o){this.$scope.edit(t.row)}},editable:!0,editaction:"dblclick",rules:{nombre:webix.rules.isNotEmpty},on:{onAfterEditStart:function(e){d=e.row,this.data.pull[d]},onAfterEditStop:function(e,t,o){var i=t.row,r=this.getItem(i);delete r.departamento,e.value==e.old&&0!=r.tipoProyectoId||(this.validate(i)?(delete r.id,0==r.tipoProyectoId?n.a.postTipoProyecto(r).then((function(e){r.tipoProyectoId=e.tipoProyectoId,$$("tiposProyectoGrid").updateItem(i,r),$$("tiposProyectoGrid").editStop()})).catch((function(e){return handleServerError(e)})):n.a.putTipoProyecto(r).catch((function(e){return handleServerError(e)}))):a.a.errorMessage("Valores incorrectos"))},onAfterFilter:function(){var e=$$("tiposProyectoGrid").count();$$("TiposProyectosNReg").config.label="NREG: "+e,$$("TiposProyectosNReg").refresh()}}}]}},t.prototype.urlChange=function(e,t){r.a.checkLoggedUser(),c.languageService.setLanguage(this.app,"es");var o=null;t[0].params.tipoProyectoId&&(o=t[0].params.tipoProyectoId),webix.UIManager.addHotKey("Esc",(function(){return $$("tiposProyectoGrid").remove(-1),!1}),$$("tiposProyectoGrid")),webix.extend($$("tiposProyectoGrid"),webix.ProgressBar),this.load(o)},t.prototype.load=function(e){n.a.getTiposProyecto().then((function(t){$$("tiposProyectoGrid").clearAll(),$$("tiposProyectoGrid").parse(s.a.prepareDataForDataTable("tipoProyectoId",t)),e&&($$("tiposProyectoGrid").select(e),$$("tiposProyectoGrid").showItem(e));var o=$$("tiposProyectoGrid").count();$$("TiposProyectosNReg").config.label="NREG: "+o,$$("TiposProyectosNReg").refresh(),$$("tiposProyectoGrid").hideProgress()})).catch((function(e){$$("tiposProyectoGrid").hideProgress(),-1!=e.response.indexOf("Cannot delete or update a parent row: a foreign key constraint fails")?a.a.errorRestriccion():a.a.errorMessageAjax(e)}))},t.prototype.edit=function(e){this.show("/top/tiposProyectoForm?tipoProyectoId="+e)},t.prototype.delete=function(e,t){var o=this.app.getService("locale")._,i=this;webix.confirm({title:o("AVISO"),text:o("¿Desea realmente borrar este registro?").replace("*",t),type:"confirm-warning",callback:function(t){!0===t&&n.a.deleteTipoProyecto(e).then((function(e){i.load()})).catch((function(e){-1!=e.response.indexOf("Cannot delete or update a parent row: a foreign key constraint fails")?a.a.errorRestriccion():a.a.errorMessageAjax(e)}))}})},t.prototype.cleanAndload=function(){$$("tiposProyectoGrid").eachColumn((function(e,t){if("actions"!=t.id){var o=this.getFilter(e);o&&(o.setValue?o.setValue(""):o.value="")}})),this.load()},t}(i.c);t.default=p},function(e,t,o){"use strict";o.r(t);var i=o(4),n=o(23),r=o(24),a=o(25);function s(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function c(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}var l=function(e){function t(){return s(this,t),c(this,e.apply(this,arguments))}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(t,e),t.prototype.config=function(){return{type:"view",rows:[r.default,{cols:[n.default,{view:"resizer",id:"resizer"},{$subview:!0}]},a.default]}},t.prototype.init=function(){},t}(i.c);t.default=l},function(e,t,o){"use strict";o.r(t);var i=o(4),n=o(18),r=o(11),a=o(13),s=o(3),c=o(0),l=o(2),u=o(6);o(27);function d(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function p(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}var f,h=null,m=[],g=function(e){function t(){return d(this,t),p(this,e.apply(this,arguments))}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(t,e),t.prototype.config=function(){var e=this;h=s.a.getUsuarioCookie();var t=this.app.getService("locale")._;return{rows:[{view:"toolbar",padding:3,elements:[{view:"icon",icon:"mdi mdi-account-key",width:37,align:"left"},{view:"label",label:t("Unidades de Obra")}]},{cols:[{view:"button",type:"icon",icon:"wxi-plus",width:37,align:"left",hotkey:"Ctrl+A",tooltip:t("Nuevo registro en formulario (Ctrl+A)"),click:function(){var e=webix.uid();$$("unidadesObraGrid").add({id:e,articuloId:0,nombre:"",grupoArticuloId:0,descripcion:"",esTecnico:1,departamentoId:5},0),$$("unidadesObraGrid").edit(e)}},{view:"button",type:"icon",icon:"mdi mdi-refresh",width:37,align:"left",hotkey:"Ctrl+R",tooltip:t("Refrescar la lista (Ctrl+R)"),click:function(){e.cleanAndload()}},{view:"button",type:"icon",icon:"wxi-download",width:37,align:"right",tooltip:t("Descargar como Excel"),click:function(){webix.toExcel($$("unidadesObraGrid"),{filename:"unidadesObra",name:"UnidadesObra",rawValues:!0,ignore:{actions:!0}})}},{view:"label",id:"CapitulosNReg",label:"NREG: "},{view:"pager",id:"mypager",css:{"text-align":"right"},template:"{common.first()} {common.prev()} {common.pages()} {common.next()} {common.last()}",size:25,group:5}]},{view:"datatable",id:"unidadesObraGrid",pager:"mypager",select:"row",fixedRowHeight:!0,ready:function(){this.adjustRowHeight()},columns:[{id:"articuloId",adjust:!0,header:[t("ID"),{content:"numberFilter"}],sort:"number",minWidth:100},{id:"grupoArticuloId",header:[t("Capitulo"),{content:"selectFilter"}],sort:"string",fillspace:!0,minWidth:350,editor:"combo",collection:m},{id:"nombre",header:[t("Unidad de obra"),{content:"textFilter"}],sort:"string",editor:"text",minWidth:250},{id:"descripcion",header:["Descripción",{content:"textFilter"}],sort:"string",width:350,fillspace:!0,editor:"popup",template:function(e){return e.descripcion.replace(/\n/g,"<br>")}},{id:"actions",header:[{text:t("Acciones"),css:{"text-align":"center"}}],template:"<span class='onDelete webix_icon wxi-trash'></span>",css:{"text-align":"center"},minWidth:100}],css:{"word-wrap":"break-word"},rightSplit:1,onClick:{onDelete:function(e,t,o){var i=this.data.pull[t.row].nombre;this.$scope.delete(t.row,i)},onEdit:function(e,t,o){this.$scope.edit(t.row)}},editable:!0,editaction:"dblclick",rules:{nombre:webix.rules.isNotEmpty},on:{onBeforeLoad:function(){r.a.getCapitulos().then((function(e){m=l.a.prepareDataForCombo("grupoArticuloId","nombre",e),$$("unidadesObraGrid").getColumnConfig("grupoArticuloId").collection=m,$$("unidadesObraGrid").refreshColumns()}))},onAfterEditStart:function(e){f=e.row,this.data.pull[f]},onAfterEditStop:function(e,t,o){var i=t.row,n=this.getItem(i);if(e.value!=e.old||0==n.articuloId){if(!this.validate(i))return;delete n.id,delete n.tipoIVA,delete n.porceIva,delete n.profesion,delete n.capitulo,delete n.departamento,delete n.$height,0==n.articuloId?a.a.postArticulo(n).then((function(e){n.articuloId=e.articuloId,$$("unidadesObraGrid").updateItem(i,n),$$("unidadesObraGrid").editStop()})).catch((function(e){return handleServerError(e)})):a.a.putArticulo(n).catch((function(e){return handleServerError(e)}))}},onAfterFilter:function(){var e=$$("unidadesObraGrid").count();$$("CapitulosNReg").config.label="NREG: "+e,$$("CapitulosNReg").refresh()},onEditorKeyPress:function(e,t){var o=this.getEditor();if(o){if(13===e&&!t.shiftKey)return o.getInputNode().value+="\n",!1;if(13===e&&t.shiftKey)return o.getInputNode().value+="\n",!1}}}}]}},t.prototype.urlChange=function(e,t){s.a.checkLoggedUser(),u.languageService.setLanguage(this.app,"es");var o=null;t[0].params.articuloId&&(o=t[0].params.articuloId),webix.UIManager.addHotKey("Esc",(function(){return $$("unidadesObraGrid").remove(-1),!1}),$$("unidadesObraGrid")),webix.extend($$("unidadesObraGrid"),webix.ProgressBar),this.load(o)},t.prototype.load=function(e){n.a.getUnidadesObra(h.usuarioId,5).then((function(t){$$("unidadesObraGrid").clearAll(),$$("unidadesObraGrid").parse(l.a.prepareDataForDataTable("articuloId",t)),e&&($$("unidadesObraGrid").select(e),$$("unidadesObraGrid").showItem(e));var o=$$("unidadesObraGrid").count();$$("CapitulosNReg").config.label="NREG: "+o,$$("CapitulosNReg").refresh(),$$("unidadesObraGrid").hideProgress()})).catch((function(e){$$("unidadesObraGrid").hideProgress(),-1!=e.response.indexOf("Cannot delete or update a parent row: a foreign key constraint fails")?c.a.errorRestriccion():c.a.errorMessageAjax(e)}))},t.prototype.edit=function(e){this.show("/top/capitulosForm?articuloId="+e)},t.prototype.delete=function(e,t){var o=this.app.getService("locale")._,i=this;webix.confirm({title:o("AVISO"),text:o("¿Desea realmente borrar este registro?").replace("*",t),type:"confirm-warning",callback:function(t){!0===t&&a.a.deleteArticulo(e).then((function(e){i.load()})).catch((function(e){-1!=e.response.indexOf("Cannot delete or update a parent row: a foreign key constraint fails")?c.a.errorRestriccion():c.a.errorMessageAjax(e)}))}})},t.prototype.cleanAndload=function(){$$("unidadesObraGrid").eachColumn((function(e,t){if("actions"!=t.id){var o=this.getFilter(e);o&&(o.setValue?o.setValue(""):o.value="")}})),this.load()},t}(i.c);t.default=g,webix.editors.$popup={text:{view:"popup",body:{view:"textarea",width:550,height:550}}}},function(e,t,o){"use strict";o.r(t);var i=o(4),n=o(3),r=o(0),a=o(2),s=o(6);function c(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function l(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}var u,d,p=!1,f=function(e){function t(){return c(this,t),l(this,e.apply(this,arguments))}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(t,e),t.prototype.config=function(){var e=this,t=this.app.getService("locale")._;return{rows:[{view:"toolbar",padding:3,elements:[{view:"icon",icon:"mdi mdi-account-key",width:37,align:"left"},{view:"label",label:t("Usuarios")}]},{cols:[{view:"button",type:"icon",icon:"wxi-plus",width:37,align:"left",hotkey:"Ctrl+A",tooltip:t("Nuevo registro en formulario (Ctrl+A)"),click:function(){e.show("/top/usuariosForm?usuarioId=0")}},{view:"button",type:"icon",icon:"mdi mdi-refresh",width:37,align:"left",hotkey:"Ctrl+R",tooltip:t("Refrescar la lista (Ctrl+R)"),click:function(){e.cleanAndload()}},{view:"button",type:"icon",icon:"wxi-download",width:37,align:"right",tooltip:t("Descargar como Excel"),click:function(){webix.toExcel($$("usuariosGrid"),{filename:"usuarios",name:"Usuarios",rawValues:!0,ignore:{actions:!0}})}},{view:"label",id:"UsuariosNReg",label:"NREG: "},{view:"pager",id:"mypager",css:{"text-align":"right"},template:"{common.first()} {common.prev()} {common.pages()} {common.next()} {common.last()}",size:25,group:5}]},{view:"datatable",id:"usuariosGrid",pager:"mypager",select:"row",columns:[{id:"usuarioId",adjust:!0,header:[t("ID"),{content:"numberFilter"}],sort:"number"},{id:"nombre",fillspace:!0,header:[t("Nombre usuario"),{content:"textFilter"}],sort:"string",editor:"text",minWidth:200},{id:"email",fillspace:!0,header:[t("Correo"),{content:"textFilter"}],sort:"string",editor:"text",minWidth:200},{id:"login",fillspace:!0,header:[t("login"),{content:"textFilter"}],sort:"string",editor:"text",minWidth:200},{id:"actions",header:[{text:t("Acciones"),css:{"text-align":"center"}}],template:"<span class='onEdit webix_icon wxi-pencil'></span><span class='onDelete webix_icon wxi-trash'></span>",css:{"text-align":"center"}}],rightSplit:1,onClick:{onDelete:function(e,t,o){var i=this.data.pull[t.row].nombre;this.$scope.delete(t.row,i)},onEdit:function(e,t,o){this.$scope.edit(t.row)}},editable:!0,editaction:"dblclick",rules:{nombre:webix.rules.isNotEmpty,email:webix.rules.isEmail},on:{onAfterEditStart:function(e){u=e.row,d=this.data.pull[u]},onAfterEditStop:function(e,t,o){var i=this,a=this.getColumnIndex(t.column),s=this.config.columns.length;if(p&&a!=s-2)return!1;if(e.value!=e.old||p)if(p=!1,this.validate(u)){delete(d=this.data.pull[u]).id;var c=d;0==c.usuarioId?n.a.postUsuario(c).then((function(e){i.$scope.load(e.usuarioId),$$("usuariosGrid").editStop()})).catch((function(e){-1!=e.response.indexOf("Cannot delete or update a parent row: a foreign key constraint fails")?r.a.errorRestriccion():r.a.errorMessageAjax(e)})):n.a.putUsuario(c).then((function(e){})).catch((function(e){-1!=e.response.indexOf("Cannot delete or update a parent row: a foreign key constraint fails")?r.a.errorRestriccion():r.a.errorMessageAjax(e)}))}else r.a.errorMessage("Valores incorrectos")},onAfterFilter:function(){var e=$$("usuariosGrid").count();$$("UsuariosNReg").config.label="NREG: "+e,$$("UsuariosNReg").refresh()}}}]}},t.prototype.urlChange=function(e,t){n.a.checkLoggedUser(),s.languageService.setLanguage(this.app,"es");var o=null;t[0].params.usuarioId&&(o=t[0].params.usuarioId),webix.UIManager.addHotKey("Esc",(function(){return $$("usuariosGrid").remove(-1),!1}),$$("usuariosGrid")),webix.extend($$("usuariosGrid"),webix.ProgressBar),this.load(o)},t.prototype.load=function(e){n.a.getUsuarios().then((function(t){$$("usuariosGrid").clearAll(),$$("usuariosGrid").parse(a.a.prepareDataForDataTable("usuarioId",t)),e&&($$("usuariosGrid").select(e),$$("usuariosGrid").showItem(e));var o=$$("usuariosGrid").count();$$("UsuariosNReg").config.label="NREG: "+o,$$("UsuariosNReg").refresh(),$$("usuariosGrid").hideProgress()})).catch((function(e){$$("usuariosGrid").hideProgress(),-1!=e.response.indexOf("Cannot delete or update a parent row: a foreign key constraint fails")?r.a.errorRestriccion():r.a.errorMessageAjax(e)}))},t.prototype.edit=function(e){this.show("/top/usuariosForm?usuarioId="+e)},t.prototype.delete=function(e,t){var o=this.app.getService("locale")._,i=this;webix.confirm({title:o("AVISO"),text:o("¿Desea realmente borrar este registro?").replace("*",t),type:"confirm-warning",callback:function(t){!0===t&&n.a.deleteUsuario(e).then((function(e){i.load()})).catch((function(e){-1!=e.response.indexOf("Cannot delete or update a parent row: a foreign key constraint fails")?r.a.errorRestriccion():r.a.errorMessageAjax(e)}))}})},t.prototype.cleanAndload=function(){$$("usuariosGrid").eachColumn((function(e,t){if("actions"!=t.id){var o=this.getFilter(e);o&&(o.setValue?o.setValue(""):o.value="")}})),this.load()},t}(i.c);t.default=f},function(e,t){},function(e,t,o){"use strict";var i;o.r(t),t.default=((i={Inicio:"Inicio","Nombre usuario":"Nombre usuario","Administración":"Administración",Salir:"Salir","Refrescar la lista (Ctrl+R)":"Refrescar la lista (Ctrl+R)","Descargar como Excel":"Descargar como Excel",Fecha:"Fecha","Gestión":"Gestión",Ofertas:"Ofertas",Parametros:"Parámetros",Usuarios:"Usuarios","Tipos de proyecto":"Tipos de proyecto",Capitulos:"Capítulos","Unidades de obra":"Unidades de obra",Expedientes:"Expedientes","Nuevo registro en formulario (Ctrl+A)":"Nuevo registro en formulario (Ctrl+A)",ID:"ID","Nombre capitulo":"Nombre capítulo","Tipo proyecto":"Tipo proyecto","Limite obra":"Límite obra","Porcentaje 1":"Porcentaje 1","Porcentaje 2":"Porcentaje 2","Porcentaje 3":"Porcentaje 3","Porcentaje 4":"Porcentaje 4","Aplicar Fórmula":"Aplicar fórmula",Referencia:"Referencia",Acciones:"Acciones","Nueva oferta de coste (Ctrl+A)":"Nueva oferta de coste (Ctrl+A)","Presupuestos de coste":"Presupuestos de coste",Id:"Id",Empresa:"Empresa",Cliente:"Cliente",Total:"Total","Total IVA":"Total IVA","Forma pago":"Forma de pago",Guardar:"Guardar",Cancelar:"Cancelar",Eliminar:"Eliminar",Editar:"Editar",Buscar:"Buscar",Aceptar:"Aceptar",Cerrar:"Cerrar",Detalles:"Detalles","Configuración":"Configuración",Idioma:"Idioma",Usuario:"Usuario","Contraseña":"Contraseña","Iniciar sesión":"Iniciar sesión","Cerrar sesión":"Cerrar sesión",Error:"Error",Cargando:"Cargando..."}).Acciones="Acciones",i.EmpresaId="ID de la Empresa",i.ClienteId="ID del Cliente",i["Nueva oferta de venta (Ctrl+A)"]="Nueva oferta de venta (Ctrl+A)",i["Presupuestos de venta"]="Presupuestos de venta",i["IMPRESIÓN DE OFERTAS"]="Impresión de ofertas",i)},function(e,t,o){"use strict";o.r(t),t.default={"Ancient Dashboard":"Ancient Dashboard"}},function(e,t,o){"use strict";o.r(t);var i,n,r=o(4),a=o(3),s=o(8),c=o(1),l=function(){return new webix.promise((function(e,t){c.a.getConfig().then((function(e){var t=e.urlApi+"/api/estados_expediente";return webix.ajax().timeout(1e4).headers({"Content-Type":"application/json"}).get(t)})).then((function(t){e(t.json())})).catch((function(e){t(e)}))}))},u=function(){return new webix.promise((function(e,t){c.a.getConfig().then((function(e){var t=e.urlApi+"/api/tipos_via";return webix.ajax().timeout(1e4).headers({"Content-Type":"application/json"}).get(t)})).then((function(t){e(t.json())})).catch((function(e){t(e)}))}))},d=o(0),p=o(2),f=o(12),h=o(22),m=o(7),g=o(9),b=o(6),v=o(15),w=o(10),x=o(5),$=!1,y=null,C=null,j=0,A=null,I={getGrid:function(e){var t;C=e;var o=e.getService("locale")._,n={cols:[{view:"button",type:"icon",icon:"wxi-plus",width:37,align:"left",hotkey:"Ctrl+A",tooltip:o("Nueva oferta de coste (Ctrl+A)"),click:function(){0!=y&&y?e.show("/top/ofertasCosteForm?ofertaId=0&expedienteId="+y+"&importeObra="+j):d.a.errorMessage("Expediente no creado.")}},{view:"button",type:"icon",icon:"mdi mdi-refresh",width:37,align:"left",hotkey:"Ctrl+R",tooltip:o("Refrescar la lista (Ctrl+R)"),click:function(){}},{view:"button",type:"icon",icon:"wxi-download",width:37,align:"right",tooltip:o("Descargar como Excel"),click:function(){webix.toExcel($$("expedientesGridSolicitud"),{filename:"expedientes",name:"oferta",rawValues:!0,ignore:{actions:!0}})}},{view:"label",id:"ofertasCosteNReg",label:"NREG: "},{view:"pager",id:"mypager1",css:{"text-align":"right"},template:"{common.first()} {common.prev()} {common.pages()} {common.next()} {common.last()}",size:25,group:5}]};return"<span class='onDelete webix_icon wxi-trash'></span>",{rows:[{view:"toolbar",padding:3,elements:[{view:"icon",icon:"mdi mdi-folder-network-outline",width:37,align:"left"},{view:"label",label:o("Presupuestos de coste")}]},n,((t={view:"datatable",id:"ofertasCosteGrid",scroll:"x,y",pager:"mypager1",select:"row",autoheight:!1,type:{rcheckbox:function(e,t,o,i){return"<input disabled class='webix_table_checkbox' type='checkbox' "+(o==i.checkValue?'checked="true"':"")+">"}},ready:function(){this.attachEvent("onItemDblClick",(function(e,t,o){var i=this.data.pull[e.row].ofertaId;I.edit(i)}))},columns:[{id:"id",header:[o("Id"),{content:"textFilter"}],sort:"string",width:50,hidden:!0},{id:"referencia",header:[o("Referencia"),{content:"textFilter"}],sort:"string",adjust:"data"},{id:"fechaOferta",header:[{text:o("Fecha"),css:{"text-align":"center"}},{content:"dateFilter"}],adjust:"data",sort:"string",format:webix.i18n.dateFormatStr,css:{"text-align":"center"}},{id:"empresaId",header:[o("EmpresaId"),{content:"textFilter"}],sort:"string",fillspace:!0,hidden:!0},{id:"empresa",header:[o("Empresa"),{content:"textFilter"}],sort:"string",adjust:"header"},{id:"clienteId",header:[o("ClienteId"),{content:"textFilter"}],sort:"string",hidden:!0},{id:"cliente",header:[o("Cliente"),{content:"textFilter"}],sort:"string",minWidth:380,fillspace:!0},{id:"importeCliente",header:[o("Total"),{content:"textFilter"}],sort:"string",width:100,format:webix.i18n.numberFormat},{id:"agente",header:[o("Agente"),{content:"textFilter"}],sort:"string",minWidth:280},{id:"comercial",header:[o("Comercial"),{content:"textFilter"}],sort:"string",minWidth:280},{id:"jefegrupoNombre",header:[o("Jefe de grupo"),{content:"textFilter"}],sort:"string",minWidth:280},{id:"asesorTecnicoNombre",header:[o("Asesor Técnico"),{content:"textFilter"}],sort:"string",minWidth:280},{id:"actions",header:[{text:o("Acciones"),css:{"text-align":"center"}}],template:"<span class='onEdit webix_icon wxi-pencil'></span><span class='onDelete webix_icon wxi-trash'></span>",css:{"text-align":"center"}}],rightSplit:1}).scroll=!0,t.onClick={onDelete:function(t,o,i){o=o.row;I.delete(o,e)},onEdit:function(e,t,o){var i=this.data.pull[t.row].ofertaId;I.edit(i)}},t.editable=!0,t.editaction="dblclick",t.rules={},t.on={onAfterEditStart:function(e){i=e.row,this.data.pull[i]},onAfterEditStop:function(e,t,o){var n=this.getColumnIndex(t.column),r=this.config.columns.length;if($&&n!=r-2)return!1;if(e.value!=e.old||$)if($=!1,this.validate(i)){delete this.data.pull[i].id}else d.a.errorMessage("Valores incorrectos")},onAfterFilter:function(){var e=$$("ofertasCosteGrid").count();$$("ofertasCosteNReg").config.label="NREG: "+e,$$("ofertasCosteNReg").refresh()}},t)]}},loadGrid:function(e,t,o,i){if(A=i,0==e)return y=null,void(j=0);t=t,j=o,0,e?(y=e,x.a.getOfertasExpediente(y,1).then((function(e){if(e.length>0){if(e=I.formateaCampos(e),e.length,$$("ofertasCosteGrid").clearAll(),$$("ofertasCosteGrid").parse(p.a.prepareDataForDataTable("ofertaId",e)),A){var t=parseInt(A);$$("ofertasCosteGrid").select(t),$$("ofertasCosteGrid").showItem(t)}var o=$$("ofertasCosteGrid").count();$$("ofertasCosteNReg").config.label="NREG: "+o,$$("ofertasCosteNReg").refresh()}else $$("ofertasCosteGrid").clearAll()})).catch((function(e){-1!=e.response.indexOf("Cannot delete or update a parent row: a foreign key constraint fails")?d.a.errorRestriccion():d.a.errorMessageAjax(e)}))):$$("ofertasCosteGrid").clearAll()},delete:function(e,t){var o=t.getService("locale")._;webix.confirm({title:o("AVISO"),text:o("¿ Está seguro que desea eliminar esta oferta ?"),type:"confirm-warning",callback:function(t){!0===t&&x.a.deleteOferta(e).then((function(e){I.loadGrid(y,null,j)})).catch((function(e){-1!=e.response.indexOf("Cannot delete or update a parent row: a foreign key constraint fails")?d.a.errorRestriccion():d.a.errorMessageAjax(e)}))}})},disparaEvento:function(){},edit:function(e){var t=$$("tabViewExpediente").getValue();localStorage.setItem("activeTab",t),C.show("/top/ofertasCosteForm?ofertaId="+e+"&expedienteId="+y+"&importeObra="+j)},formateaCampos:function(e){return e.forEach((function(e){e.empresa=e.empresa.substr(0,4),e.fechaOferta=new Date(e.fechaOferta)})),e}},E=!1,P=null,F=null,O=null,T=0,G={getGrid:function(e){var t;O=e;var o=e.getService("locale")._,i={cols:[{view:"button",type:"icon",icon:"wxi-plus",width:37,align:"left",hotkey:"Ctrl+A",tooltip:o("Nueva oferta de venta (Ctrl+A)"),click:function(){0!=F&&F?e.show("/top/ofertasVentaForm?ofertaId=0&expedienteId="+F+"&importeObra="+T):d.a.errorMessage("Expediente no creado.")}},{view:"button",type:"icon",icon:"mdi mdi-refresh",width:37,align:"left",hotkey:"Ctrl+R",tooltip:o("Refrescar la lista (Ctrl+R)"),click:function(){}},{view:"button",type:"icon",icon:"wxi-download",width:37,align:"right",tooltip:o("Descargar como Excel"),click:function(){webix.toExcel($$("expedientesGridSolicitud"),{filename:"expedientes",name:"oferta",rawValues:!0,ignore:{actions:!0}})}},{view:"label",id:"ofertasVentaNReg",label:"NREG: "},{view:"pager",id:"mypagerVenta",css:{"text-align":"right"},template:"{common.first()} {common.prev()} {common.pages()} {common.next()} {common.last()}",size:25,group:5}]};return"<span class='onDelete webix_icon wxi-trash'></span>",{rows:[{view:"toolbar",padding:3,elements:[{view:"icon",icon:"mdi mdi-folder-network-outline",width:37,align:"left"},{view:"label",label:o("Presupuestos de venta")}]},i,((t={view:"datatable",id:"ofertasVentaGrid",scroll:"x,y",pager:"mypagerVenta",select:"row",autoheight:!1,type:{rcheckbox:function(e,t,o,i){return"<input disabled class='webix_table_checkbox' type='checkbox' "+(o==i.checkValue?'checked="true"':"")+">"}},ready:function(){this.attachEvent("onItemDblClick",(function(e,t,o){var i=this.data.pull[e.row].ofertaId;G.edit(i)}))},columns:[{id:"id",header:[o("Id"),{content:"textFilter"}],sort:"string",width:50,hidden:!0},{id:"referencia",header:[o("Referencia"),{content:"textFilter"}],sort:"string",adjust:"data"},{id:"fechaOferta",header:[{text:o("Fecha"),css:{"text-align":"center"}},{content:"dateFilter"}],adjust:"data",sort:"string",format:webix.i18n.dateFormatStr,css:{"text-align":"center"}},{id:"empresaId",header:[o("EmpresaId"),{content:"textFilter"}],sort:"string",fillspace:!0,hidden:!0},{id:"empresa",header:[o("Empresa"),{content:"textFilter"}],sort:"string",adjust:"header"},{id:"clienteId",header:[o("ClienteId"),{content:"textFilter"}],sort:"string",hidden:!0},{id:"cliente",header:[o("Cliente"),{content:"textFilter"}],sort:"string",minWidth:380,fillspace:!0},{id:"importeCliente",header:[o("Total"),{content:"textFilter"}],sort:"string",width:100,format:webix.i18n.numberFormat},{id:"agente",header:[o("Agente"),{content:"textFilter"}],sort:"string",minWidth:280},{id:"comercial",header:[o("Comercial"),{content:"textFilter"}],sort:"string",minWidth:280},{id:"jefegrupoNombre",header:[o("Jefe de grupo"),{content:"textFilter"}],sort:"string",minWidth:280},{id:"asesorTecnicoNombre",header:[o("Asesor Técnico"),{content:"textFilter"}],sort:"string",minWidth:280},{id:"actions",header:[{text:o("Acciones"),css:{"text-align":"center"}}],template:"<span class='onEdit webix_icon wxi-pencil'></span><span class='onDelete webix_icon wxi-trash'></span>",css:{"text-align":"center"}}],rightSplit:1}).scroll=!0,t.onClick={onDelete:function(t,o,i){o=o.row;G.delete(o,e)},onEdit:function(e,t,o){var i=this.data.pull[t.row].ofertaId;G.edit(i)}},t.editable=!0,t.editaction="dblclick",t.rules={},t.on={onAfterEditStart:function(e){n=e.row,this.data.pull[n]},onAfterEditStop:function(e,t,o){var i=this.getColumnIndex(t.column),r=this.config.columns.length;if(E&&i!=r-2)return!1;if(e.value!=e.old||E)if(E=!1,this.validate(n)){delete this.data.pull[n].id}else d.a.errorMessage("Valores incorrectos")},onAfterFilter:function(){var e=$$("ofertasVentaGrid").count();$$("ofertasVentaNReg").config.label="NREG: "+e,$$("ofertasVentaNReg").refresh()}},t)]}},loadGrid:function(e,t,o,i){if(P=i,0!=e){if(0==e)return F=null,void(T=0);t=t,T=o,0,e?(F=e,x.a.getOfertasExpediente(F,0).then((function(e){if(e.length>0){if(e=G.formateaCampos(e),e.length,$$("ofertasVentaGrid").clearAll(),$$("ofertasVentaGrid").parse(p.a.prepareDataForDataTable("ofertaId",e)),P){var t=parseInt(P);$$("ofertasVentaGrid").select(t),$$("ofertasVentaGrid").showItem(t)}var o=$$("ofertasVentaGrid").count();$$("ofertasVentaNReg").config.label="NREG: "+o,$$("ofertasVentaNReg").refresh()}else $$("ofertasVentaGrid").clearAll()})).catch((function(e){-1!=e.response.indexOf("Cannot delete or update a parent row: a foreign key constraint fails")?d.a.errorRestriccion():d.a.errorMessageAjax(e)}))):$$("ofertasVentaGrid").clearAll()}else d.a.errorMessage("Expediente no creado.")},delete:function(e,t){var o=t.getService("locale")._;webix.confirm({title:o("AVISO"),text:o("¿ Está seguro que desea eliminar esta oferta ?"),type:"confirm-warning",callback:function(t){!0===t&&x.a.deleteOferta(e).then((function(e){G.loadGrid(F,null,T)})).catch((function(e){-1!=e.response.indexOf("Cannot delete or update a parent row: a foreign key constraint fails")?d.a.errorRestriccion():d.a.errorMessageAjax(e)}))}})},disparaEvento:function(){},edit:function(e){var t=$$("tabViewExpediente").getValue();localStorage.setItem("activeTab",t),O.show("/top/ofertasVentaForm?ofertaId="+e+"&expedienteId="+F+"&importeObra="+T)},formateaCampos:function(e){return e.forEach((function(e){e.empresa=e.empresa.substr(0,4),e.fechaOferta=new Date(e.fechaOferta)})),e}};function _(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function S(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}var V,D,k=0,R=0,L=0,N=null,M=null,W=!1,U=null,B={},q=null,J=null,z=function(e){function t(){return _(this,t),S(this,e.apply(this,arguments))}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(t,e),t.prototype.config=function(){var e=this,t=(this.app.getService("locale")._,I.getGrid(this.app)),o=G.getGrid(this.app);return this,{view:"tabview",id:"tabViewExpediente",cells:[{header:"Datos",width:100,body:{view:"layout",id:"expedientesForm",multiview:!0,rows:[{view:"toolbar",padding:3,css:{"background-color":"#F4F5F9"},elements:[{view:"icon",icon:"mdi mdi-currency-eur",width:37,align:"left"},{view:"label",label:"Expediente"}]},{view:"form",scroll:"y",id:"frmExpedientes",maxWidth:2500,autoheight:!0,elements:[{view:"toolbar",padding:3,css:{"background-color":"#F4F5F9"},elements:[{view:"icon",icon:"mdi mdi-currency-eur",width:37,align:"left"},{view:"label",label:"Datos"}]},{cols:[{view:"text",id:"expedienteId",name:"expedienteId",hidden:!0,label:"ID",labelPosition:"top",width:100,disabled:!0},{view:"text",id:"referencia",name:"referencia",required:!0,label:"Referencia",labelPosition:"top",maxWidth:130},{view:"combo",id:"cmbEmpresas",name:"empresaId",required:!0,options:{},label:"Empresa",labelPosition:"top",maxWidth:280},{view:"combo",id:"cmbEstados",name:"estadoExpedienteId",required:!0,options:{},label:"Estado",labelPosition:"top",maxWidth:100},{view:"combo",id:"cmbClientes",name:"clienteId",required:!0,minWidth:300,label:"Cliente",labelPosition:"top",options:{},on:{onChange:function(t,o){if(!W){var i=t;e.loadAgenteCliente(i)}},onTimedKeyPress:function(){var e=$$("cmbClientes").getText();e.length>=3&&this.buscaClientesActivos(e),"*"===e&&this.buscaClientesActivos(e)}.bind(this)}},{view:"text",id:"titulo",name:"titulo",required:!0,label:"Titulo",labelPosition:"top",maxwidth:250},{view:"datepicker",id:"fecha",name:"fecha",maxWidth:150,label:"Fecha",labelPosition:"top",required:!0},{view:"combo",id:"cmbTiposProyecto",name:"tipoProyectoId",required:!0,label:"Tipo proyecto",labelPosition:"top",options:{}}]},{cols:[{view:"combo",id:"cmbTiposVia",name:"tipoViaId",options:{},label:"tipo de via",labelPosition:"top",maxWidth:150},{view:"text",id:"direccion",name:"direccion",label:"Direccion",labelPosition:"top"},{view:"text",id:"poblacion",name:"poblacion",label:"Población",labelPosition:"top",maxWidth:130},{view:"text",id:"codPostal",name:"codPostal",label:"Cod. postal",labelPosition:"top",maxWidth:130},{view:"text",id:"provincia",name:"provincia",label:"Provincia",labelPosition:"top",maxWidth:130},{view:"text",id:"contacto",name:"contacto",label:"Contacto",labelPosition:"top"},{view:"text",type:"numeric",id:"importeObra",name:"importeObra",label:"Importe de la obra",labelPosition:"top",value:0,format:{edit:function(e){return webix.Number.format(e,webix.i18n)},parse:function(e){return webix.Number.parse(e,webix.i18n)}}}]},{view:"toolbar",padding:3,css:{"background-color":"#F4F5F9"},elements:[{view:"icon",icon:"mdi mdi-currency-eur",width:37,align:"left"},{view:"label",label:"Colaboradores"}]},{cols:[{view:"combo",id:"cmbAgentes",name:"agenteId",required:!0,label:"Agente",labelPosition:"top",minWidth:130,options:{},on:{onChange:function(t,o){if(!W){var i=t;o&&""!==o&&e.loadClientesAgente(null,i,null)}},onTimedKeyPress:function(){var e=$$("cmbAgentes").getText();e.length>=3&&this.buscaAgentesActivos(e),"*"===e&&this.buscaAgentesActivos(e)}.bind(this)}},{view:"combo",id:"cmbComerciales",name:"comercialId",label:"Comercial",labelPosition:"top",minWidth:130,options:{},on:{onTimedKeyPress:function(){var e=$$("cmbComerciales").getText(),t=$$("cmbComerciales").config.name;e.length>=3&&this.buscaColaboradoresActivos(e,t,"cmbComerciales",null),"*"===e&&this.buscaColaboradoresActivos(e,t,"cmbComerciales",null)}.bind(this)}},{view:"combo",id:"cmbJefeGrupo",name:"jefeGrupoId",label:"Jefe de grupo",labelPosition:"top",minWidth:130,options:{},on:{onTimedKeyPress:function(){var e=$$("cmbJefeGrupo").getText(),t=$$("cmbJefeGrupo").config.name;e.length>=3&&this.buscaColaboradoresActivos(e,t,"cmbJefeGrupo",null),"*"===e&&this.buscaColaboradoresActivos(e,t,"cmbJefeGrupo",null)}.bind(this)}},{view:"combo",id:"cmbAsesorTecnico",name:"asesorTecnicoId",label:"Asesor técnico",labelPosition:"top",minWidth:130,options:{},on:{onTimedKeyPress:function(){var e=$$("cmbAsesorTecnico").getText(),t=$$("cmbAsesorTecnico").config.name;e.length>=3&&this.buscaColaboradoresActivos(e,t,"cmbAsesorTecnico",null),"*"===e&&this.buscaColaboradoresActivos(e,t,"cmbAsesorTecnico",null)}.bind(this)}}]},{cols:[{view:"textarea",id:"observaciones",name:"observaciones",label:"Observaciones",labelPosition:"top",height:140},{width:600,rows:[{gravity:1},{paddingX:50,align:"center",cols:[{view:"button",label:"Cancelar",css:"webix_danger",click:this.cancel},{view:"button",label:"Guardar",click:function(){return e.accept(!0)},css:"webix_primary",type:"form"}]},{paddingX:50,align:"center",cols:[{view:"button",label:"Guardar sin salir",click:function(){return e.accept(!1)},type:"form"}]},{gravity:1}]}]}]}],scroll:!0}},{header:"Costes",width:100,body:{view:"layout",id:"presupuestoCosteGrid",multiview:!0,rows:[t]}},{header:"Ventas",width:100,body:{view:"layout",id:"presupuestoVentaGrid",multiview:!0,rows:[o]}}]}},t.prototype.init=function(e,t){this.ui(w.default),this.cargarEventos(),b.languageService.setLanguage(this.app,"es")},t.prototype.urlChange=function(e,t){q=null,J=null,t[0].params.NEW&&d.a.normalMessage("Expediente creado correctamente."),t[0].params.MOD&&d.a.normalMessage("Expediente modificado correctamente."),D=a.a.checkLoggedUser(),V=D.usuarioId,b.languageService.setLanguage(this.app,"es"),t[0].params.expedienteId&&(k=t[0].params.expedienteId),N=t[0].params.desdeCoste?t[0].params.desdeCoste:null,M=t[0].params.desdeVenta?t[0].params.desdeVenta:null,t[0].params.ofertaVentaId&&(q=t[0].params.ofertaVentaId),t[0].params.ofertaCosteId&&(J=t[0].params.ofertaCosteId),this.load(k)},t.prototype.load=function(e){var t=this,o=localStorage.getItem("activeTab");if(N||M?o&&$$("tabViewExpediente").setValue(o):localStorage.removeItem("activeTab"),0==e)return this.loadEmpresas(),this.loadAgentes(),this.loadClientes(),this.loadEstados(),this.loadTiposVia(),this.loadTiposProyecto(),this.buscaColaboradoresActivos("","comercialId","cmbComerciales",null),this.buscaColaboradoresActivos("","jefeGrupoId","cmbJefeGrupo",null),this.buscaColaboradoresActivos("","asesorTecnicoId","cmbAsesorTecnico",null),void $$("fecha").setValue(new Date);W=!0,m.a.getExpediente(e).then((function(e){B=e,$$("cmbTiposProyecto").blockEvent(),t.loadTiposProyecto(B.tipoProyectoId),delete B.empresa,delete B.cliente,delete B.estado,delete B.agente,delete B.comercial,delete B.jefeGrupo,delete B.jefeObras,delete B.oficinatecnica,delete B.asesorTecnico,B.fecha=new Date(B.fecha),U=B.formaPagoId,$$("frmExpedientes").setValues(B),t.loadEmpresas(B.empresaId),t.loadClientesAgente(B.clienteId,B.agenteId),t.loadEstados(B.estadoExpedienteId),t.loadTiposVia(B.tipoViaId),t.loadAgentes(B.agenteId),t.buscaColaboradoresActivos("","comercialId","cmbComerciales",B.comercialId),t.buscaColaboradoresActivos("","jefeGrupoId","cmbJefeGrupo",B.jefeGrupoId),t.buscaColaboradoresActivos("","asesorTecnicoId","cmbAsesorTecnico",B.asesorTecnicoId),$$("cmbTiposProyecto").unblockEvent(),I.loadGrid(B.expedienteId,null,B.importeObra,J),G.loadGrid(B.expedienteId,null,B.importeObra,q)})).catch((function(e){d.a.errorMessageAjax(e)}))},t.prototype.cargarEventos=function(){var e=this;$$("cmbTiposProyecto").attachEvent("onChange",(function(t,o){""!=t&&t&&e.cambioTipoProyecto(t)}))},t.prototype.cancel=function(){this.$scope.show("/top/expedientes")},t.prototype.accept=function(e){var t=this;if($$("frmExpedientes").validate()){var o=$$("frmExpedientes").getValues();""==o.jefeGrupoId&&(o.jefeGrupoId=null),""==o.asesorTecnicoId&&(o.asesorTecnicoId=null),o.formaPagoId=U,0==k?(o.expedienteId=0,m.a.postExpediente(o).then((function(e){t.show("/top/expedientesForm?expedienteId="+e.expedienteId+"&NEW")})).catch((function(e){-1!=e.response.indexOf("Cannot delete or update a parent row: a foreign key constraint fails")?d.a.errorRestriccion():d.a.errorMessageAjax(e)}))):m.a.putExpediente(o,o.expedienteId).then((function(){e?t.show("/top/expedientes?expedienteId="+o.expedienteId):t.show("/top/expedientesForm?expedienteId="+o.expedienteId+"&MOD")})).catch((function(e){-1!=e.response.indexOf("Cannot delete or update a parent row: a foreign key constraint fails")?d.a.errorRestriccion():d.a.errorMessageAjax(e)}))}else d.a.errorMessage("Debe rellenar los campos correctamente")},t.prototype.loadEmpresas=function(e){v.a.getEmpresas().then((function(t){var o=p.a.prepareDataForCombo("empresaId","nombre",t),i=$$("cmbEmpresas").getPopup().getList();i.clearAll(),i.parse(o),e?($$("cmbEmpresas").setValue(e),$$("cmbEmpresas").refresh()):($$("cmbEmpresas").setValue(10),$$("cmbEmpresas").refresh())}))},t.prototype.loadAgentes=function(e){f.a.getAgentes().then((function(t){var o=p.a.prepareDataForCombo("comercialId","nombre",t),i=$$("cmbAgentes").getList();i.clearAll(),i.parse(o),e&&($$("cmbAgentes").setValue(e),$$("cmbAgentes").refresh())}))},t.prototype.loadEstados=function(e){l().then((function(t){var o=p.a.prepareDataForCombo("estadoExpedienteId","nombre",t),i=$$("cmbEstados").getPopup().getList();i.clearAll(),i.parse(o),e&&($$("cmbEstados").setValue(e),$$("cmbEstados").refresh())}))},t.prototype.loadTiposVia=function(e){u().then((function(t){var o=p.a.prepareDataForCombo("tipoViaId","nombre",t),i=$$("cmbTiposVia").getPopup().getList();i.clearAll(),i.parse(o),e&&($$("cmbTiposVia").setValue(e),$$("cmbTiposVia").refresh())}))},t.prototype.loadClientesAgente=function(e,t){t&&s.a.getClientesAgenteActivos(t).then((function(t){var o=p.a.prepareDataForCombo("clienteId","nombre",t),i=$$("cmbClientes").getList();i.clearAll(),i.parse(o),e?($$("cmbClientes").setValue(e),$$("cmbClientes").refresh()):($$("cmbClientes").setValue(null),$$("cmbClientes").refresh()),W=!1}))},t.prototype.loadClientes=function(){s.a.getClientesActivos().then((function(e){var t=p.a.prepareDataForCombo("clienteId","nombre",e);t.sort((function(e,t){return e.value>t.value?1:e.value<t.value?-1:0}));var o=$$("cmbClientes").getList();o.clearAll(),o.parse(t),$$("cmbClientes").setValue(null),$$("cmbClientes").refresh()}))},t.prototype.loadClienteData=function(e){var t=this;e&&s.a.getCliente(e).then((function(e){t.loadTiposVia(e.tipoViaId2),$$("direccion").setValue(e.direccion2),$$("poblacion").setValue(e.poblacion2),$$("provincia").setValue(e.provincia2),$$("codPostal").setValue(e.codPostal2),t.buscaColaboradoresActivos("","comercialId","cmbComerciales",e.colaboradorId),U=e.formaPagoId}))},t.prototype.cambioTipoProyecto=function(e){var t=this;g.a.getTipoProyecto(e).then((function(e){e&&m.a.getSiguienteReferencia(e.abrev).then((function(e){var o=e;t.$$("referencia").setValue(o)})).catch((function(e){d.a.errorMessageAjax(e)}))})).catch((function(e){d.a.errorMessageAjax(e)}))},t.prototype.loadTiposProfesionales=function(e){tiposProfesionalService.getTiposProfesional().then((function(t){var o=p.a.prepareDataForCombo("tipoProfesionalId","nombre",t),i=$$("cmbTiposProfesional").getPopup().getList();i.clearAll(),i.parse(o),e&&($$("cmbTiposProfesional").setValue(e),$$("cmbTiposProfesional").refresh())}))},t.prototype.loadTiposProyecto=function(e){g.a.getTiposProyecto(V).then((function(e){var t=p.a.prepareDataForCombo("tipoProyectoId","nombre",e),o=$$("cmbTiposProyecto").getPopup().getList();o.clearAll(),o.parse(t),tiposProyectoId&&($$("cmbTiposProyecto").setValue(tiposProyectoId),$$("cmbTiposProyecto").refresh())}))},t.prototype.loadAgenteCliente=function(e){var t=this;e&&f.a.getAgenteCliente(e).then((function(o){t.loadAgentes(o[0].comercialId),t.loadClienteData(e)}))},t.prototype.loadUsuarios=function(e){a.a.getUsuarios().then((function(t){var o=p.a.prepareDataForCombo("usuarioId","nombre",t),i=$$("cmbUsuarios").getPopup().getList();i.clearAll(),i.parse(o),e?($$("cmbUsuarios").setValue(e),$$("cmbUsuarios").refresh()):($$("cmbUsuarios").setValue(null),$$("cmbUsuarios").refresh())}))},t.prototype.loadNumero=function(){m.a.getNumServicio().then((function(e){$$("numServicio").setValue(e)})).catch((function(e){-1!=e.response.indexOf("Cannot delete or update a parent row: a foreign key constraint fails")?d.a.errorRestriccion():d.a.errorMessageAjax(e)}))},t.prototype.compruebaCobrosCliente=function(e){s.a.getCliente(e).then((function(t){t&&s.a.getCobrosCliente(e).then((function(e){R=t.limiteCredito,e.forEach((function(e){e.seguro||(L+=parseFloat(e.impvenci))})),L>R&&d.a.normalMessage("ATENCION!!!, este cliente ha superado su limete de credito")})).catch((function(e){d.a.errorMessageAjax(e)}))})).catch((function(e){}))},t.prototype.buscaAgentesActivos=function(e){f.a.getAgentesActivosQuery(e).then((function(e){var t=p.a.prepareDataForCombo("comercialId","nombre",e),o=$$("cmbAgentes").getPopup().getList(),i=$$("cmbAgentes").getPopup();o.clearAll(),o.parse(t),i.show()})).catch((function(e){console.error("Error al buscar agentes activos:",e)}))},t.prototype.buscaColaboradoresActivos=function(e,t,o,i){var n=0;switch(t){case"comercialId":n=2;break;case"jefeGrupoId":n=3;break;case"jefeObrasId":n=5;break;case"oficinaTecnicaId":n=6;break;case"asesorTecnicoId":n=7;break;default:console.log("No hacemos nada.")}console.log(t),h.a.getColaboradoresActivosQuery(e,n).then((function(e){var t=p.a.prepareDataForCombo("comercialId","nombre",e),n=$$(o).getList();$$(o).getPopup();n.clearAll(),n.parse(t),i?($$(o).setValue(i),$$(o).refresh()):($$(o).setValue(null),$$(o).refresh())})).catch((function(e){console.error("Error al buscar agentes activos:",e)}))},t.prototype.loadComerciales=function(e){h.a.getColaboradores().then((function(t){var o=p.a.prepareDataForCombo("comercialId","nombre",t),i=$$("cmbComerciales").getList();i.clearAll(),i.parse(o),e&&($$("cmbComerciales").setValue(e),$$("cmbComerciales").refresh())}))},t.prototype.buscaClientesActivos=function(e){s.a.getClientesActivosQuery(e).then((function(e){var t=p.a.prepareDataForCombo("clienteId","nombre",e),o=$$("cmbClientes").getPopup().getList(),i=$$("cmbClientes").getPopup();o.clearAll(),o.parse(t),i.show()})).catch((function(e){console.error("Error al buscar clientes activos:",e)}))},t}(r.c);t.default=z},function(e,t,o){"use strict";o.r(t);var i,n,r,a,s,c,l=o(4),u=o(3),d=o(0),p=o(2),f=o(1),h=function(){return new webix.promise((function(e,t){f.a.getConfig().then((function(e){var t=e.urlApi+"/api/departamentos";return webix.ajax().timeout(2e4).headers({"Content-Type":"application/json"}).get(t)})).then((function(t){e(t.json())})).catch((function(e){t(e)}))}))},m=!1,g={getWindow:function(e){if(!m){var t={view:"form",id:"localesAfectadosWin",rows:[{view:"toolbar",padding:3,elements:[{view:"icon",icon:"mdi mdi-office-building",width:37,align:"left"},{view:"label",label:"Departamentos asociados"}]},{view:"form",id:"usuariosDepartamentosfrm",elements:[{rows:[{template:"Elija departammento asociado",type:"section"},{cols:[{view:"combo",id:"cmbDepartamentos",name:"cmbDepartamentos",required:!0,options:{},label:"Departamentos",labelPosition:"top"}]}]},{margin:5,cols:[{gravity:5},{view:"button",id:"btnCancelarWindow",label:(i=e.getService("locale")._)("Cancelar"),click:g.cancel,hotkey:"esc"},{view:"button",id:"btnAceptarWindow",label:i("Aceptar"),click:g.accept,type:"form",hotkey:"enter"}]}],on:{onValidationError:function(e,t){}}}]};webix.ui({view:"window",id:"usuarioDepartamentosWindow",position:"center",move:!0,resize:!0,width:800,head:{view:"toolbar",cols:[{},{view:"icon",icon:"mdi mdi-close",click:function(){$$("usuarioDepartamentosWindow").hide()}}]},modal:!0,body:t}),m=!0}},loadWindow:function(e,t,o){n=e,r=t,a=o,$$("usuarioDepartamentosWindow").show(),r?g.loadDepartamentos(r):g.loadDepartamentos(null)},accept:function(){if($$("usuariosDepartamentosfrm").validate()){var e=$$("usuariosDepartamentosfrm").getValues(),t={};t=r?{usuarioId:n,departamentoId:e.cmbDepartamentos,usuarioDepartamentoId:a}:{usuarioId:n,departamentoId:e.cmbDepartamentos,usuarioDepartamentoId:0},r?u.a.putUsuarioDepartamento(t.usuarioDepartamentoId,t).then((function(e){$$("usuarioDepartamentosWindow").hide(),g.refreshGridCloseWindow()})).catch((function(e){-1!=e.response.indexOf("Cannot delete or update a parent row: a foreign key constraint fails")?d.a.errorRestriccion():d.a.errorMessageAjax(e)})):u.a.postUsuarioDepartamento(t).then((function(e){$$("usuarioDepartamentosWindow").hide(),g.refreshGridCloseWindow()})).catch((function(e){-1!=e.response.indexOf("Cannot delete or update a parent row: a foreign key constraint fails")?d.a.errorRestriccion():d.a.errorMessageAjax(e)}))}else d.a.errorMessage("Debe rellenar los campos correctamente")},cancel:function(){$$("usuarioDepartamentosWindow").hide()},refreshGridCloseWindow:function(){u.a.getDepartamentosAsociados(n).then((function(e){$$("usuarioDepartamentosGrid").clearAll(),$$("usuarioDepartamentosGrid").parse(p.a.prepareDataForDataTable("usuarioDepartamentoId",e))})).catch((function(e){$$("usuarioDepartamentosWindow").hide(),-1!=e.response.indexOf("Cannot delete or update a parent row: a foreign key constraint fails")?d.a.errorRestriccion():d.a.errorMessageAjax(e)}))},loadDepartamentos:function(e){h().then((function(t){var o=p.a.prepareDataForCombo("departamentoId","nombre",t),i=$$("cmbDepartamentos").getPopup().getList();i.clearAll(),i.parse(o),e?($$("cmbDepartamentos").setValue(e),$$("cmbDepartamentos").refresh()):($$("cmbDepartamentos").setValue(null),$$("cmbDepartamentos").refresh())}))}},b=o(6),v="<span class='onEdit webix_icon wxi-pencil'></span>",w="<span class='onDelete webix_icon wxi-trash'></span>",x={getGrid:function(e){var t=e.getService("locale")._;g.getWindow(e);var o={view:"toolbar",padding:3,elements:[{view:"icon",icon:"mdi mdi-folder-network-outline",width:37,align:"left"},{view:"label",label:t("Departamentos asociados")}]},i={cols:[{view:"button",id:"btnNew",type:"icon",icon:"wxi-plus",width:37,align:"left",hotkey:"Ctrl+A",tooltip:t("Nuevo registro en formulario (Ctrl+A)"),click:function(){s?g.loadWindow(s,null):d.a.errorMessage(t("Debe dar de alta un usuario antes de poder asiganarle Departamentos"))}},{view:"pager",id:"mypager",css:{"text-align":"right"},template:"{common.first()} {common.prev()} {common.pages()} {common.next()} {common.last()}",size:25,group:5}]};return w,{rows:[o,i,{cols:[{view:"datatable",id:"usuarioDepartamentosGrid",pager:"mypager",select:"row",autoheight:!0,columns:[{id:"usuarioDepartamentoId",adjust:!0,header:[t("ID"),{content:"numberFilter"}],sort:"number"},{id:"departamentoId",adjust:!0,header:[t("departamentoId"),{content:"numberFilter"}],sort:"number",hidden:!0},{id:"nombreDepartamento",fillspace:!0,header:[t("Departamento"),{content:"textFilter"}],sort:"string",editor:"text",minWidth:200},{id:"actions",header:[{text:t("Acciones"),css:{"text-align":"center"}}],template:v+w,css:{"text-align":"center"}}],rules:{nombreDepartamento:webix.rules.isNotEmpty},onClick:{onDelete:function(t,o,i){o=o.row;var n=this.data.pull[o].nombreDepartamento;x.delete(o,n,e)},onEdit:function(e,t,o){var i=this.data.pull[t.row];g.loadWindow(s,i.departamentoId,i.usuarioDepartamentoId)}},on:{onAfterFilter:function(){var e=$$("usuarioDepartamentosGrid").count();$$("usuarioDepartamentosNReg").config.label="NREG: "+e,$$("usuarioDepartamentosNReg").refresh()}}}]}]}},loadDepartamentosGrid:function(e,t){s=e,c=t,u.a.getDepartamentosAsociados(s).then((function(e){$$("usuarioDepartamentosGrid").clearAll(),$$("usuarioDepartamentosGrid").parse(p.a.prepareDataForDataTable("usuarioDepartamentoId",e)),c&&($$("usuarioDepartamentosGrid").select(c),$$("usuarioDepartamentosGrid").showItem(c));var t=$$("usuarioDepartamentosGrid").count();$$("usuarioDepartamentosNReg").config.label="NREG: "+t,$$("usuarioDepartamentosNReg").refresh(),$$("usuarioDepartamentosGrid").hideProgress()})).catch((function(e){$$("usuarioDepartamentosGrid").hideProgress(),-1!=e.response.indexOf("Cannot delete or update a parent row: a foreign key constraint fails")?d.a.errorRestriccion():d.a.errorMessageAjax(e)}))},delete:function(e,t,o){var i=o.getService("locale")._;webix.confirm({title:i("AVISO"),text:i("Está seguro que desea eliminar *").replace("*",t),type:"confirm-warning",callback:function(t){!0===t&&u.a.deleteUsuarioDepartamento(e).then((function(e){x.loadDepartamentosGrid(s)})).catch((function(e){-1!=e.response.indexOf("Cannot delete or update a parent row: a foreign key constraint fails")?d.a.errorRestriccion():d.a.errorMessageAjax(e)}))}})}};function $(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function y(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}var C=0,j=function(e){function t(){return $(this,t),y(this,e.apply(this,arguments))}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(t,e),t.prototype.config=function(){var e=this.app.getService("locale")._,t=x.getGrid(this.app);return{view:"layout",id:"usuariosForm",rows:[{view:"toolbar",padding:3,elements:[{view:"icon",icon:"mdi mdi-account-key",width:37,align:"left"},{view:"label",label:e("Usuarios")}]},{view:"form",id:"frmUsuarios",elements:[{cols:[{view:"text",name:"usuarioId",width:100,disabled:!0,label:e("ID"),labelPosition:"top"},{view:"text",name:"nombre",required:!0,id:"firstField",label:e("Nombre usuario"),labelPosition:"top"},{view:"text",name:"login",required:!0,label:e("Login"),labelPosition:"top"}]},{cols:[{width:100},{view:"text",name:"pass01",label:e("Contraseña"),type:"password",labelPosition:"top",id:"pass01"},{view:"text",name:"pass02",label:e("Repita contraseña"),type:"password",labelPosition:"top",id:"pass02"}]},{cols:[{width:100},{view:"text",name:"email",label:e("Correo electronico"),labelPosition:"top",id:"email"},{view:"combo",name:"nivel",label:e("nivel de usuario"),labelPosition:"top",id:"cmbNivelUsu",required:!0,options:{}}]},{margin:5,cols:[{gravity:5},{view:"button",label:e("Cancelar"),click:this.cancel,hotkey:"esc"},{view:"button",label:e("Aceptar"),click:this.accept,type:"form",hotkey:"enter"}]}],rules:{email:webix.rules.isEmail}},t,{minheight:600}]}},t.prototype.urlChange=function(e,t){u.a.checkLoggedUser(),b.languageService.setLanguage(this.app,"es"),t[0].params.usuarioId&&(C=t[0].params.usuarioId),0!=C?(this.load(C),x.loadDepartamentosGrid(C)):(this.loadNivelUsu(),x.loadDepartamentosGrid(null)),webix.delay((function(){$$("firstField").focus()}))},t.prototype.load=function(e){var t=this;u.a.getUsuario(e).then((function(e){$$("frmUsuarios").setValues(e),t.loadNivelUsu(e.nivel)})).catch((function(e){-1!=e.response.indexOf("Cannot delete or update a parent row: a foreign key constraint fails")?d.a.errorRestriccion():d.a.errorMessageAjax(e)}))},t.prototype.cancel=function(){this.$scope.show("/top/usuarios")},t.prototype.accept=function(){var e=this,t=this.$scope.app.getService("locale")._;if($$("frmUsuarios").validate()){var o=$$("pass01").getValue(),i=$$("pass02").getValue();if(""==o||o==i){var n=$$("frmUsuarios").getValues();delete n.pass01,delete n.pass02,""!=o&&(n.password=o),0==C?(n.usuarioId=0,u.a.postUsuario(n).then((function(t){e.$scope.show("/top/usuarios?usuarioId="+t.usuarioId)})).catch((function(e){-1!=e.response.indexOf("Cannot delete or update a parent row: a foreign key constraint fails")?d.a.errorRestriccion():d.a.errorMessageAjax(e)}))):u.a.putUsuario(n).then((function(){e.$scope.show("/top/usuarios?usuarioId="+n.usuarioId)})).catch((function(e){-1!=e.response.indexOf("Cannot delete or update a parent row: a foreign key constraint fails")?d.a.errorRestriccion():d.a.errorMessageAjax(e)}))}else d.a.errorMessage(t("Las contraseñas introducidas no coinciden"))}else d.a.errorMessage(t("Debe rellenar los campos correctamente"))},t.prototype.loadNivelUsu=function(e){var t=u.a.prepareDataForCombo(),o=$$("cmbNivelUsu").getPopup().getList();o.clearAll(),o.parse(t),(e||0==e)&&($$("cmbNivelUsu").setValue(e),$$("cmbNivelUsu").refresh())},t}(l.c);t.default=j},function(e,t,o){"use strict";o.r(t);var i,n=o(4),r=o(3),a=o(8),s=o(0),c=o(2),l=o(5),u=o(21),d=o(9),p=o(6),f=o(15),h=o(14),m=o(20),g={getGrid:function(e){var t=e.getService("locale")._;try{h.a.getWindow(e)}catch(e){console.log(e)}return"<span class='onDelete webix_icon wxi-trash'></span>",{view:"layout",id:"lineasDelOferta",rows:[{view:"toolbar",padding:3,css:{"background-color":"#F4F5F9"},elements:[{view:"icon",icon:"mdi mdi-folder-network-outline",width:37,align:"left"},{view:"label",label:t("Partidas")}]},{cols:[{view:"button",id:"btnNew3",type:"icon",icon:"wxi-plus",width:37,align:"left",hotkey:"Ctrl+A",tooltip:t("Nuevo registro en formulario (Ctrl+A)"),click:function(){if(i)try{var e=$$("cmbClientes").getValue();h.a.loadWindow(i,null,e,null,null,null)}catch(e){console.log(e)}else s.a.errorMessage(t("Debe dar de alta el oferta antes las lineas"))}},{view:"label",id:"ofertasLineasVentaNReg",label:"NREG: "},{view:"pager",id:"mypager3",css:{"text-align":"right"},template:"{common.first()} {common.prev()} {common.pages()} {common.next()} {common.last()}",size:25,group:5}]},{view:"datatable",scroll:"x",id:"lineasOfertaVentaGrid",pager:"mypager3",select:"row",autoheight:!0,footer:!1,columns:[{id:"ofertaLineaId",header:[t("Id"),{content:"textFilter"}],sort:"string",width:50,hidden:!0},{id:"ofertaId",header:[t("Id"),{content:"textFilter"}],sort:"string",width:50,hidden:!0},{id:"linea",header:[t("Linea"),{content:"textFilter"}],sort:"string",width:80},{id:"nombreGrupoArticulo",header:[t("Capítulo"),{content:"textFilter"}],sort:"string",fillspace:!0},{id:"nombreArticulo",header:[t("Partida"),{content:"textFilter"}],sort:"string",fillspace:!0},{id:"unidades",header:[t("Uds."),{content:"textFilter"}],sort:"string",width:40},{id:"importe",header:[t("Coste/Ud."),{content:"textFilter"}],sort:"string",width:80,format:webix.i18n.numberFormat,css:{"text-align":"right"}},{id:"cantidad",header:[t("Cant."),{content:"textFilter"}],sort:"string",width:50,css:{"text-align":"right"}},{id:"precio",header:[t("Precio"),{content:"textFilter"}],sort:"string",width:80,css:{"text-align":"right"}},{id:"coste",header:[t("Coste"),{content:"textFilter"}],sort:"string",width:80,hidden:!0,css:{"text-align":"right"}},{id:"importeBeneficioLinea",header:[t("BI"),{content:"textFilter"}],sort:"string",width:80,format:webix.i18n.numberFormat,css:{"text-align":"right"}},{id:"ventaNetaLinea",header:[t("venta neta"),{content:"textFilter"}],sort:"string",width:80,format:webix.i18n.numberFormat,hidden:!0,css:{"text-align":"right"}},{id:"importeAgenteLinea",header:[t("Imp. Agente."),{content:"textFilter"}],sort:"string",width:110,format:webix.i18n.numberFormat,css:{"text-align":"right"}},{id:"totalLinea",header:[t("Total."),{content:"textFilter"}],sort:"string",width:80,format:webix.i18n.numberFormat,css:{"text-align":"right"}},{id:"porcentajeBeneficioLinea",header:[t("% BI"),{content:"textFilter"}],sort:"string",width:80,editor:"text",format:webix.i18n.numberFormat,css:{"text-align":"right"}}],rightSplit:1,onClick:{onDelete:function(t,o,i){o=o.row;var n=this.data.pull[o];g.delete(o,n,e)},onEdit:function(e,t,o){this.data.pull[t.row],$$("cmbClientes").getValue()}},editable:!0,editaction:"dblclick",rules:{},on:{onAfterEditStart:function(e){},onAfterEditStop:function(e,t,o){if("porcentajeBeneficioLinea"==t.column){var i=this.getItem(t.row),n=i.totalLinea,r=$$("importeCli").getValue();r-=n;var a=parseFloat(e.value.replace(",","."))/100||0,s=parseFloat(i.costeLinea)||0,c=a*s,l=s/(parseFloat(i.cantidad)||0),u=s+c,d=u/((100-parseFloat($$("porcentajeAgente").getValue()))/100),p=d-(s+c);r+=d,$$("importeCli").setValue(r),i.totalLinea=d,i.importeAgenteLinea=p,i.porcentajeBeneficioLinea=100*a,i.importeBeneficioLinea=c,i.importe=l,i.precio=s,i.coste=s,i.ventaNetaLinea=u,this.updateItem(t.row,i)}},OnAfterLoad:function(){setTimeout((function(){var e=$$("porcentajeBeneficio").getValue()/100||0,t=$$("lineasOfertaVentaGrid"),o=0;t.eachRow((function(i){var n=t.getItem(i),r=parseFloat(n.costeLinea)||0,a=parseFloat(n.cantidad)||0,s=parseFloat($$("porcentajeAgente").getValue()),c=e*r,l=r/a,u=r+c,d=u/((100-s)/100),p=d-(r+c);o+=d,n.totalLinea=d,n.importeAgenteLinea=p,n.porcentajeBeneficioLinea=100*e,n.importeBeneficioLinea=c,n.importe=l,n.precio=r,n.coste=r,n.ventaNetaLinea=u,t.updateItem(i,n)})),$$("importeCli").setValue(o)}),100)},onAfterFilter:function(){var e=$$("lineasOfertaVentaGrid").count();$$("ofertasLineasVentaNReg").config.label="NREG: "+e,$$("ofertasLineasVentaNReg").refresh()}}}]}},loadGrid:function(e,t,o){t;var n=0;if((i=e)&&0!=i)l.a.getLineasOferta(i).then((function(e){if(e.length>0){$$("lineasOfertaVentaGrid").clearAll(),$$("lineasOfertaVentaGrid").parse(c.a.prepareDataForDataTable("ofertaLineaId",e));var t=$$("lineasOfertaVentaGrid").count();$$("ofertasLineasVentaNReg").config.label="NREG: "+t,$$("ofertasLineasVentaNReg").refresh();for(var o=0;o<e.length;o++)n+=e[o].totalLinea,$$("importeCli").setValue(n)}else $$("lineasOfertaVentaGrid").clearAll(),$$("importeCli").setValue(n)})).catch((function(e){s.a.errorMessageAjax(e)}));else if(o&&o.length>0){$$("lineasOfertaVentaGrid").clearAll(),$$("lineasOfertaVentaGrid").parse(c.a.prepareDataForDataTable("ofertaLineaId",o));var r=$$("lineasOfertaVentaGrid").count();$$("ofertasLineasVentaNReg").config.label="NREG: "+r,$$("ofertasLineasVentaNReg").refresh();for(var a=0;a<o.length;a++)n+=o[a].totalLinea,$$("importeCli").setValue(n)}else $$("lineasOfertaVentaGrid").clearAll(),$$("importeCli").setValue(n)},delete:function(e,t,o){var n=o.getService("locale")._;webix.confirm({title:n("AVISO"),text:n("Está seguro que desea eliminar la linea "),type:"confirm-warning",callback:function(o){!0===o&&l.a.deleteLineaOferta(e,t).then((function(e){g.loadGrid(i),m.a.loadGrid(i,null)})).catch((function(e){s.a.errorMessageAjax(e)}))}})}},b=o(10),v=o(7),w=o(19),x=o(1),$=function(e,t,o){return new webix.promise((function(i,n){x.a.getConfig().then((function(i){var n=i.urlApi+"/api/textos_predeterminados/conceptos-excluidos/"+t+"/"+o+"/"+e;return webix.ajax().timeout(1e4).headers({"Content-Type":"application/json"}).get(n)})).then((function(e){i(e.json())})).catch((function(e){n(e)}))}))},y=function(e){return new webix.promise((function(t,o){x.a.getConfig().then((function(t){var o=t.urlApi+"/api/textos_predeterminados/"+e;return webix.ajax().timeout(1e4).headers({"Content-Type":"application/json"}).get(o)})).then((function(e){t(e.json())})).catch((function(e){o(e)}))}))},C=function(e,t,o){return new webix.promise((function(i,n){x.a.getConfig().then((function(i){var n=i.urlApi+"/api/textos_predeterminados/conceptos-excluidos/"+t+"/"+o+"/"+e;return webix.ajax().timeout(1e4).headers({"Content-Type":"application/json"}).get(n)})).then((function(e){i(e.json())})).catch((function(e){n(e)}))}))},j=function(e,t,o){return new webix.promise((function(i,n){x.a.getConfig().then((function(i){var n=i.urlApi+"/api/textos_predeterminados/conceptos-excluidos/"+t+"/"+o+"/"+e;return webix.ajax().timeout(1e4).headers({"Content-Type":"application/json"}).get(n)})).then((function(e){i(e.json())})).catch((function(e){n(e)}))}))},A=o(12);function I(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function E(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}var P,F,O=!1,T=0,G=0,_=0,S=0,V=0,D=0,k=0,R=0,L=0,N=0,M=0,W=0,U=0,B=0,q=function(e){function t(){return I(this,t),E(this,e.apply(this,arguments))}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(t,e),t.prototype.config=function(){var e=this,t=(this.app.getService("locale")._,g.getGrid(this.app));return{view:"tabview",cells:[{header:"Oferta",body:{view:"layout",id:"ofertasVentaForm",multiview:!0,rows:[{view:"toolbar",padding:3,elements:[{view:"icon",icon:"mdi mdi-currency-eur",width:37,align:"left"},{view:"label",label:"Oferta de venta"}]},{view:"form",scroll:"xy",id:"frmOfertas",minWidth:500,autoheight:!0,elements:[{view:"toolbar",padding:3,css:{"background-color":"#F4F5F9"},elements:[{view:"icon",icon:"mdi mdi-currency-eur",width:37,align:"left"},{view:"label",label:"Datos"}]},{cols:[{view:"text",id:"ofertaId",name:"ofertaId",hidden:!0,label:"ID",labelPosition:"top",width:50,disabled:!0},{view:"text",id:"referencia",name:"referencia",required:!0,label:"Referencia",labelPosition:"top",width:250},{view:"combo",id:"cmbEmpresas",name:"empresaId",required:!0,options:{},label:"Empresa",labelPosition:"top",width:250},{view:"datepicker",id:"fechaOferta",name:"fechaOferta",width:150,label:"Fecha de Solicitud",labelPosition:"top",required:!0},{view:"combo",id:"cmbExpedientes",name:"expedienteId",disabled:!0,label:"Expediente",labelPosition:"top",options:{}},{view:"label",label:"Valorado",width:60,on:{onAfterRender:function(){this.getNode().style.marginLeft="10px"}}},{view:"checkbox",id:"valorado",name:"valorado",width:50},{view:"label",label:"Desglosado",width:80},{view:"checkbox",id:"desglosado",name:"desglosado",width:50},{view:"label",label:"IVA",width:30},{view:"checkbox",id:"mostrarIva",name:"mostrarIva",width:50}]},{cols:[{view:"combo",id:"cmbClientes",name:"clienteId",required:!0,minWidth:300,label:"Cliente",labelPosition:"top",options:{},on:{onTimedKeyPress:function(){var e=$$("cmbClientes").getText();e.length>=3&&this.buscaClientesActivos(e),"*"===e&&this.buscaClientesActivos(e)}.bind(this)}},{view:"combo",id:"cmbFormasPago",name:"formaPagoId",required:!0,options:{},label:"Forma de pago",labelPosition:"top",minWidth:250},{view:"text",id:"importeCli",name:"importeCliente",disabled:!0,width:180,label:"Importe cliente",labelPosition:"top",value:0,format:"1,00"}]},{cols:[{view:"combo",id:"cmbPresupuestosCoste",name:"ofertaCosteId",label:"Presupuesto de coste",labelPosition:"top",options:{},on:{onChange:function(t,o){if(!O){var i=t;e.loadLienasCosteData(i)}}}},{view:"text",id:"increMediciones",name:"increMediciones",width:180,label:"Incr. mediciones (%)",labelPosition:"top",value:0,format:"1,00"},{view:"text",id:"porcentajeBeneficio",name:"porcentajeBeneficio",width:180,label:"Incr. beneficio ind. (%)",labelPosition:"top",value:0,format:"1,00",on:{onTimedKeyPress:function(){e.calculaBI()}}},{view:"text",id:"porcentajeAgente",name:"porcentajeAgente",width:180,label:"Incr. comercial (%)",labelPosition:"top",value:0,format:"1,00",on:{onTimedKeyPress:function(){e.calculaBI()}}}]},{cols:[{rows:[{cols:[{view:"richselect",id:"cmbTitulos",name:"tituloId",label:"Título",width:400,gravity:1,options:{},on:{onChange:function(e){this.$scope.cambioTextosPredeterminadosTitulos(e)}}},{}]},{view:"textarea",id:"tituloTexto",name:"tituloTexto",required:!0,height:155,labelWidth:150}]}]},{cols:[{gravity:1,rows:[{cols:[{view:"richselect",id:"cmbSistemaPago",name:"sistemaPagoId",label:"Sistema de pago",labelWidth:150,options:{},gravity:1,width:400,on:{onChange:function(e){this.$scope.cambioTextosPredeterminados(e)}}},{}]},{view:"textarea",id:"sistemaPago",name:"sistemaPago",height:155,labelWidth:150}]},{gravity:1,rows:[{cols:[{view:"richselect",id:"cmbConceptosExcluidos",name:"conceptoExcluidoId",label:"Conceptos excluidos",labelWidth:150,width:400,options:{},gravity:1,on:{onChange:function(e){this.$scope.cambioTextosPredeterminadosExcluidos(e)}}},{}]},{view:"textarea",id:"conceptosExcluidos",name:"conceptosExcluidos",height:155,labelWidth:150}]},{gravity:1,rows:[{},{rows:[{template:"Observaciones",type:"clean",css:{"font-weight":"500","padding-left":"6px"},height:20},{height:5},{view:"textarea",id:"observaciones",name:"observaciones",height:155,gravity:1}]}]},{gravity:1,rows:[{template:"",height:38},{padding:10,rows:[{align:"center",cols:[{view:"button",label:"Cancelar",click:this.cancel,hotkey:"esc",css:"webix_danger",width:80},{view:"button",label:"Guardar",click:function(){return e.accept(!0)},css:"webix_primary",type:"form",width:80}]},{align:"center",cols:[{view:"button",label:"Guardar sin salir",click:function(){return e.accept(!1)},type:"form",width:160}]},{align:"center",cols:[{view:"button",label:"Imprimir oferta",id:"btnImprimir",type:"form",width:160}]}]}]}]},t,{minWidth:100}]}],scroll:!0}}]}},t.prototype.init=function(e,t){this.imprimirWindow=this.ui(b.default),$$("btnImprimir").attachEvent("onItemClick",(function(e,t,o){var i=this,n=$$("cmbEmpresas").getValue();f.a.getEmpresa(n).then((function(e){if(e.infOfertas){var t="/stireport/reports/"+e.infOfertas+".mrt";i.$scope.imprimirWindow.showWindow(T,t)}else s.a.errorMessage("Esta empresa no tiene plantilla de oferta asociada")})).catch((function(e){-1!=e.response.indexOf("Cannot delete or update a parent row: a foreign key constraint fails")?s.a.errorRestriccion():s.a.errorMessageAjax(e)}))})),this.cargarEventos()},t.prototype.urlChange=function(e,t){t[0].params.NEW&&s.a.normalMessage("Oferta guardada correctamente."),t[0].params.MOD&&s.a.normalMessage("Oferta guardada correctamente."),P=r.a.checkLoggedUser(),P.usuarioId,p.languageService.setLanguage(this.app,"es"),t[0].params.ofertaId&&(T=t[0].params.ofertaId),t[0].params.expedienteId&&(G=t[0].params.expedienteId),t[0].params.importeObra&&parseFloat(t[0].params.importeObra),this.cargarEventos(),this.load(T,G)},t.prototype.load=function(e,t){var o=this;0==e&&t>0?v.a.getExpediente(t).then((function(e){F=e.tipoProyectoId,o.loadEmpresas(e.empresaId),o.loadExpediente(e),o.loadPresupuestosCoste(t,null),o.loadClientes(e.clienteId),o.loadFormasPago(e.formaPagoId),o.loadSistemaPago(e.empresaId,null),o.loadConceptosExcluidos(e.empresaId,null),o.loadTitulos(e.empresaId,null),$$("fechaOferta").setValue(new Date(e.fecha)),o.$$("referencia").setValue(e.referencia),g.loadGrid(null,null,[])})).catch((function(e){s.a.errorMessageAjax(e)})):(O=!0,l.a.getOferta(e).then((function(e){delete e.empresa,delete e.cliente,delete e.tipo,delete e.mantenedor,delete e.agente,delete e.formaPago,e.fechaOferta=new Date(e.fechaOferta),$$("frmOfertas").setValues(e),o.loadEmpresas(e.empresaId),g.loadGrid(e.ofertaId,void 0,[]),o.loadPresupuestosCoste(t,e.ofertaCosteId),o.loadClientes(e.clienteId),o.loadFormasPago(e.formaPagoId),$$("valorado").setValue(e.valorado),$$("desglosado").setValue(e.desglosado),$$("mostrarIva").setValue(e.mostrarIva),o.loadSistemaPago(e.empresaId,e.sistemaPagoId),o.loadConceptosExcluidos(e.empresaId,e.conceptoExcluidoId),o.loadTitulos(e.empresaId,e.tituloId),v.a.getExpediente(t).then((function(e){o.loadExpediente(e),O=!1})).catch((function(e){s.a.errorMessageAjax(e)}))})).catch((function(e){s.a.errorMessageAjax(e)})))},t.prototype.calculaBI=function(){var e=$$("porcentajeBeneficio").getValue()/100||0,t=$$("lineasOfertaVentaGrid"),o=0;t.eachRow((function(i){var n=t.getItem(i),r=parseFloat(n.costeLinea)||0,a=parseFloat(n.cantidad)||0,s=parseFloat($$("porcentajeAgente").getValue()),c=e*r,l=r/a,u=r+c,d=u/((100-s)/100),p=d-(r+c);o+=d,n.totalLinea=d,n.importeAgenteLinea=p,n.porcentajeBeneficioLinea=100*e,n.importeBeneficioLinea=c,n.importe=l,n.precio=r,n.coste=r,n.ventaNetaLinea=u,t.updateItem(i,n)})),$$("importeCli").setValue(o)},t.prototype.cargarEventos=function(){},t.prototype.cancel=function(){this.$scope.show("/top/expedientesForm?expedienteId="+G+"&desdeVenta=true")},t.prototype.accept=function(e){var t=this;if($$("frmOfertas").validate()){var o=$$("frmOfertas").getValues();if(delete o.increMediciones,delete o.textoPredeterminadoId,""==o.sistemaPagoId&&(o.sistemaPagoId=null),""==o.conceptoExcluidoId&&(o.conceptoExcluidoId=null),0==T){var i=$$("lineasOfertaVentaGrid").serialize();console.log(i),i.length>0&&(o.lineas=this.limpiaDatalineas(i,"POST")),o.tipoProyectoId=F,o.ofertaId=0,o.tipoOfertaId=5,o.importeMantenedor=0,o.mantenedorId=null,o.expedienteId=G,o.coste=M,o.importeBeneficio=W,o.ventaNeta=U,o.importeAgente=B,o.esCoste=0,o.agenteId=V,o.comercialId=D,o.jefeGrupoId=k,o.jefeObrasId=R,o.oficinaTecnicaId=L,o.asesorTecnicoId=N,l.a.postOfertaVenta(o).then((function(e){t.show("/top/ofertasVentaForm?ofertaId="+e.ofertaId+"&NEW")})).catch((function(e){-1!=e.response.indexOf("Cannot delete or update a parent row: a foreign key constraint fails")?s.a.errorRestriccion():s.a.errorMessageAjax(e)}))}else{i=$$("lineasOfertaVentaGrid").serialize();console.log(i),i.length>0&&(o.lineas=this.limpiaDatalineas(i,"PUT")),delete o.direccion,delete o.codpostal,delete o.poblacion,delete o.provincia,delete o.tipoViaId,delete o.comercialCliente,o.importeMantenedor=0,l.a.putOfertaVenta(o).then((function(){e?t.show("/top/expedientesForm?expedienteId="+G+"&ofertaVentaId="+o.ofertaId+"&desdeVenta=true"):t.show("/top/ofertasVentaForm?ofertaId="+o.ofertaId+"&MOD")})).catch((function(e){-1!=e.response.indexOf("Cannot delete or update a parent row: a foreign key constraint fails")?s.a.errorRestriccion():s.a.errorMessageAjax(e)}))}}else s.a.errorMessage("Debe rellenar los campos correctamente")},t.prototype.limpiaDatalineas=function(e,t){var o=[];M=0,W=0,U=0,B=0;var i=e,n=Array.isArray(i),r=0;for(i=n?i:i[Symbol.iterator]();;){var a;if(n){if(r>=i.length)break;a=i[r++]}else{if((r=i.next()).done)break;a=r.value}var s=a,c={ofertaLineaId:0,ofertaId:0,linea:s.linea,unidadId:s.unidadId,articuloId:s.articuloId,tipoIvaId:s.tipoIvaId,porcentaje:s.porcentaje,descripcion:s.descripcion,cantidad:s.cantidad,importe:s.importe,totalLinea:s.totalLinea,coste:s.coste,porcentajeBeneficio:s.porcentajeBeneficioLinea,importeBeneficioLinea:s.importeBeneficioLinea,porcentajeAgente:s.porcentajeAgente,importeAgenteLinea:s.importeAgenteLinea,ventaNetaLinea:s.ventaNetaLinea,capituloLinea:s.capituloLinea,proveedorId:s.proveedorId,importeProveedor:s.importeProveedor,totalLineaProveedor:s.totalLineaProveedor,costeLineaProveedor:s.importeProveedor,tipoIvaProveedorId:s.tipoIvaProveedorId,porcentajeProveedor:s.porcentajeProveedor,precio:s.precio,perdto:s.perdto,perdtoProveedor:s.perdtoProveedor,dto:s.dto,precioProveedor:s.precioProveedor,dtoProveedor:s.dtoProveedor,totalLineaProveedorIva:s.totalLineaProveedorIva,esTarifa:s.esTarifa};M+=s.coste,W+=s.importeBeneficioLinea,U+=s.ventaNetaLinea,B+=s.importeAgenteLinea,"PUT"==t&&(c.ofertaId=s.ofertaId,c.ofertaLineaId=s.ofertaLineaId),o.push(c)}return o},t.prototype.loadEmpresas=function(e){f.a.getEmpresas().then((function(t){var o=c.a.prepareDataForCombo("empresaId","nombre",t),i=$$("cmbEmpresas").getPopup().getList();i.clearAll(),i.parse(o),e?($$("cmbEmpresas").setValue(e),$$("cmbEmpresas").refresh()):($$("cmbEmpresas").setValue(10),$$("cmbEmpresas").refresh())}))},t.prototype.loadClientes=function(e){a.a.getClientesActivos().then((function(t){var o=c.a.prepareDataForCombo("clienteId","nombre",t),i=$$("cmbClientes").getList();i.clearAll(),i.parse(o),$$("cmbClientes").setValue(e),$$("cmbClientes").refresh()}))},t.prototype.cambioTipoProyecto=function(e){var t=this;d.a.getTipoProyecto(e).then((function(e){e&&l.a.getSiguienteReferencia(e.abrev).then((function(e){var o=e;t.$$("referencia").setValue(o)})).catch((function(e){s.a.errorMessageAjax(e)}))})).catch((function(e){s.a.errorMessageAjax(e)}))},t.prototype.loadFormasPago=function(e){u.a.getFormasPago().then((function(t){var o=c.a.prepareDataForCombo("formaPagoId","nombre",t),i=$$("cmbFormasPago").getPopup().getList();i.clearAll(),i.parse(o),$$("cmbFormasPago").setValue(e),$$("cmbFormasPago").refresh()})).catch((function(e){s.a.errorMessageAjax(e)}))},t.prototype.loadSistemaPago=function(e,t){$(1,e,5).then((function(e){var o=c.a.prepareDataForCombo("textoPredeterminadoId","abrev",e),i=$$("cmbSistemaPago").getPopup().getList();if(i.clearAll(),i.parse(o),t)return $$("cmbSistemaPago").setValue(t),void $$("cmbSistemaPago").refresh();$$("cmbSistemaPago").setValue(null),$$("cmbSistemaPago").refresh()})).catch((function(e){s.a.errorMessageAjax(e)}))},t.prototype.loadConceptosExcluidos=function(e,t){C(2,e,5).then((function(e){var o=c.a.prepareDataForCombo("textoPredeterminadoId","abrev",e),i=$$("cmbConceptosExcluidos").getPopup().getList();if(i.clearAll(),i.parse(o),t)return $$("cmbConceptosExcluidos").setValue(t),void $$("cmbConceptosExcluidos").refresh();$$("cmbConceptosExcluidos").setValue(null),$$("cmbConceptosExcluidos").refresh()})).catch((function(e){s.a.errorMessageAjax(e)}))},t.prototype.cambioTextosPredeterminados=function(e){e&&y(e).then((function(e){$$("sistemaPago").setValue(e.texto)})).catch((function(e){s.a.errorMessageAjax(e)}))},t.prototype.cambioTextosPredeterminadosExcluidos=function(e){e&&y(e).then((function(e){$$("conceptosExcluidos").setValue(e.texto)})).catch((function(e){s.a.errorMessageAjax(e)}))},t.prototype.loadUsuarios=function(e){r.a.getUsuarios().then((function(t){var o=c.a.prepareDataForCombo("usuarioId","nombre",t),i=$$("cmbUsuarios").getPopup().getList();i.clearAll(),i.parse(o),e?($$("cmbUsuarios").setValue(e),$$("cmbUsuarios").refresh()):($$("cmbUsuarios").setValue(null),$$("cmbUsuarios").refresh())}))},t.prototype.loadNumero=function(){l.a.getNumServicio().then((function(e){$$("numServicio").setValue(e)})).catch((function(e){-1!=e.response.indexOf("Cannot delete or update a parent row: a foreign key constraint fails")?s.a.errorRestriccion():s.a.errorMessageAjax(e)}))},t.prototype.loadExpediente=function(e){var t=[];t.push(e);var o=c.a.prepareDataForCombo("expedienteId","titulo",t),i=$$("cmbExpedientes").getPopup().getList();i.clearAll(),i.parse(o),$$("cmbExpedientes").setValue(e.expedienteId),$$("cmbExpedientes").refresh()},t.prototype.loadPresupuestosCoste=function(e,t){e&&l.a.getOfertasExpediente(e,1).then((function(e){var o=c.a.prepareDataForCombo("ofertaId","referencia",e),i=$$("cmbPresupuestosCoste").getPopup().getList();i.clearAll(),i.parse(o),$$("cmbPresupuestosCoste").setValue(t),$$("cmbPresupuestosCoste").refresh()})).catch((function(e){s.a.errorMessageAjax(e)}))},t.prototype.compruebaCobrosCliente=function(e){a.a.getCliente(e).then((function(t){t&&a.a.getCobrosCliente(e).then((function(e){_=t.limiteCredito,e.forEach((function(e){e.seguro||(S+=parseFloat(e.impvenci))})),S>_&&s.a.normalMessage("ATENCION!!!, este cliente ha superado su limete de credito")})).catch((function(e){s.a.errorMessageAjax(e)}))})).catch((function(e){s.a.errorMessageAjax(e)}))},t.prototype.loadLienasCosteData=function(e){var t=this;l.a.getLineasOferta(e).then((function(e){if(0==e.length)return s.a.errorMessage("El presupuesto de coste seleccionado no tiene partidas."),void g.loadGrid(T,void 0,e);t.asignaColaboradores(e[0]),t.obtenerPorcentajeDelAgente(e[0].agenteId,e[0].empresaId,e[0].tipoOfertaId),t.obtenerPorcentajeBeneficio(),g.loadGrid(T,void 0,e),t.loadDatos(e[0])})).catch((function(e){s.a.errorMessageAjax(e)}))},t.prototype.asignaColaboradores=function(e){V=e.agenteId,D=e.comercialId,k=e.jefeGrupoId,R=e.jefeObrasId,L=e.oficinaTecnicaId,N=e.asesorTecnicoId},t.prototype.obtenerPorcentajeDelAgente=function(e,t,o){A.a.getComisionAgente(e,t,o).then((function(e){e?$$("porcentajeAgente").setValue(e):$$("porcentajeAgente").setValue(0)})).catch((function(e){s.a.errorMessageAjax(e)}))},t.prototype.obtenerPorcentajeBeneficio=function(e,t,o){w.a.getParametros().then((function(e){e?$$("porcentajeBeneficio").setValue(e[0].margenArquitectura):$$("porcentajeBeneficio").setValue(0)})).catch((function(e){s.a.errorMessageAjax(e)}))},t.prototype.buscaClientesActivos=function(e){a.a.getClientesActivosQuery(e).then((function(e){var t=c.a.prepareDataForCombo("clienteId","nombre",e),o=$$("cmbClientes").getPopup().getList(),i=$$("cmbClientes").getPopup();o.clearAll(),o.parse(t),i.show()})).catch((function(e){console.error("Error al buscar clientes activos:",e)}))},t.prototype.loadDatos=function(e){$$("valorado").setValue(e.valorado),$$("desglosado").setValue(e.desglosado),$$("mostrarIva").setValue(e.mostrarIva)},t.prototype.loadTitulos=function(e,t){j(3,e,5).then((function(e){var o=c.a.prepareDataForCombo("textoPredeterminadoId","abrev",e),i=$$("cmbTitulos").getPopup().getList();if(i.clearAll(),i.parse(o),t)return $$("cmbTitulos").setValue(t),void $$("cmbTitulos").refresh();$$("cmbTitulos").setValue(null),$$("cmbTitulos").refresh()})).catch((function(e){s.a.errorMessageAjax(e)}))},t.prototype.cambioTextosPredeterminadosTitulos=function(e){e&&y(e).then((function(e){var t="PRESUPUESTO REF. "+$$("cmbPresupuestosCoste").getText()+" "+e.texto;$$("tituloTexto").setValue(t)})).catch((function(e){s.a.errorMessageAjax(e)}))},t}(n.c);t.default=q},function(e,t,o){"use strict";o.r(t);var i=o(4),n=new webix.DataCollection({data:[{id:1,title:"The Shawshank Redemption",year:1994,votes:678790,rating:9.2,rank:1},{id:2,title:"The Godfather",year:1972,votes:511495,rating:9.2,rank:2},{id:3,title:"The Godfather: Part II",year:1974,votes:319352,rating:9,rank:3},{id:4,title:"The Good, the Bad and the Ugly",year:1966,votes:213030,rating:8.9,rank:4},{id:5,title:"My Fair Lady",year:1964,votes:533848,rating:8.9,rank:5},{id:6,title:"12 Angry Men",year:1957,votes:164558,rating:8.9,rank:6}]});function r(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function a(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}var s=function(e){function t(){return r(this,t),a(this,e.apply(this,arguments))}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(t,e),t.prototype.config=function(){return{view:"datatable",autoConfig:!0,css:"webix_shadow_medium"}},t.prototype.init=function(e){e.parse(n)},t}(i.c);t.default=s},function(e,t,o){"use strict";o.r(t);o(27);var i=o(4),n=(o(50),Object.assign||function(e){for(var t=1;t<arguments.length;t++){var o=arguments[t];for(var i in o)Object.prototype.hasOwnProperty.call(o,i)&&(e[i]=o[i])}return e});var r=function(e){function t(o){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t);var r={id:"webix-jet-app",version:"1.1.0",router:i.a,debug:!1,start:"/login"};return function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}(this,e.call(this,n({},r,o)))}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(t,e),t}(i.b);t.default=r,webix.ready((function(){var e=new r;e.use(i.d.Locale),e.use(i.d.Theme),webix.i18n.setLocale("es-ES"),e.render(),e.getService("theme").setTheme("compact-default")}))},function(e,t,o){var i={"./capitulos":28,"./capitulos.js":28,"./data":46,"./data.js":46,"./expedientes":29,"./expedientes.js":29,"./expedientesForm":43,"./expedientesForm.js":43,"./imprimirWindow":30,"./imprimirWindow.js":30,"./inicio":31,"./inicio.js":31,"./login":32,"./login.js":32,"./mainFooter":25,"./mainFooter.js":25,"./mainMenu":23,"./mainMenu.js":23,"./mainToolbar":24,"./mainToolbar.js":24,"./ofertas":33,"./ofertas.js":33,"./ofertasCosteForm":34,"./ofertasCosteForm.js":34,"./ofertasEpisReport":10,"./ofertasEpisReport.js":10,"./ofertasForm":26,"./ofertasForm.js":26,"./ofertasVentaForm":45,"./ofertasVentaForm.js":45,"./start":35,"./start.js":35,"./tiposProyecto":36,"./tiposProyecto.js":36,"./top":37,"./top.js":37,"./unidadesObra":38,"./unidadesObra.js":38,"./usuarios":39,"./usuarios.js":39,"./usuariosForm":44,"./usuariosForm.js":44};function n(e){var t=r(e);return o(t)}function r(e){if(!o.o(i,e)){var t=new Error("Cannot find module '"+e+"'");throw t.code="MODULE_NOT_FOUND",t}return i[e]}n.keys=function(){return Object.keys(i)},n.resolve=r,e.exports=n,n.id=48},function(e,t,o){var i={"./en":40,"./en.js":40,"./es":41,"./es.js":41,"./fr.":42,"./fr..js":42,"./language_service":6,"./language_service.js":6};function n(e){var t=r(e);return o(t)}function r(e){if(!o.o(i,e)){var t=new Error("Cannot find module '"+e+"'");throw t.code="MODULE_NOT_FOUND",t}return i[e]}n.keys=function(){return Object.keys(i)},n.resolve=r,e.exports=n,n.id=49},function(e,t,o){(function(e){var t="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e};!function(o){"use strict";var i=Object.prototype,n=i.hasOwnProperty,r="function"==typeof Symbol?Symbol:{},a=r.iterator||"@@iterator",s=r.asyncIterator||"@@asyncIterator",c=r.toStringTag||"@@toStringTag",l="object"===t(e),u=o.regeneratorRuntime;if(u)l&&(e.exports=u);else{(u=o.regeneratorRuntime=l?e.exports:{}).wrap=g;var d={},p={};p[a]=function(){return this};var f=Object.getPrototypeOf,h=f&&f(f(E([])));h&&h!==i&&n.call(h,a)&&(p=h);var m=x.prototype=v.prototype=Object.create(p);w.prototype=m.constructor=x,x.constructor=w,x[c]=w.displayName="GeneratorFunction",u.isGeneratorFunction=function(e){var t="function"==typeof e&&e.constructor;return!!t&&(t===w||"GeneratorFunction"===(t.displayName||t.name))},u.mark=function(e){return Object.setPrototypeOf?Object.setPrototypeOf(e,x):(e.__proto__=x,c in e||(e[c]="GeneratorFunction")),e.prototype=Object.create(m),e},u.awrap=function(e){return{__await:e}},$(y.prototype),y.prototype[s]=function(){return this},u.AsyncIterator=y,u.async=function(e,t,o,i){var n=new y(g(e,t,o,i));return u.isGeneratorFunction(t)?n:n.next().then((function(e){return e.done?e.value:n.next()}))},$(m),m[c]="Generator",m[a]=function(){return this},m.toString=function(){return"[object Generator]"},u.keys=function(e){var t=[];for(var o in e)t.push(o);return t.reverse(),function o(){for(;t.length;){var i=t.pop();if(i in e)return o.value=i,o.done=!1,o}return o.done=!0,o}},u.values=E,I.prototype={constructor:I,reset:function(e){if(this.prev=0,this.next=0,this.sent=this._sent=void 0,this.done=!1,this.delegate=null,this.method="next",this.arg=void 0,this.tryEntries.forEach(A),!e)for(var t in this)"t"===t.charAt(0)&&n.call(this,t)&&!isNaN(+t.slice(1))&&(this[t]=void 0)},stop:function(){this.done=!0;var e=this.tryEntries[0].completion;if("throw"===e.type)throw e.arg;return this.rval},dispatchException:function(e){if(this.done)throw e;var t=this;function o(o,i){return a.type="throw",a.arg=e,t.next=o,i&&(t.method="next",t.arg=void 0),!!i}for(var i=this.tryEntries.length-1;i>=0;--i){var r=this.tryEntries[i],a=r.completion;if("root"===r.tryLoc)return o("end");if(r.tryLoc<=this.prev){var s=n.call(r,"catchLoc"),c=n.call(r,"finallyLoc");if(s&&c){if(this.prev<r.catchLoc)return o(r.catchLoc,!0);if(this.prev<r.finallyLoc)return o(r.finallyLoc)}else if(s){if(this.prev<r.catchLoc)return o(r.catchLoc,!0)}else{if(!c)throw new Error("try statement without catch or finally");if(this.prev<r.finallyLoc)return o(r.finallyLoc)}}}},abrupt:function(e,t){for(var o=this.tryEntries.length-1;o>=0;--o){var i=this.tryEntries[o];if(i.tryLoc<=this.prev&&n.call(i,"finallyLoc")&&this.prev<i.finallyLoc){var r=i;break}}r&&("break"===e||"continue"===e)&&r.tryLoc<=t&&t<=r.finallyLoc&&(r=null);var a=r?r.completion:{};return a.type=e,a.arg=t,r?(this.method="next",this.next=r.finallyLoc,d):this.complete(a)},complete:function(e,t){if("throw"===e.type)throw e.arg;return"break"===e.type||"continue"===e.type?this.next=e.arg:"return"===e.type?(this.rval=this.arg=e.arg,this.method="return",this.next="end"):"normal"===e.type&&t&&(this.next=t),d},finish:function(e){for(var t=this.tryEntries.length-1;t>=0;--t){var o=this.tryEntries[t];if(o.finallyLoc===e)return this.complete(o.completion,o.afterLoc),A(o),d}},catch:function(e){for(var t=this.tryEntries.length-1;t>=0;--t){var o=this.tryEntries[t];if(o.tryLoc===e){var i=o.completion;if("throw"===i.type){var n=i.arg;A(o)}return n}}throw new Error("illegal catch attempt")},delegateYield:function(e,t,o){return this.delegate={iterator:E(e),resultName:t,nextLoc:o},"next"===this.method&&(this.arg=void 0),d}}}function g(e,t,o,i){var n=t&&t.prototype instanceof v?t:v,r=Object.create(n.prototype),a=new I(i||[]);return r._invoke=function(e,t,o){var i="suspendedStart";return function(n,r){if("executing"===i)throw new Error("Generator is already running");if("completed"===i){if("throw"===n)throw r;return P()}for(o.method=n,o.arg=r;;){var a=o.delegate;if(a){var s=C(a,o);if(s){if(s===d)continue;return s}}if("next"===o.method)o.sent=o._sent=o.arg;else if("throw"===o.method){if("suspendedStart"===i)throw i="completed",o.arg;o.dispatchException(o.arg)}else"return"===o.method&&o.abrupt("return",o.arg);i="executing";var c=b(e,t,o);if("normal"===c.type){if(i=o.done?"completed":"suspendedYield",c.arg===d)continue;return{value:c.arg,done:o.done}}"throw"===c.type&&(i="completed",o.method="throw",o.arg=c.arg)}}}(e,o,a),r}function b(e,t,o){try{return{type:"normal",arg:e.call(t,o)}}catch(e){return{type:"throw",arg:e}}}function v(){}function w(){}function x(){}function $(e){["next","throw","return"].forEach((function(t){e[t]=function(e){return this._invoke(t,e)}}))}function y(e){var o;this._invoke=function(i,r){function a(){return new Promise((function(o,a){!function o(i,r,a,s){var c=b(e[i],e,r);if("throw"!==c.type){var l=c.arg,u=l.value;return u&&"object"===(void 0===u?"undefined":t(u))&&n.call(u,"__await")?Promise.resolve(u.__await).then((function(e){o("next",e,a,s)}),(function(e){o("throw",e,a,s)})):Promise.resolve(u).then((function(e){l.value=e,a(l)}),s)}s(c.arg)}(i,r,o,a)}))}return o=o?o.then(a,a):a()}}function C(e,t){var o=e.iterator[t.method];if(void 0===o){if(t.delegate=null,"throw"===t.method){if(e.iterator.return&&(t.method="return",t.arg=void 0,C(e,t),"throw"===t.method))return d;t.method="throw",t.arg=new TypeError("The iterator does not provide a 'throw' method")}return d}var i=b(o,e.iterator,t.arg);if("throw"===i.type)return t.method="throw",t.arg=i.arg,t.delegate=null,d;var n=i.arg;return n?n.done?(t[e.resultName]=n.value,t.next=e.nextLoc,"return"!==t.method&&(t.method="next",t.arg=void 0),t.delegate=null,d):n:(t.method="throw",t.arg=new TypeError("iterator result is not an object"),t.delegate=null,d)}function j(e){var t={tryLoc:e[0]};1 in e&&(t.catchLoc=e[1]),2 in e&&(t.finallyLoc=e[2],t.afterLoc=e[3]),this.tryEntries.push(t)}function A(e){var t=e.completion||{};t.type="normal",delete t.arg,e.completion=t}function I(e){this.tryEntries=[{tryLoc:"root"}],e.forEach(j,this),this.reset(!0)}function E(e){if(e){var t=e[a];if(t)return t.call(e);if("function"==typeof e.next)return e;if(!isNaN(e.length)){var o=-1,i=function t(){for(;++o<e.length;)if(n.call(e,o))return t.value=e[o],t.done=!1,t;return t.value=void 0,t.done=!0,t};return i.next=i}}return{next:P}}function P(){return{value:void 0,done:!0}}}(function(){return this}()||Function("return this")())}).call(this,o(51)(e))},function(e,t){e.exports=function(e){return e.webpackPolyfill||(e.deprecate=function(){},e.paths=[],e.children||(e.children=[]),Object.defineProperty(e,"loaded",{enumerable:!0,get:function(){return e.l}}),Object.defineProperty(e,"id",{enumerable:!0,get:function(){return e.i}}),e.webpackPolyfill=1),e}}]);