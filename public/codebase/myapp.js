!function(e){var t={};function o(n){if(t[n])return t[n].exports;var r=t[n]={i:n,l:!1,exports:{}};return e[n].call(r.exports,r,r.exports,o),r.l=!0,r.exports}o.m=e,o.c=t,o.d=function(e,t,n){o.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:n})},o.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},o.t=function(e,t){if(1&t&&(e=o(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var n=Object.create(null);if(o.r(n),Object.defineProperty(n,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var r in e)o.d(n,r,function(t){return e[t]}.bind(null,r));return n},o.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return o.d(t,"a",t),t},o.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},o.p="/codebase/",o(o.s=23)}([function(e,t,o){"use strict";o.d(t,"a",(function(){return n}));var n={getConfig:function(){return new Promise((function(e,t){webix.ajax().timeout(1e4).headers({"Content-Type":"application/json"}).get("/config").then((function(t){e(t.json())})).catch((function(e){t(e)}))}))},getConfigMysql:function(){return new Promise((function(e,t){webix.ajax().timeout(1e4).headers({"Content-Type":"application/json"}).get("/config").then((function(t){e(t.json())})).catch((function(e){t(e)}))}))},getVersion:function(){return new Promise((function(e,t){webix.ajax().timeout(1e4).headers({"Content-Type":"application/json"}).get("/version").then((function(t){e(t.json())})).catch((function(e){t(e)}))}))}}},function(e,t,o){"use strict";o.d(t,"a",(function(){return n}));o(0);var n={errorMessageAjax:function(e){var t=e.response;webix.alert({type:"alert-error",title:"ERROR",text:t})},errorMessage:function(e){webix.alert({type:"alert-error",title:"ERROR",text:e})},normalMessage:function(e){webix.alert({title:"INFORMATION",text:e})},errorRestriccion:function(){webix.alert({title:"INFORMATION",text:"Hay registros dependientes de esta entrada. No se puede eliminar."})}}},function(e,t,o){"use strict";o.d(t,"a",(function(){return n}));var n={prepareDataForDataTable:function(e,t){var o=[];return t.forEach((function(t){t.id=t[e],o.push(t)})),o},prepareDataForCombo:function(e,t,o){var n=[];return o.forEach((function(o){n.push({id:o[e],value:o[t]})})),n}}},function(e,t,o){"use strict";o.d(t,"d",(function(){return U})),o.d(t,"b",(function(){return y})),o.d(t,"c",(function(){return d})),o.d(t,"a",(function(){return b}));var n="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e};function r(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function i(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}function a(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}var s=function e(){a(this,e)},c=function(){function e(t){a(this,e),this.webixJet=!0,this.webix=t,this._events=[],this._subs={},this._data={}}return e.prototype.getRoot=function(){return this._root},e.prototype.destructor=function(){this._detachEvents(),this._destroySubs(),this._events=this._container=this.app=this._parent=this._root=null},e.prototype.setParam=function(e,t,o){if(this._data[e]!==t&&(this._data[e]=t,this._segment.update(e,t,0),o))return this.show(null)},e.prototype.getParam=function(e,t){var o=this._data[e];if(void 0!==o||!t)return o;var n=this.getParentView();return n?n.getParam(e,t):void 0},e.prototype.getUrl=function(){return this._segment.suburl()},e.prototype.getUrlString=function(){return this._segment.toString()},e.prototype.getParentView=function(){return this._parent},e.prototype.$$=function(e){if("string"==typeof e){var t=this.getRoot();return t.queryView((function(o){return(o.config.id===e||o.config.localId===e)&&o.$scope===t.$scope}),"self")}return e},e.prototype.on=function(e,t,o){var n=e.attachEvent(t,o);return this._events.push({obj:e,id:n}),n},e.prototype.contains=function(e){for(var t in this._subs){var o=this._subs[t].view;if(o===e||o.contains(e))return!0}return!1},e.prototype.getSubView=function(e){var t=this.getSubViewInfo(e);if(t)return t.subview.view},e.prototype.getSubViewInfo=function(e){var t=this._subs[e||"default"];return t?{subview:t,parent:this}:"_top"===e?(this._subs[e]={url:"",id:null,popup:!0},this.getSubViewInfo(e)):this._parent?this._parent.getSubViewInfo(e):null},e.prototype._detachEvents=function(){for(var e=this._events,t=e.length-1;t>=0;t--)e[t].obj.detachEvent(e[t].id)},e.prototype._destroySubs=function(){for(var e in this._subs){var t=this._subs[e].view;t&&t.destructor()}this._subs={}},e.prototype._init_url_data=function(){var e=this._segment.current();this._data={},this.webix.extend(this._data,e.params,!0)},e.prototype._getDefaultSub=function(){if(this._subs.default)return this._subs.default;for(var e in this._subs){var t=this._subs[e];if(!t.branch&&t.view&&"_top"!==e){var o=t.view._getDefaultSub();if(o)return o}}},e.prototype._routed_view=function(){var e=this.getParentView();if(!e)return!0;var t=e._getDefaultSub();return!(!t&&t!==this)&&e._routed_view()},e}();function u(e){"/"===e[0]&&(e=e.substr(1));for(var t=e.split("/"),o=[],n=0;n<t.length;n++){var r=t[n],i={},a=r.indexOf(":");if(-1===a&&(a=r.indexOf("?")),-1!==a){var s=r.substr(a+1).split(/[\:\?\&]/g),c=Array.isArray(s),u=0;for(s=c?s:s[Symbol.iterator]();;){var l;if(c){if(u>=s.length)break;l=s[u++]}else{if((u=s.next()).done)break;l=u.value}var p=l.split("=");i[p[0]]=decodeURIComponent(p[1])}}o[n]={page:a>-1?r.substr(0,a):r,params:i,isNew:!0}}return o}function l(e){var t=[],o=e,n=Array.isArray(o),r=0;for(o=n?o:o[Symbol.iterator]();;){var i;if(n){if(r>=o.length)break;i=o[r++]}else{if((r=o.next()).done)break;i=r.value}var a=i;t.push("/"+a.page);var s=p(a.params);s&&t.push("?"+s)}return t.join("")}function p(e){var t=[];for(var o in e)t.length&&t.push("&"),t.push(o+"="+encodeURIComponent(e[o]));return t.join("")}var f=function(){function e(t,o){a(this,e),this._next=1,this.route="string"==typeof t?{url:u(t),path:t}:t,this.index=o}return e.prototype.current=function(){return this.route.url[this.index]},e.prototype.next=function(){return this.route.url[this.index+this._next]},e.prototype.suburl=function(){return this.route.url.slice(this.index)},e.prototype.shift=function(){return new e(this.route,this.index+this._next)},e.prototype.refresh=function(){for(var e=this.route.url,t=this.index+1;t<e.length;t++)e[t].isNew=!0},e.prototype.toString=function(){var e=l(this.suburl());return e?e.substr(1):""},e.prototype._join=function(e,t){var o=this.route.url;if(null===e)return o;var n=this.route.url;if(o=n.slice(0,this.index+(t?this._next:0)),e){o=o.concat(u(e));for(var r=0;r<o.length;r++)n[r]&&(o[r].view=n[r].view),n[r]&&o[r].page===n[r].page&&(o[r].isNew=!1)}return o},e.prototype.append=function(e){var t=this._join(e,!0);return this.route.path=l(t),this.route.url=t,this.route.path},e.prototype.show=function(e,t,o){var n=this,r=this._join(e,o);return new Promise((function(e,o){var i=l(r),a={url:r,redirect:i,confirm:Promise.resolve()},c=t?t.app:null;if(c&&!c.callEvent("app:guard",[a.redirect,t,a]))return void o(new s);a.confirm.catch((function(e){return o(e)})).then((function(){if(null!==a.redirect){if(a.redirect!==i)return c.show(a.redirect),void o(new s);n.route.path=i,n.route.url=r,e()}else o(new s)}))}))},e.prototype.size=function(e){this._next=e},e.prototype.split=function(){var t={url:this.route.url.slice(this.index+1),path:""};return t.url.length&&(t.path=l(t.url)),new e(t,0)},e.prototype.update=function(e,t,o){var n=this.route.url[this.index+(o||0)];if(!n)return this.route.url.push({page:"",params:{}}),this.update(e,t,o);""===e?n.page=t:n.params[e]=t,this.route.path=l(this.route.url)},e}(),d=function(e){function t(o,n){a(this,t);var i=r(this,e.call(this,o.webix));return i.app=o,i._children=[],i}return i(t,e),t.prototype.ui=function(e,t){var o=(t=t||{}).container||e.container,r=this.app.createView(e);return this._children.push(r),r.render(o,this._segment,this),"object"!==(void 0===e?"undefined":n(e))||e instanceof c?r:r.getRoot()},t.prototype.show=function(e,t){if(t=t||{},"object"===(void 0===e?"undefined":n(e))){for(var o in e)this.setParam(o,e[o]);e=null}else{if("/"===e.substr(0,1))return this.app.show(e);if(0===e.indexOf("./")&&(e=e.substr(2)),0===e.indexOf("../")){var r=this.getParentView();return r?r.show(e.substr(3),t):this.app.show("/"+e.substr(3))}var i=this.getSubViewInfo(t.target);if(i){if(i.parent!==this)return i.parent.show(e,t);if(t.target&&"default"!==t.target)return this._renderFrameLock(t.target,i.subview,e)}else if(e)return this.app.show("/"+e)}return this._show(this._segment,e,this)},t.prototype._show=function(e,t,o){var n=this;return e.show(t,o,!0).then((function(){return n._init_url_data(),n._urlChange()})).then((function(){e.route.linkRouter&&(n.app.getRouter().set(e.route.path,{silent:!0}),n.app.callEvent("app:route",[e.route.path]))}))},t.prototype.init=function(e,t){},t.prototype.ready=function(e,t){},t.prototype.config=function(){this.app.webix.message("View:Config is not implemented")},t.prototype.urlChange=function(e,t){},t.prototype.destroy=function(){},t.prototype.destructor=function(){this.destroy(),this._destroyKids(),this._root.destructor(),e.prototype.destructor.call(this)},t.prototype.use=function(e,t){e(this.app,this,t)},t.prototype.refresh=function(){this.getUrl();return this.destroy(),this._destroyKids(),this._destroySubs(),this._detachEvents(),this._container.tagName&&this._root.destructor(),this._segment.refresh(),this._render(this._segment)},t.prototype.render=function(e,t,o){var n=this;"string"==typeof t&&(t=new f(t,0)),this._segment=t,this._parent=o,this._init_url_data();var r="string"==typeof(e=e||document.body)?this.webix.toNode(e):e;return this._container!==r?(this._container=r,this._render(t)):this._urlChange().then((function(){return n.getRoot()}))},t.prototype._render=function(e){var t=this,o=this.config();return o.then?o.then((function(o){return t._render_final(o,e)})):this._render_final(o,e)},t.prototype._render_final=function(e,t){var o=this,n=null,r=null,i=!1;if(this._container.tagName?r=this._container:(n=this._container).popup?(r=document.body,i=!0):r=this.webix.$$(n.id),!this.app||!r)return Promise.reject(null);var a=void 0,s=this._segment.current(),c={ui:{}};this.app.copyConfig(e,c.ui,this._subs),this.app.callEvent("app:render",[this,t,c]),c.ui.$scope=this,!n&&s.isNew&&s.view&&s.view.destructor();try{if(n&&!i){var u=r,l=u.getParentView();l&&"multiview"===l.name&&!c.ui.id&&(c.ui.id=u.config.id)}this._root=this.app.webix.ui(c.ui,r);var p=this._root;i&&p.setPosition&&!p.isVisible()&&p.show(),n&&(n.view&&n.view!==this&&n.view!==this.app&&n.view.destructor(),n.id=this._root.config.id,this.getParentView()||!this.app.app?n.view=this:n.view=this.app),s.isNew&&(s.view=this,s.isNew=!1),a=Promise.resolve(this._init(this._root,t)).then((function(){return o._urlChange().then((function(){return o._initUrl=null,o.ready(o._root,t.suburl())}))}))}catch(e){a=Promise.reject(e)}return a.catch((function(e){return o._initError(o,e)}))},t.prototype._init=function(e,t){return this.init(e,t.suburl())},t.prototype._urlChange=function(){var e=this;this.app.callEvent("app:urlchange",[this,this._segment]);var t=[];for(var o in this._subs){var n=this._subs[o],r=this._renderFrameLock(o,n,null);r&&t.push(r)}return Promise.all(t).then((function(){return e.urlChange(e._root,e._segment.suburl())}))},t.prototype._renderFrameLock=function(e,t,o){if(!t.lock){var n=this._renderFrame(e,t,o);n&&(t.lock=n.then((function(){return t.lock=null}),(function(){return t.lock=null})))}return t.lock},t.prototype._renderFrame=function(e,t,o){var n=this;if("default"===e){if(this._segment.next())return this._createSubView(t,this._segment.shift());t.view&&t.popup&&(t.view.destructor(),t.view=null)}if(null!==o&&(t.url=o),t.route){if(null!==o)return t.route.show(o,t.view).then((function(){return n._createSubView(t,t.route)}));if(t.branch)return}var r=t.view;if(!r&&t.url){if("string"==typeof t.url)return t.route=new f(t.url,0),this._createSubView(t,t.route);"function"!=typeof t.url||r instanceof t.url||(r=new t.url(this.app,"")),r||(r=t.url)}if(r)return r.render(t,t.route||this._segment,this)},t.prototype._initError=function(e,t){return this.app&&this.app.error("app:error:initview",[t,e]),!0},t.prototype._createSubView=function(e,t){var o=this;return this.app.createFromURL(t.current()).then((function(n){return n.render(e,t,o)}))},t.prototype._destroyKids=function(){for(var e=this._children,t=e.length-1;t>=0;t--)e[t]&&e[t].destructor&&e[t].destructor();this._children=[]},t}(c),h=function(e){function t(o,n){a(this,t);var i=r(this,e.call(this,o,n));return i._ui=n.ui,i}return i(t,e),t.prototype.config=function(){return this._ui},t}(d),g=function(){function e(t,o,n){a(this,e),this.path="",this.app=n}return e.prototype.set=function(e,t){this.path=e;var o=this.app;o.app.getRouter().set(o._segment.append(this.path),{silent:!0})},e.prototype.get=function(){return this.path},e}(),m=!0,v=function(e){function t(o){a(this,t);var n=(o||{}).webix||window.webix,i=r(this,e.call(this,n));return i.config=i.webix.extend({name:"App",version:"1.0",start:"/home"},o,!0),i.app=i.config.app,i.ready=Promise.resolve(),i._services={},i.webix.extend(i,i.webix.EventSystem),i}return i(t,e),t.prototype.getUrl=function(){return this._subSegment.suburl()},t.prototype.getUrlString=function(){return this._subSegment.toString()},t.prototype.getService=function(e){var t=this._services[e];return"function"==typeof t&&(t=this._services[e]=t(this)),t},t.prototype.setService=function(e,t){this._services[e]=t},t.prototype.destructor=function(){this.getSubView().destructor(),e.prototype.destructor.call(this)},t.prototype.copyConfig=function(e,t,o){if((e instanceof c||"function"==typeof e&&e.prototype instanceof c)&&(e={$subview:e}),void 0!==e.$subview)return this.addSubView(e,t,o);for(var r in t=t||(e instanceof Array?[]:{}),e){var i=e[r];if("function"==typeof i&&i.prototype instanceof c&&(i={$subview:i}),!i||"object"!==(void 0===i?"undefined":n(i))||i instanceof this.webix.DataCollection||i instanceof RegExp||i instanceof Map)t[r]=i;else if(i instanceof Date)t[r]=new Date(i);else{var a=this.copyConfig(i,i instanceof Array?[]:{},o);null!==a&&(t[r]=a)}}return t},t.prototype.getRouter=function(){return this.$router},t.prototype.clickHandler=function(e,t){if(e&&(t=t||e.target||e.srcElement)&&t.getAttribute){var o=t.getAttribute("trigger");if(o)return this._forView(t,(function(e){return e.app.trigger(o)})),e.cancelBubble=!0,e.preventDefault();var n=t.getAttribute("route");if(n)return this._forView(t,(function(e){return e.show(n)})),e.cancelBubble=!0,e.preventDefault()}var r=t.parentNode;r&&this.clickHandler(e,r)},t.prototype.getRoot=function(){return this.getSubView().getRoot()},t.prototype.refresh=function(){var e=this;return this._subSegment?this.getSubView().refresh().then((function(t){return e.callEvent("app:route",[e.getUrl()]),t})):Promise.resolve(null)},t.prototype.loadView=function(e){var t=this,o=this.config.views,n=null;if(""===e)return Promise.resolve(this._loadError("",new Error("Webix Jet: Empty url segment")));try{o&&"string"==typeof(n="function"==typeof o?o(e):o[e])&&(e=n,n=null),n||(n="_blank"===e?{}:this._loadViewDynamic(e))}catch(t){n=this._loadError(e,t)}return n.then||(n=Promise.resolve(n)),n=n.then((function(e){return e.__esModule?e.default:e})).catch((function(o){return t._loadError(e,o)}))},t.prototype._forView=function(e,t){var o=this.webix.$$(e);o&&t(o.$scope)},t.prototype._loadViewDynamic=function(e){return null},t.prototype.createFromURL=function(e){var t=this;return e.isNew||!e.view?this.loadView(e.page).then((function(e){return t.createView(e,name)})):Promise.resolve(e.view)},t.prototype.createView=function(e,o){if("function"==typeof e){if(e.prototype instanceof t)return new e({app:this,name:o,router:g});if(e.prototype instanceof c)return new e(this,{name:o});e=e(this)}return e instanceof c?e:new h(this,{name:o,ui:e})},t.prototype.show=function(e){return this.render(this._container,e||this.config.start)},t.prototype.trigger=function(e){for(var t=arguments.length,o=Array(t>1?t-1:0),n=1;n<t;n++)o[n-1]=arguments[n];this.apply(e,o)},t.prototype.apply=function(e,t){this.callEvent(e,t)},t.prototype.action=function(e){return this.webix.bind((function(){for(var t=arguments.length,o=Array(t),n=0;n<t;n++)o[n]=arguments[n];this.apply(e,o)}),this)},t.prototype.on=function(e,t){this.attachEvent(e,t)},t.prototype.use=function(e,t){e(this,null,t)},t.prototype.error=function(e,t){if(this.callEvent(e,t),this.callEvent("app:error",t),this.config.debug)for(var o=0;o<t.length;o++)if(console.error(t[o]),t[o]instanceof Error){var n=t[o].message;0===n.indexOf("Module build failed")?(n=n.replace(/\x1b\[[0-9;]*m/g,""),document.body.innerHTML="<pre style='font-size:16px; background-color: #ec6873; color: #000; padding:10px;'>"+n+"</pre>"):(n+="<br><br>Check console for more details",this.webix.message({type:"error",text:n,expire:-1}))}},t.prototype.render=function(e,t,o){var n=this;this._container="string"==typeof e?this.webix.toNode(e):e||document.body;var r=null;!this.$router?(m&&"tagName"in this._container&&(this.webix.event(document.body,"click",(function(e){return n.clickHandler(e)})),m=!1),"string"==typeof t&&(t=new f(t,0)),this._subSegment=this._first_start(t),this._subSegment.route.linkRouter=!0):r="string"==typeof t?t:this.app?t.split().route.path||this.config.start:t.toString();var i=this.getSubView(),a=this._subSegment,s=a.show(r,i).then((function(){return n.createFromURL(a.current())})).then((function(t){return t.render(e,a)})).then((function(e){return n.$router.set(a.route.path,{silent:!0}),n.callEvent("app:route",[n.getUrl()]),e}));return this.ready=this.ready.then((function(){return s})),s},t.prototype.getSubView=function(){if(this._subSegment){var e=this._subSegment.current().view;if(e)return e}return new d(this,{})},t.prototype._first_start=function(e){var t=this;this._segment=e;if(this.$router=new this.config.router((function(e){return setTimeout((function(){t.show(e).catch((function(e){if(!(e instanceof s))throw e}))}),1)}),this.config,this),this._container===document.body&&!1!==this.config.animation){var o=this._container;this.webix.html.addCss(o,"webixappstart"),setTimeout((function(){t.webix.html.removeCss(o,"webixappstart"),t.webix.html.addCss(o,"webixapp")}),10)}if(e)this.app&&(e.current().view=this,e.next()?(e.refresh(),e=e.split()):e=new f(this.config.start,0));else{var n=this.$router.get();n||(n=this.config.start,this.$router.set(n,{silent:!0})),e=new f(n,0)}return e},t.prototype._loadError=function(e,t){return this.error("app:error:resolve",[t,e]),{template:" "}},t.prototype.addSubView=function(e,t,o){var n=!0!==e.$subview?e.$subview:null,r=e.name||(n?this.webix.uid():"default");return t.id=e.id||"s"+this.webix.uid(),(o[r]={id:t.id,url:n,branch:e.branch,popup:e.popup}).popup?null:t},t}(c),b=function(){function e(t,o){var n=this;a(this,e),this.config=o||{},this._detectPrefix(),this.cb=t,window.onpopstate=function(){return n.cb(n.get())}}return e.prototype.set=function(e,t){var o=this;if(this.config.routes){var n=e.split("?",2);for(var r in this.config.routes)if(this.config.routes[r]===n[0]){e=r+(n.length>1?"?"+n[1]:"");break}}this.get()!==e&&window.history.pushState(null,null,this.prefix+this.sufix+e),t&&t.silent||setTimeout((function(){return o.cb(e)}),1)},e.prototype.get=function(){var e=this._getRaw().replace(this.prefix,"").replace(this.sufix,"");if(e="/"!==e&&"#"!==e?e:"",this.config.routes){var t=e.split("?",2),o=this.config.routes[t[0]];o&&(e=o+(t.length>1?"?"+t[1]:""))}return e},e.prototype._detectPrefix=function(){var e=this.config.routerPrefix;this.sufix="#"+(void 0===e?"!":e),this.prefix=document.location.href.split("#",2)[0]},e.prototype._getRaw=function(){return document.location.href},e}(),w=!1;function $(e){if(!w&&e){w=!0;var t=window;t.Promise||(t.Promise=e.promise);var o=e.version.split(".");10*o[0]+1*o[1]<53&&(e.ui.freeze=function(t){var o=t();return o&&o.then?o.then((function(t){return e.ui.$freeze=!1,e.ui.resize(),t})):(e.ui.$freeze=!1,e.ui.resize()),o});var r=e.ui.baselayout.prototype.addView,i=e.ui.baselayout.prototype.removeView,a={addView:function(e,t){var o=this;if(!this.$scope||!this.$scope.webixJet||e.queryView)return r.apply(this,arguments);var i=function(){var n=o.$scope,i={};e=n.app.copyConfig(e,{},i),r.apply(o,[e,t]);var a=function(e){n._renderFrame(e,i[e],null).then((function(){n._subs[e]=i[e]}))};for(var s in i)a(s);return{v:e.id}}();return"object"===(void 0===i?"undefined":n(i))?i.v:void 0},removeView:function(){if(i.apply(this,arguments),this.$scope&&this.$scope.webixJet){var t=this.$scope._subs;for(var o in t){var n=t[o];e.$$(n.id)||(n.view.destructor(),delete t[o])}}}};e.extend(e.ui.layout.prototype,a,!0),e.extend(e.ui.baselayout.prototype,a,!0),e.protoUI({name:"jetapp",$init:function(t){this.$app=new this.app(t);var o=e.uid().toString();for(var n in t.body={id:o},this.$ready.push((function(){this.$app.render({id:o})})),this.$app){var r=this.$app[n];"function"!=typeof r||this[n]||(this[n]=r.bind(this.$app))}}},e.ui.proxy)}}var y=function(e){function t(o){a(this,t),o.router=o.router||b;var n=r(this,e.call(this,o));return $(n.webix),n}return i(t,e),t.prototype._loadViewDynamic=function(e){return e=e.replace(/\./g,"/"),o(25)("./"+e)},t}(v);(function(){function e(t,o,n){a(this,e),this.storage=o.storage||n.webix.storage.session,this.name=o.storeName||o.id+":route",this.cb=t}e.prototype.set=function(e,t){var o=this;this.storage.put(this.name,e),t&&t.silent||setTimeout((function(){return o.cb(e)}),1)},e.prototype.get=function(){return this.storage.get(this.name)}})(),function(e){function t(){return a(this,t),r(this,e.apply(this,arguments))}i(t,e),t.prototype._detectPrefix=function(){this.prefix="",this.sufix=this.config.routerPrefix||""},t.prototype._getRaw=function(){return document.location.pathname+(document.location.search||"")}}(b),function(){function e(t,o){a(this,e),this.path="",this.cb=t}e.prototype.set=function(e,t){var o=this;this.path=e,t&&t.silent||setTimeout((function(){return o.cb(e)}),1)},e.prototype.get=function(){return this.path}}();function x(e,t){return Object.prototype.hasOwnProperty.call(e,t)}function C(e,t,o){for(var n in e)x(e,n)&&t.call(o||e,e[n],n,e)}function j(e){e="Warning: "+e,"undefined"!=typeof console&&console.error(e);try{throw new Error(e)}catch(e){}}var P=String.prototype.replace,_=String.prototype.split,A=function(e){var t=e%10;return 11!==e&&1===t?0:2<=t&&t<=4&&!(e>=12&&e<=14)?1:2},I={arabic:function(e){if(e<3)return e;var t=e%100;return t>=3&&t<=10?3:t>=11?4:5},bosnian_serbian:A,chinese:function(){return 0},croatian:A,french:function(e){return e>1?1:0},german:function(e){return 1!==e?1:0},russian:A,lithuanian:function(e){return e%10==1&&e%100!=11?0:e%10>=2&&e%10<=9&&(e%100<11||e%100>19)?1:2},czech:function(e){return 1===e?0:e>=2&&e<=4?1:2},polish:function(e){if(1===e)return 0;var t=e%10;return 2<=t&&t<=4&&(e%100<10||e%100>=20)?1:2},icelandic:function(e){return e%10!=1||e%100==11?1:0},slovenian:function(e){var t=e%100;return 1===t?0:2===t?1:3===t||4===t?2:3}},O={arabic:["ar"],bosnian_serbian:["bs-Latn-BA","bs-Cyrl-BA","srl-RS","sr-RS"],chinese:["id","id-ID","ja","ko","ko-KR","lo","ms","th","th-TH","zh"],croatian:["hr","hr-HR"],german:["fa","da","de","en","es","fi","el","he","hi-IN","hu","hu-HU","it","nl","no","pt","sv","tr"],french:["fr","tl","pt-br"],russian:["ru","ru-RU"],lithuanian:["lt"],czech:["cs","cs-CZ","sk"],polish:["pl"],icelandic:["is"],slovenian:["sl-SL"]};function E(e){var t,o=(t={},C(O,(function(e,o){C(e,(function(e){t[e]=o}))})),t);return o[e]||o[_.call(e,/-/,1)[0]]||o.en}function S(e){return e.replace(/[.*+?^${}()|[\]\\]/g,"\\$&")}var V=/\$/g,T=/%\{(.*?)\}/g;function F(e,t,o,n){if("string"!=typeof e)throw new TypeError("Polyglot.transformPhrase expects argument #1 to be string");if(null==t)return e;var r=e,i=n||T,a="number"==typeof t?{smart_count:t}:t;if(null!=a.smart_count&&r){var s=_.call(r,"||||");r=(s[function(e,t){return I[E(e)](t)}(o||"en",a.smart_count)]||s[0]).replace(/^[\s\uFEFF\xA0]+|[\s\uFEFF\xA0]+$/g,"")}return r=P.call(r,i,(function(e,t){return x(a,t)&&null!=a[t]?P.call(a[t],V,"$$"):e}))}function L(e){var t=e||{};this.phrases={},this.extend(t.phrases||{}),this.currentLocale=t.locale||"en";var o=t.allowMissing?F:null;this.onMissingKey="function"==typeof t.onMissingKey?t.onMissingKey:o,this.warn=t.warn||j,this.tokenRegex=function(e){var t=e&&e.prefix||"%{",o=e&&e.suffix||"}";if("||||"===t||"||||"===o)throw new RangeError('"||||" token is reserved for pluralization');return new RegExp(S(t)+"(.*?)"+S(o),"g")}(t.interpolation)}L.prototype.locale=function(e){return e&&(this.currentLocale=e),this.currentLocale},L.prototype.extend=function(e,t){C(e,(function(e,o){var r=t?t+"."+o:o;"object"===(void 0===e?"undefined":n(e))?this.extend(e,r):this.phrases[r]=e}),this)},L.prototype.unset=function(e,t){"string"==typeof e?delete this.phrases[e]:C(e,(function(e,o){var r=t?t+"."+o:o;"object"===(void 0===e?"undefined":n(e))?this.unset(e,r):delete this.phrases[r]}),this)},L.prototype.clear=function(){this.phrases={}},L.prototype.replace=function(e){this.clear(),this.extend(e)},L.prototype.t=function(e,t){var o,n,r=null==t?{}:t;if("string"==typeof this.phrases[e])o=this.phrases[e];else if("string"==typeof r._)o=r._;else if(this.onMissingKey){n=(0,this.onMissingKey)(e,r,this.currentLocale,this.tokenRegex)}else this.warn('Missing translation for key: "'+e+'"'),n=e;return"string"==typeof o&&(n=F(o,r,this.currentLocale,this.tokenRegex)),n},L.prototype.has=function(e){return x(this.phrases,e)},L.transformPhrase=function(e,t,o){return F(e,t,o)};var k=L;function R(e,t,o){if(t.urls)o=t.urls[o]||o;else if(t.param){var n;(n={})[t.param]=o,o=n}e.show(o)}var D={good:"check",error:"warning",saving:"refresh fa-spin"},N={good:"Ok",error:"Error",saving:"Connecting..."};function M(e,t,o){for(var n=0;n<o.length;n++)e[o[n]]=t[n+1]?t[n+1].page:""}var G=window.webix;G&&$(G);var U={UnloadGuard:function(e,t,o){t.on(e,"app:guard",(function(e,n,r){if(n===t||n.contains(t)){var i=o();r.confirm=!1===i?Promise.reject(new s):r.confirm.then((function(){return i}))}}))},Locale:function(e,t,n){var r=(n=n||{}).storage,i=r?r.get("lang")||"en":n.lang||"en";function a(t,o,a){o.__esModule&&(o=o.default);var s={phrases:o};n.polyglot&&e.webix.extend(s,n.polyglot);var u=c.polyglot=new k(s);if(u.locale(t),c._=e.webix.bind(u.t,u),i=t,r&&r.put("lang",i),n.webix){var l=n.webix[t];l&&e.webix.i18n.setLocale(l)}return a?Promise.resolve():e.refresh()}function s(e,t){if(!1!==n.path){var r=(n.path?n.path+"/":"")+e;a(e,o(26)("./"+r),t)}}var c={getLang:function(){return i},setLang:s,setLangData:a,_:null,polyglot:null};e.setService("locale",c),s(i,!0)},Menu:function(e,t,o){var n=t.getSubViewInfo().parent,r=t.$$(o.id||o),i=!1;r.attachEvent("onchange",(function(){i||R(n,o,this.getValue())})),r.attachEvent("onafterselect",(function(){if(!i){var e=null;r.setValue?e=this.getValue():r.getSelectedId&&(e=r.getSelectedId()),R(n,o,e)}})),t.on(e,"app:route",(function(){var e="";if(o.param)e=t.getParam(o.param,!0);else{var a=n.getUrl()[1];a&&(e=a.page)}e&&(i=!0,r.setValue&&r.getValue()!==e?r.setValue(e):r.select&&r.exists(e)&&r.getSelectedId()!==e&&r.select(e),i=!1)}))},Theme:function(e,t,o){var n=(o=o||{}).storage,r=n?n.get("theme")||"flat-default":o.theme||"flat-default",i={getTheme:function(){return r},setTheme:function(t,o){for(var i=t.split("-"),a=document.getElementsByTagName("link"),s=0;s<a.length;s++){var c=a[s].getAttribute("title");c&&(c===t||c===i[0]?a[s].disabled=!1:a[s].disabled=!0)}e.webix.skin.set(i[0]),e.webix.html.removeCss(document.body,"theme-"+r),e.webix.html.addCss(document.body,"theme-"+t),r=t,n&&n.put("theme",t),o||e.refresh()}};e.setService("theme",i),i.setTheme(r,!0)},User:function(e,t,o){var n=(o=o||{}).login||"/login",r=o.logout||"/logout",i=o.afterLogin||e.config.start,a=o.afterLogout||"/login",s=o.ping||3e5,c=o.model,u=o.user,l={getUser:function(){return u},getStatus:function(e){return e?c.status().catch((function(){return null})).then((function(e){u=e})):null!==u},login:function(t,o){return c.login(t,o).then((function(t){if(u=t,!t)throw new Error("Access denied");e.callEvent("app:user:login",[u]),e.show(i)}))},logout:function(){return u=null,c.logout().then((function(t){return e.callEvent("app:user:logout",[]),t}))}};function p(e,t){e===r?(l.logout(),t.redirect=a):e===n||l.getStatus()||(t.redirect=n)}e.setService("user",l),e.attachEvent("app:guard",(function(e,t,n){return!(!o.public||!o.public(e))||(void 0===u&&(n.confirm=l.getStatus(!0).then((function(){return p(e,n)}))),p(e,n))})),s&&setInterval((function(){return l.getStatus(!0)}),s)},Status:function(e,t,o){var n="good",r=0,i=!1,a=o.expire;a||!1===a||(a=2e3);var s=o.texts||N,c=o.icons||D;function u(e){var r=t.$$(o.target);r&&(e||(e="<div class='status_"+n+"'><span class='webix_icon fa-"+c[n]+"'></span> "+s[n]+"</div>"),r.setHTML(e))}function l(){r--,h("good")}function p(e){r--,h("error",e)}function f(e){r++,h("saving"),e&&e.then&&e.then(l,p)}function d(){0===r&&u(" ")}function h(t,o){r<0&&(r=0),"saving"===t?(n="saving",u()):(i="error"===t,0===r&&(n=i?"error":"good",i?e.error("app:error:server",[o.responseText||o]):a&&setTimeout(d,a),u()))}function g(o){var n=e.webix.dp(o);n&&(t.on(n,"onAfterDataSend",f),t.on(n,"onAfterSaveError",(function(e,t,o){return p(o)})),t.on(n,"onAfterSave",l))}"string"==typeof o&&(o={target:o}),e.setService("status",{getStatus:function(){return n},setStatus:h,track:g}),o.remote&&t.on(e.webix,"onRemoteCall",f),o.ajax&&t.on(e.webix,"onBeforeAjax",(function(e,t,o,n,r,i,a){f(a)})),o.data&&g(o.data)},UrlParam:function(e,t,o){var n=o.route||o,r={};t.on(e,"app:urlchange",(function(e,o){t===e&&(M(r,o.suburl(),n),o.size(n.length+1))}));var i=t.setParam,a=t.getParam;t.setParam=function(e,o,a){var s=n.indexOf(e);return s>=0?(r[e]=o,this._segment.update("",o,s+1),a?t.show(null):void 0):i.call(this,e,o,a)},t.getParam=function(e,t){var o=r[e];return void 0!==o?o:a.call(this,e,t)},M(r,t.getUrl(),n)}},W=window;W.Promise||(W.Promise=W.webix.promise)},function(e,t,o){"use strict";o.d(t,"a",(function(){return r}));var n=o(0),r={getOfertas:function(e){return new webix.promise((function(t,o){n.a.getConfig().then((function(t){var o=t.urlApi+"/api/ofertas/usuario/logado/departamento/"+e+"/5";return webix.ajax().timeout(1e4).headers({"Content-Type":"application/json"}).get(o)})).then((function(e){t(e.json())})).catch((function(e){o(e)}))}))},getOferta:function(e){return new webix.promise((function(t,o){n.a.getConfig().then((function(t){var o=t.urlApi+"/api/ofertas/"+e;return webix.ajax().timeout(1e4).headers({"Content-Type":"application/json"}).get(o)})).then((function(e){t(e.json())})).catch((function(e){o(e)}))}))},getSiguienteReferencia:function(e){return new webix.promise((function(t,o){n.a.getConfig().then((function(t){var o=t.urlApi+"/api/ofertas/siguiente_referencia/"+e;return webix.ajax().timeout(1e4).headers({"Content-Type":"application/json"}).get(o)})).then((function(e){t(e.json())})).catch((function(e){o(e)}))}))},getLineasOferta:function(e){return new webix.promise((function(t,o){n.a.getConfig().then((function(t){var o=t.urlApi+"/api/ofertas/lineas/"+e+"/"+!1+"/"+!1;return webix.ajax().timeout(1e4).headers({"Content-Type":"application/json"}).get(o)})).then((function(e){t(e.json())})).catch((function(e){o(e)}))}))},getLineaOferta:function(e){return new webix.promise((function(t,o){n.a.getConfig().then((function(t){var o=t.urlApi+"/api/ofertas/linea/"+e;return webix.ajax().timeout(1e4).headers({"Content-Type":"application/json"}).get(o)})).then((function(e){t(e.json())})).catch((function(e){o(e)}))}))},getBasesOferta:function(e){return new webix.promise((function(t,o){n.a.getConfig().then((function(t){var o=t.urlApi+"/api/ofertas/bases/"+e;return webix.ajax().timeout(1e4).headers({"Content-Type":"application/json"}).get(o)})).then((function(e){t(e.json())})).catch((function(e){o(e)}))}))},getSiguienteLinea:function(e){return new webix.promise((function(t,o){n.a.getConfig().then((function(t){var o=t.urlApi+"/api/ofertas/nextlinea/"+e;return webix.ajax().timeout(1e4).headers({"Content-Type":"application/json"}).get(o)})).then((function(e){t(e.json())})).catch((function(e){o(e)}))}))},getProveedoresOferta:function(e){return new webix.promise((function(t,o){n.a.getConfig().then((function(t){var o=t.urlApi+"/api/ofertas/proveedores/lineas/totales/"+e;return webix.ajax().timeout(1e4).headers({"Content-Type":"application/json"}).get(o)})).then((function(e){t(e.json())})).catch((function(e){o(e)}))}))},postOferta:function(e){return new webix.promise((function(t,o){n.a.getConfig().then((function(t){var o=t.urlApi+"/api/ofertas/";return webix.ajax().timeout(1e4).headers({"Content-Type":"application/json"}).post(o,{oferta:e})})).then((function(e){t(e.json())})).catch((function(e){o(e)}))}))},putOferta:function(e,t){return new webix.promise((function(o,r){n.a.getConfig().then((function(o){var n=o.urlApi+"/api/ofertas/"+t;return webix.ajax().timeout(1e4).headers({"Content-Type":"application/json"}).put(n,{oferta:e})})).then((function(e){o(e.json())})).catch((function(e){r(e)}))}))},postLineaOferta:function(e){return new webix.promise((function(t,o){n.a.getConfig().then((function(t){var o=t.urlApi+"/api/ofertas/lineas";return webix.ajax().timeout(1e4).headers({"Content-Type":"application/json"}).post(o,{ofertaLinea:e})})).then((function(e){t(e.json())})).catch((function(e){o(e)}))}))},putLineaOferta:function(e,t){return new webix.promise((function(o,r){n.a.getConfig().then((function(o){var n=o.urlApi+"/api/ofertas/lineas/"+t;return webix.ajax().timeout(1e4).headers({"Content-Type":"application/json"}).put(n,{ofertaLinea:e})})).then((function(e){o(e.json())})).catch((function(e){r(e)}))}))},deleteOferta:function(e){return new webix.promise((function(t,o){n.a.getConfig().then((function(t){var o=t.urlApi+"/api/ofertas/"+e;return webix.ajax().timeout(1e4).headers({"Content-Type":"application/json"}).del(o)})).then((function(e){t(e.json())})).catch((function(e){o(e)}))}))},deleteLineaOferta:function(e,t){return new webix.promise((function(o,r){n.a.getConfig().then((function(o){var n=o.urlApi+"/api/ofertas/lineas/"+e;return webix.ajax().timeout(1e4).headers({"Content-Type":"application/json"}).del(n,{ofertaLinea:t})})).then((function(e){o(e.json())})).catch((function(e){r(e)}))}))}}},function(e,t,o){"use strict";o.d(t,"a",(function(){return i}));var n=o(7),r=o(0),i={getUsuarioCookie:function(){var e=n.a.getCookie("usuarioArquitectura");return e?JSON.parse(e):null},setUsuarioCookie:function(e){n.a.setCookie("usuarioArquitectura",JSON.stringify(e),1)},deleteUsuarioCookie:function(e){n.a.deleteCookie("usuarioArquitectura")},getAccesoCookie:function(){var e=n.a.getCookie("loginArquitectura");return e?JSON.parse(e):null},setAccesoCookie:function(e){n.a.setCookie("loginArquitectura",JSON.stringify(e),1e5)},deleteAccesoCookie:function(){n.a.deleteCookie("loginArquitectura")},checkLoggedUser:function(){var e=i.getUsuarioCookie();return e||(window.open("/#!/login","_blank"),window.close(),!1)},getLogin:function(e,t){return new webix.promise((function(o,n){r.a.getConfig().then((function(o){var n=o.urlApi+"/api/usuarios/login",r={usuario:{login:e,password:t}};return webix.ajax().timeout(1e4).headers({"Content-Type":"application/json"}).post(n,r)})).then((function(e){o(e.json())})).catch((function(e){n(e)}))}))},getUsuarios:function(){return new webix.promise((function(e,t){r.a.getConfig().then((function(e){var t=e.urlApi+"/api/usuarios/";return webix.ajax().timeout(1e4).headers({"Content-Type":"application/json"}).get(t)})).then((function(t){e(t.json())})).catch((function(e){t(e)}))}))},getUsuario:function(e){return new webix.promise((function(t,o){r.a.getConfig().then((function(t){var o=t.urlApi+"/api/usuarios/"+e;return webix.ajax().timeout(1e4).headers({"Content-Type":"application/json"}).get(o)})).then((function(e){t(e.json())})).catch((function(e){o(e)}))}))},getDepartamentosAsociados:function(e){return new webix.promise((function(t,o){r.a.getConfig().then((function(t){var o=t.urlApi+"/api/usuarios/departamentos/"+e;return webix.ajax().timeout(1e4).headers({"Content-Type":"application/json"}).get(o)})).then((function(e){t(e.json())})).catch((function(e){o(e)}))}))},postUsuario:function(e){return new webix.promise((function(t,o){r.a.getConfig().then((function(t){var o=t.urlApi+"/api/usuarios/";return webix.ajax().timeout(1e4).headers({"Content-Type":"application/json"}).post(o,{usuario:e})})).then((function(e){t(e.json())})).catch((function(e){o(e)}))}))},postUsuarioDepartamento:function(e){return new webix.promise((function(t,o){r.a.getConfig().then((function(t){var o=t.urlApi+"/api/usuarios/departamento";return webix.ajax().timeout(1e4).headers({"Content-Type":"application/json"}).post(o,{departamento:e})})).then((function(e){t(e.json())})).catch((function(e){o(e)}))}))},putUsuario:function(e){return new webix.promise((function(t,o){r.a.getConfig().then((function(t){var o=t.urlApi+"/api/usuarios/"+e.usuarioId;return webix.ajax().timeout(1e4).headers({"Content-Type":"application/json"}).put(o,{usuario:e})})).then((function(e){t(e.json())})).catch((function(e){o(e)}))}))},putUsuarioDepartamento:function(e,t){return new webix.promise((function(o,n){r.a.getConfig().then((function(o){var n=o.urlApi+"/api/usuarios/departamento/"+e;return webix.ajax().timeout(1e4).headers({"Content-Type":"application/json"}).put(n,{departamento:t})})).then((function(e){o(e.json())})).catch((function(e){n(e)}))}))},deleteUsuario:function(e){return new webix.promise((function(t,o){r.a.getConfig().then((function(t){var o=t.urlApi+"/api/usuarios/"+e;return webix.ajax().timeout(1e4).headers({"Content-Type":"application/json"}).del(o)})).then((function(e){t(e.json())})).catch((function(e){o(e)}))}))},deleteUsuarioDepartamento:function(e){return new webix.promise((function(t,o){r.a.getConfig().then((function(t){var o=t.urlApi+"/api/usuarios/departamento/"+e;return webix.ajax().timeout(1e4).headers({"Content-Type":"application/json"}).del(o)})).then((function(e){t(e.json())})).catch((function(e){o(e)}))}))},prepareDataForCombo:function(){return[{id:1,value:"Usuario"},{id:2,value:"Jefe de Equipo"},{id:3,value:"Vigilante"}]}}},function(e,t,o){"use strict";o.r(t),o.d(t,"languageService",(function(){return i}));var n=o(3),r={es:{groupDelimiter:".",groupSize:3,decimalDelimiter:",",decimalSize:2,dateFormat:"%d/%m/%Y",timeFormat:"%H:%i",longDateFormat:"%d %F %Y",fullDateFormat:"%d.%m.%Y %H:%i",am:null,pm:null,price:"{obj} €",calendar:{monthFull:["Enero","Febrero","Marzo","Abril","Mayo","Junio","Julio","Agosto","Septiembre","Octubre","Noviembre","Diciembre"],monthShort:["En","Feb","Mar","Abr","Mayo","Jun","Jul","Ago","Sep","Oct","Nov","Dic"],dayFull:["Domingo","Lunes","Martes","Miercoles","Jueves","Viernes","Sabado"],dayShort:["Dom","Lun","Mar","Mier","Jue","Vier","Sab"]},hours:"Horas ",minutes:"Minutos",done:"Listo",controls:{select:"Seleccione"}},en:{groupDelimiter:".",groupSize:3,decimalDelimiter:",",decimalSize:2,dateFormat:"%d/%m/%Y",timeFormat:"%H:%i",longDateFormat:"%d %F %Y",fullDateFormat:"%d.%m.%Y %H:%i",am:null,pm:null,price:"{obj} €",calendar:{monthFull:["Enero","Febrero","Marzo","Abril","Mayo","Junio","Julio","Agosto","Septiembre","Octubre","Noviembre","Diciembre"],monthShort:["En","Feb","Mar","Abr","Mayo","Jun","Jul","Ago","Sep","Oct","Nov","Dic"],dayFull:["Domingo","Lunes","Martes","Miercoles","Jueves","Viernes","Sabado"],dayShort:["Dom","Lun","Mar","Mier","Jue","Vier","Sab"]},hours:"Horas ",minutes:"Minutos",done:"Listo",controls:{select:"Seleccione"}},fr:{groupDelimiter:".",groupSize:3,decimalDelimiter:",",decimalSize:2,dateFormat:"%d/%m/%Y",timeFormat:"%H:%i",longDateFormat:"%d %F %Y",fullDateFormat:"%d.%m.%Y %H:%i",am:null,pm:null,price:"{obj} €",calendar:{monthFull:["Enero","Febrero","Marzo","Abril","Mayo","Junio","Julio","Agosto","Septiembre","Octubre","Noviembre","Diciembre"],monthShort:["En","Feb","Mar","Abr","Mayo","Jun","Jul","Ago","Sep","Oct","Nov","Dic"],dayFull:["Domingo","Lunes","Martes","Miercoles","Jueves","Viernes","Sabado"],dayShort:["Dom","Lun","Mar","Mier","Jue","Vier","Sab"]},hours:"Horas ",minutes:"Minutos",done:"Listo",controls:{select:"Seleccione"}}},i={setLanguage:function(e,t){e.use(n.d.Locale,{lang:t}),webix.i18n.locales[t]=r[t],webix.i18n.setLocale(t)}}},function(e,t,o){"use strict";o.d(t,"a",(function(){return n}));var n={areCookiesEnabled:function(){var e=!!navigator.cookieEnabled;return void 0!==navigator.cookieEnabled||e||(document.cookie="testcookie",e=-1!=document.cookie.indexOf("testcookie")),e},setCookie:function(e,t,o){n.areCookiesEnabled()||alert("NO COOKIES");var r=new Date;r.setDate(r.getDate()+o);var i=encodeURI(t)+(null==o?"":"; expires="+r.toUTCString());document.cookie=e+"="+i},deleteCookie:function(e){n.areCookiesEnabled()||alert("NO COOKIES"),document.cookie=e+"=;expires=Thu, 01 Jan 1970 00:00:01 GMT;"},getCookie:function(e){var t,o,n,r=document.cookie.split(";");for(t=0;t<r.length;t++)if(o=r[t].substr(0,r[t].indexOf("=")),n=r[t].substr(r[t].indexOf("=")+1),(o=o.replace(/^\s+|\s+$/g,""))==e)return decodeURI(n)}}},function(e,t,o){"use strict";o.r(t);var n,r=o(3),i=(o(5),o(0));function a(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function s(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}var c=function(e){function t(){return a(this,t),s(this,e.apply(this,arguments))}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(t,e),t.prototype.config=function(){return{view:"window",id:"ofertasEpisReport",position:"top",move:!0,resize:!0,scroll:"x,y",width:1129,height:775,fullscreen:!1,head:{view:"toolbar",cols:[{view:"label",label:(0,this.app.getService("locale")._)("IMPRESIÓN DE OFERTAS")},{view:"icon",icon:"mdi mdi-close",click:function(){$$("ofertasEpisReport").hide()}}]},modal:!0,body:{template:"<div id='report_viewer'></div>"}}},t.prototype.init=function(e,t){i.a.getConfigMysql().then((function(e){n=e})).catch((function(e){fail(e)}))},t.prototype.showWindow=function(e,t,o){$$("ofertasEpisReport").show();var r=new Stimulsoft.Viewer.StiViewerOptions;Stimulsoft.Base.Localization.StiLocalization.setLocalizationFile("../stireport/localization/es.xml",!0),Stimulsoft.Base.StiLicense.key="6vJhGtLLLz2GNviWmUTrhSqnOItdDwjBylQzQcAOiHltN9ZO4D78QwpEoh6+UpBm5mrGyhSAIsuWoljPQdUv6R6vgviStsx8W3jirJvfPH27oRYrC2WIPEmaoAZTNtqb+nDxUpJlSmG62eA46oRJDV8kJ2cJSEx19GMJXYgZvv7yQT9aJHYaSrTVD7wdhpNVS1nQC3OtisVd7MQNQeM40GJxcZpyZDPfvld8mK6VX0RTPJsQZ7UcCEH4Y3LaKzA5DmUS+mwSnjXz/JFv1uO2JNkfcioieXfYfTaBIgZlKecarCS5vBgMrXly3m5kw+YwpJ2v+cMXuDk3UrZgrdxNnOhg8ZHPg9ijHxqUomZZBzKpVQU0d06ne60j/liMH5KirAI2JCVfBcBvIcyliJos8LAWr9q/1sPR9y7LmA1eyS1/dXaxmEaqi5ubhLqlf+OS0xFX6tlBBgegqHlIj6Fytwvq5YlGAZ0Cra05JhnKh/ohYlADQz6Jbg5sOKyn5EbejvPS3tWr0LRBH2FO6+mJaSEAwzGmoWT057ScSvGgQmfx8wCqSF+PgK/zTzjy75Oh",StiOptions.WebServer.url=n.report.stiUrl,r.appearance.scrollbarsMode=!0,r.appearance.fullScreenMode=!1,r.toolbar.showSendEmailButton=!1,r.toolbar.viewMode=Stimulsoft.Viewer.StiWebViewMode.Continuous;var i=new Stimulsoft.Viewer.StiViewer(r,"StiViewer",!1),a=new Stimulsoft.Report.StiReport;a.loadFile(o);n.report.host;n.report.database,n.report.user,n.report.password;for(var s=0;s<a.dataSources.items.length;s++)a.dataSources.items[s].sqlCommand;var c=a.dataSources.items[0].sqlCommand;c=c+" WHERE o.ofertaId = "+e,t&&(c+=" AND p.proveedorId = "+t),a.dataSources.items[0].sqlCommand=c,i.report=a,i.renderHtml("report_viewer")},t.prototype.cancel=function(){$$("ofertasEpisReport").hide()},t}(r.c);t.default=c},function(e,t,o){"use strict";o.r(t);var n=o(3);function r(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function i(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}var a=function(e){function t(){return r(this,t),i(this,e.apply(this,arguments))}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(t,e),t.prototype.config=function(){var e=this.app.getService("locale")._;return{view:"sidebar",width:280,id:"main:menu",activeTitle:!0,select:!0,data:[{id:"inicio",icon:"mdi mdi-home",value:"Inicio"},{id:"gestion",icon:"mdi mdi-book",value:e("Gestión"),open:!0,data:[{id:"ofertas",icon:"mdi mdi-currency-eur",value:e("Ofertas")}]}]}},t.prototype.init=function(){this.use(n.d.Menu,"main:menu")},t}(n.c);t.default=a},function(e,t,o){"use strict";o.r(t);var n=o(3),r=o(5),i=o(6);function a(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function s(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}var c=function(e){function t(){return a(this,t),s(this,e.apply(this,arguments))}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(t,e),t.prototype.config=function(){var e=this,t=this.app,o=(t.getService("locale"),t.getService("theme"),r.a.getUsuarioCookie());this.app.getService("locale");return{view:"toolbar",height:60,elements:[{view:"button",type:"icon",icon:"mdi mdi-menu",width:37,align:"left",click:function(){$$("main:menu").toggle()}},{view:"label",label:"<a href='#!/top/inicio'><img src='assets/img/logo.png' height='50' /></a>",width:150},{view:"button",width:60,label:'<span class="mdi mdi-account-key mdi-36px mystyle"></span>'},{height:46,id:"person_template",css:"header_person",borderless:!0,data:o,template:function(e){var t="<div style='height:100%;width:100%;'>";return t+="<span class='name'>"+e.nombre+"</span> </div>"}},{view:"label",label:"\n\t\t\t\t\t\t<div>\n\t\t\t\t\t\t<img style=\"vertical-align:middle\" src='assets/img/handshake.png' height='35' />\n\t\t\t\t\t\t<span>"+this.app.config.name+"</span>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t",width:200},{view:"button",type:"icon",icon:"mdi mdi-exit-run mdi-36px",width:50,align:"right",tooltip:"Salir",click:function(){r.a.deleteUsuarioCookie(),e.show("/login")}}]}},t.prototype.init=function(){r.a.checkLoggedUser(),i.languageService.setLanguage(this.app,"es")},t}(n.c);t.default=c},function(e,t,o){"use strict";o.r(t);var n=o(3),r=o(5),i=(o(7),o(0)),a=function(){return new webix.promise((function(e,t){i.a.getConfig().then((function(e){var t=e.urlApi+"/api/version";return webix.ajax().timeout(1e4).headers({"Content-Type":"application/json"}).get(t,null)})).then((function(t){e(t.json())})).catch((function(e){t(e)}))}))};function s(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function c(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}var u=function(e){function t(){return s(this,t),c(this,e.apply(this,arguments))}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(t,e),t.prototype.config=function(){var e=this.app;e.getService("locale"),e.getService("theme"),r.a.getUsuarioCookie(),this.app.getService("locale")._;return{view:"label",id:"vers",align:"center",label:"NREG: ",height:60,minWidth:100}},t.prototype.init=function(){a().then((function(e){$$("vers").config.label="Proasistencia "+e.version+" - Aplicación general © Ariadna Software S.L. 2019-2020",$$("vers").refresh()})).catch((function(e){-1!=e.response.indexOf("Cannot delete or update a parent row: a foreign key constraint fails")?messageApi.errorRestriccion():messageApi.errorMessageAjax(e)}))},t}(n.c);t.default=u},function(e,t,o){"use strict";o.r(t);var n=o(3),r=o(0);function i(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function a(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}var s=function(e){function t(){return i(this,t),a(this,e.apply(this,arguments))}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(t,e),t.prototype.config=function(){return{view:"window",id:"imprimirWindow",position:"center",move:!0,resize:!0,fullscreen:!0,head:{view:"toolbar",cols:[{view:"label",label:(0,this.app.getService("locale")._)("IMPRESIÓN DE FACTURAS")},{view:"icon",icon:"mdi mdi-close",click:function(){$$("imprimirWindow").hide()}}]},modal:!0,body:{template:"<div id='report_viewer'></div>"}}},t.prototype.init=function(e,t){r.a.getConfigMysql().then((function(e){myconfig=e})).catch((function(e){fail(e)}))},t.prototype.showWindow=function(e,t){},t.prototype.cancel=function(){$$("imprimirWindow").hide()},t}(n.c);t.default=s},function(e,t,o){"use strict";o.r(t);var n=o(3),r=o(5),i=o(6);function a(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function s(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}var c=function(e){function t(){return a(this,t),s(this,e.apply(this,arguments))}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(t,e),t.prototype.config=function(){this.app.getService("locale")._;return{view:"iframe",id:"frame-body",src:""}},t.prototype.init=function(){r.a.checkLoggedUser(),i.languageService.setLanguage(this.app,"es")},t}(n.c);t.default=c},function(e,t,o){"use strict";o.r(t);var n=o(3),r=o(5),i=o(1),a=o(0);function s(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function c(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}var u=function(e){function t(){return s(this,t),c(this,e.apply(this,arguments))}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(t,e),t.prototype.config=function(){return{view:"layout",css:"loginBack",rows:[{},{cols:[{},{rows:[{view:"form",width:300,css:"round-border",id:"frmLogin",elements:[{view:"label",height:100,align:"center",label:"<img src='assets/img/logo.png'/>"},{view:"label",align:"center",id:"version",label:"VRS"},{view:"text",name:"login",id:"login",required:!0,label:"Usuario",labelPosition:"top"},{view:"text",type:"password",name:"password",id:"password",required:!0,label:"Contraseña",labelPosition:"top"},{view:"checkbox",id:"recordar",name:"recordar",label:"Recordarme en este equipo",labelWidth:200,labelAlign:"left",value:0},{margin:5,cols:[{view:"button",label:"Aceptar",click:this.accept,type:"form",hotkey:"enter"},{view:"button",label:"Cancelar",click:this.cancel,hotkey:"esc"}]}]}]},{}]},{}]}},t.prototype.init=function(){var e;a.a.getVersion().then((function(t){$$("version").data.label="VRS "+t.version,$$("version").refresh(),(e=r.a.getAccesoCookie())&&($$("login").setValue(e.login),$$("password").setValue(e.password),$$("recordar").setValue(1))})).catch((function(e){-1!=e.response.indexOf("Cannot delete or update a parent row: a foreign key constraint fails")?i.a.errorRestriccion():i.a.errorMessageAjax(e)}))},t.prototype.cancel=function(){},t.prototype.accept=function(){var e=this;if($$("frmLogin").validate()){var t=void 0,o=$$("frmLogin").getValues(),n={};r.a.getLogin(o.login,o.password).then((function(i){i&&(t=i,r.a.setUsuarioCookie(t),o.recordar?(n={login:o.login,password:o.password},r.a.setAccesoCookie(n)):r.a.deleteAccesoCookie(),e.$scope.show("top/inicio"))})).catch((function(e){i.a.errorMessageAjax(e.response)}))}else i.a.errorMessage("Debe rellenar los campos correctamente")},t}(n.c);t.default=u},function(e,t,o){"use strict";o.r(t);var n=o(3),r=o(5),i=o(4),a=o(1),s=o(2),c=o(6),u=o(8);function l(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function p(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}var f=function(e){function t(){return l(this,t),p(this,e.apply(this,arguments))}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(t,e),t.prototype.config=function(){var e,t=this,o=this.app.getService("locale")._;return"<span class='onDelete webix_icon wxi-trash'></span> ","<span class='onPrint mdi mdi-printer'></span>",{rows:[{view:"toolbar",padding:3,elements:[{view:"icon",icon:"mdi mdi-file",width:37,align:"left"},{view:"label",label:"Ofertas"}]},{cols:[{view:"button",type:"icon",icon:"wxi-plus",width:37,align:"left",hotkey:"Ctrl+A",tooltip:o("Nuevo registro en formulario (Ctrl+A)"),click:function(){t.show("/top/ofertasForm?ofertaId=0")}},{view:"button",type:"icon",icon:"mdi mdi-refresh",width:37,align:"left",hotkey:"Ctrl+R",tooltip:o("Refrescar la lista (Ctrl+R)"),click:function(){t.cleanAndload()}},{view:"button",type:"icon",icon:"wxi-download",width:37,align:"right",tooltip:o("Descargar como Excel"),click:function(){webix.toExcel($$("ofertasGrid"),{filename:"ofertas",name:"oferta",rawValues:!0,ignore:{actions:!0}})}},{view:"label",id:"ofertasNReg",label:"NREG: "},{view:"pager",id:"mypager1",css:{"text-align":"right"},template:"{common.first()} {common.prev()} {common.pages()} {common.next()} {common.last()}",size:25,group:5}]},((e={view:"datatable",css:{"font-size":"0.9em"},id:"ofertasGrid",scroll:"x,y",pager:"mypager1",select:"row",scheme:{$change:function(e){$$("ofertasGrid").getIndexById(e.id)%2||(e.$css={background:"#E6E7E7"})}},columns:[{id:"ofertaId",header:["Id",{content:"textFilter"}],sort:"int",adjust:"data",hidden:!0},{id:"empresaId",header:["IdEmpresa",{content:"textFilter"}],sort:"int",adjust:"data",hidden:!0},{id:"referencia",header:["Ref.",{content:"textFilter"}],sort:"string",adjust:"data"},{id:"tipo",header:["Tipo.",{content:"textFilter"}],sort:"string",adjust:"data"},{id:"fechaOferta",header:[{text:o("Fecha"),css:{"text-align":"center"}},{content:"dateFilter"}],adjust:"data",sort:"string",format:webix.i18n.dateFormatStr,css:{"text-align":"center"}},{id:"empresa",header:["Empresa",{content:"textFilter"}],sort:"string",adjust:"data"},{id:"cliente",header:["Cliente",{content:"textFilter"}],sort:"string",adjust:"all"},{id:"agente",header:["Agente",{content:"textFilter"}],sort:"string",adjust:"data"},{id:"total",header:["Base",{content:"textFilter"}],sort:"int",format:webix.i18n.numberFormat,adjust:"data"},{id:"observaciones",header:["Observaciones",{content:"textFilter"}],sort:"string",adjust:"all"},{id:"actions",header:[{text:"Acciones",css:{"text-align":"center"}}],template:"<span class='onEdit webix_icon wxi-pencil'></span> <span class='onDelete webix_icon wxi-trash'></span> <span class='onPrint mdi mdi-printer'></span>",css:{"text-align":"center"},adjust:"all"}],rightSplit:1}).scroll=!0,e.onClick={onEdit:function(e,t,o){var n=this.data.pull[t.row];this.$scope.edit(n.ofertaId)},onDelete:function(e,t,o){t=t.row;var n=this.data.pull[t];this.$scope.delete(n.ofertaId)},onPrint:function(e,t,o){var n=this.data.pull[t.row];this.$scope.imprimirWindow.showWindow(n.ofertaId,null,"/stireport/reports/oferta_general.mrt")}},e.editable=!0,e.editaction="dblclick",e.rules={direccionTrabajo:webix.rules.isNotEmpty},e.on={onAfterFilter:function(){webix.storage.local.put("stateGridOfertas",this.getState())}},e)]}},t.prototype.init=function(e,t){this.imprimirWindow=this.ui(u.default),$$("ofertasGrid").attachEvent("onItemDblClick",(function(e,t,o){var n=this.data.pull[e.row];this.$scope.edit(n.ofertaId)}))},t.prototype.urlChange=function(e,t){var o=r.a.checkLoggedUser().usuarioId;c.languageService.setLanguage(this.app,"es"),this.load(o)},t.prototype.load=function(e){var t=this;i.a.getOfertas(e).then((function(e){e||(e=[]),e=t.formateaCampos(e),$$("ofertasGrid").clearAll(),$$("ofertasGrid").parse(s.a.prepareDataForDataTable("ofertaId",e));var o=$$("ofertasGrid").count();$$("ofertasNReg").config.label="NREG: "+o,$$("ofertasNReg").refresh();var n=webix.storage.local.get("stateGridOfertas");n&&t.$$("ofertasGrid").setState(n)})).catch((function(e){-1!=e.response.indexOf("Cannot delete or update a parent row: a foreign key constraint fails")?a.a.errorRestriccion():a.a.errorMessageAjax(e)}))},t.prototype.formateaCampos=function(e){return e.forEach((function(e){e.empresa=e.empresa.substr(0,3),e.fechaOferta=new Date(e.fechaOferta)})),e},t.prototype.cleanAndload=function(){$$("ofertasGrid").eachColumn((function(e,t){if("actions"!=t.id){var o=this.getFilter(e);o&&(o.setValue?o.setValue(""):o.value="")}})),this.load()},t.prototype.edit=function(e){this.show("/top/ofertasForm?ofertaId="+e)},t.prototype.delete=function(e){var t=this;i.a.deleteOferta(e).then((function(e){t.load()})).catch((function(e){a.a.errorMessageAjax(e)}))},t}(n.c);t.default=f},function(e,t,o){"use strict";o.r(t),t.default={template:"Start page",css:"webix_shadow_medium app_start"}},function(e,t,o){"use strict";o.r(t);var n=o(3),r=o(9),i=o(10),a=o(11);function s(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function c(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}var u=function(e){function t(){return s(this,t),c(this,e.apply(this,arguments))}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(t,e),t.prototype.config=function(){return{type:"view",rows:[i.default,{cols:[r.default,{view:"resizer",id:"resizer"},{$subview:!0}]},a.default]}},t.prototype.init=function(){},t}(n.c);t.default=u},function(e,t){},function(e,t,o){"use strict";o.r(t),t.default={Inicio:"Inicio","Nombre usuario":"Nombre usuario","Administración":"Administración",Salir:"Salir","Facturación":"Facturación",Facturas:"Facturas","Refrescar la lista (Ctrl+R)":"Refrescar la lista (Ctrl+R)","Descargar como Excel":"Descargar como Excel",Fecha:"Fecha","IMPRESIÓN DE ENTREGAS":"IMPRESIÓN DE ENTREGAS","IMPRESIÓN DE FACTURAS":"IMPRESIÓN DE FACTURAS",Servicios:"Servicios",Reparaciones:"Reparaciones",Tarifas:"Tarifas","Gestión":"Gestión",Ofertas:"Ofertas"}},function(e,t,o){"use strict";o.r(t),t.default={"Ancient Dashboard":"Ancient Dashboard"}},function(e,t,o){"use strict";o.r(t);var n,r,i,a,s,c,u,l,p,f,d,h,g=o(3),m=o(5),v=o(0),b=function(){return new webix.promise((function(e,t){v.a.getConfig().then((function(e){var t=e.urlApi+"/api/clientes/activos";return webix.ajax().timeout(1e4).headers({"Content-Type":"application/json"}).get(t)})).then((function(t){e(t.json())})).catch((function(e){t(e)}))}))},w=function(e){return new webix.promise((function(t,o){v.a.getConfig().then((function(t){var o=t.urlApi+"/api/clientes/agente/clientes-activos/"+e;return webix.ajax().timeout(1e4).headers({"Content-Type":"application/json"}).get(o)})).then((function(e){t(e.json())})).catch((function(e){o(e)}))}))},$=function(e){return new webix.promise((function(t,o){v.a.getConfig().then((function(t){var o=t.urlApi+"/api/clientes/"+e;return webix.ajax().timeout(1e4).headers({"Content-Type":"application/json"}).get(o)})).then((function(e){t(e.json())})).catch((function(e){o(e)}))}))},y=function(e){return new webix.promise((function(t,o){v.a.getConfig().then((function(t){var o=t.urlApi+"/api/cobros/cliente/"+e;return webix.ajax().timeout(1e4).headers({"Content-Type":"application/json"}).get(o)})).then((function(e){t(e.json())})).catch((function(e){o(e)}))}))},x=function(e,t){return new webix.promise((function(o,n){v.a.getConfig().then((function(o){var n=o.urlApi+"/api/clientes/tarifa/por/articuloId/"+e+"/"+t;return webix.ajax().timeout(1e4).headers({"Content-Type":"application/json"}).get(n)})).then((function(e){o(e.json())})).catch((function(e){n(e)}))}))},C=o(1),j=o(2),P=function(){return new webix.promise((function(e,t){v.a.getConfig().then((function(e){var t=e.urlApi+"/api/comerciales/agentes/activos";return webix.ajax().timeout(1e4).headers({"Content-Type":"application/json"}).get(t)})).then((function(t){e(t.json())})).catch((function(e){t(e)}))}))},_=function(e){return new webix.promise((function(t,o){v.a.getConfig().then((function(t){var o=t.urlApi+"/api/comerciales/agente/cliente/"+e;return webix.ajax().timeout(1e4).headers({"Content-Type":"application/json"}).get(o)})).then((function(e){t(e.json())})).catch((function(e){o(e)}))}))},A=o(4),I=function(e){return new webix.promise((function(t,o){v.a.getConfig().then((function(t){var o=t.urlApi+"/api/tipos_proyectos/departamento/"+e+"/5";return webix.ajax().timeout(1e4).headers({"Content-Type":"application/json"}).get(o)})).then((function(e){t(e.json())})).catch((function(e){o(e)}))}))},O=function(e){return new webix.promise((function(t,o){v.a.getConfig().then((function(t){var o=t.urlApi+"/api/tipos_proyectos/"+e;return webix.ajax().timeout(1e4).headers({"Content-Type":"application/json"}).get(o)})).then((function(e){t(e.json())})).catch((function(e){o(e)}))}))},E=o(6),S=function(){return new webix.promise((function(e,t){v.a.getConfig().then((function(e){var t=e.urlApi+"/api/empresas";return webix.ajax().timeout(1e4).headers({"Content-Type":"application/json"}).get(t)})).then((function(t){e(t.json())})).catch((function(e){t(e)}))}))},V=function(){return new webix.promise((function(e,t){v.a.getConfig().then((function(e){var t=e.urlApi+"/api/formas_pago";return webix.ajax().timeout(1e4).headers({"Content-Type":"application/json"}).get(t)})).then((function(t){e(t.json())})).catch((function(e){t(e)}))}))},T=function(){return new webix.promise((function(e,t){v.a.getConfig().then((function(e){var t=e.urlApi+"/api/tipos_iva";return webix.ajax().timeout(1e4).headers({"Content-Type":"application/json"}).get(t)})).then((function(t){e(t.json())})).catch((function(e){t(e)}))}))},F=function(e){return new webix.promise((function(t,o){v.a.getConfig().then((function(t){var o=t.urlApi+"/api/tipos_iva/"+e;return webix.ajax().timeout(1e4).headers({"Content-Type":"application/json"}).get(o)})).then((function(e){t(e.json())})).catch((function(e){o(e)}))}))},L=function(){return new webix.promise((function(e,t){v.a.getConfig().then((function(e){var t=e.urlApi+"/api/unidades/";return webix.ajax().timeout(1e4).headers({"Content-Type":"application/json"}).get(t)})).then((function(t){e(t.json())})).catch((function(e){t(e)}))}))},k=function(){return new webix.promise((function(e,t){v.a.getConfig().then((function(e){var t=e.urlApi+"/api/proveedores";return webix.ajax().timeout(1e4).headers({"Content-Type":"application/json"}).get(t)})).then((function(t){e(t.json())})).catch((function(e){t(e)}))}))},R=function(e){return new webix.promise((function(t,o){v.a.getConfig().then((function(t){var o=t.urlApi+"/api/proveedores/"+e;return webix.ajax().timeout(1e4).headers({"Content-Type":"application/json"}).get(o)})).then((function(e){t(e.json())})).catch((function(e){o(e)}))}))},D=function(e,t){return new webix.promise((function(o,n){v.a.getConfig().then((function(o){var n=o.urlApi+"/api/proveedores/tarifa/por/articuloId/"+e+"/"+t;return webix.ajax().timeout(1e4).headers({"Content-Type":"application/json"}).get(n)})).then((function(e){o(e.json())})).catch((function(e){n(e)}))}))},N=function(e,t){return e&&""!=e||(e=0),new webix.promise((function(o,n){v.a.getConfig().then((function(o){var n=o.urlApi+"/api/tarifas_proveedor/articulos/proveedor/"+t+"/"+e;return webix.ajax().timeout(1e4).headers({"Content-Type":"application/json"}).get(n)})).then((function(e){o(e.json())})).catch((function(e){n(e)}))}))},M=function(){return new webix.promise((function(e,t){v.a.getConfig().then((function(e){var t=e.urlApi+"/api/tipos_profesional";return webix.ajax().timeout(1e4).headers({"Content-Type":"application/json"}).get(t)})).then((function(t){e(t.json())})).catch((function(e){t(e)}))}))},G=function(e){return new webix.promise((function(t,o){v.a.getConfig().then((function(t){var o=t.urlApi+"/api/tipos_profesional/tarifa/"+e;return webix.ajax().timeout(1e4).headers({"Content-Type":"application/json"}).get(o)})).then((function(e){t(e.json())})).catch((function(e){o(e)}))}))},U=function(){return new webix.promise((function(e,t){v.a.getConfig().then((function(e){var t=e.urlApi+"/api/articulos/";return webix.ajax().timeout(1e4).headers({"Content-Type":"application/json"}).get(t)})).then((function(t){e(t.json())})).catch((function(e){t(e)}))}))},W=function(e){return new webix.promise((function(t,o){v.a.getConfig().then((function(t){var o=t.urlApi+"/api/articulos/grupo/"+e;return webix.ajax().timeout(1e4).headers({"Content-Type":"application/json"}).get(o)})).then((function(e){t(e.json())})).catch((function(e){o(e)}))}))},q=function(e){return new webix.promise((function(t,o){v.a.getConfig().then((function(t){var o=t.urlApi+"/api/articulos/"+e;return webix.ajax().timeout(1e4).headers({"Content-Type":"application/json"}).get(o)})).then((function(e){t(e.json())})).catch((function(e){o(e)}))}))},z=function(){return new webix.promise((function(e,t){v.a.getConfig().then((function(e){var t=e.urlApi+"/api/grupo_articulo/departamento/5";return webix.ajax().timeout(1e4).headers({"Content-Type":"application/json"}).get(t)})).then((function(t){e(t.json())})).catch((function(e){t(e)}))}))},J=function(e){return new webix.promise((function(t,o){v.a.getConfig().then((function(t){var o=t.urlApi+"/api/grupo_articulo/"+e;return webix.ajax().timeout(1e4).headers({"Content-Type":"application/json"}).get(o)})).then((function(e){t(e.json())})).catch((function(e){o(e)}))}))},B=function(e,t,o){return new webix.promise((function(n,r){v.a.getConfig().then((function(n){var r=n.urlApi+"/api/articulos/tarifas/cliente/proveedor/"+e+"/"+t+"/"+o;return webix.ajax().timeout(1e4).headers({"Content-Type":"application/json"}).get(r)})).then((function(e){n(e.json())})).catch((function(e){r(e)}))}))},H=!1,K={getGridTarifasWindow:function(e){var t;if(!H){var o=e.getService("locale")._,i={rows:[{cols:[{view:"combo",id:"cmbTiposProf",name:"tipoProfesionalId",options:{},label:"Tipo profesional",labelPosition:"top",width:200,on:{onChange:function(e,t){var o=e;(o||""!=o)&&K.loadGridTarifas(n,r,o)}}},{minWidth:240},{view:"text",id:"tarifaClienteNombre",value:0,name:"tarifaClienteNombre",minWidth:100,disabled:!0},{view:"text",id:"tarifaProveedorNombre",value:0,name:"tarifaProveedorNombre",minWidth:100,disabled:!0}]}]},a={rows:[{view:"toolbar",padding:3,elements:[{view:"icon",icon:"mdi mdi-archive",width:37,align:"left"},{view:"label",label:"Tarifas"}]},{cols:[{view:"button",type:"icon",icon:"mdi mdi-refresh",width:37,align:"left",hotkey:"Ctrl+R",tooltip:o("Refrescar la lista (Ctrl+R)"),click:function(){K.cleanAndload()}},{view:"button",type:"icon",icon:"wxi-download",width:37,align:"right",tooltip:o("Descargar como Excel"),click:function(){webix.toExcel($$("tarifasGrid"),{filename:"tarifas",name:"tarifas",rawValues:!0,ignore:{actions:!0}})}},{view:"label",id:"TarifasNReg",label:"NREG: "},{view:"pager",id:"mypagerTarifas",css:{"text-align":"right"},template:"{common.first()} {common.prev()} {common.pages()} {common.next()} {common.last()}",size:25,group:5}]},i,((t={view:"datatable",css:{"font-size":"0.9em","font-weight":"bold"},height:550,id:"tarifasGrid",scroll:"x,y",pager:"mypagerTarifas",select:"row",columns:[{id:"articuloId",header:["Id",{content:"textFilter"}],sort:"int",width:50,hidden:!0},{id:"codigoReparacion",header:["Codigo reparación",{content:"textFilter"}],sort:"string",width:60},{id:"abrev",header:["Unidad",{content:"textFilter"}],sort:"string",width:50},{id:"nombre",header:["Nombre",{content:"textFilter"}],sort:"string",width:350},{id:"precioCliente",header:["Precio cli",{content:"textFilter"}],sort:"int",format:webix.i18n.numberFormat,width:110},{id:"precioProveedor",header:["Precio pro.",{content:"textFilter"}],sort:"int",format:webix.i18n.numberFormat,width:110}]}).scroll=!0,t.on={onItemDblClick:function(e,t,o){this.data.pull[e.row];$$("tarifasGridWindow").hide()}},t.onClick={onEdit:function(e,t,o){this.data.pull[t.row]}},t.editable=!0,t.editaction="dblclick",t.rules={},t)]};webix.ui({view:"window",id:"tarifasGridWindow",position:"center",move:!0,resize:!1,width:690,height:690,head:{view:"toolbar",cols:[{},{view:"icon",icon:"mdi mdi-close",click:function(){$$("tarifasGridWindow").hide()}}]},modal:!0,body:a}),H=!0}},loadWindow:function(e,t,o){n=e,r=t,$$("tarifasGridWindow").show(),K.loadTiposProfesionales(o),K.loadGridTarifas(n,r,o)},loadGridTarifas:function(e,t,o){o&&""!=o||(o=0),B(e,t,o).then((function(e){var t;if(!(e.length>0)){$$("tarifasGrid").clearAll();var o=$$("tarifasGrid").count();return $$("TarifasNReg").config.label="NREG: "+o,void $$("TarifasNReg").refresh()}t=K.formateaData(e),$$("tarifasGrid").clearAll(),$$("tarifasGrid").parse(j.a.prepareDataForDataTable("articuloId",t));o=$$("tarifasGrid").count();$$("TarifasNReg").config.label="NREG: "+o,$$("TarifasNReg").refresh()})).catch((function(e){-1!=e.response.indexOf("Cannot delete or update a parent row: a foreign key constraint fails")?C.a.errorRestriccion():C.a.errorMessageAjax(e)}))},formateaData:function(e){var t=[];return $$("tarifaClienteNombre").setValue(e[0].tarifaClienteNombre),$$("tarifaProveedorNombre").setValue(e[0].tarifaProveedorNombre),e.forEach((function(e){delete e.tarifaClienteId,delete e.tarifaClienteNombre,delete e.tarifaProveedorNombre,delete e.tarifaProveedorId,t.push(e)})),t},loadTiposProfesionales:function(e){M().then((function(t){t.splice(0,0,{tipoProfesionalId:0,nombre:""});var o=j.a.prepareDataForCombo("tipoProfesionalId","nombre",t),n=$$("cmbTiposProf").getPopup().getList();n.clearAll(),n.parse(o),e?($$("cmbTiposProf").setValue(e),$$("cmbTiposProf").refresh()):($$("cmbTiposProf").setValue(null),$$("cmbTiposProf").refresh())}))},cleanAndload:function(){$$("tarifasGrid").eachColumn((function(e,t){if("actions"!=t.id){var o=this.getFilter(e);o&&(o.setValue?o.setValue(""):o.value="")}})),this.load()}},Y=!1,Z=null,Q={getWindow:function(e){var t,o;if(!Y){K.getGridTarifasWindow(e),i=e.getService("locale")._;var n=((o={view:"form",id:"LineasOfertafrm",scroll:"y"}).scroll=!0,o.elements=[{template:"Linea del oferta",type:"section"},{view:"fieldset",label:"GENERAL",id:"general",body:{rows:[{rows:[{cols:[{view:"text",id:"capituloLinea",name:"capituloLinea",required:!0,label:"Texto del capitulo",labelPosition:"top",disabled:!0}]},{cols:[{view:"text",id:"linea",name:"linea",required:!0,label:"Linea",labelPosition:"top",width:80},{view:"combo",id:"cmbGrupoArticulo",name:"grupoArticuloId",required:!0,options:{},label:"Capítulo",labelPosition:"top",minwidth:250},{view:"combo",id:"cmbArticulos",name:"articuloId",minwidth:200,label:"Unidad constructiva",labelPosition:"top",options:{filter:function(e,t){var o=e.id;return-1!==e.value.toLowerCase().indexOf(t)||o==t}}},(t={view:"combo",id:"cmbUnidades",name:"unidadId",options:{},label:"Unidades",labelPosition:"top",width:120},t.width=150,t),{view:"text",id:"cantidad",name:"cantidad",required:!0,label:"Cantidad",labelPosition:"top",width:100}]},{cols:[{view:"textarea",id:"descripcion",name:"descripcion",label:"Descripción",labelPosition:"top",height:170}]}]}]}},{view:"fieldset",label:"CLIENTE",id:"cliente",body:{rows:[{cols:[{view:"combo",id:"cmbTiposIvaCliente",name:"tipoIvaId",required:!0,options:{},label:"IVA",labelPosition:"top",width:180},{view:"text",id:"porcentaje",name:"porcentaje",label:"Porcentaje",labelPosition:"top",minwidth:80,format:"1.00",hidden:!0},{view:"text",id:"importeCliente",name:"importe",label:"coste/ud",labelPosition:"top",minwidth:80,format:"1.00"},{view:"text",id:"perdto",name:"perdto",label:"% Descuento",labelPosition:"top",minwidth:80,format:"1,00"}]},{cols:[{view:"text",id:"precioCliente",value:0,name:"precio",required:!0,label:"Precio",labelPosition:"top",minWidth:100,format:"1,00",disabled:!0},{view:"text",id:"dto",value:0,name:"dto",required:!0,disabled:!0,label:"Importe descuento",labelPosition:"top",minWidth:100,format:"1.00"},{view:"text",id:"coste",name:"coste",disabled:!0,label:"total coste",labelPosition:"top",minwidth:80,format:"1,00"}]}]}},{view:"fieldset",label:"PROVEEDOR",id:"proveedor",body:{rows:[{cols:[{view:"combo",id:"cmbProveedores",name:"proveedorId",label:"Proveedor (empezar busquedas con @)",labelPosition:"top",width:350,suggest:{view:"mentionsuggest",id:"proveedoresList",data:[]}},{view:"combo",id:"cmbTiposIvaProveedor",name:"tipoIvaProveedorId",options:{},label:"IVA",labelPosition:"top",minWidth:80},{view:"text",id:"porcentajeProveedor",name:"porcentajeProveedor",label:"Porcentaje Proveedor",labelPosition:"top",minwidth:80,format:"1.00",hidden:!0},{view:"text",id:"importeProveedor",name:"importeProveedor",label:"coste/ud",labelPosition:"top",minwidth:80,format:"1.00"},{view:"text",id:"perdtoProveedor",name:"perdtoProveedor",label:"% Descuento",labelPosition:"top",minwidth:80,format:"1.00"}]},{cols:[{view:"text",id:"precioProveedor",value:0,name:"precioProveedor",label:"Precio",labelPosition:"top",minWidth:100,format:"1,00",disabled:!0},{view:"text",id:"dtoProveedor",value:0,name:"dtoProveedor",disabled:!0,required:!0,label:"Importe descuento",labelPosition:"top",minWidth:100,format:"1.00"},{view:"text",id:"costeLineaProveedor",name:"costeLineaProveedor",label:"total coste",labelPosition:"top",minwidth:80,format:"1,00",disabled:!0},{view:"text",id:"totalLineaProveedorIva",name:"totalLineaProveedorIva",hidden:!0,label:"total con iva",labelPosition:"top",minwidth:80,format:"1,00",disabled:!0}]}]}},{margin:5,cols:[{gravity:5},{view:"button",id:"btnCancelarWindowLineaOferta",label:i("Cancelar"),click:Q.cancel,hotkey:"esc"},{view:"button",id:"btnAceptarWindowLineaOferta",label:i("Aceptar"),click:Q.accept,type:"form"}]}],o);webix.ui({view:"window",id:"lineasOfertaWindow",position:"top",move:!0,resize:!0,width:1100,height:700,head:{view:"toolbar",cols:[{},{view:"icon",icon:"mdi mdi-close",click:function(){$$("lineasOfertaWindow").hide()}}]},modal:!0,body:n}),Y=!0,$$("cmbGrupoArticulo").attachEvent("onChange",(function(e,t){""!=e&&(Q.loadArticulos(e,null),Q.crearTextoDeCapituloAutomatico(e))})),$$("cmbArticulos").attachEvent("onChange",(function(e,t){e&&""!=e&&Q.cambioArticulo(e)})),$$("cantidad").attachEvent("onFocus",(function(e,t){$$("cantidad").setValue(""),$$("precioCliente").setValue(0),$$("precioProveedor").setValue(0),$$("coste").setValue(0)})),$$("cantidad").attachEvent("onBlur",(function(e,t){var o=$$("cantidad").getValue(),n=$$("importeProveedor").getValue(),r=$$("importeCliente").getValue(),i=$$("porcentajeProveedor").getValue();if(""!=r){r=parseFloat(r);var a=parseFloat(o*r);$$("precioCliente").setValue(parseFloat(a));var s=$$("dto").getValue();""!=s||s>0?(s=parseFloat(s),$$("coste").setValue(a-s)):$$("coste").setValue(a)}if(""!=n){n=parseFloat(n);var c=parseFloat(o*n);$$("precioProveedor").setValue(c);var u=$$("dtoProveedor").getValue();if(""!=u||u>0?(u=parseFloat(u),$$("costeLineaProveedor").setValue(c-u)):$$("costeLineaProveedor").setValue(c),null!==i){var l=$$("costeLineaProveedor").getValue(),p=l+l*(i/100);$$("totalLineaProveedorIva").setValue(parseFloat(p))}}})),$$("importeProveedor").attachEvent("onChange",(function(e,t){var o=parseFloat(e),n=$$("cantidad").getValue(),r=$$("porcentajeProveedor").getValue();if(""!=n)n=parseFloat(n);if(""!=n){var i=parseFloat(n*o);$$("precioProveedor").setValue(i);var a=$$("dtoProveedor").getValue();if(""!=a||a>0?(a=parseFloat(a),$$("costeLineaProveedor").setValue(i-a)):$$("costeLineaProveedor").setValue(i),null!==r){var s=$$("costeLineaProveedor").getValue(),c=s+s*(r/100);$$("totalLineaProveedorIva").setValue(parseFloat(c))}}})),$$("importeCliente").attachEvent("onChange",(function(e,t){""==e&&(e=0);var o=parseFloat(e);if(""!=(n=$$("cantidad").getValue()))var n=parseFloat(n);if(""!=n){var r=parseFloat(n*o);$$("precioCliente").setValue(parseFloat(r));var i=$$("dto").getValue();""!=i||i>0?(i=parseFloat(i),$$("coste").setValue(r-i)):$$("coste").setValue(r)}})),$$("cmbTiposIvaCliente").attachEvent("onChange",(function(e,t){""!=e&&Q.cambioTipoIva(e)})),$$("cmbTiposIvaProveedor").attachEvent("onChange",(function(e,t){""!=e&&Q.cambioTipoIvaProveedor(e)})),$$("perdto").attachEvent("onBlur",(function(e,t){var o=$$("perdto").getValue(),n=$$("precioCliente").getValue();if((o>0||""!=o)&&(n>0||""!=n)){o=parseFloat(o),n=parseFloat(n),o/=100;var r=parseFloat(n*o);$$("dto").setValue(r);var i=parseFloat(n-r);$$("coste").setValue(i)}})),$$("proveedoresList").attachEvent("onValueSuggest",(function(e){e&&(Q.recuperaTarifaProveedor(e.id),Q.recuperaIvaProveedor(e.id))})),$$("perdtoProveedor").attachEvent("onBlur",(function(e,t){var o=$$("perdtoProveedor").getValue(),n=$$("precioProveedor").getValue(),r=$$("porcentajeProveedor").getValue();if((o>0||""!=o)&&(n>0||""!=n)){o=parseFloat(o),n=parseFloat(n),o/=100;var i=parseFloat(n*o);$$("dtoProveedor").setValue(i);var a=parseFloat(n-i);if($$("costeLineaProveedor").setValue(a),null!==r){var s=$$("costeLineaProveedor").getValue(),c=s+s*(r/100);$$("totalLineaProveedorIva").setValue(parseFloat(c))}}}))}},loadWindow:function(e,t,o){l=null,0,a=e,s=t,u=o,$$("lineasOfertaWindow").show(),s?Q.bloqueaEventos():Q.limpiaWindow()},limpiaWindow:function(){$$("porcentaje").setValue(0),$$("porcentajeProveedor").setValue(0),$$("importeCliente").setValue(0),$$("perdto").setValue(0),$$("dto").setValue(0),$$("coste").setValue(0),$$("precioCliente").setValue(0),$$("importeProveedor").setValue(0),$$("precioProveedor").setValue(0),$$("perdto").setValue(0),$$("dto").setValue(0),$$("perdtoProveedor").setValue(0),$$("dtoProveedor").setValue(0),$$("costeLineaProveedor").setValue(0),$$("totalLineaProveedorIva").setValue(0),$$("descripcion").setValue(""),Q.loadProveedores(null),Q.loadGruposArticulo(null,null),Q.loadUnidades(null),Q.loadTiposIvaCliente(null),Q.loadTiposIvaProveedor(null),Q.nuevaLinea()},crearTextoDeCapituloAutomatico:function(e){var t="Capitulo "+Math.floor($$("linea").getValue())+": ";J(e).then((function(e){$$("capituloLinea").getValue()!=(t+=e.nombre)&&$$("capituloLinea").setValue(t)})).catch((function(e){C.a.errorMessageAjax(e)}))},nuevaLinea:function(){A.a.getSiguienteLinea(a).then((function(e){e&&$$("linea").setValue(e)})).catch((function(e){C.a.errorMessageAjax(e)}))},bloqueaEventos:function(){$$("cmbTiposIvaCliente").blockEvent(),$$("cmbTiposIvaProveedor").blockEvent(),$$("importeProveedor").blockEvent(),$$("importeCliente").blockEvent(),$$("cmbArticulos").blockEvent(),$$("cmbGrupoArticulo").blockEvent(),A.a.getLineaOferta(s).then((function(e){var t=e[0];$$("LineasOfertafrm").clear(),$$("LineasOfertafrm").setValues(t),Q.loadProveedores(t.proveedorId),Q.loadUnidades(t.unidadId),Q.loadTiposIvaCliente(t.tipoIvaId),Q.loadTiposIvaProveedor(t.tipoIvaProveedorId),Q.recuperaCapituloId(t.articuloId)})).catch((function(e){C.a.errorMessageAjax(e)}))},recuperaCapituloId:function(e){q(e).then((function(t){t&&Q.loadGruposArticulo(t.grupoArticuloId,e)})).catch((function(e){C.a.errorMessageAjax(e)}))},desbloqueaEventos:function(){$$("cmbTiposIvaCliente").unblockEvent(),$$("cmbTiposIvaProveedor").unblockEvent(),$$("importeProveedor").unblockEvent(),$$("importeCliente").unblockEvent(),$$("cmbArticulos").unblockEvent(),$$("cmbGrupoArticulo").unblockEvent()},accept:function(){$$("LineasOfertafrm").validate()?Q.enviaDatos():C.a.errorMessage("Debe rellenar los campos correctamente")},enviaDatos:function(){var e=$$("LineasOfertafrm").getValues();""==(e=Q.formateaDatos(e)).proveedorId&&(e.proveedorId=null),""==e.tipoIvaProveedorId&&(e.tipoIvaProveedorId=null),e.ofertaLineaId?A.a.putLineaOferta(e,e.ofertaLineaId).then((function(e){$$("lineasOfertaWindow").hide(),Q.refreshGridCloseWindow(a)})).catch((function(e){-1!=e.response.indexOf("Cannot delete or update a parent row: a foreign key constraint fails")?C.a.errorRestriccion():C.a.errorMessageAjax(e)})):(e.ofertaLineaId=0,A.a.postLineaOferta(e).then((function(e){$$("lineasOfertaWindow").hide(),Q.refreshGridCloseWindow(a)})).catch((function(e){C.a.errorMessageAjax(e)})))},formateaDatos:function(e){return delete e.unidades,delete e.grupoArticuloId,e.ofertaId=a,e.totalLinea=$$("coste").getValue(),e.totalLineaProveedor=$$("costeLineaProveedor").getValue(),e.porcentajeBeneficio=0,e.porcentajeAgente=0,e},preparaDatos:function(e){return delete e.cmbDescripcion,delete e.tipoProfesionalId,e.descripcion=$$("descripcion").getValue(),e},updateFacprove:function(e,t){facturacionService.putLineaFacprove(e,t).then((function(e){})).catch((function(e){-1!=e.response.indexOf("Cannot delete or update a parent row: a foreign key constraint fails")?C.a.errorRestriccion():C.a.errorMessageAjax(e)}))},updateFactura:function(e){e.clienteId=$$("cliId").getValue(),facturacionService.putLineaFactura(e).then((function(e){})).catch((function(e){-1!=e.response.indexOf("Cannot delete or update a parent row: a foreign key constraint fails")?C.a.errorRestriccion():C.a.errorMessageAjax(e)}))},cancel:function(){$$("lineasOfertaWindow").hide()},refreshGridCloseWindow:function(e){e&&(Q.refreshLineas(e),Q.refreshBases(e),Q.refreshProveedoresOferta(e))},refreshLineas:function(e){A.a.getLineasOferta(e).then((function(e){var t=0;if(null!=e||e.length>0){$$("lineasOfertaGrid").clearAll(),$$("lineasOfertaGrid").parse(j.a.prepareDataForDataTable("ofertaLineaId",e));var o=$$("lineasOfertaGrid").count();$$("ofertasLineasNReg").config.label="NREG: "+o,$$("ofertasLineasNReg").refresh(),$$("lineasOfertaWindow").hide();for(var n=0;n<e.length;n++)t+=e[n].totalLinea,$$("importeCli").setValue(t)}else $$("lineasOfertaWindow").hide(),$$("importeCli").setValue(t)})).catch((function(e){C.a.errorMessageAjax(e)}))},refreshBases:function(e){A.a.getBasesOferta(e).then((function(e){if(e.length>0){$$("basesOfertaGrid").clearAll(),$$("basesOfertaGrid").parse(j.a.prepareDataForDataTable("ofertaBaseId",e));var t=$$("basesOfertaGrid").count();$$("basesLineasNReg").config.label="NREG: "+t,$$("basesLineasNReg").refresh()}else $$("basesOfertaGrid").clearAll()})).catch((function(e){C.a.errorMessageAjax(e)}))},refreshProveedoresOferta:function(e){A.a.getProveedoresOferta(e).then((function(e){if(e.length>0){for(var t=0;t<e.length;t++)null==e[t].proveedorId&&(e[t].proveedorId=0,e[t].proveedornombre="Sin proveedor asignado",e[t].totalProveedorIva=e[t].totalLinea);$$("proveedoresOfertaGrid").clearAll(),$$("proveedoresOfertaGrid").parse(j.a.prepareDataForDataTable("proveedorId",e));var o=$$("proveedoresOfertaGrid").count();$$("poeveedoresNReg").config.label="NREG: "+o,$$("poeveedoresNReg").refresh()}else $$("proveedoresOfertaGrid").clearAll()})).catch((function(e){C.a.errorMessageAjax(e)}))},loadCodigosArticulos:function(e,t){var o;$$("tarifas").show(),o=t||$$("cmbTipoProfesionales2").getValue(),N(o,$$("cmbProveedores").getValue()).then((function(t){0==t.length&&(C.a.errorMessage("No existe ningúna tarifa asociada a este proveedor."),$$("tarifas").hide()),!l&&t.length>0&&(l=t[0].tarifaProveedorId,Q.loadTiposProfesionales(o));for(var n=0;n<t.length;n++)t[n].codigoReparacion||(t.splice(n,1),n=0);for(n=0;n<t.length;n++)t[n].codigoReparacion||(t.splice(n,1),n=0);for(n=0;n<t.length;n++)t[n].porceIva||(t[n].porceIva=0);c=t;var r=j.a.prepareDataForCombo("codigoReparacion","codigoReparacion",t),i=$$("cmbCodigo").getPopup().getList();i.clearAll(),i.parse(r),e?($$("cmbCodigo").setValue(e),$$("cmbCodigo").refresh(),Q.loadCmbDescripcion(e)):Q.loadCmbDescripcion(null)}))},loadCmbDescripcion:function(e){var t=$$("descripcion").getValue(),o=j.a.prepareDataForCombo("codigoReparacion","nombre",c),n=$$("cmbDescripcion").getPopup().getList();$$("descripcion").getValue();n.clearAll(),n.parse(o),e&&($$("cmbDescripcion").setValue(e),$$("cmbDescripcion").refresh(),(Z&&Z!=e||""==t)&&$$("descripcion").setValue($$("cmbDescripcion").getText()),Z=e)},loadTiposIvaCliente:function(e){T().then((function(t){var o=j.a.prepareDataForCombo("tipoIvaId","nombre",t);o.push({id:null,value:""});var n=$$("cmbTiposIvaCliente").getPopup().getList();n.clearAll(),n.parse(o),$$("cmbTiposIvaCliente").setValue(e),$$("cmbTiposIvaCliente").refresh()}))},loadTiposIvaProveedor:function(e){T().then((function(t){var o=j.a.prepareDataForCombo("tipoIvaId","nombre",t),n=$$("cmbTiposIvaProveedor").getPopup().getList();n.clearAll(),n.parse(o),$$("cmbTiposIvaProveedor").setValue(e),$$("cmbTiposIvaProveedor").refresh()}))},loadGruposArticulo:function(e,t){z().then((function(o){var n=j.a.prepareDataForCombo("grupoArticuloId","nombre",o),r=$$("cmbGrupoArticulo").getPopup().getList();r.clearAll(),r.parse(n),$$("cmbGrupoArticulo").setValue(e),$$("cmbGrupoArticulo").refresh(),Q.loadArticulos(e,t)}))},loadArticulos:function(e,t){e?W(e).then((function(e){if(e){var o=j.a.prepareDataForCombo("articuloId","nombre",e),n=$$("cmbArticulos").getPopup().getList();n.clearAll(),n.parse(o),$$("cmbArticulos").setValue(t),$$("cmbArticulos").refresh(),setTimeout(Q.desbloqueaEventos,1e3)}})):U().then((function(e){if(e){var o=j.a.prepareDataForCombo("articuloId","nombre",e),n=$$("cmbArticulos").getPopup().getList();n.clearAll(),n.parse(o),$$("cmbArticulos").setValue(t),$$("cmbArticulos").refresh(),setTimeout(Q.desbloqueaEventos,1e3)}}))},loadUnidades:function(e){L().then((function(t){var o=j.a.prepareDataForCombo("unidadId","abrev",t),n=$$("cmbUnidades").getPopup().getList();n.clearAll(),n.parse(o),$$("cmbUnidades").setValue(e),$$("cmbUnidades").refresh()}))},loadProveedores:function(e){k().then((function(t){var o=j.a.prepareDataForCombo("proveedorId","nombre",t),n=$$("cmbProveedores").getList();if(n.clearAll(),n.parse(o),e)return $$("cmbProveedores").setValue(e),void $$("cmbProveedores").refresh();$$("cmbProveedores").setValue(null),$$("cmbProveedores").refresh()}))},cambioArticulo:function(e){q(e).then((function(e){e&&($$("cmbUnidades").setValue(e.unidadId),$$("cmbUnidades").refresh(),$$("descripcion").setValue(e.descripcion),$$("cantidad").setValue(1),Q.recuperaTarifaCliente(),Q.recuperaIvaCliente())})).catch((function(e){C.a.errorMessageAjax(e)}))},cambioTipoIva:function(e){F(e).then((function(e){e&&$$("porcentaje").setValue(e.porcentaje)}))},cambioTipoIvaProveedor:function(e){F(e).then((function(e){if(e&&($$("porcentajeProveedor").setValue(e.porcentaje),null!==e.porcentaje)){var t=$$("costeLineaProveedor").getValue(),o=t+t*(e.porcentaje/100);$$("totalLineaProveedorIva").setValue(parseFloat(o))}}))},recuperaIvaCliente:function(){var e=this,t=$$("cmbClientes").getValue();$(t).then((function(t){t.tipoIvaId?e.loadTiposIvaCliente(t.tipoIvaId):e.loadTiposIvaCliente(3)})).catch((function(e){-1!=e.response.indexOf("Cannot delete or update a parent row: a foreign key constraint fails")?C.a.errorRestriccion():C.a.errorMessageAjax(e)}))},recuperaIvaProveedor:function(e){var t=this;R(e).then((function(e){e.tipoIvaId?t.loadTiposIvaProveedor(e.tipoIvaId):t.loadTiposIvaProveedor(3)})).catch((function(e){-1!=e.response.indexOf("Cannot delete or update a parent row: a foreign key constraint fails")?C.a.errorRestriccion():C.a.errorMessageAjax(e)}))},recuperaTarifaCliente:function(){x($$("cmbClientes").getValue(),$$("cmbArticulos").getValue()).then((function(e){if(e.length>0){$$("importeCliente").setValue(e[0].precioCliente);var t=$$("cantidad").getValue();if(""!=t){var o=parseFloat($$("importeCliente").getValue());$$("importeCliente").setValue(parseFloat(o)),$$("precioCliente").setValue(parseFloat(t*o)),$$("coste").setValue(parseFloat(t*o))}}0==e.length&&$$("importeCliente").setValue(0)})).catch((function(e){-1!=e.response.indexOf("Cannot delete or update a parent row: a foreign key constraint fails")?C.a.errorRestriccion():C.a.errorMessageAjax(e)}))},recuperaTarifaProveedor:function(e){var t=$$("cmbArticulos").getValue();D(e,t).then((function(e){if(e.length>0){$$("importeProveedor").setValue(e[0].precioProveedor);var t=$$("cantidad").getValue();if(""!=t){var o=parseFloat($$("precioProveedor").getValue()),n=parseFloat(t*o);$$("importeProveedor").setValue(parseFloat(o)),$$("precioProveedor").setValue(parseFloat(n)),$$("costeLineaProveedor").setValue(parseFloat(n))}}0==e.length&&$$("precioProveedor").setValue(0)})).catch((function(e){-1!=e.response.indexOf("Cannot delete or update a parent row: a foreign key constraint fails")?C.a.errorRestriccion():C.a.errorMessageAjax(e)}))},loadTiposProfesionales:function(e){G(l).then((function(t){var o=j.a.prepareDataForCombo("tipoProfesionalId","nombre",t),n=$$("cmbTipoProfesionales2").getPopup().getList();n.clearAll(),n.parse(o),e&&($$("cmbTipoProfesionales2").setValue(e),$$("cmbTipoProfesionales2").refresh())}))},muestraVentanaTarifas:function(){var e=$$("cmbTipoProfesionales2").getValue();K.loadWindow(u,void 0,e)}},X=o(8),ee=function(e){var t=e.getService("locale")._;return{view:"layout",id:"poeveedoresDelaOferta",rows:[{view:"toolbar",padding:3,elements:[{view:"icon",icon:"mdi mdi-folder-network-outline",width:37,align:"left"},{view:"label",label:t("Lineas de la oferta")}]},{cols:[{view:"label",id:"poeveedoresNReg",label:"NREG: "},{view:"pager",id:"mypager2",css:{"text-align":"right"},template:"{common.first()} {common.prev()} {common.pages()} {common.next()} {common.last()}",size:25,group:5}]},{view:"datatable",scroll:"x",id:"proveedoresOfertaGrid",pager:"mypager2",select:"row",autoheight:!0,footer:!1,columns:[{id:"proveedorId",header:[t("Id"),{content:"textFilter"}],sort:"string",width:50,hidden:!0},{id:"proveedornombre",header:[t("Proveedor"),{content:"textFilter"}],sort:"string",fillspace:!0},{id:"totalProveedor",header:[t("Base"),{content:"textFilter"}],sort:"string",width:80,format:webix.i18n.numberFormat},{id:"totalProveedorIva",header:[t("Total"),{content:"textFilter"}],sort:"string",width:100,format:webix.i18n.numberFormat},{id:"actions",header:[{text:"Acciones",css:{"text-align":"center"}}],css:{"text-align":"center"},adjust:"all",hidden:!1,template:function(e){return null==e.proveedorId?"":"<span class='onPrint mdi mdi-printer'></span>"}}],onClick:{onDelete:function(e,t,o){},onEdit:function(e,t,o){},onPrint:function(e,t,o){var n=this.data.pull[t.row];f.showWindow(n.ofertaId,n.proveedorId,"/stireport/reports/oferta_general_proveedores.mrt")}},editable:!0,editaction:"dblclick",rules:{},on:{onAfterEditStart:function(e){},onAfterEditStop:function(e,t,o){}}}]}},te=function(e,t){var o;t&&(f=t);for(var n=$$("proveedoresOfertaGrid").config.columns,r=0;r<n.length;r++)3==r&&(n[r].hidden||(o=n[r].hidden));(p=e)?A.a.getProveedoresOferta(p).then((function(e){if(e){for(var t=0;t<e.length;t++)null==e[t].proveedorId&&(e[t].proveedornombre="Sin proveedor asignado",e[t].totalProveedorIva=e[t].totalLinea);1!=e.length||null!=e[0].proveedorId||o||$$("proveedoresOfertaGrid").hideColumn("actions"),$$("proveedoresOfertaGrid").clearAll(),$$("proveedoresOfertaGrid").parse(j.a.prepareDataForDataTable("proveedorId",e));var n=$$("proveedoresOfertaGrid").count();$$("poeveedoresNReg").config.label="NREG: "+n,$$("poeveedoresNReg").refresh()}else $$("proveedoresOfertaGrid").clearAll()})).catch((function(e){C.a.errorMessageAjax(e)})):$$("proveedoresOfertaGrid").clearAll()},oe={getGrid:function(e){var t=e.getService("locale")._;try{Q.getWindow(e)}catch(e){console.log(e)}return"<span class='onDelete webix_icon wxi-trash'></span>",{view:"layout",id:"lineasDelOferta",rows:[{view:"toolbar",padding:3,elements:[{view:"icon",icon:"mdi mdi-folder-network-outline",width:37,align:"left"},{view:"label",label:t("Lineas de la oferta")}]},{cols:[{view:"button",id:"btnNew3",type:"icon",icon:"wxi-plus",width:37,align:"left",hotkey:"Ctrl+A",tooltip:t("Nuevo registro en formulario (Ctrl+A)"),click:function(){if(d)try{var e=$$("cmbClientes").getValue();Q.loadWindow(d,null,e,null)}catch(e){console.log(e)}else C.a.errorMessage(t("Debe dar de alta el oferta antes las lineas"))}},{view:"label",id:"ofertasLineasNReg",label:"NREG: "},{view:"pager",id:"mypager3",css:{"text-align":"right"},template:"{common.first()} {common.prev()} {common.pages()} {common.next()} {common.last()}",size:25,group:5}]},{view:"datatable",scroll:"x",id:"lineasOfertaGrid",pager:"mypager3",select:"row",autoheight:!0,footer:!1,ready:function(){$$("lineasOfertaGrid").attachEvent("onItemDblClick",(function(e,t,o){var n=this.data.pull[e.row],r=$$("cmbClientes").getValue();Q.loadWindow(n.ofertaId,n.ofertaLineaId,r)}))},columns:[{id:"ofertaLineaId",header:[t("Id"),{content:"textFilter"}],sort:"string",width:50,hidden:!0},{id:"ofertaId",header:[t("Id"),{content:"textFilter"}],sort:"string",width:50,hidden:!0},{id:"linea",header:[t("Linea"),{content:"textFilter"}],sort:"string",width:80},{id:"unidades",header:[t("Uds."),{content:"textFilter"}],sort:"string",width:40},{id:"descripcion",header:[t("Concepto"),{content:"textFilter"}],sort:"string",fillspace:!0},{id:"importe",header:[t("€/Ud. Cli."),{content:"textFilter"}],sort:"string",width:80,format:webix.i18n.numberFormat},{id:"cantidad",header:[t("Cantidad"),{content:"textFilter"}],sort:"string",width:50},{id:"dto",header:[t("Descuento"),{content:"textFilter"}],sort:"string",width:100,format:webix.i18n.numberFormat},{id:"costeLinea",header:[t("Imp cli."),{content:"textFilter"}],sort:"string",width:80,format:webix.i18n.numberFormat},{id:"proveedorId",header:[t("Id"),{content:"textFilter"}],sort:"string",width:50,hidden:!0},{id:"proveedorNombre",header:[t("Proveedor"),{content:"textFilter"}],sort:"string",fillspace:!0},{id:"importeProveedor",header:[t("€/Ud. Pro."),{content:"textFilter"}],sort:"string",width:80,format:webix.i18n.numberFormat},{id:"dtoProveedor",header:[t("Descuento pro."),{content:"textFilter"}],sort:"string",width:100,format:webix.i18n.numberFormat},{id:"costeLineaProveedor",header:[t("Imp pro."),{content:"textFilter"}],sort:"string",width:80,format:webix.i18n.numberFormat},{id:"actions",header:[{text:t("Acciones"),css:{"text-align":"center"}}],template:"<span class='onEdit webix_icon wxi-pencil'></span><span class='onDelete webix_icon wxi-trash'></span>",css:{"text-align":"center"}}],rightSplit:1,onClick:{onDelete:function(t,o,n){o=o.row;var r=this.data.pull[o];oe.delete(o,r,e)},onEdit:function(e,t,o){this.data.pull[t.row],$$("proveedorId").getValue(),$$("cliId").getValue()}},editable:!0,editaction:"dblclick",rules:{},on:{onAfterEditStart:function(e){},onAfterEditStop:function(e,t,o){},onAfterFilter:function(){var e=$$("lineasOfertaGrid").count();$$("ofertasLineasNReg").config.label="NREG: "+e,$$("ofertasLineasNReg").refresh()}}}]}},loadGrid:function(e,t){t,0,(d=e)?A.a.getLineasOferta(d).then((function(e){var t=0;if(e.length>0){$$("lineasOfertaGrid").clearAll(),$$("lineasOfertaGrid").parse(j.a.prepareDataForDataTable("ofertaLineaId",e));var o=$$("lineasOfertaGrid").count();$$("ofertasLineasNReg").config.label="NREG: "+o,$$("ofertasLineasNReg").refresh();for(var n=0;n<e.length;n++)t+=e[n].totalLinea,$$("importeCli").setValue(t)}else $$("lineasOfertaGrid").clearAll(),$$("importeCli").setValue(t)})).catch((function(e){C.a.errorMessageAjax(e)})):$$("lineasOfertaGrid").clearAll()},delete:function(e,t,o){var n=o.getService("locale")._;webix.confirm({title:n("AVISO"),text:n("Está seguro que desea eliminar la linea "),type:"confirm-warning",callback:function(o){!0===o&&A.a.deleteLineaOferta(e,t).then((function(e){oe.loadGrid(d),te(d,null)})).catch((function(e){C.a.errorMessageAjax(e)}))}})},disparaEvento:function(){},estableceContado:function(e){setTimeout((function(){var t=0;if(e){for(var o=0;o<e.length;o++)t+=e[o].aCuentaProveedor;$$("aCuentaProfesional").setValue(t)}else $$("aCuentaProfesional").setValue(t)}),300)}},ne=function(e){var t=e.getService("locale")._;return{view:"layout",id:"basesOferta",rows:[{view:"toolbar",padding:3,elements:[{view:"icon",icon:"mdi mdi-folder-network-outline",width:37,align:"left"},{view:"label",label:t("Bases de la oferta")}]},{cols:[{view:"label",id:"basesLineasNReg",label:"NREG: "},{view:"pager",id:"mypager",css:{"text-align":"right"},template:"{common.first()} {common.prev()} {common.pages()} {common.next()} {common.last()}",size:25,group:5}]},{view:"datatable",id:"basesOfertaGrid",pager:"mypager",select:"row",autoheight:!0,footer:!1,columns:[{id:"ofertaBaseId",header:[t("Id"),{content:"textFilter"}],sort:"string",width:50,hidden:!0},{id:"tipoIvaId",header:[t("Id"),{content:"textFilter"}],sort:"string",width:50,hidden:!0},{id:"tipo",header:[t("Tipo"),{content:"textFilter"}],sort:"string",minWidth:180},{id:"porcentaje",header:[t("Porcentaje"),{content:"textFilter"}],sort:"string",minWidth:140},{id:"base",header:[t("Base"),{content:"textFilter"}],sort:"string",minWidth:380,format:webix.i18n.numberFormat},{id:"cuota",header:[t("Cuota"),{content:"textFilter"}],sort:"string",fillspace:!0,format:webix.i18n.numberFormat}],onClick:{onDelete:function(e,t,o){},onEdit:function(e,t,o){}},editable:!1,rules:{},on:{onAfterEditStart:function(e){},onAfterEditStop:function(e,t,o){},onAfterFilter:function(){var e=$$("basesOfertaGrid").count();$$("basesLineasNReg").config.label="NREG: "+e,$$("basesLineasNReg").refresh()}}}]}},re=function(e){(h=e)?A.a.getBasesOferta(h).then((function(e){if(e.length>0){$$("basesOfertaGrid").clearAll(),$$("basesOfertaGrid").parse(j.a.prepareDataForDataTable("ofertaBaseId",e));var t=$$("basesOfertaGrid").count();$$("basesLineasNReg").config.label="NREG: "+t,$$("basesLineasNReg").refresh()}else $$("basesOfertaGrid").clearAll()})).catch((function(e){C.a.errorMessageAjax(e)})):$$("basesOfertaGrid").clearAll()};function ie(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function ae(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}var se,ce,ue,le=0,pe=0,fe=0,de=function(e){function t(){return ie(this,t),ae(this,e.apply(this,arguments))}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(t,e),t.prototype.config=function(){this.app.getService("locale")._;var e=oe.getGrid(this.app),t=ee(this.app),o=ne(this.app);return{view:"tabview",cells:[{header:"Oferta",body:{view:"layout",id:"ofertasForm",multiview:!0,rows:[{view:"toolbar",padding:3,elements:[{view:"icon",icon:"mdi mdi-currency-eur",width:37,align:"left"},{view:"label",label:"Ofertas"}]},{view:"form",scroll:"y",id:"frmOfertas",maxWidth:1500,autoheight:!0,elements:[{cols:[{view:"text",id:"ofertaId",name:"ofertaId",hidden:!0,label:"ID",labelPosition:"top",width:50,disabled:!0},{view:"text",id:"referencia",name:"referencia",required:!0,label:"Referencia",labelPosition:"top",width:250},{view:"combo",id:"cmbEmpresas",name:"empresaId",required:!0,options:{},label:"Empresa",labelPosition:"top",width:250},{view:"datepicker",id:"fechaOferta",name:"fechaOferta",width:150,label:"Fecha de Solicitud",labelPosition:"top",required:!0},{view:"combo",id:"cmbTiposProyecto",name:"tipoProyectoId",required:!0,label:"Tipo proyecto",labelPosition:"top",options:{}}]},{cols:[{view:"combo",id:"cmbClientes",name:"clienteId",required:!0,label:"Cliente (empezar busquedas con @)",labelPosition:"top",suggest:{view:"mentionsuggest",id:"clientesList",data:[]}},{minWidth:200},{view:"combo",id:"cmbAgentes",name:"agenteId",required:!0,label:"Agente (empezar busquedas con @)",labelPosition:"top",suggest:{view:"mentionsuggest",id:"agentesList",data:[]}}]},{cols:[{view:"combo",id:"cmbFormasPago",name:"formaPagoId",required:!0,options:{},label:"Forma de pago",labelPosition:"top",minWidth:250},{view:"text",id:"importeCli",name:"importeCliente",disabled:!0,width:180,label:"Importe cliente",labelPosition:"top",value:0,format:"1,00"}]},{cols:[{view:"textarea",id:"observaciones",name:"observaciones",label:"Observaciones",labelPosition:"top",height:140},{rows:[{padding:50,cols:[{view:"button",label:"Cancelar",click:this.cancel,hotkey:"esc"},{view:"button",label:"Aceptar",click:this.accept,type:"form"}]}]}]},e,{minWidth:100},o]}],scroll:!0}},{header:"Lineas proveedores",body:{view:"layout",id:"proveedoresGrid",multiview:!0,rows:[t,{minheight:500}]}}]}},t.prototype.init=function(e,t){ue=this.ui(X.default),this.cargarEventos()},t.prototype.urlChange=function(e,t){t[0].params.NEW&&C.a.normalMessage("Oferta correctamente, puede crear ahora las  lineas asociadas."),ce=m.a.checkLoggedUser(),se=ce.usuarioId,E.languageService.setLanguage(this.app,"es"),t[0].params.ofertaId&&(le=t[0].params.ofertaId),this.cargarEventos(),this.load(le)},t.prototype.load=function(e){var t=this;if(0==e)return this.loadEmpresas(),this.loadAgentes(),this.loadClientes(),this.loadFormasPago(),this.loadTiposProyecto(),$$("fechaOferta").setValue(new Date),oe.loadGrid(null,null),re(null),void te(null,null);A.a.getOferta(e).then((function(e){$$("cmbTiposProyecto").blockEvent(),delete e.empresa,delete e.cliente,delete e.tipo,delete e.mantenedor,delete e.agente,delete e.formaPago,e.fechaOferta=new Date(e.fechaOferta),$$("frmOfertas").setValues(e),t.loadAgentes(e.agenteId),t.loadEmpresas(e.empresaId),t.loadClientesAgente(e.clienteId,e.agenteId),t.loadTiposProyecto(e.tipoProyectoId),oe.loadGrid(e.ofertaId,ue),re(e.ofertaId),te(e.ofertaId,ue),t.loadFormasPago(e.formaPagoId),$$("cmbTiposProyecto").unblockEvent()})).catch((function(e){C.a.errorMessageAjax(e)}))},t.prototype.cargarEventos=function(){var e=this;$$("clientesList").attachEvent("onValueSuggest",(function(t){e.loadAgenteCliente(t.id),e.loadClienteData(t.id)})),$$("agentesList").attachEvent("onValueSuggest",(function(t){e.loadClientesAgente(null,t.id)})),$$("cmbTiposProyecto").attachEvent("onChange",(function(t,o){""!=t&&t&&e.cambioTipoProyecto(t)}))},t.prototype.cancel=function(){this.$scope.show("/top/ofertas")},t.prototype.accept=function(){var e=this;if($$("frmOfertas").validate()){var t=$$("frmOfertas").getValues();0==le?(t.ofertaId=0,t.tipoOfertaId=5,t.coste=0,t.porcentajeBeneficio=0,t.importeBeneficio=0,t.ventaNeta=0,t.porcentajeAgente=0,t.importeAgente=0,t.importeCliente=0,t.importeMantenedor=0,t.mantenedorId=null,A.a.postOferta(t).then((function(t){e.$scope.show("/top/ofertasForm?ofertaId="+t.ofertaId+"&NEW")})).catch((function(e){-1!=e.response.indexOf("Cannot delete or update a parent row: a foreign key constraint fails")?C.a.errorRestriccion():C.a.errorMessageAjax(e)}))):(t.porcentajeBeneficio=0,t.importeBeneficio=0,t.porcentajeAgente=0,t.importeAgente=0,t.importeMantenedor=0,A.a.putOferta(t,t.ofertaId).then((function(){e.$scope.show("/top/ofertas?ofertaId="+t.ofertaId)})).catch((function(e){-1!=e.response.indexOf("Cannot delete or update a parent row: a foreign key constraint fails")?C.a.errorRestriccion():C.a.errorMessageAjax(e)})))}else C.a.errorMessage("Debe rellenar los campos correctamente")},t.prototype.loadEmpresas=function(e){S().then((function(t){var o=j.a.prepareDataForCombo("empresaId","nombre",t),n=$$("cmbEmpresas").getPopup().getList();n.clearAll(),n.parse(o),e?($$("cmbEmpresas").setValue(e),$$("cmbEmpresas").refresh()):($$("cmbEmpresas").setValue(2),$$("cmbEmpresas").refresh())}))},t.prototype.loadAgentes=function(e,t){P().then((function(t){var o=j.a.prepareDataForCombo("comercialId","nombre",t),n=$$("agentesList").getList();n.clearAll(),n.parse(o),e&&($$("cmbAgentes").setValue(e),$$("cmbAgentes").refresh())}))},t.prototype.loadClientesAgente=function(e,t){t&&w(t).then((function(t){var o=j.a.prepareDataForCombo("clienteId","nombre",t),n=$$("clientesList").getList();n.clearAll(),n.parse(o),e?($$("cmbClientes").setValue(e),$$("cmbClientes").refresh()):($$("cmbClientes").setValue(null),$$("cmbClientes").refresh())}))},t.prototype.loadClientes=function(){b().then((function(e){var t=j.a.prepareDataForCombo("clienteId","nombre",e);t.sort((function(e,t){return e.value>t.value?1:e.value<t.value?-1:0}));var o=$$("clientesList").getList();o.clearAll(),o.parse(t),$$("cmbClientes").setValue(null),$$("cmbClientes").refresh()}))},t.prototype.loadClienteData=function(e){e&&$(e).then((function(e){$$("cmbFormasPago").setValue(e.formaPagoId),$$("cmbFormasPago").refresh()}))},t.prototype.cambioTipoProyecto=function(e){var t=this;O(e).then((function(e){e&&A.a.getSiguienteReferencia(e.abrev).then((function(e){var o=e;t.$$("referencia").setValue(o)})).catch((function(e){C.a.errorMessageAjax(e)}))})).catch((function(e){C.a.errorMessageAjax(e)}))},t.prototype.loadFormasPago=function(e){V().then((function(t){var o=j.a.prepareDataForCombo("formaPagoId","nombre",t),n=$$("cmbFormasPago").getPopup().getList();n.clearAll(),n.parse(o),$$("cmbFormasPago").setValue(e),$$("cmbFormasPago").refresh()})).catch((function(e){C.a.errorMessageAjax(e)}))},t.prototype.loadTiposProfesionales=function(e){tiposProfesionalService.getTiposProfesional().then((function(t){var o=j.a.prepareDataForCombo("tipoProfesionalId","nombre",t),n=$$("cmbTiposProfesional").getPopup().getList();n.clearAll(),n.parse(o),e&&($$("cmbTiposProfesional").setValue(e),$$("cmbTiposProfesional").refresh())}))},t.prototype.loadTiposProyecto=function(e){I(se).then((function(e){var t=j.a.prepareDataForCombo("tipoProyectoId","nombre",e),o=$$("cmbTiposProyecto").getPopup().getList();o.clearAll(),o.parse(t),tiposProyectoId&&($$("cmbTiposProyecto").setValue(tiposProyectoId),$$("cmbTiposProyecto").refresh())}))},t.prototype.loadAgenteCliente=function(e){var t=this;e&&_(e).then((function(o){t.loadAgentes(o[0].comercialId,e)}))},t.prototype.loadUsuarios=function(e){m.a.getUsuarios().then((function(t){var o=j.a.prepareDataForCombo("usuarioId","nombre",t),n=$$("cmbUsuarios").getPopup().getList();n.clearAll(),n.parse(o),e?($$("cmbUsuarios").setValue(e),$$("cmbUsuarios").refresh()):($$("cmbUsuarios").setValue(null),$$("cmbUsuarios").refresh())}))},t.prototype.loadNumero=function(){A.a.getNumServicio().then((function(e){$$("numServicio").setValue(e)})).catch((function(e){-1!=e.response.indexOf("Cannot delete or update a parent row: a foreign key constraint fails")?C.a.errorRestriccion():C.a.errorMessageAjax(e)}))},t.prototype.compruebaCobrosCliente=function(e){$(e).then((function(t){t&&y(e).then((function(e){pe=t.limiteCredito,e.forEach((function(e){e.seguro||(fe+=parseFloat(e.impvenci))})),fe>pe&&C.a.normalMessage("ATENCION!!!, este cliente ha superado su limete de credito")})).catch((function(e){C.a.errorMessageAjax(e)}))})).catch((function(e){}))},t}(g.c);t.default=de},function(e,t,o){"use strict";o.r(t);var n=o(3),r=new webix.DataCollection({data:[{id:1,title:"The Shawshank Redemption",year:1994,votes:678790,rating:9.2,rank:1},{id:2,title:"The Godfather",year:1972,votes:511495,rating:9.2,rank:2},{id:3,title:"The Godfather: Part II",year:1974,votes:319352,rating:9,rank:3},{id:4,title:"The Good, the Bad and the Ugly",year:1966,votes:213030,rating:8.9,rank:4},{id:5,title:"My Fair Lady",year:1964,votes:533848,rating:8.9,rank:5},{id:6,title:"12 Angry Men",year:1957,votes:164558,rating:8.9,rank:6}]});function i(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function a(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}var s=function(e){function t(){return i(this,t),a(this,e.apply(this,arguments))}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(t,e),t.prototype.config=function(){return{view:"datatable",autoConfig:!0,css:"webix_shadow_medium"}},t.prototype.init=function(e){e.parse(r)},t}(n.c);t.default=s},function(e,t,o){"use strict";o.r(t);o(24);var n=o(3),r=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var o=arguments[t];for(var n in o)Object.prototype.hasOwnProperty.call(o,n)&&(e[n]=o[n])}return e};var i=function(e){function t(o){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t);var i={id:"webix-jet-app",version:"1.1.0",router:n.a,debug:!1,start:"/login"};return function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}(this,e.call(this,r({},i,o)))}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(t,e),t}(n.b);t.default=i,webix.ready((function(){var e=new i;webix.i18n.setLocale("es-ES"),e.render()}))},function(e,t,o){},function(e,t,o){var n={"./data":22,"./data.js":22,"./imprimirWindow":12,"./imprimirWindow.js":12,"./inicio":13,"./inicio.js":13,"./login":14,"./login.js":14,"./mainFooter":11,"./mainFooter.js":11,"./mainMenu":9,"./mainMenu.js":9,"./mainToolbar":10,"./mainToolbar.js":10,"./ofertas":15,"./ofertas.js":15,"./ofertasEpisReport":8,"./ofertasEpisReport.js":8,"./ofertasForm":21,"./ofertasForm.js":21,"./start":16,"./start.js":16,"./top":17,"./top.js":17};function r(e){var t=i(e);return o(t)}function i(e){if(!o.o(n,e)){var t=new Error("Cannot find module '"+e+"'");throw t.code="MODULE_NOT_FOUND",t}return n[e]}r.keys=function(){return Object.keys(n)},r.resolve=i,e.exports=r,r.id=25},function(e,t,o){var n={"./en":18,"./en.js":18,"./es":19,"./es.js":19,"./fr.":20,"./fr..js":20,"./language_service":6,"./language_service.js":6};function r(e){var t=i(e);return o(t)}function i(e){if(!o.o(n,e)){var t=new Error("Cannot find module '"+e+"'");throw t.code="MODULE_NOT_FOUND",t}return n[e]}r.keys=function(){return Object.keys(n)},r.resolve=i,e.exports=r,r.id=26}]);